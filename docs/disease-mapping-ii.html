<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 5 Disease Mapping II | EPI 563: Spatial Epidemiology, Fall 2020</title>
  <meta name="description" content="Week 5 Disease Mapping II | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 5 Disease Mapping II | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="mkram01/EPI563-SpatialEPI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 5 Disease Mapping II | EPI 563: Spatial Epidemiology, Fall 2020" />
  
  
  

<meta name="author" content="Michael Kramer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="disease-mapping-i.html"/>
<link rel="next" href="disease-mapping-iii.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>How to use this eBook</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#strategy-for-using-this-ebook"><i class="fa fa-check"></i>Strategy for using this eBook</a></li>
</ul></li>
<li class="part"><span><b>I Getting readyâ€¦</b></span></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a>
<ul>
<li><a href="software-installation.html#installing-r-on-your-computer">Installing <code>R</code> on your computer</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#installing-rstudio-on-your-computer"><i class="fa fa-check"></i>Installing RStudio on your computer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html"><i class="fa fa-check"></i>Installing packages for this course</a>
<ul>
<li><a href="installing-packages-for-this-course.html#installing-rtools40">Installing <code>Rtools40</code></a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-general-data-science"><i class="fa fa-check"></i>Installing packages used for general data science</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-use-for-geographic-data"><i class="fa fa-check"></i>Installing packages use for geographic data</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-data-manipulation-visualization"><i class="fa fa-check"></i>Installing packages used for spatial data manipulation &amp; visualization</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-analysis"><i class="fa fa-check"></i>Installing packages used for spatial analysis</a></li>
</ul></li>
<li class="part"><span><b>II Weekly Modules</b></span></li>
<li class="chapter" data-level="1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html"><i class="fa fa-check"></i><b>1</b> Locating Spatial Epidemiology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>1.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#learning-objectives"><i class="fa fa-check"></i><b>1.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i><b>1.1.2</b> Additional Resources</a></li>
<li class="chapter" data-level="1.1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#important-vocabulary"><i class="fa fa-check"></i><b>1.1.3</b> Important Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>1.2</b> Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>1.3</b> Spatial Analysis in Epidemiology</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-data-storage-foramts"><i class="fa fa-check"></i><b>1.3.1</b> Spatial data storage foramts</a></li>
<li class="chapter" data-level="1.3.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#representing-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.2</b> Representing spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#benefits-of-sf-data-classes"><i class="fa fa-check"></i><b>1.3.3</b> Benefits of <code>sf</code> data classes</a></li>
<li class="chapter" data-level="1.3.4" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.4</b> Working with spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#basic-visual-inspectionplots"><i class="fa fa-check"></i><b>1.3.5</b> Basic visual inspection/plots</a></li>
<li class="chapter" data-level="1.3.6" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-crs-and-projection"><i class="fa fa-check"></i><b>1.3.6</b> Working with CRS and projection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html"><i class="fa fa-check"></i><b>2</b> Cartography for Epidemiology I</a>
<ul>
<li class="chapter" data-level="2.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>2.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#learning-objectives-w2"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives, w2</a></li>
<li class="chapter" data-level="2.1.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#additional-resources-w2"><i class="fa fa-check"></i><b>2.1.2</b> Additional Resources, w2</a></li>
<li class="chapter" data-level="2.1.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#important-vocabulary-w2"><i class="fa fa-check"></i><b>2.1.3</b> Important Vocabulary, w2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-thinking-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.2</b> Spatial Thinking in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#color-choices"><i class="fa fa-check"></i><b>2.2.1</b> Color choices</a></li>
<li class="chapter" data-level="2.2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#choropleth-binning-styles"><i class="fa fa-check"></i><b>2.2.2</b> Choropleth binning styles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-analysis-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.3</b> Spatial Analysis in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-numerator-data"><i class="fa fa-check"></i><b>2.3.1</b> Obtaining and preparing numerator data</a></li>
<li class="chapter" data-level="2.3.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-denominator-or-contextual-data"><i class="fa fa-check"></i><b>2.3.2</b> Obtaining and preparing denominator or contextual data</a></li>
<li class="chapter" data-level="2.3.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-geographic-data"><i class="fa fa-check"></i><b>2.3.3</b> Obtaining and preparing geographic data</a></li>
<li class="chapter" data-level="2.3.4" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#merging-attributes-and-geography"><i class="fa fa-check"></i><b>2.3.4</b> Merging Attributes and Geography</a></li>
<li class="chapter" data-level="2.3.5" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#mapping-mortality-uninsured"><i class="fa fa-check"></i><b>2.3.5</b> Mapping Mortality &amp; Uninsured</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html"><i class="fa fa-check"></i><b>3</b> Cartography for Epidemiology II</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#learning-objectives-w3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives, w3</a></li>
<li class="chapter" data-level="3.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#additional-resources-w3"><i class="fa fa-check"></i><b>3.2</b> Additional resources, w3</a></li>
<li class="chapter" data-level="3.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#important-vocabulary-w3"><i class="fa fa-check"></i><b>3.3</b> Important Vocabulary, w3</a></li>
<li class="chapter" data-level="3.4" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#spatial-thinking-in-epidemiology-w3"><i class="fa fa-check"></i><b>3.4</b> Spatial Thinking in Epidemiology, w3</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risks-of-privacy-breaches-in-collection-of-geospatial-information"><i class="fa fa-check"></i><b>3.4.1</b> Risks of privacy breaches in collection of geospatial information</a></li>
<li class="chapter" data-level="3.4.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-confidentiality-breaches-through-unintentional-de-identification"><i class="fa fa-check"></i><b>3.4.2</b> Risk of confidentiality breaches through unintentional de-identification</a></li>
<li class="chapter" data-level="3.4.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-stigmatization-of-place"><i class="fa fa-check"></i><b>3.4.3</b> Risk of stigmatization of place</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html"><i class="fa fa-check"></i><b>4</b> Disease Mapping I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#getting-ready-w4"><i class="fa fa-check"></i><b>4.1</b> Getting ready, w4</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#learning-objectives-w4"><i class="fa fa-check"></i><b>4.1.1</b> Learning objectives, w4</a></li>
<li class="chapter" data-level="4.1.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#additional-resources-w4"><i class="fa fa-check"></i><b>4.1.2</b> Additional Resources, w4</a></li>
<li class="chapter" data-level="4.1.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#important-vocabulary-w4"><i class="fa fa-check"></i><b>4.1.3</b> Important Vocabulary, w4</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-thinking-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.2</b> Spatial Thinking in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#why-do-we-need-disease-mapping"><i class="fa fa-check"></i><b>4.2.1</b> Why do we need disease mapping?</a></li>
<li class="chapter" data-level="4.2.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#using-statistics-and-probability-models-to-improve-disease-mapping"><i class="fa fa-check"></i><b>4.2.2</b> Using statistics and probability models to improve disease mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-analysis-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.3</b> Spatial Analysis in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-is-there-spatial-heterogeneity"><i class="fa fa-check"></i><b>4.3.1</b> Disease mapping: Is there spatial heterogeneity?</a></li>
<li class="chapter" data-level="4.3.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-how-precise-are-county-estimates"><i class="fa fa-check"></i><b>4.3.2</b> Disease mapping: How precise are county estimates?</a></li>
<li class="chapter" data-level="4.3.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-adjusting-for-covariates"><i class="fa fa-check"></i><b>4.3.3</b> Disease mapping: Adjusting for covariates</a></li>
<li class="chapter" data-level="4.3.4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-rate-stabilization-with-global-empirical-bayes"><i class="fa fa-check"></i><b>4.3.4</b> Disease mapping: Rate stabilization with global Empirical Bayes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html"><i class="fa fa-check"></i><b>5</b> Disease Mapping II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#getting-ready-w5"><i class="fa fa-check"></i><b>5.1</b> Getting Ready, w5</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#w5-learning-objectives"><i class="fa fa-check"></i><b>5.1.1</b> w5 Learning objectives</a></li>
<li class="chapter" data-level="5.1.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#additional-resources-w5"><i class="fa fa-check"></i><b>5.1.2</b> Additional Resources, w5</a></li>
<li class="chapter" data-level="5.1.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#important-vocabulary-w5"><i class="fa fa-check"></i><b>5.1.3</b> Important Vocabulary, w5</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-thinking-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.2</b> Spatial Thinking in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#an-argument-for-the-relevance-of-space"><i class="fa fa-check"></i><b>5.2.1</b> An argument for the relevance of space</a></li>
<li class="chapter" data-level="5.2.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#on-making-meaning-from-neighbors"><i class="fa fa-check"></i><b>5.2.2</b> On making meaning from neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-analysis-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.3</b> Spatial Analysis in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-contiguity-neighbor-objects"><i class="fa fa-check"></i><b>5.3.1</b> Creating contiguity neighbor objects</a></li>
<li class="chapter" data-level="5.3.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-k-nearest-neighbors"><i class="fa fa-check"></i><b>5.3.2</b> Creating k-nearest neighbors</a></li>
<li class="chapter" data-level="5.3.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-graph-based-triangle-neighbor-objects"><i class="fa fa-check"></i><b>5.3.3</b> Creating Graph-based triangle neighbor objects</a></li>
<li class="chapter" data-level="5.3.4" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-fixed-distance-neighbors"><i class="fa fa-check"></i><b>5.3.4</b> Creating fixed-distance neighbors</a></li>
<li class="chapter" data-level="5.3.5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#from-spatial-neighbors-to-spatial-disease-mapping"><i class="fa fa-check"></i><b>5.3.5</b> From spatial neighbors to spatial Disease Mapping</a></li>
<li class="chapter" data-level="5.3.6" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-empirical-bayes"><i class="fa fa-check"></i><b>5.3.6</b> Spatial Empirical Bayes</a></li>
<li class="chapter" data-level="5.3.7" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#final-thoughts-making-choices"><i class="fa fa-check"></i><b>5.3.7</b> Final thoughts: Making choices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html"><i class="fa fa-check"></i><b>6</b> Disease Mapping III</a>
<ul>
<li class="chapter" data-level="6.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#getting-ready-w6"><i class="fa fa-check"></i><b>6.1</b> Getting Ready, w6</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#learning-objectives-w6"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives, w6</a></li>
<li class="chapter" data-level="6.1.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#additional-resources-w6"><i class="fa fa-check"></i><b>6.1.2</b> Additional Resources, w6</a></li>
<li class="chapter" data-level="6.1.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#important-vocabulary-w6"><i class="fa fa-check"></i><b>6.1.3</b> Important Vocabulary, w6</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-thinking-in-epidemiology-w6"><i class="fa fa-check"></i><b>6.2</b> Spatial Thinking in Epidemiology, w6</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#revisiting-spatial-point-processes"><i class="fa fa-check"></i><b>6.2.1</b> Revisiting spatial point processes</a></li>
<li class="chapter" data-level="6.2.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-is-a-kernel-density-estimator"><i class="fa fa-check"></i><b>6.2.2</b> What is a kernel density estimator?</a></li>
<li class="chapter" data-level="6.2.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#limitations-in-kernel-density-estimation"><i class="fa fa-check"></i><b>6.2.3</b> Limitations in kernel density estimation</a></li>
<li class="chapter" data-level="6.2.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#uses-for-kernel-density-estimation-kde-in-spatial-epidemiology"><i class="fa fa-check"></i><b>6.2.4</b> Uses for kernel density estimation (KDE) in spatial epidemiology</a></li>
<li class="chapter" data-level="6.2.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#guide-to-the-rest-of-this-section"><i class="fa fa-check"></i><b>6.2.5</b> Guide to the rest of this sectionâ€¦</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-point-processes"><i class="fa fa-check"></i><b>6.3</b> Spatial Analysis in Epidemiology: Kernel estimation of point processes</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#preparing-packages-and-data"><i class="fa fa-check"></i><b>6.3.1</b> Preparing packages and data</a></li>
<li class="chapter" data-level="6.3.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#introducing-a-new-spatial-data-class-ppp"><i class="fa fa-check"></i><b>6.3.2</b> Introducing a new spatial data class: <code>ppp</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-the-ppp-objects"><i class="fa fa-check"></i><b>6.3.3</b> Creating the <code>ppp</code> objects</a></li>
<li class="chapter" data-level="6.3.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#bandwidth-selection"><i class="fa fa-check"></i><b>6.3.4</b> Bandwidth selection</a></li>
<li class="chapter" data-level="6.3.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-kernel-density-surfaces"><i class="fa fa-check"></i><b>6.3.5</b> Estimating Kernel Density surfaces</a></li>
<li class="chapter" data-level="6.3.6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-manually"><i class="fa fa-check"></i><b>6.3.6</b> Creating relative risk surface manually</a></li>
<li class="chapter" data-level="6.3.7" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-with-risk-function"><i class="fa fa-check"></i><b>6.3.7</b> Creating relative risk surface with <code>risk()</code> function</a></li>
<li class="chapter" data-level="6.3.8" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#using-functions-to-map-rr-with-tmap"><i class="fa fa-check"></i><b>6.3.8</b> Using functions to map RR with <code>tmap</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#gwss"><i class="fa fa-check"></i><b>6.4</b> Spatial Analysis in Epidemiology: Kernel estimation of areal data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>6.4.1</b> Packages and data</a></li>
<li class="chapter" data-level="6.4.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-bandwidth-for-kernel-density-estimates"><i class="fa fa-check"></i><b>6.4.2</b> What bandwidth for kernel density estimates?</a></li>
<li class="chapter" data-level="6.4.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#geographically-weighted-summary-statistics-gwss"><i class="fa fa-check"></i><b>6.4.3</b> Geographically weighted summary statistics: <code>gwss()</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#calculating-pseudo-p-values-for-smoothed-estimates"><i class="fa fa-check"></i><b>6.4.4</b> Calculating pseudo p-values for smoothed estimates</a></li>
<li class="chapter" data-level="6.4.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-geographically-weighted-bivariate-statistics"><i class="fa fa-check"></i><b>6.4.5</b> Estimating geographically-weighted bivariate statistics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html"><i class="fa fa-check"></i><b>7</b> Disease Mapping IV</a>
<ul>
<li class="chapter" data-level="7.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#getting-ready-w7"><i class="fa fa-check"></i><b>7.1</b> Getting Ready, w7</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#learning-objectives-w7"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives, w7</a></li>
<li class="chapter" data-level="7.1.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#additional-resources-w7"><i class="fa fa-check"></i><b>7.1.2</b> Additional Resources, w7</a></li>
<li class="chapter" data-level="7.1.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#important-vocabulary-w7"><i class="fa fa-check"></i><b>7.1.3</b> Important Vocabulary, w7</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-thinking-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.2</b> Spatial Thinking in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#what-is-bayesian-inference"><i class="fa fa-check"></i><b>7.2.1</b> What is <em>Bayesian Inference</em>?</a></li>
<li class="chapter" data-level="7.2.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#bayesian-inference-in-spatial-epidemiology"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian inference in spatial epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-analysis-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.3</b> Spatial Analysis in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>7.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="7.3.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#preparing-for-carbayes"><i class="fa fa-check"></i><b>7.3.2</b> Preparing for <code>CARBayes()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#fitting-a-besag-york-mollie-bym-bayesian-model"><i class="fa fa-check"></i><b>7.3.3</b> Fitting a <em>Besag-York-Mollie (BYM)</em> Bayesian model</a></li>
<li class="chapter" data-level="7.3.4" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#summarizing-carbayes-model-output"><i class="fa fa-check"></i><b>7.3.4</b> Summarizing <code>CARBayes</code> model output</a></li>
<li class="chapter" data-level="7.3.5" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#making-inference-from-bayesian-posteriors"><i class="fa fa-check"></i><b>7.3.5</b> Making inference from Bayesian posteriors</a></li>
<li class="chapter" data-level="7.3.6" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#extracting-summaries-for-mapping-or-analysis"><i class="fa fa-check"></i><b>7.3.6</b> Extracting summaries for mapping or analysis</a></li>
<li class="chapter" data-level="7.3.7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#plot-raw-versus-smoothed"><i class="fa fa-check"></i><b>7.3.7</b> Plot raw versus smoothed</a></li>
<li class="chapter" data-level="7.3.8" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-rates"><i class="fa fa-check"></i><b>7.3.8</b> Mapping rates</a></li>
<li class="chapter" data-level="7.3.9" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-exceedance-probability"><i class="fa fa-check"></i><b>7.3.9</b> Mapping exceedance probability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html"><i class="fa fa-check"></i><b>8</b> Spatial Structure and Clustering I</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#getting-ready-w8"><i class="fa fa-check"></i><b>8.1</b> Getting Ready, w8</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#learning-objectives-w8"><i class="fa fa-check"></i><b>8.1.1</b> Learning objectives, w8</a></li>
<li class="chapter" data-level="8.1.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#additional-resources-w8"><i class="fa fa-check"></i><b>8.1.2</b> Additional Resources, w8</a></li>
<li class="chapter" data-level="8.1.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#important-vocabulary-w8"><i class="fa fa-check"></i><b>8.1.3</b> Important Vocabulary, w8</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-thinking-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.2</b> Spatial Thinking in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#two-big-questions"><i class="fa fa-check"></i><b>8.2.1</b> Two big questionsâ€¦</a></li>
<li class="chapter" data-level="8.2.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#why-does-structure-or-clustering-matter"><i class="fa fa-check"></i><b>8.2.2</b> Why does structure or clustering matter?</a></li>
<li class="chapter" data-level="8.2.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#making-meaning-of-hypotheses-in-spatial-structure-testing"><i class="fa fa-check"></i><b>8.2.3</b> Making meaning of hypotheses in spatial structure testing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-analysis-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.3</b> Spatial Analysis in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>8.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="8.3.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#global-morans-i"><i class="fa fa-check"></i><b>8.3.2</b> Global Moranâ€™s I</a></li>
<li class="chapter" data-level="8.3.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#local-morans-i"><i class="fa fa-check"></i><b>8.3.3</b> Local Moranâ€™s I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html"><i class="fa fa-check"></i><b>9</b> Spatial Structure and Clustering II</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#getting-ready-w9"><i class="fa fa-check"></i><b>9.1</b> Getting Ready, w9</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#learning-objectives-w9"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives, w9</a></li>
<li class="chapter" data-level="9.1.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#additional-resources-w9"><i class="fa fa-check"></i><b>9.1.2</b> Additional Resources, w9</a></li>
<li class="chapter" data-level="9.1.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#important-vocabulary-w9"><i class="fa fa-check"></i><b>9.1.3</b> Important Vocabulary, w9</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-thinking-in-epidemiology-conceptual-tools-for-thinking-about-clusters"><i class="fa fa-check"></i><b>9.2</b> Spatial Thinking in Epidemiology: Conceptual tools for thinking about â€˜clustersâ€™</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#the-clustering-conundrum"><i class="fa fa-check"></i><b>9.2.1</b> The clustering conundrum</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-scan-statistics"><i class="fa fa-check"></i><b>9.3</b> Spatial Scan Statistics</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>9.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#overview-of-kulldorff-nagarwalla-scan-statistic"><i class="fa fa-check"></i><b>9.3.2</b> Overview of <em>Kulldorff &amp; Nagarwalla</em> scan statistic</a></li>
<li class="chapter" data-level="9.3.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatio-temporal-scan-statistics"><i class="fa fa-check"></i><b>9.3.3</b> Spatio-temporal scan statistics</a></li>
<li class="chapter" data-level="9.3.4" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatial-only-kulldorff-scan-statistics"><i class="fa fa-check"></i><b>9.3.4</b> Estimating <em>spatial-only</em> Kulldorff scan statistics</a></li>
<li class="chapter" data-level="9.3.5" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatio-temporal-kuldorff-scan-statistic"><i class="fa fa-check"></i><b>9.3.5</b> Estimating <em>spatio-temporal</em> Kuldorff scan statistic</a></li>
<li class="chapter" data-level="9.3.6" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.3.6</b> Concluding thoughts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatreg1.html"><a href="spatreg1.html"><i class="fa fa-check"></i><b>10</b> Spatial Regression I</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatreg1.html"><a href="spatreg1.html#getting-ready-w10"><i class="fa fa-check"></i><b>10.1</b> Getting Ready, w10</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="spatreg1.html"><a href="spatreg1.html#learning-objectives-w10"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives, w10</a></li>
<li class="chapter" data-level="10.1.2" data-path="spatreg1.html"><a href="spatreg1.html#important-vocabulary-w10"><i class="fa fa-check"></i><b>10.1.2</b> Important Vocabulary, w10</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="spatreg1.html"><a href="spatreg1.html#multivariable-regression-for-exploring-spatial-data"><i class="fa fa-check"></i><b>10.2</b> Multivariable regression for exploring spatial data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="spatreg1.html"><a href="spatreg1.html#data-generating-process"><i class="fa fa-check"></i><b>10.2.1</b> Data Generating Process</a></li>
<li class="chapter" data-level="10.2.2" data-path="spatreg1.html"><a href="spatreg1.html#model-residuals-are-not-just-mistakes"><i class="fa fa-check"></i><b>10.2.2</b> Model residuals are not just mistakes</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="spatreg1.html"><a href="spatreg1.html#spatializing-aspatial-regression"><i class="fa fa-check"></i><b>10.3</b> Spatializing aspatial regression</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="spatreg1.html"><a href="spatreg1.html#data-packages"><i class="fa fa-check"></i><b>10.3.1</b> Data &amp; Packages</a></li>
<li class="chapter" data-level="10.3.2" data-path="spatreg1.html"><a href="spatreg1.html#fitting-unconditional-empty-model"><i class="fa fa-check"></i><b>10.3.2</b> Fitting unconditional (empty) model</a></li>
<li class="chapter" data-level="10.3.3" data-path="spatreg1.html"><a href="spatreg1.html#fitting-conditional-model"><i class="fa fa-check"></i><b>10.3.3</b> Fitting conditional model</a></li>
<li class="chapter" data-level="10.3.4" data-path="spatreg1.html"><a href="spatreg1.html#mapping-residuals"><i class="fa fa-check"></i><b>10.3.4</b> Mapping residuals</a></li>
<li class="chapter" data-level="10.3.5" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-tests-on-lm-models"><i class="fa fa-check"></i><b>10.3.5</b> Moranâ€™s I tests on <code>lm</code> models</a></li>
<li class="chapter" data-level="10.3.6" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-tests-on-glm-models"><i class="fa fa-check"></i><b>10.3.6</b> Moranâ€™s I tests on <code>glm</code> models</a></li>
<li class="chapter" data-level="10.3.7" data-path="spatreg1.html"><a href="spatreg1.html#mapping-glm-residuals"><i class="fa fa-check"></i><b>10.3.7</b> Mapping <code>glm</code> residuals</a></li>
<li class="chapter" data-level="10.3.8" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-for-glm"><i class="fa fa-check"></i><b>10.3.8</b> Moranâ€™s I for <code>glm</code></a></li>
<li class="chapter" data-level="10.3.9" data-path="spatreg1.html"><a href="spatreg1.html#final-words"><i class="fa fa-check"></i><b>10.3.9</b> Final words</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html"><i class="fa fa-check"></i><b>11</b> Spatial Regression II</a>
<ul>
<li class="chapter" data-level="11.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#getting-ready-w11"><i class="fa fa-check"></i><b>11.1</b> Getting Ready, w11</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#learning-objectives-w11"><i class="fa fa-check"></i><b>11.1.1</b> Learning objectives, w11</a></li>
<li class="chapter" data-level="11.1.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#important-vocabulary-w11"><i class="fa fa-check"></i><b>11.1.2</b> Important Vocabulary, w11</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#spatially-varying-relationships"><i class="fa fa-check"></i><b>11.2</b> Spatially varying relationships</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#non-stationarity-in-context-of-spatial-epidemiology"><i class="fa fa-check"></i><b>11.2.1</b> Non-stationarity in context of spatial epidemiology</a></li>
<li class="chapter" data-level="11.2.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#introducing-geographically-weighted-regression"><i class="fa fa-check"></i><b>11.2.2</b> Introducing geographically weighted regression</a></li>
<li class="chapter" data-level="11.2.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#making-epidemiologic-meaning-of-spatially-varying-coefficients"><i class="fa fa-check"></i><b>11.2.3</b> Making epidemiologic meaning of spatially varying coefficients</a></li>
<li class="chapter" data-level="11.2.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#distinguishing-variation-in-prevalence-from-variation-in-correlation"><i class="fa fa-check"></i><b>11.2.4</b> Distinguishing variation in <strong>prevalence</strong> from variation in <strong>correlation</strong></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#estimating-geogrpahically-weighted-regression-models"><i class="fa fa-check"></i><b>11.3</b> Estimating geogrpahically weighted regression models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>11.3.1</b> Packages and Data</a></li>
<li class="chapter" data-level="11.3.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#preparing-for-using-gwmodel"><i class="fa fa-check"></i><b>11.3.2</b> Preparing for using <code>GWModel</code></a></li>
<li class="chapter" data-level="11.3.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#defining-local-optimizing-kernel-bandwidths"><i class="fa fa-check"></i><b>11.3.3</b> Defining local: optimizing kernel bandwidths</a></li>
<li class="chapter" data-level="11.3.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>11.3.4</b> Geographically weighted regression</a></li>
<li class="chapter" data-level="11.3.5" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#checking-local-multi-collinearity"><i class="fa fa-check"></i><b>11.3.5</b> Checking local multi-collinearity</a></li>
<li class="chapter" data-level="11.3.6" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#adjusting-for-multiple-comparisons"><i class="fa fa-check"></i><b>11.3.6</b> Adjusting for multiple comparisons</a></li>
<li class="chapter" data-level="11.3.7" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#visualizing-model-inference"><i class="fa fa-check"></i><b>11.3.7</b> Visualizing model inference</a></li>
<li class="chapter" data-level="11.3.8" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#extensions"><i class="fa fa-check"></i><b>11.3.8</b> Extensions</a></li>
<li class="chapter" data-level="11.3.9" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#data-models"><i class="fa fa-check"></i><b>11.3.9</b> Data models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html"><i class="fa fa-check"></i><b>12</b> Spatial Regression III</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#getting-ready-w12"><i class="fa fa-check"></i><b>12.1</b> Getting Ready, w12</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#learning-objectives-w12"><i class="fa fa-check"></i><b>12.1.1</b> Learning objectives, w12</a></li>
<li class="chapter" data-level="12.1.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#important-vocabulary-w12"><i class="fa fa-check"></i><b>12.1.2</b> Important Vocabulary, w12</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-econometric-models-putting-dependence-right-in-the-model"><i class="fa fa-check"></i><b>12.2</b> Spatial econometric models: Putting dependence right in the model</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-spatial-econometric-models"><i class="fa fa-check"></i><b>12.2.1</b> Comparing spatial econometric models</a></li>
<li class="chapter" data-level="12.2.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-and-selecting-spatial-econometric-models"><i class="fa fa-check"></i><b>12.2.2</b> Comparing and selecting spatial econometric models</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#estimating-spatial-econometrics-models"><i class="fa fa-check"></i><b>12.3</b> Estimating spatial econometrics models</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#package-data"><i class="fa fa-check"></i><b>12.3.1</b> Package &amp; Data</a></li>
<li class="chapter" data-level="12.3.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#defining-the-study-question"><i class="fa fa-check"></i><b>12.3.2</b> Defining the study question</a></li>
<li class="chapter" data-level="12.3.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#defining-competing-definitions-of-local"><i class="fa fa-check"></i><b>12.3.3</b> Defining competing definitions of <em>local</em></a></li>
<li class="chapter" data-level="12.3.4" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#two-extremes"><i class="fa fa-check"></i><b>12.3.4</b> Two extremes</a></li>
<li class="chapter" data-level="12.3.5" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#fitting-multivariable-regression-models"><i class="fa fa-check"></i><b>12.3.5</b> Fitting multivariable regression models</a></li>
<li class="chapter" data-level="12.3.6" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-error-model-1"><i class="fa fa-check"></i><b>12.3.6</b> Spatial Error Model</a></li>
<li class="chapter" data-level="12.3.7" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#hausman-test-of-coefficients"><i class="fa fa-check"></i><b>12.3.7</b> Hausman test of coefficients</a></li>
<li class="chapter" data-level="12.3.8" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-lag-model"><i class="fa fa-check"></i><b>12.3.8</b> Spatial Lag Model</a></li>
<li class="chapter" data-level="12.3.9" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-durbin-model-1"><i class="fa fa-check"></i><b>12.3.9</b> Spatial Durbin Model</a></li>
<li class="chapter" data-level="12.3.10" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-models"><i class="fa fa-check"></i><b>12.3.10</b> Comparing Models</a></li>
<li class="chapter" data-level="12.3.11" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#impact-assessments"><i class="fa fa-check"></i><b>12.3.11</b> Impact Assessments</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Appendices</b></span></li>
<li class="chapter" data-level="13" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html"><i class="fa fa-check"></i><b>13</b> Tips for reproducibility in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i>Additional Resources</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflows-to-enhance-reproducibility"><i class="fa fa-check"></i>Workflows to enhance reproducibility</a>
<ul>
<li><a href="tips-for-reproducibility-in-r.html#using-projects-in-r">Using Projects in <code>R</code></a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#understanding-directory-and-file-path-names-in-r">Understanding directory and file path names in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-location-within-the-working-directory"><i class="fa fa-check"></i>Specify a location within the working directory</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-relative-location-outside-the-working-directory"><i class="fa fa-check"></i>Specify a relative location outside the working directory</a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#why-r-notebooks">Why <code>R Notebooks</code>?</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#what-you-need-to-know"><i class="fa fa-check"></i>What you need to know</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#important-r-notebook-functions"><i class="fa fa-check"></i>Important R Notebook functions</a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#the-yaml"><i class="fa fa-check"></i>The YAML</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#typing-text"><i class="fa fa-check"></i>Typing text</a></li>
<li><a href="tips-for-reproducibility-in-r.html#adding-r-code">Adding <code>R</code> Code</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#making-tables"><i class="fa fa-check"></i>Making tables</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflow"><i class="fa fa-check"></i>Workflow</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#optional-functions"><i class="fa fa-check"></i>Optional functions</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#customizing-your-yaml"><i class="fa fa-check"></i>Customizing your YAML</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#simple-formatting-of-your-notebook"><i class="fa fa-check"></i>Simple formatting of your Notebook</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#text-formatting"><i class="fa fa-check"></i>Text formatting</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#final-note"><i class="fa fa-check"></i>Final Note</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="sf-overview.html"><a href="sf-overview.html"><i class="fa fa-check"></i><b>14</b> Tips for working with <code>sf</code> data class</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sf-overview.html"><a href="sf-overview.html#st_set_geom"><i class="fa fa-check"></i><b>14.1</b> <code>st_set_geom()</code></a></li>
<li class="chapter" data-level="14.2" data-path="sf-overview.html"><a href="sf-overview.html#st-as-sf"><i class="fa fa-check"></i><b>14.2</b> <code>st_as_sf()</code></a></li>
<li class="chapter" data-level="14.3" data-path="sf-overview.html"><a href="sf-overview.html#st_crs"><i class="fa fa-check"></i><b>14.3</b> <code>st_crs()</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>15</b> Tips for using <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="15.1" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>15.1</b> <code>select()</code></a></li>
<li class="chapter" data-level="15.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>15.2</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="15.3" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>15.3</b> <code>filter()</code></a></li>
<li class="chapter" data-level="15.4" data-path="dplyr.html"><a href="dplyr.html#arrange"><i class="fa fa-check"></i><b>15.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="15.5" data-path="dplyr.html"><a href="dplyr.html#pipe-operator"><i class="fa fa-check"></i><b>15.5</b> <code>%&gt;%</code> Pipe operator</a></li>
<li class="chapter" data-level="15.6" data-path="dplyr.html"><a href="dplyr.html#group_by-and-summarise"><i class="fa fa-check"></i><b>15.6</b> <code>group_by()</code> and <code>summarise()</code></a></li>
<li class="chapter" data-level="15.7" data-path="dplyr.html"><a href="dplyr.html#join"><i class="fa fa-check"></i><b>15.7</b> <code>join()</code></a></li>
<li class="chapter" data-level="15.8" data-path="dplyr.html"><a href="dplyr.html#pivot_"><i class="fa fa-check"></i><b>15.8</b> Reshaping (transposing) data</a>
<ul>
<li class="chapter" data-level="15.8.1" data-path="dplyr.html"><a href="dplyr.html#pivot_longer-for-going-from-wide-to-long"><i class="fa fa-check"></i><b>15.8.1</b> <code>pivot_longer()</code> for going from wide to long</a></li>
<li class="chapter" data-level="15.8.2" data-path="dplyr.html"><a href="dplyr.html#pivot_wider"><i class="fa fa-check"></i><b>15.8.2</b> <code>pivot_wider()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="intro-tmap.html"><a href="intro-tmap.html"><i class="fa fa-check"></i><b>16</b> Tips for using <code>tmap</code></a>
<ul>
<li class="chapter" data-level="16.1" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-mode"><i class="fa fa-check"></i><b>16.1</b> <code>tmap</code> mode</a></li>
<li class="chapter" data-level="16.2" data-path="intro-tmap.html"><a href="intro-tmap.html#qtm"><i class="fa fa-check"></i><b>16.2</b> Quick maps: <code>qtm()</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-polygons"><i class="fa fa-check"></i><b>16.2.1</b> Customizing <code>qtm()</code> for polygons</a></li>
<li class="chapter" data-level="16.2.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-lines"><i class="fa fa-check"></i><b>16.2.2</b> Customizing <code>qtm()</code> for lines</a></li>
<li class="chapter" data-level="16.2.3" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-points"><i class="fa fa-check"></i><b>16.2.3</b> Customizing <code>qtm()</code> for points</a></li>
<li class="chapter" data-level="16.2.4" data-path="intro-tmap.html"><a href="intro-tmap.html#finding-valid-color-options"><i class="fa fa-check"></i><b>16.2.4</b> Finding valid color options</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="intro-tmap.html"><a href="intro-tmap.html#building-maps-with-tmap"><i class="fa fa-check"></i><b>16.3</b> Building maps with <code>tmap</code></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="intro-tmap.html"><a href="intro-tmap.html#building-blocks-in-tmap"><i class="fa fa-check"></i><b>16.3.1</b> Building blocks in <code>tmap</code></a></li>
<li class="chapter" data-level="16.3.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-text-on-maps"><i class="fa fa-check"></i><b>16.3.2</b> Customizing text on maps</a></li>
<li class="chapter" data-level="16.3.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-two-or-more-spatial-objects-in-one-map"><i class="fa fa-check"></i><b>16.3.3</b> Adding two or more spatial objects in one map</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-layout-and-map-elements"><i class="fa fa-check"></i><b>16.4</b> Controlling layout and map elements</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="intro-tmap.html"><a href="intro-tmap.html#understanding-the-graphic-space-in-tmap"><i class="fa fa-check"></i><b>16.4.1</b> Understanding the graphic space in <code>tmap</code></a></li>
<li class="chapter" data-level="16.4.2" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-map-layout"><i class="fa fa-check"></i><b>16.4.2</b> Controlling map layout</a></li>
<li class="chapter" data-level="16.4.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-map-elements"><i class="fa fa-check"></i><b>16.4.3</b> Adding map elements</a></li>
<li class="chapter" data-level="16.4.4" data-path="intro-tmap.html"><a href="intro-tmap.html#change-the-global-style-of-a-map"><i class="fa fa-check"></i><b>16.4.4</b> Change the global style of a map</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="intro-tmap.html"><a href="intro-tmap.html#making-small-multiple-maps"><i class="fa fa-check"></i><b>16.5</b> Making small-multiple maps</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-as-a-vector-of-variables"><i class="fa fa-check"></i><b>16.5.1</b> Small multiples as a vector of variables</a></li>
<li class="chapter" data-level="16.5.2" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-facet"><i class="fa fa-check"></i><b>16.5.2</b> Small multiples with facets</a></li>
<li class="chapter" data-level="16.5.3" data-path="intro-tmap.html"><a href="intro-tmap.html#facets-for-time-series"><i class="fa fa-check"></i><b>16.5.3</b> Facets for time-series</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-with-tmap_arrange"><i class="fa fa-check"></i><b>16.6</b> Small multiples with <code>tmap_arrange()</code></a></li>
<li class="chapter" data-level="16.7" data-path="intro-tmap.html"><a href="intro-tmap.html#summarizing-small-multiples"><i class="fa fa-check"></i><b>16.7</b> Summarizing small multiples</a></li>
<li class="chapter" data-level="16.8" data-path="intro-tmap.html"><a href="intro-tmap.html#saving-maps"><i class="fa fa-check"></i><b>16.8</b> Saving maps</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="disease-mapping-ii" class="section level1" number="5">
<h1><span class="header-section-number">Week 5</span> Disease Mapping II</h1>
<div id="getting-ready-w5" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Getting Ready, w5</h2>
<div id="w5-learning-objectives" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> w5 Learning objectives</h3>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; width: 100%; margin-left: auto; margin-right: auto;  " id="learning-ob">
<caption style="caption-side: top; text-align: center;"><span id="tab:learning-ob">TABLE 1.1: </span> Learning objectives by weekly module</caption><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(208, 211, 212); font-weight: bold;">After this module you should be able toâ€¦</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(250, 229, 211); font-weight: normal;">Compare and contrast the operationalization of distance or contiguity in spatial statistics to sociologic and demographic theories of health relevant processes and relationships in space</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(245, 203, 167); font-weight: normal;">Apply and justify contrasting definitions of spatial weights matrix in estimation of statistically smoothed disease maps</td></tr>
</table>

</div>
<div id="additional-resources-w5" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Additional Resources, w5</h3>
<ul>
<li><a href="https://dces.wisc.edu/wp-content/uploads/sites/128/2013/08/W14_Anselin2007.pdf">Anselin, L. Spatial Regression Analysis in R: A workbook. 2007.</a></li>
<li><a href="https://geodacenter.github.io/workbook/4b_dist_weights/lab4b.html">GeoDa Center Resources: Section on distance-based spatial weights</a></li>
<li><a href="https://geodacenter.github.io/workbook/4a_contig_weights/lab4a.html">GeoDa Center Resources: Section on contiguity-based spatial weights</a></li>
</ul>
</div>
<div id="important-vocabulary-w5" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Important Vocabulary, w5</h3>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; width: 90%; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-98">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-98">TABLE 5.1: </span> Vocabulary for Week 5</caption><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(84, 153, 199); font-weight: bold;"><span style="color: rgb(255, 255, 255);">Term</span></th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(84, 153, 199); font-weight: bold;"><span style="color: rgb(255, 255, 255);">Definition</span></th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Aspatial vs. Spatial</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">This distinction refers to whether or not spatial proximity or contiguity is explicitly incorporated into an analysis (spatial) versus whether spatial units are treated as independent of one another (aspatial)</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Delauney triangulation</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">Geometric strategy for creating a mesh of contiguous, nonoverlapping triangles from a dataset of points. If points are the centroids of polygons, the triangle edges become graph-based definitions of spatial neighbors</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Distance</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A fundamental dimension in geography referring to the strength of connectedness or proximity in eculidean space, social space, or network space. Distance if fundamental because we assume that a) entities that are closer are, on average, more alike than entities that are far apart; and b) increasing distance represents increasing friction or imedance to social and health-relevant interaction</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Neighbor symmetry</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">An attribute of spatial relationships in which it is assumed that if spatial unit A is a neighbor with B, then spatial unit B is also a neighbor with A. Some neighbor definitions (e.g. k-nearest neighbors) do not require symmetry.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Spatial neighbors</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">The set of spatial entities that are determined to be 'near' rather than 'far' (in binary terms) or relatively 'closer' or 'further' (in continuous terms). The definition of 'neighbors' is part of specifying spatial relatedness.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Spatial weights matrix</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">Typically a square matrix (n rows x n columns where n=geographic units) indexing all units on rows and columns. The values in the matrix indicate the spatial connectedness between all pairs of units.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Toblers' First Law of Geography</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">All things are related, but near things are more related on average than distant things</td></tr>
</table>

</div>
</div>
<div id="spatial-thinking-in-epidemiology-w5" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Spatial Thinking in Epidemiology, w5</h2>
<p>This is the first time where we will formally incorporate and make explicit what <em>spatial</em> means in <em>spatial analysis</em>. Although all work up until now has been represented on a map (thus spatially contextualized), we have not formally incorporate spatial relationships into any aspect of analysis. Specifically, last week we calculated statistical tests for heterogeneity, estimated precision or statistical significance, and produced Empirical Bayes smoothed (stabilized) estimates of parameters of interest. But each of these treated each spatial unit as it were spatially or geographically <em>independent</em> of every other spatial unit. This assumption that units are geographically independent is what I have referred to as <strong>aspatial analysis</strong>.</p>
<div id="an-argument-for-the-relevance-of-space" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> An argument for the relevance of space</h3>
<p>To formally and explicitly incorporate spatial relatedness we need to be clear about what constitutes spatial relationship. There are two aspects to considering spatial relatedness, and they apply to two sides of spatial thinking about health. As discussed in the recorded lecture, the fundamental dimension for spatial relations in geography is that of <em>distance</em>, whether that be euclidean (e.g.Â as the crow flies) distance, social distance, or network distance.</p>
<p>On the one hand, distance is used as a metric for defining some aspect of <em>local population homogeneity</em> that is distinct from the <em>broader regional (e.g.Â study region-wide) heterogeneity</em>. In other words, based on Toblerâ€™s First Law of Geography, near things tend to be more alike than distant things (on average), implying a kind of dependence or correlation among local units that might not be evident overall. This concept â€“ which seems to hold true for many human and non-human systems â€“ means that when faced with sparse data, and concern for uncertainty, we can â€˜<em>borrow</em>â€™ statistical information from spatial neighbors to supplement estimation of local disease parameters. This is exactly what we will do with <em>spatial Empirical Bayes</em> estimation, where instead of using the overall (global) rate of disease as the prior, we will use the <em>local rate</em> for neighbors surrounding each entity as a kind of custom, place-specific prior.</p>
<p>But at a deeper level, distance is also important to spatial thinking in epidemiology. This is because we hypothesize â€“ and are interested in â€“ whether entities that are geographically or socially more connected share health-relevant experiences. These experiences or exposures include microbial space (e.g.Â person-to-person transmission of infectious agents), social norms (e.g.Â acceptability of smoking or body image perceptions), built environments (e.g.Â lead exposure in municipal water systems, food environments), access to health resources (e.g.Â health care, cancer screening), and access to opportunity structures (e.g.Â good schools, safe streets, employment opportunities).</p>
<p>The examples above rely primarily on the note of <em>distance</em> in Cartesian (geographic) space. However, it is worth emphasizing how more complex versions of <em>distance</em> and <em>proximity</em> could come into play. For example air travel makes the <em>distance</em> between two places less relevant than the economic and social drivers of flows of people back and forth when it comes to infectious disease transmission such as Zika or Ebola. There is a still a <em>distance</em> dimension, but it is defined by the push and pull of human mobility and migration. It is possible to define <em>spatial neighbors</em> in these more abstract (e.g.Â non-geographic) ways. For example, political scientists have created spatial weights matrices that connect states not by their geographic boundaries, but by how similarly their legislatures act on policy decisions. In this way <em>distance</em> is a measure of ideology rather than geography, but still has meaning for spatial analysis of health. But for today we will focus on the more specific example of <em>geographic space</em> rather than social, political, or economic <em>space</em>.</p>
<p>In sum, the notion of explicitly <em>spatial analysis</em> is a way to incorporate theoretical and conceptual aspects of how humans relate to one another and their environment into our understanding of the distribution and determinants of disease.</p>
<p>Whether we treat spatial dependence and relatedness as a primarily statistical feature for exploitation (e.g.Â as in spatial disease mapping with Empirical Bayes), or as an attribute of the local ecosystem of disease generation, it is clear that when and how neighbors are defined is influential on the final numerical results and the inference we take from them. The definition of spatial neighbors, and the corresponding symbolization of that relatedness with creation of spatial weights matrices is a fundamental bridge between theory of geography and meaning for spatial epidemiology.</p>
</div>
<div id="on-making-meaning-from-neighbors" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> On making meaning from neighbors</h3>
<p>The challenge for the spatial epidemiologist is twofold:
1. Conceptualizing the spatial scale and extent at which a health relevant process of interest occur
2. Translating that conceptual idea to an explicit definition of neighbors, and therefore spatial weights</p>
<p>For areal analysis (e.g.Â spatial analysis of polygons), there are two broad classes of neighborhood definitions: contiguity-based definitions and distance-based definitions. In reality both are abstract expressions of â€˜distanceâ€™, but they differ in how â€˜<em>near</em>â€™ and â€˜<em>far</em>â€™ are operationalized. While we are primarily focused on analysis of areal units in this course, it is possible to create neighbor definitions among point-referenced data by using a tessalation process such as creation of Thiessen polygons (e.g.Â see <a href="https://geodacenter.github.io/workbook/4b_dist_weights/lab4b.html#distance-metric">this discussion on Contiguity-based weights for points</a>). Below is a brief summary of several common neighbor definitions:</p>
<table>
<colgroup>
<col width="14%" />
<col width="15%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Basic metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Rook</strong></td>
<td>Contiguity</td>
<td>Unit A and unit B are neighbors if and only if they share boundary edges. Second or higher-order contiguity refers to units sharing edges with index unit (1st order contiguity), plus units that share boundary edges with all 1st order neighbors; and so forth)</td>
</tr>
<tr class="even">
<td><strong>Queen</strong></td>
<td>Contiguity</td>
<td>Unit A and unit B are neighbors if they share <em>either</em> boundary edges <em>or</em> boundary corners (e.g.Â vertices). Second or higher-order contiguity refers to units sharing edges with index unit (1st order contiguity), plus units that share boundary edges with all 1st order neighbors; and so forth)</td>
</tr>
<tr class="odd">
<td><strong>Sphere of influence graph neighbors</strong></td>
<td>Contiguity</td>
<td><em>Graph-based</em> neighbors start by creating <em>Delauney triangles</em> from the centroid of units. Neighbors are defined by the <em>edges</em> of the triangles.</td>
</tr>
<tr class="even">
<td><strong>Fixed distance</strong></td>
<td>Distance</td>
<td>Unit A is a neighbor of unit B, if unit A (or perhaps the centroid of the unit) falls within a fixed-distance buffer created around unit B (or perhaps the centroid of the unit).</td>
</tr>
<tr class="odd">
<td><strong>K-nearest neighbors (KNN)</strong></td>
<td>Distance</td>
<td>Unit A is a neighbor of unit B, if when a rank-order of closest to furthest neighbors from Unit B is created, Unit A is ranked <span class="math inline">\(\leq k\)</span>. In other words, if <span class="math inline">\(K\)</span> is set to 5, then unit A is neighbor of B if it is among the 5 nearest neighbors. KNN is an <em>asymmetric</em> definition; it is possible for A to be neighbors with B, but B may not be a neighbor to A.</td>
</tr>
<tr class="even">
<td><strong>Inverse distance</strong></td>
<td>Distance</td>
<td>Instead of using a fixed threshold of distance (e.g.Â a buffer) or a fixed number of near neighbors (e.g.Â KNN), this strategy describes proximity or â€˜<em>nearness</em>â€™ as the inverse of the Euclidean or road-network distance (or possibly inverse of distance-squared).</td>
</tr>
</tbody>
</table>
<p>The choice of which neighbor definition to use is influenced by several study-specific factors, some of which can be in conflict with others:</p>
<ul>
<li>Variation in size of areal units across the study area. If some areal units are very small (e.g.Â counties in the Eastern U.S.) and some are very large (e.g.Â counties in the Western U.S.), then the geographic area defined by adjacent counties will be quite different. In contrast, fixed-distance neighbors will be more consistent.</li>
<li>Assumptions or requirements of the statistical analysis of interest. Some algorithms require/expect features such as <em>neighbor symmetry</em> or <em>spatial weights row standardization</em> to account for unequal numbers of neighbors.</li>
<li>The assumed meaning of space in the analysis. It is possible that, for instance, the meaning of distance in Western counties is different where further travel to basic services is more the norm than in denser areas in the East.</li>
<li>The purpose and audience of the map. It is important to make the analysis accessible and interpretable to the target audience.</li>
<li>Aspects of the geography including islands or presence of non-contiguous units (e.g.Â Hawaii, Alaska, Puerto Rico)</li>
</ul>
</div>
</div>
<div id="spatial-analysis-in-epidemiology-w5" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Spatial Analysis in Epidemiology, w5</h2>
<p>To apply these concepts to specific spatial analysis, we will continue to use the Georgia <em>very low birthweight</em> dataset used in the previous module of the eBook. As a reminder, this is a county-level dataset for the <span class="math inline">\(n=159\)</span> Georgia Counties containing the county of all live births (denominator) as well as the count of VLBW births (weight at birth &lt; 1500 grams) babies in 2018-2019. These data were derived from the <a href="https://oasis.state.ga.us/">Georgia OASIS website</a>.</p>
<p>In this section we first introduce how to create and examine several different spatial neighbor definitions. But we never create neighbors just or their own sake. The purpose of creating spatial neighbors and weights matrices is always to use the definition in a spatial analysis. Later in this section you will see the use of the spatial weights for producing <em>spatial Empirical Bayes</em> estimates.</p>
<div id="creating-contiguity-neighbor-objects" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Creating contiguity neighbor objects</h3>
<p>In <code>R</code>, the <code>spdep</code> package has a series of functions useful for creating spatial weights matrices. In general, the process of going from a spatial object (e.g.Â an <code>sf</code> class data object) to a usable spatial weights matrix requires more than one step, and the steps vary depending on the eventual use.</p>
<p>Since we are starting with areal (polygon) data, the starting point is to use a utility function, <code>poly2nb()</code>, that take a polygon spatial object (of class <code>sf</code> or <code>sp</code>) and determine which specific polygon regions are contiguous with (touch, share boundaries with) other regions. If you review the help documentation, you will see that the function takes a spatial <code>sf</code> object as the input, with arguments specifying whether to use <em>Queen</em> contiguity (default; <em>Rook</em> is the alternative). The function returns something called a <em>neighbor list</em>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="disease-mapping-ii.html#cb57-1"></a><span class="co"># load the package spdep</span></span>
<span id="cb57-2"><a href="disease-mapping-ii.html#cb57-2"></a><span class="kw">library</span>(spdep)</span>
<span id="cb57-3"><a href="disease-mapping-ii.html#cb57-3"></a></span>
<span id="cb57-4"><a href="disease-mapping-ii.html#cb57-4"></a><span class="co"># Create a queen contiguity neighbor list</span></span>
<span id="cb57-5"><a href="disease-mapping-ii.html#cb57-5"></a>queen_nb &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(vlbw, <span class="dt">queen =</span> <span class="ot">TRUE</span>)</span>
<span id="cb57-6"><a href="disease-mapping-ii.html#cb57-6"></a></span>
<span id="cb57-7"><a href="disease-mapping-ii.html#cb57-7"></a><span class="co"># Examine the resulting object</span></span>
<span id="cb57-8"><a href="disease-mapping-ii.html#cb57-8"></a><span class="kw">summary</span>(queen_nb)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 860 
## Percentage nonzero weights: 3.401764 
## Average number of links: 5.408805 
## Link number distribution:
## 
##  1  2  3  4  5  6  7  8  9 10 
##  1  4 12 29 36 37 28  9  1  2 
## 1 least connected region:
## 64 with 1 link
## 2 most connected regions:
## 1 66 with 10 links</code></pre>
<p>The <code>summary()</code> function for objects of class <code>nb</code> (a <em>neighbor</em> object created in <code>spdep</code>) provides some useful high-level info, including the presence of regions with zero links (no neighbors â€“ a problem that could occur with islands, for example), and the distribution of number of links or neighbors. You might want to look at the structure of the <code>queen_nb</code> object also, either using <code>str(queen_nb)</code>, or perhaps just viewing the first few elements in the list (e.g.Â because <code>nb</code> objects are of class <code>list</code> in R, use the double-bracket indexing of lists like this <code>queen_nb[[1]]</code>).</p>
<p>The neighbor object is essentially a list with length equal to the number of regions (<span class="math inline">\(n=159\)</span> counties in this case). The elements in the list correspond to the order of the input dataset, with the first list item being the first county in the current sort order. Each element in the list is a vector identifying <em>which other</em> counties are neighbors to it.</p>
<p>One important attribute of spatial relationships is whether they are <em>symmetric</em> or not. In the context of spatial neighbors, spatial symmetry implies that if <span class="math inline">\(region_i\)</span> is a neighbor to <span class="math inline">\(region_j\)</span>, then <span class="math inline">\(region_j\)</span> is also a neighbor to <span class="math inline">\(region_i\)</span>. Contiguity neighbors are symmetric by design: if the definition of <em>neighbor</em> is shared boundaries, that is true for either partner in the relationship. We will see below that not all definitions of spatial relationships and neighbors result in symmetric relationships. A quick way to check whether a neighbor object is symmetric or not is this code:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="disease-mapping-ii.html#cb59-1"></a><span class="kw">is.symmetric.nb</span>(queen_nb)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>To better understand a set of spatial relationships, it can be useful to visualize neighbor links or connections when choosing among a neighbor definition, simply to see the relative density and pattern of connectivity. Note that the function <code>plot.nb()</code> has the <code>nb</code> object as its first argument, but must also include a matrix of centroids as the second argument. The reason is that the <code>nb</code> object defines <em>which</em> region connects to <em>which</em>, but does not say where they are in space. The centroids tell the plot <em>where</em> each link or line begins and ends.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="disease-mapping-ii.html#cb61-1"></a><span class="co"># Create a matrix of the x,y coordinates for each county centroid</span></span>
<span id="cb61-2"><a href="disease-mapping-ii.html#cb61-2"></a>ga_cent &lt;-<span class="st"> </span><span class="kw">st_centroid</span>(<span class="kw">st_geometry</span>(vlbw))</span>
<span id="cb61-3"><a href="disease-mapping-ii.html#cb61-3"></a></span>
<span id="cb61-4"><a href="disease-mapping-ii.html#cb61-4"></a><span class="co"># Plot the outlines of counties with light grey boundaries</span></span>
<span id="cb61-5"><a href="disease-mapping-ii.html#cb61-5"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb61-6"><a href="disease-mapping-ii.html#cb61-6"></a></span>
<span id="cb61-7"><a href="disease-mapping-ii.html#cb61-7"></a><span class="co"># Add the plot of the Queen contiguity connections</span></span>
<span id="cb61-8"><a href="disease-mapping-ii.html#cb61-8"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
<p>Notice how the density of neighbors is generally lower on the coast and at state boundaries. This systematic difference in neighbors can produce patterns sometimes referred to as <em>edge effects</em>. These edge effects could be a source of bias, because counties in the interior of the state have more neighbors (and thus more â€˜<em>local information</em>â€™ on average) than border counties. This is especially true when the absence of neighbors is artificial as in the case of counties bordering Alabama, Tennessee, North or South Carolina, Florida. In contrast, counties on the coast have a â€˜<em>real</em>â€™ absence of neighbors.</p>
</div>
<div id="creating-k-nearest-neighbors" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Creating k-nearest neighbors</h3>
<p><em>K-nearest neighbors</em> is a flexible approach to assuring balanced number of neighbors, and can help when the size and density of the spatial regions varies across the study area. For instance a fixed-distance buffer (e.g.Â perhaps counties within 50 miles) might work to identify relevant neighbors in the Eastern or Midwestern U.S., but in the West, where a county may be 100-200 miles across, there would be <em>zero</em> neighbors with this definition. But with <em>K-nearest neighbors</em>, both smaller Eastern and larger Western counties would have neighbors (albeit of differing spatial scales).</p>

<div class="rmdnote">
Because <em>k-nearest neighbors</em> does not depend on either arbitrary fixed distance, nor on contiguity, it will always produce neighbors even for islands. For example in analyses of U.S. states, Alaska and Hawaii have no contiguous neighbors. However, a k-nearest neighbor approach would still assign the <em>nearest neighbor</em> regardless of how far away. For instance the nearest neighbor to Hawaii might be California. The question you must ask yourself is whether it is meaningful to say Hawaii and California are neighbors. If you are interested in food environment, that seems implausible. However, there is a great deal of social, cultural, and economic interaction between Hawaii and California; so in some instances this could be a plausible and meaningful connection.
</div>
<p>To create a <em>k-nearest neighbor</em> object, we first must identify the relative proximity of candidate neighbors. To define <em>who is nearest to whom</em>, by convention we measure Euclidean distance between the <em>centroids</em> of polygons (literally the geometric center), under the assumption that this is an <em>average</em> location to describe the polygon. This requires two steps.</p>
<p>First, the <code>knearneigh()</code> function takes these centroids, calculates all pair-wise distances, sorts them from closest to furthest, and then selects the <span class="math inline">\(k\)</span> nearest (or smallest distance) units. Then the <code>knn2nb()</code> function takes this information and creates a formal <code>nb</code> or <em>neighbor</em> object.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="disease-mapping-ii.html#cb62-1"></a><span class="co"># First create two sets of neighbors: 2 nearest and 5 nearest</span></span>
<span id="cb62-2"><a href="disease-mapping-ii.html#cb62-2"></a>knn2 &lt;-<span class="st"> </span><span class="kw">knearneigh</span>(ga_cent, <span class="dt">k =</span> <span class="dv">2</span>)</span>
<span id="cb62-3"><a href="disease-mapping-ii.html#cb62-3"></a>knn5 &lt;-<span class="st"> </span><span class="kw">knearneigh</span>(ga_cent, <span class="dt">k =</span> <span class="dv">5</span>)</span>
<span id="cb62-4"><a href="disease-mapping-ii.html#cb62-4"></a></span>
<span id="cb62-5"><a href="disease-mapping-ii.html#cb62-5"></a><span class="co"># Now take those lists of neighbors and make an nb object</span></span>
<span id="cb62-6"><a href="disease-mapping-ii.html#cb62-6"></a>knn2_nb &lt;-<span class="st"> </span><span class="kw">knn2nb</span>(knn2, <span class="dt">row.names =</span> vlbw<span class="op">$</span>GEOID)</span>
<span id="cb62-7"><a href="disease-mapping-ii.html#cb62-7"></a>knn5_nb &lt;-<span class="st"> </span><span class="kw">knn2nb</span>(knn5, <span class="dt">row.names =</span> vlbw<span class="op">$</span>GEOID)</span>
<span id="cb62-8"><a href="disease-mapping-ii.html#cb62-8"></a></span>
<span id="cb62-9"><a href="disease-mapping-ii.html#cb62-9"></a><span class="kw">summary</span>(knn5_nb)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 795 
## Percentage nonzero weights: 3.144654 
## Average number of links: 5 
## Non-symmetric neighbours list
## Link number distribution:
## 
##   5 
## 159 
## 159 least connected regions:
## 13121 13029 13135 13127 13271 13279 13301 13007 13143 13221 13137 13289 13105 13051 13073 13189 13103 13319 13209 13317 13241 13033 13261 13249 13309 13113 13123 13157 13215 13311 13265 13019 13291 13171 13263 13001 13303 13027 13305 13133 13251 13163 13195 13013 13153 13205 13025 13009 13021 13217 13213 13151 13185 13181 13313 13183 13031 13245 13141 13191 13049 13079 13283 13083 13139 13107 13179 13229 13075 13267 13039 13077 13219 13315 13285 13095 13115 13225 13045 13035 13161 13097 13071 13237 13081 13011 13109 13017 13255 13197 13003 13015 13275 13211 13235 13131 13065 13293 13287 13155 13227 13173 13223 13277 13145 13297 13129 13295 13055 13165 13243 13047 13233 13187 13117 13111 13063 13067 13207 13101 13167 13193 13239 13149 13069 13125 13085 13091 13201 13061 13321 13169 13281 13299 13037 13053 13307 13273 13159 13023 13093 13177 13257 13175 13269 13059 13089 13043 13147 13057 13231 13253 13087 13005 13119 13247 13099 13199 13259 with 5 links
## 159 most connected regions:
## 13121 13029 13135 13127 13271 13279 13301 13007 13143 13221 13137 13289 13105 13051 13073 13189 13103 13319 13209 13317 13241 13033 13261 13249 13309 13113 13123 13157 13215 13311 13265 13019 13291 13171 13263 13001 13303 13027 13305 13133 13251 13163 13195 13013 13153 13205 13025 13009 13021 13217 13213 13151 13185 13181 13313 13183 13031 13245 13141 13191 13049 13079 13283 13083 13139 13107 13179 13229 13075 13267 13039 13077 13219 13315 13285 13095 13115 13225 13045 13035 13161 13097 13071 13237 13081 13011 13109 13017 13255 13197 13003 13015 13275 13211 13235 13131 13065 13293 13287 13155 13227 13173 13223 13277 13145 13297 13129 13295 13055 13165 13243 13047 13233 13187 13117 13111 13063 13067 13207 13101 13167 13193 13239 13149 13069 13125 13085 13091 13201 13061 13321 13169 13281 13299 13037 13053 13307 13273 13159 13023 13093 13177 13257 13175 13269 13059 13089 13043 13147 13057 13231 13253 13087 13005 13119 13247 13099 13199 13259 with 5 links</code></pre>
<p>Notice how the summaries are not so interesting when we force everyone to have the same number of links! However in checking the symmetry, and important concern rises:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="disease-mapping-ii.html#cb64-1"></a><span class="kw">is.symmetric.nb</span>(knn2_nb)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="disease-mapping-ii.html#cb66-1"></a><span class="kw">is.symmetric.nb</span>(knn5_nb)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><em>K-nearest neighbors</em> will almost always produce <em>asymmetric</em> neighbors. Thinking about U.S. states is perhaps an easy way to understand this. Consider the state of Hawaii: the nearest states are probably California, Oregon, and Washington. However the inverse is not true. The nearest 2 (or 3 or 4 or 5) states to California are all in the contiguous â€˜lower 48â€™ states; Hawaii is certainly not among the <em>nearest</em> places to California.</p>
<p>This <em>asymmetry</em> is not a problem for spatial analytic tasks including the spatial Empirical Bayes smoothing we will do in this week. However, for some cluster analysis or other analyses in future weeks, neighbor symmetry is assumed and required. If you choose a <em>k-nearest neighbor</em> definition, but you also require symmetric spatial relationships, you can force symmetry in at least two ways. First, you could specify <code>sym  = TRUE</code> in the <code>knn2nb()</code> call above. That essentially <em>breaks</em> the rigid <em>k-nearest neighbors</em> and forces reciprocity in <em>â€˜neighborlinessâ€™</em>. The second method is appropriate if you have already created <em>asymmetric</em> neighbors, but wish to retrospectively force symmetry: <code>make.sym.nb()</code>. This simply takes an asymmetric neighbor object and adds links to make the relationships symmetric. Note, however, that this alters the number of links or neighbors for each region: some will now have more than others.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="disease-mapping-ii.html#cb68-1"></a>knn5_symmetric &lt;-<span class="st"> </span><span class="kw">make.sym.nb</span>(knn5_nb)</span>
<span id="cb68-2"><a href="disease-mapping-ii.html#cb68-2"></a><span class="kw">summary</span>(knn5_symmetric)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 910 
## Percentage nonzero weights: 3.599541 
## Average number of links: 5.72327 
## Link number distribution:
## 
##  5  6  7  8 
## 73 61 21  4 
## 73 least connected regions:
## 13121 13135 13127 13289 13105 13051 13103 13319 13317 13241 13033 13249 13113 13157 13215 13171 13027 13133 13251 13013 13009 13021 13181 13031 13245 13049 13079 13083 13107 13179 13267 13039 13219 13315 13285 13095 13225 13081 13017 13275 13235 13155 13145 13295 13055 13165 13243 13047 13233 13111 13207 13101 13167 13239 13149 13091 13201 13061 13281 13053 13159 13093 13177 13257 13175 13059 13147 13057 13231 13253 13087 13005 13099 with 5 links
## 4 most connected regions:
## 13007 13223 13129 13187 with 8 links</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="disease-mapping-ii.html#cb70-1"></a><span class="kw">is.symmetric.nb</span>(knn5_symmetric)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Note that now there are four counties with 8 links, rather than 5. That means each of those counties were the <em>nearest</em> to at least 3 others, even though those 3 were not <em>nearest</em> to them.</p>
<div id="visualizing-differences-between-competing-neighbor-definitions" class="section level4" number="5.3.2.1">
<h4><span class="header-section-number">5.3.2.1</span> Visualizing differences between competing neighbor definitions</h4>
<p>As a spatial analyst, you might be very interested in how the choice of neighbors affects your results. To better understand what is different from one definition to the next it can be helpful to visualize them side-by-side.</p>
<p>Using just base-R plotting (you could create fancier maps if desired with <code>ggplot</code> or <code>tmap</code>), we can easily visualize the county polygons, with lines connecting the centroids of <em>neighboring counties</em> as an indication of shared influence, contact, or interaction.</p>
<p>The function <code>plot.nb()</code> requires the spatial neighbor object (e.g.Â object of class <code>nb</code>), a matrix of the <span class="math inline">\(x, y\)</span> locations of polygon centroids, and then does the work of drawing the connecting lines.</p>
<p>The function in the code below named <code>diffnb()</code> is simply a utility function to compare two <code>nb</code> objects to determine what is the <em>same</em> and what is <em>different</em>. We can then plot the <em>different</em> values in red in order to quickly see what differs from one neighbor definition to the next.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="disease-mapping-ii.html#cb72-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),        <span class="co"># set plotting space for 3 side-by-side plots</span></span>
<span id="cb72-2"><a href="disease-mapping-ii.html#cb72-2"></a>    <span class="dt">mar =</span> <span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,<span class="dv">1</span>,.<span class="dv">2</span>))    <span class="co"># Set margins for plotting</span></span>
<span id="cb72-3"><a href="disease-mapping-ii.html#cb72-3"></a></span>
<span id="cb72-4"><a href="disease-mapping-ii.html#cb72-4"></a><span class="co"># Plot the knn = 2 neighbor connections</span></span>
<span id="cb72-5"><a href="disease-mapping-ii.html#cb72-5"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;knn = 2&#39;</span>)</span>
<span id="cb72-6"><a href="disease-mapping-ii.html#cb72-6"></a><span class="kw">plot.nb</span>(knn2_nb, ga_cent, <span class="dt">point =</span> F, <span class="dt">add =</span> T)</span>
<span id="cb72-7"><a href="disease-mapping-ii.html#cb72-7"></a></span>
<span id="cb72-8"><a href="disease-mapping-ii.html#cb72-8"></a><span class="co"># Plot the knn = 5 neighbor connections</span></span>
<span id="cb72-9"><a href="disease-mapping-ii.html#cb72-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;knn = 5&#39;</span>)</span>
<span id="cb72-10"><a href="disease-mapping-ii.html#cb72-10"></a><span class="kw">plot.nb</span>(knn5_nb, ga_cent, <span class="dt">point =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb72-11"><a href="disease-mapping-ii.html#cb72-11"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(knn2_nb, knn5_nb), ga_cent, <span class="dt">point =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb72-12"><a href="disease-mapping-ii.html#cb72-12"></a></span>
<span id="cb72-13"><a href="disease-mapping-ii.html#cb72-13"></a><span class="co"># Plot the knn = 5 AND the differences (in red) when knn = 5 is made symmetric</span></span>
<span id="cb72-14"><a href="disease-mapping-ii.html#cb72-14"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Symmetric Knn5&#39;</span>)</span>
<span id="cb72-15"><a href="disease-mapping-ii.html#cb72-15"></a><span class="kw">plot.nb</span>(knn5_nb, ga_cent, <span class="dt">point =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb72-16"><a href="disease-mapping-ii.html#cb72-16"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(knn5_nb, knn5_symmetric), ga_cent, <span class="dt">point =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-107-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="disease-mapping-ii.html#cb73-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>It is no surprise that there are lots of red lines on the <em>knn5</em> as compared with the <em>knn2</em>. Every single county has 3 additional neighbors in the former compared to the latter. However it is interesting to see how many initially <em>asymmetric</em> relationships had to have added links in order to enforce <em>symmetry</em> (e.g.Â the red lines in the right-hand plot, compared to middle).</p>
</div>
</div>
<div id="creating-graph-based-triangle-neighbor-objects" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Creating Graph-based triangle neighbor objects</h3>
<p>The contiguity framework takes the reasonable approach that <em>local</em> implies direct interaction as indicated by shared borders. However in many instances, the odd shape of polygons means that regions could be quite close to one another but not share a border. A different approach â€“ one of two methods weâ€™ll discuss called <em>graph-based neighbors</em> â€“ defines the local neighbors by relative proximity using a geometry approach. The process subdivides the space into non-overlapping triangles, using the centroids of each region as vertices in the triangle. A <em>neighbor</em> is therefore any region that is connected by an edge (link) between two vertices (centroids). More practically, this results in neighbor region that are near(ish) but are not required to have touching-borders. Graph-based neighbor objects are symmetric by design.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="disease-mapping-ii.html#cb74-1"></a>tri_nb &lt;-<span class="st"> </span><span class="kw">tri2nb</span>(ga_cent)</span>
<span id="cb74-2"><a href="disease-mapping-ii.html#cb74-2"></a><span class="kw">summary</span>(tri_nb)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 918 
## Percentage nonzero weights: 3.631185 
## Average number of links: 5.773585 
## Link number distribution:
## 
##  3  4  5  6  7  8 
##  1 18 40 63 31  6 
## 1 least connected region:
## 15 with 3 links
## 6 most connected regions:
## 58 65 82 107 118 120 with 8 links</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="disease-mapping-ii.html#cb76-1"></a><span class="kw">is.symmetric.nb</span>(tri_nb)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Look back at the summary for the <code>queen_nb</code> object created previously. This graph-based neighbor definition results in slightly more connections for every county as compared with Queen contiguity, but also reduces the variation in number of links. The Queen had counties with as many as 10 links and some with only 1 link; in contrast this graph-based definition results in counties ranging from a minimum of 3 neighbors to a maximum of 8.</p>
<p>To visualize the triangularized neighbors we can plot their links, next to the <em>Queen contiguity</em> to compare.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="disease-mapping-ii.html#cb78-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),        <span class="co"># set plotting space for 2 side-by-side plots</span></span>
<span id="cb78-2"><a href="disease-mapping-ii.html#cb78-2"></a>    <span class="dt">mar =</span> <span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,<span class="dv">1</span>,.<span class="dv">2</span>))    <span class="co"># Set margins for plotting</span></span>
<span id="cb78-3"><a href="disease-mapping-ii.html#cb78-3"></a></span>
<span id="cb78-4"><a href="disease-mapping-ii.html#cb78-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Queen contiguity&#39;</span>) <span class="co"># plot the polygons</span></span>
<span id="cb78-5"><a href="disease-mapping-ii.html#cb78-5"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) <span class="co"># plot the Queen neighbor links</span></span>
<span id="cb78-6"><a href="disease-mapping-ii.html#cb78-6"></a></span>
<span id="cb78-7"><a href="disease-mapping-ii.html#cb78-7"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Triangle neighbors&#39;</span>)</span>
<span id="cb78-8"><a href="disease-mapping-ii.html#cb78-8"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb78-9"><a href="disease-mapping-ii.html#cb78-9"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(queen_nb, tri_nb), ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="disease-mapping-ii.html#cb79-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))  <span class="co"># This just resets the graphic device to be 1-plot per page</span></span></code></pre></div>
<p>Notice how the graph-based neighbors have strange connections along the Western border of Georgia. This is because the Delauney triangle algorithm makes unexpected connections between centroids along edges. If we thought these were unreasonable spatial relationships (I think they are!), we can <em>prune</em> them down by using a <em>Sphere of Influence</em> graph to restrict to more proximate relationships. In most instances, carrying out this pruning to produce <em>sphere of influence</em> graph neighbors is most sensible as compared to using the product we have at this stage.</p>
<p>The code is a little intimidating looking: It includes some nested functions where the original triangle neighbor object is fed into the <code>soi.graph()</code> function, which itself is fed into the <code>graph2nb()</code> function. But basically what it is doing is looking for ties or connections defined by the triangularization algorithm that are also proximate.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="disease-mapping-ii.html#cb80-1"></a>soi_nb &lt;-<span class="st"> </span><span class="kw">graph2nb</span>(<span class="kw">soi.graph</span>(tri_nb, ga_cent))</span>
<span id="cb80-2"><a href="disease-mapping-ii.html#cb80-2"></a></span>
<span id="cb80-3"><a href="disease-mapping-ii.html#cb80-3"></a><span class="kw">summary</span>(soi_nb)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 850 
## Percentage nonzero weights: 3.362209 
## Average number of links: 5.345912 
## Link number distribution:
## 
##  3  4  5  6  7  8 
## 11 35 32 53 25  3 
## 11 least connected regions:
## 14 15 21 64 71 87 96 120 123 124 152 with 3 links
## 3 most connected regions:
## 65 82 107 with 8 links</code></pre>
<p>To see how <em>Queen</em> neighbors compares to each we can plot them:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="disease-mapping-ii.html#cb82-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>),        <span class="co"># set plotting space for 3 side-by-side plots</span></span>
<span id="cb82-2"><a href="disease-mapping-ii.html#cb82-2"></a>    <span class="dt">mar =</span> <span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,<span class="dv">1</span>,.<span class="dv">2</span>))    <span class="co"># Set margins for plotting</span></span>
<span id="cb82-3"><a href="disease-mapping-ii.html#cb82-3"></a></span>
<span id="cb82-4"><a href="disease-mapping-ii.html#cb82-4"></a><span class="co"># Plot Queen</span></span>
<span id="cb82-5"><a href="disease-mapping-ii.html#cb82-5"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Triangle neighbors&#39;</span>) <span class="co"># plot the polygons</span></span>
<span id="cb82-6"><a href="disease-mapping-ii.html#cb82-6"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) <span class="co"># plot the Queen neighbor links</span></span>
<span id="cb82-7"><a href="disease-mapping-ii.html#cb82-7"></a></span>
<span id="cb82-8"><a href="disease-mapping-ii.html#cb82-8"></a></span>
<span id="cb82-9"><a href="disease-mapping-ii.html#cb82-9"></a><span class="co"># Plot triangle and differences from Queen</span></span>
<span id="cb82-10"><a href="disease-mapping-ii.html#cb82-10"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Triangle neighbors&#39;</span>) </span>
<span id="cb82-11"><a href="disease-mapping-ii.html#cb82-11"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) </span>
<span id="cb82-12"><a href="disease-mapping-ii.html#cb82-12"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(tri_nb, queen_nb), ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) </span>
<span id="cb82-13"><a href="disease-mapping-ii.html#cb82-13"></a></span>
<span id="cb82-14"><a href="disease-mapping-ii.html#cb82-14"></a><span class="co"># Plot Sphere of Influence and differences from Queen</span></span>
<span id="cb82-15"><a href="disease-mapping-ii.html#cb82-15"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Sphere of Influence pruning&#39;</span>)</span>
<span id="cb82-16"><a href="disease-mapping-ii.html#cb82-16"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) </span>
<span id="cb82-17"><a href="disease-mapping-ii.html#cb82-17"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(queen_nb, soi_nb), ga_cent, <span class="dt">add =</span> T, <span class="dt">points =</span> F, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) </span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="disease-mapping-ii.html#cb83-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))  <span class="co"># This just resets the graphic device to be 1-plot per page</span></span></code></pre></div>
</div>
<div id="creating-fixed-distance-neighbors" class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Creating fixed-distance neighbors</h3>
<p>The concept of <em>buffering</em> around locations to define exposure is probably familiar. It is not uncommon for exposures such as access to health services, healthy food stores, or exposure to toxin emitters is quantified using fixed-distance buffers. The fixed-distance neighbor definition is therefore a natural extension, where we believe that the definition of <em>local</em> or <em>near</em> can be described by who (or where) falls within a given radius. In that way it is different from all of the previous approaches because neither sharing borders, nor being the k-nearest neighbor is required. All that is required is that the place (or more specifically the centroid of the place), falls within the designated distance. The number of other units falling within a given threshold could range from zero to the maximum number of units in the study, and certainly could vary from one location to another (e.g.Â thinking again about distinctions between Easter and Western counties in the U.S.).</p>
<p>Determining an appropriate distance can be challenging unless there is clear theory or evidence (e.g.Â the distance required to avoid exposure to radiation from a fixed point source). Often analysts consider a range of distances to understand how or whether the pattern changes under competing scenarios. This approach will be used more when we investigate spatial clusters of disease.</p>
<p>To define fixed-distance neighbors, we use the function <code>dnearneigh()</code> and must define both a minimum distance (probably but not always set at zero), and a maximum distance defining the buffer.</p>

<div class="rmdcaution">
Note that the distance parameters are described on the <em>scale of the coordinate measures of the spatial object</em>. In this case, the spatial object is projected, and the units are meters. Therefore a distance of 1000 is 1 kilometer. However, beware of using distance measures for unprojected data, as the units are the somewhat opaque angular degrees.
</div>
<p>Here we calculate neighbors for two distance buffers: all counties within 25km and all within 50km of the centroid of each county are neighbors; all other counties are not neighbors. Notice that the output of each instance of <code>dnearneigh()</code> is not just the distances themselves, but is actually a formal neighbor (<code>nb</code>) object.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="disease-mapping-ii.html#cb84-1"></a>dist_<span class="dv">25</span> &lt;-<span class="st"> </span><span class="kw">dnearneigh</span>(ga_cent, <span class="dt">d1 =</span> <span class="dv">0</span>, <span class="dt">d2 =</span> <span class="dv">25000</span>)</span>
<span id="cb84-2"><a href="disease-mapping-ii.html#cb84-2"></a>dist_<span class="dv">50</span> &lt;-<span class="st"> </span><span class="kw">dnearneigh</span>(ga_cent, <span class="dt">d1 =</span> <span class="dv">0</span>, <span class="dt">d2 =</span> <span class="dv">50000</span>)</span>
<span id="cb84-3"><a href="disease-mapping-ii.html#cb84-3"></a><span class="kw">summary</span>(dist_<span class="dv">50</span>)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 159 
## Number of nonzero links: 1072 
## Percentage nonzero weights: 4.240339 
## Average number of links: 6.742138 
## Link number distribution:
## 
##  3  4  5  6  7  8  9 10 11 12 
## 10 18 20 21 33 21 21 10  4  1 
## 10 least connected regions:
## 4 14 22 41 61 71 96 120 152 153 with 3 links
## 1 most connected region:
## 156 with 12 links</code></pre>
<p>We can compare the linkages of these two distance bands to one another:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="disease-mapping-ii.html#cb86-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),        <span class="co"># set plotting space for 2 side-by-side plots</span></span>
<span id="cb86-2"><a href="disease-mapping-ii.html#cb86-2"></a>    <span class="dt">mar =</span> <span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,<span class="dv">1</span>,.<span class="dv">2</span>))    <span class="co"># Set margins for plotting</span></span>
<span id="cb86-3"><a href="disease-mapping-ii.html#cb86-3"></a></span>
<span id="cb86-4"><a href="disease-mapping-ii.html#cb86-4"></a></span>
<span id="cb86-5"><a href="disease-mapping-ii.html#cb86-5"></a><span class="co"># Plot neighbor relations for 25 km</span></span>
<span id="cb86-6"><a href="disease-mapping-ii.html#cb86-6"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;25 km neighbors&#39;</span>)</span>
<span id="cb86-7"><a href="disease-mapping-ii.html#cb86-7"></a><span class="kw">plot.nb</span>(dist_<span class="dv">25</span>, ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T)</span>
<span id="cb86-8"><a href="disease-mapping-ii.html#cb86-8"></a></span>
<span id="cb86-9"><a href="disease-mapping-ii.html#cb86-9"></a><span class="co"># Plot neighbor relations for 50 km</span></span>
<span id="cb86-10"><a href="disease-mapping-ii.html#cb86-10"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;50 km neighbors&#39;</span>)</span>
<span id="cb86-11"><a href="disease-mapping-ii.html#cb86-11"></a><span class="kw">plot.nb</span>(dist_<span class="dv">50</span>, ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="disease-mapping-ii.html#cb87-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Or we could compare one to a previous definition (e.g.Â the <em>Queen contiguity</em>).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="disease-mapping-ii.html#cb88-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),        <span class="co"># set plotting space for 2 side-by-side plots</span></span>
<span id="cb88-2"><a href="disease-mapping-ii.html#cb88-2"></a>    <span class="dt">mar =</span> <span class="kw">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>,<span class="dv">1</span>,.<span class="dv">2</span>))    <span class="co"># Set margins for plotting</span></span>
<span id="cb88-3"><a href="disease-mapping-ii.html#cb88-3"></a></span>
<span id="cb88-4"><a href="disease-mapping-ii.html#cb88-4"></a><span class="co"># Plot queen for reference</span></span>
<span id="cb88-5"><a href="disease-mapping-ii.html#cb88-5"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Queen&#39;</span>)</span>
<span id="cb88-6"><a href="disease-mapping-ii.html#cb88-6"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb88-7"><a href="disease-mapping-ii.html#cb88-7"></a></span>
<span id="cb88-8"><a href="disease-mapping-ii.html#cb88-8"></a><span class="co"># Plot the difference between queen and dist_50</span></span>
<span id="cb88-9"><a href="disease-mapping-ii.html#cb88-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(vlbw), <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Difference of Queen &amp; 50-km dist&#39;</span>)</span>
<span id="cb88-10"><a href="disease-mapping-ii.html#cb88-10"></a><span class="kw">plot.nb</span>(queen_nb, ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb88-11"><a href="disease-mapping-ii.html#cb88-11"></a><span class="kw">plot.nb</span>(<span class="kw">diffnb</span>(queen_nb, dist_<span class="dv">50</span>), ga_cent, <span class="dt">points =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="disease-mapping-ii.html#cb89-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="from-spatial-neighbors-to-spatial-disease-mapping" class="section level3" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> From spatial neighbors to spatial Disease Mapping</h3>
<p>The main reason for struggling through all of the preceding ins and outs of spatial neighbors is because we would like to define a reasonable version of <em>local</em> given a spatial dataset, and use that definition to advance spatial epidemiologic goals. As discussed above, a primary goal is the production of statistically stable rates, with less bouncing around from small numbers.</p>
<p>To state it again: statistics cannot solve some fundamental problems of sparse data! However, statistical disease mapping methods, including Empirical Bayes and fully Bayesian methods, can use all available information to recover important underlying geographic trends in some instances.</p>
<div id="empirical-bayes-overview" class="section level4" number="5.3.5.1">
<h4><span class="header-section-number">5.3.5.1</span> Empirical Bayes Overview</h4>
<p>Bayesian thinking is a mathematical operationalization of a relatively intuitive process we all engage in: we often have <strong>prior information</strong> or <strong>prior beliefs</strong> about what is plausible, informed by our experiences and the literature and evidence to date, against which we judge a given statistic or dataset. We internally (often sub-consciously) combine those pieces (the <em>prior</em> and the <em>data</em>) to develop a new, updated belief, or <em>posterior belief</em>. The Bayesian process is a framework from moving this implicit cognitive process out into the open, by stating mathematically what our prior belief is, and therefore how we arrived at a new updated, posterior, belief.</p>
<p>Empirical Bayes disease rate smoothing is a process by which we take a set of regions, and consider each of them as <em>data</em>, with the question, â€˜<em>What is the truest underlying rate of disease in this place?</em>â€™ We compare this observed data with some <em>prior belief</em> or expectation of what the rate could plausibly be (not specifically, but approximately or within a range).</p>
<p>Where we get the prior is important and potentially impactful; conventionally for <em>aspatial Empirical Bayes</em> smoothing we use the overall average rate for the entire study period as the <em>prior</em>. In other words, we sum all of the cases across regions, and all of the population at risk across region, to calculate a single reference rate, and the variance around that expectation. This reference rate (the <em>prior</em>) is then combined with the observed data in a weighted fashion where the prior is weighted higher in small-population regions, and the data is weighted higher in large-population regions. The result of this weighted calculation is a <em>posterior</em> or <em>smoothed</em> estimate of the rate.</p>
<p>Recall that last week we calculated the aspatial Empirical Bayes estimate of very low birthweight. The prior information for this estimation comes from the size of each counties <code>expected</code> count. Specifically a mean, <span class="math inline">\(\mu\)</span>, and variance, <span class="math inline">\(\sigma^2\)</span> are estimated from all <span class="math inline">\(n=159\)</span> counties <code>expected</code> count, and this single, global, overall prior was used for the strategy used last week.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="disease-mapping-ii.html#cb90-1"></a><span class="co"># Calculate aspatial EB</span></span>
<span id="cb90-2"><a href="disease-mapping-ii.html#cb90-2"></a>global_eb1 &lt;-<span class="st"> </span><span class="kw">eBayes</span>(vlbw<span class="op">$</span>VLBW, vlbw<span class="op">$</span>expected)</span>
<span id="cb90-3"><a href="disease-mapping-ii.html#cb90-3"></a></span>
<span id="cb90-4"><a href="disease-mapping-ii.html#cb90-4"></a><span class="co"># Add the crude/observed SMR to the data</span></span>
<span id="cb90-5"><a href="disease-mapping-ii.html#cb90-5"></a>vlbw<span class="op">$</span>eb_global &lt;-<span class="st"> </span>global_eb1<span class="op">$</span>RR</span>
<span id="cb90-6"><a href="disease-mapping-ii.html#cb90-6"></a></span>
<span id="cb90-7"><a href="disease-mapping-ii.html#cb90-7"></a><span class="co"># Convert the aspatial EB RR to a smoothed aspatial EB rate by multiplying by referent rate, r</span></span>
<span id="cb90-8"><a href="disease-mapping-ii.html#cb90-8"></a>vlbw<span class="op">$</span>EB_global &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span>vlbw<span class="op">$</span>eb_global</span></code></pre></div>

<div class="rmdcaution">
Beware of <em>what output</em> any given function is providing! One possible place for consusion here is that the output from the global aspatial Empirical Bayes estimate using <code>eBayes()</code> was the <em>excess relative ris</em> of each county as compared to the global referent (e.g.Â the statewide prevalence of VLBW). However the function we use for <em>spatial Empirical Bayes</em> (below) will output a <em>rate</em> rather than a <em>relative excess risk</em>. Luckily those two are closely related. The <code>RR</code> from <code>eBayes()</code> represents the relative deviation of each county from the statewide average. Because we <em>know the global average</em> (e.g.Â we calculated it as <code>r</code>), simply multiplying the <code>RR</code> value for each individual county by the single global referent, <code>r</code>, gives us an aspatial Empirical Bayes smoothed estimate of the <strong>rate</strong> for each county. This will therefore be comparable with the estimates from the spatial Empirical Bayes estimators.
</div>
</div>
</div>
<div id="spatial-empirical-bayes" class="section level3" number="5.3.6">
<h3><span class="header-section-number">5.3.6</span> Spatial Empirical Bayes</h3>
<p>By using our newly-created definitions of <em>local neighbors</em> among Georgia counties we can extend the Empirical Bayes approach by changing the source of the <em>prior</em> information. In the aspatial or global EB, the total rate for all of Georgia was the <em>prior</em> reference rate. However another option for providing statistical information about locally-varying <em>expected rates</em> is to use the <em>average of oneâ€™s neighbors</em> as a prior. This produces a sort of <em>borrowing of statistical information</em> through space, under the assumption that the local counties tell us more about a specific place than do counties far away.</p>
<p>Note that there is no expectation that counties next to one another do not differ, but instead that on average the local information is more informative than non-local. That being said, there are statistical approaches for disease mapping when you believe important spatial dissimilarities exist, or where you are searching for boundaries between areas of high and low rates. These can be implemented in the package <code>CARBayes</code> which will be introduced in the upcoming (optional) section on fully Bayesian disease mapping.</p>
<p>The spatial EB, thus follows the same process as the global or aspatial EB, but with a different prior. And because the prior is defined by the <em>local neighbors</em>, the different choices of neighbor object will likely have at least some influence on the resulting geographic smoothed patterns.</p>
<p>The function for estimating spatial Empirical Bayes is <code>EBlocal()</code> from the <code>spdep</code> package, and it requires not only the count of events and the count of population at risk for each county, but also a <code>nb</code> neighbor object. Although we highlighted the importance of neighbor symmetry above for some spatial analysis, symmetric neighbors <em>are not required</em> for spatial Empirical Bayes estimation. (<strong>NOTE:</strong> there is currently no function in <code>R</code> to estimate spatial EB rates with credible/confidence intervals or p-values, as we could with the Poisson-Gamma model for aspatial).</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="disease-mapping-ii.html#cb91-1"></a><span class="co"># Estimate spatial (local) EB under the Queen contiguity neighbor definition</span></span>
<span id="cb91-2"><a href="disease-mapping-ii.html#cb91-2"></a>eb_queen &lt;-<span class="st"> </span><span class="kw">EBlocal</span>(vlbw<span class="op">$</span>VLBW, vlbw<span class="op">$</span>TOT, <span class="dt">nb =</span> queen_nb)</span>
<span id="cb91-3"><a href="disease-mapping-ii.html#cb91-3"></a></span>
<span id="cb91-4"><a href="disease-mapping-ii.html#cb91-4"></a><span class="co"># The output fro EBlocal() is a 2 column data.frame. The second colum is the EB estimate</span></span>
<span id="cb91-5"><a href="disease-mapping-ii.html#cb91-5"></a>vlbw<span class="op">$</span>EB_queen &lt;-<span class="st"> </span>eb_queen[,<span class="dv">2</span>]</span></code></pre></div>
<p>Now we can create a spatial EB estimate for other neighbor definitions in order to understand how robust or sensitive our ultimate results are to the choice of neighbors.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="disease-mapping-ii.html#cb92-1"></a><span class="co"># Use the sphere of influence-pruned Delauney triangle definition</span></span>
<span id="cb92-2"><a href="disease-mapping-ii.html#cb92-2"></a>eb_soi &lt;-<span class="st"> </span><span class="kw">EBlocal</span>(vlbw<span class="op">$</span>VLBW, vlbw<span class="op">$</span>TOT, <span class="dt">nb =</span> soi_nb)</span>
<span id="cb92-3"><a href="disease-mapping-ii.html#cb92-3"></a>vlbw<span class="op">$</span>EB_soi &lt;-<span class="st"> </span>eb_soi[,<span class="dv">2</span>]</span>
<span id="cb92-4"><a href="disease-mapping-ii.html#cb92-4"></a></span>
<span id="cb92-5"><a href="disease-mapping-ii.html#cb92-5"></a><span class="co"># Use the k-nearest neighbors (k=5) definition</span></span>
<span id="cb92-6"><a href="disease-mapping-ii.html#cb92-6"></a>eb_knn5 &lt;-<span class="st"> </span><span class="kw">EBlocal</span>(vlbw<span class="op">$</span>VLBW, vlbw<span class="op">$</span>TOT, <span class="dt">nb =</span> knn5_nb)</span>
<span id="cb92-7"><a href="disease-mapping-ii.html#cb92-7"></a>vlbw<span class="op">$</span>EB_knn5 &lt;-<span class="st"> </span>eb_knn5[,<span class="dv">2</span>]</span>
<span id="cb92-8"><a href="disease-mapping-ii.html#cb92-8"></a></span>
<span id="cb92-9"><a href="disease-mapping-ii.html#cb92-9"></a><span class="co"># Use the 50-km fixed distance neighbors</span></span>
<span id="cb92-10"><a href="disease-mapping-ii.html#cb92-10"></a>eb_dist50 &lt;-<span class="st"> </span><span class="kw">EBlocal</span>(vlbw<span class="op">$</span>VLBW, vlbw<span class="op">$</span>TOT, <span class="dt">nb =</span> dist_<span class="dv">50</span>)</span>
<span id="cb92-11"><a href="disease-mapping-ii.html#cb92-11"></a>vlbw<span class="op">$</span>EB_dist50 &lt;-<span class="st"> </span>eb_dist50[,<span class="dv">2</span>]</span></code></pre></div>
<div id="visualizing-alternate-smoothing-approaches" class="section level4" number="5.3.6.1">
<h4><span class="header-section-number">5.3.6.1</span> Visualizing alternate smoothing approaches</h4>
<p>Here is some code for simple visual comparison of the raw/observed, aspatial EB, and a variety of spatially-smoothed EB estimates. Where does <em>any EB smoothing</em> versus the <em>raw/observed</em> estimates differ? Where do the <em>spatial EB</em> estimates differ from the <em>aspatial EB</em> estimate? And what differences do you notice <em>among</em> the various <em>spatial EB</em> estimates, distinguished by their unique definitions of local?</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="disease-mapping-ii.html#cb93-1"></a><span class="kw">tm_shape</span>(vlbw) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-2"><a href="disease-mapping-ii.html#cb93-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;rate&#39;</span>, <span class="st">&#39;EB_global&#39;</span>, <span class="st">&#39;EB_queen&#39;</span>, <span class="st">&#39;EB_soi&#39;</span>, <span class="st">&#39;EB_knn5&#39;</span>, <span class="st">&#39;EB_dist50&#39;</span>),</span>
<span id="cb93-3"><a href="disease-mapping-ii.html#cb93-3"></a>          <span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb93-4"><a href="disease-mapping-ii.html#cb93-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb93-5"><a href="disease-mapping-ii.html#cb93-5"></a>          <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">&#39;Unsmoothed&#39;</span>, <span class="st">&#39;Aspatial&#39;</span>, <span class="st">&#39;Queen contig&#39;</span>, <span class="st">&#39;Delauney&#39;</span>, <span class="st">&#39;Knn = 5&#39;</span>, <span class="st">&#39;50-km fixed&#39;</span>)) <span class="op">+</span></span>
<span id="cb93-6"><a href="disease-mapping-ii.html#cb93-6"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-7"><a href="disease-mapping-ii.html#cb93-7"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&#39;RIGHT&#39;</span>, <span class="st">&#39;TOP&#39;</span>),</span>
<span id="cb93-8"><a href="disease-mapping-ii.html#cb93-8"></a>            <span class="dt">legend.format =</span> <span class="kw">list</span>(<span class="dt">fun=</span><span class="cf">function</span>(x) <span class="kw">paste0</span>(<span class="kw">formatC</span>(x <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb93-9"><a href="disease-mapping-ii.html#cb93-9"></a>                                                                <span class="dt">digits=</span><span class="dv">1</span>, </span>
<span id="cb93-10"><a href="disease-mapping-ii.html#cb93-10"></a>                                                                <span class="dt">format=</span><span class="st">&quot;f&quot;</span>), <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb93-11"><a href="disease-mapping-ii.html#cb93-11"></a>            <span class="dt">inner.margins =</span> <span class="kw">c</span>(.<span class="dv">02</span>,.<span class="dv">02</span>,<span class="fl">0.1</span>, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p>As we saw last week, there are some differences between the observed (crude) rates and the aspatial EB. However we can see even more dramatic differences for all four of the <em>spatial EB</em> rates as compared with either observed or aspatial. Among the spatial EB estimates there are only minor differences suggesting that â€“ among this set of neighbor definitions, and for this outcome â€“ there is relatively consistent patterns of VLBW regardless of choice of neighbors (e.g.Â our answer is relatively <em>robust</em> to neighbor definition).</p>
</div>
</div>
<div id="final-thoughts-making-choices" class="section level3" number="5.3.7">
<h3><span class="header-section-number">5.3.7</span> Final thoughts: Making choices</h3>
<p>Over the past two weeks we have quickly amassed a large number of analytic tools to address one problem in spatial epidemiology: reliably characterize <em>spatial heterogeneity</em> in the presence of <em>rate instability</em> and uncertainty due to data sparsity. These analytic strategies include the two approaches to Empirical Bayes smoothing, but also the myriad of neighbor definitions for when we do choose a spatial approach. Unfortunately there is no simple rule to follow when choosing which tool to use, but below is a summary of considerations. Ultimately you make decisions in the context of the epidemiologic question, the constraints of the data, and the audience or end-user of the results. As with many things in epidemiologic analysis, there is an important role for <em>science</em> but also a need for experts who can engage in the <em>art</em> of analysis.</p>
<table>
<colgroup>
<col width="20%" />
<col width="35%" />
<col width="44%" />
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Uses</th>
<th>Assumptions and comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Aspatial Empirical Bayes</strong></td>
<td>Smooth or shrink local rates towards <em>global</em> (overall) reference rate, with shrinkage inversely proportionate to variance / sample size in local region. <br> In one simulation study, aspatial (versus spatial) EB minimized mean-squared error (MSE) when the outcome is rare.</td>
<td><strong>1.</strong> The best prior estimation of plausible rates (mean and variance) is the overall average. <br> <strong>2.</strong> The reason for sparsity is about both numerator and denominator (e.g.Â both a rare disease, and small populations at risk).</td>
</tr>
<tr class="even">
<td><strong>Spatial Empirical Bayes</strong></td>
<td>Smooth or shrink local rates towards <em>local</em> reference. In simulation study, spatial (local) EB outperformed aspatial when outcomes were not rare.</td>
<td><strong>1.</strong> There is at least some spatial auto correlation in rates such that nearby-regions rates serve as a more informative prior than the global average. <br> <strong>2.</strong> The reason for sparsity is primarily about the denominator (e.g.Â small population at risk), but the health outcome itself is not rare (in the overall region).</td>
</tr>
</tbody>
</table>
<div id="choosing-neighborhood-definitions" class="section level4" number="5.3.7.1">
<h4><span class="header-section-number">5.3.7.1</span> Choosing <em>â€˜neighborhoodâ€™</em> definitions</h4>
<p>As you can see, there are a lot of ways of describing <em>local</em>, and we havenâ€™t even talked about inverse-distance weighting. So how do you go about choosing one definition over another? This is an example of the intersection of the <em>art</em> and <em>science</em> of spatial epidemiology.</p>
<p>So, you might wonder how one decides when to smooth or not smooth, and when smoothing, which neighbor definition to use? There is a lot written about this and very few final answers. There are actually three general approaches to selecting a neighbor definition:</p>
<ol style="list-style-type: decimal">
<li><strong>By maximizing precision or fit</strong> - this method is statistical in nature and implies that best smoother <em>fits</em> the data best. It is possible to estimate the mean-squared error (MSE) or the root mean squared error (RMSE) to describe how far, on average, each observed rate is from the observed data, with the idea being that the closest <em>average</em> distance is best. We will discuss extensions of this idea of <em>model fit</em> when we move to fully Bayesian mapping. There is code below to estimate the RMSE.</li>
<li><strong>By theory, context, or question</strong> - most of my emphasis in explaining the neighbors has been on this approach. It is clearly important for the analyst to bring clarity about the question at hand, and the local context, to the decision of what is <em>sensibly local</em> for a given disease or health outcome. In some instances, one method clearly stands out from the others. However, it is not uncommon that there is moderate support (theoretically) for multiple. As you can see if you mapped the methods above, in our case there is only minor difference between the definitions for these data.</li>
<li><strong>By empirically estimating weights</strong> - I will not be covering this approach further. However, briefly, the idea here is to use the evidence for spatial auto correlation to inform how <em>spatially important</em> one unit is to another.</li>
</ol>
<p>My bottom line recommendation is to <em>think spatially</em> and consider the data, question, and goals at hand. For the purposes of disease mapping, error reduction and precision are driving goals, so comparing RMSE across competing options could make sense. However for other purposes, statistical fit might not equate with unbiased estimation of target parameters (the same is true for non-spatial analysis!).</p>
<p>Below is one simple approach to calculating the root mean squared error (RMSE). Recall that RMSE is the square root of the average squared difference between an observed value and its <em>model-predicted</em> (in our case EB-smoothed) value. The first bit of code is defining a simple function to calculate the RMSE. I define the function to have 2 arguments: <code>eb</code> is the Empirical Bayes estimate for <span class="math inline">\(region_i\)</span>, and <code>o</code> is the observed rate for <span class="math inline">\(region_i\)</span>.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="disease-mapping-ii.html#cb94-1"></a>RMSE &lt;-<span class="st"> </span><span class="cf">function</span>(eb, o){</span>
<span id="cb94-2"><a href="disease-mapping-ii.html#cb94-2"></a>  <span class="kw">sqrt</span>(<span class="kw">mean</span>((eb <span class="op">-</span><span class="st"> </span>o)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb94-3"><a href="disease-mapping-ii.html#cb94-3"></a>}</span>
<span id="cb94-4"><a href="disease-mapping-ii.html#cb94-4"></a></span>
<span id="cb94-5"><a href="disease-mapping-ii.html#cb94-5"></a><span class="kw">RMSE</span>(vlbw<span class="op">$</span>EB_global, vlbw<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 0.006809047</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="disease-mapping-ii.html#cb96-1"></a><span class="kw">RMSE</span>(vlbw<span class="op">$</span>EB_queen , vlbw<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 0.006404844</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="disease-mapping-ii.html#cb98-1"></a><span class="kw">RMSE</span>(vlbw<span class="op">$</span>EB_soi , vlbw<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 0.006471757</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="disease-mapping-ii.html#cb100-1"></a><span class="kw">RMSE</span>(vlbw<span class="op">$</span>EB_knn5 , vlbw<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 0.006529195</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="disease-mapping-ii.html#cb102-1"></a><span class="kw">RMSE</span>(vlbw<span class="op">$</span>EB_dist50 , vlbw<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 0.006433534</code></pre>
<p>So based on this, which fits best? In this case, the RMSE is quite similar, with slight advantage given to the <em>spatial Queen contiguity</em> definition. Although this is not strong evidence for preferring one strategy over another based on statistical fit alone. Therefore other factors (including purpose of map, audience, and theory of place underlying analysis) will be important in making decisions.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="disease-mapping-i.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="disease-mapping-iii.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mkram01/EPI563-SpatialEPI/edit/master/05-disease-mapping-2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["EPI563-SpatialEPI.pdf"],
"toc": {
"collapse": "section",
"toc_depth": 2,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
