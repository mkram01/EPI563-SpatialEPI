<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 6 Disease Mapping III | EPI 563: Spatial Epidemiology, Fall 2020</title>
  <meta name="description" content="Week 6 Disease Mapping III | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 6 Disease Mapping III | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="mkram01/EPI563-SpatialEPI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 6 Disease Mapping III | EPI 563: Spatial Epidemiology, Fall 2020" />
  
  
  

<meta name="author" content="Michael Kramer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="disease-mapping-ii.html"/>
<link rel="next" href="disease-mapping-iv.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>How to use this eBook</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#strategy-for-using-this-ebook"><i class="fa fa-check"></i>Strategy for using this eBook</a></li>
</ul></li>
<li class="part"><span><b>I Getting ready…</b></span></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a>
<ul>
<li><a href="software-installation.html#installing-r-on-your-computer">Installing <code>R</code> on your computer</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#installing-rstudio-on-your-computer"><i class="fa fa-check"></i>Installing RStudio on your computer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html"><i class="fa fa-check"></i>Installing packages for this course</a>
<ul>
<li><a href="installing-packages-for-this-course.html#installing-rtools40">Installing <code>Rtools40</code></a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-general-data-science"><i class="fa fa-check"></i>Installing packages used for general data science</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-use-for-geographic-data"><i class="fa fa-check"></i>Installing packages use for geographic data</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-data-manipulation-visualization"><i class="fa fa-check"></i>Installing packages used for spatial data manipulation &amp; visualization</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-analysis"><i class="fa fa-check"></i>Installing packages used for spatial analysis</a></li>
</ul></li>
<li class="part"><span><b>II Weekly Modules</b></span></li>
<li class="chapter" data-level="1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html"><i class="fa fa-check"></i><b>1</b> Locating Spatial Epidemiology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>1.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#learning-objectives"><i class="fa fa-check"></i><b>1.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i><b>1.1.2</b> Additional Resources</a></li>
<li class="chapter" data-level="1.1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#important-vocabulary"><i class="fa fa-check"></i><b>1.1.3</b> Important Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>1.2</b> Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>1.3</b> Spatial Analysis in Epidemiology</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-data-storage-foramts"><i class="fa fa-check"></i><b>1.3.1</b> Spatial data storage foramts</a></li>
<li class="chapter" data-level="1.3.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#representing-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.2</b> Representing spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#benefits-of-sf-data-classes"><i class="fa fa-check"></i><b>1.3.3</b> Benefits of <code>sf</code> data classes</a></li>
<li class="chapter" data-level="1.3.4" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.4</b> Working with spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#basic-visual-inspectionplots"><i class="fa fa-check"></i><b>1.3.5</b> Basic visual inspection/plots</a></li>
<li class="chapter" data-level="1.3.6" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-crs-and-projection"><i class="fa fa-check"></i><b>1.3.6</b> Working with CRS and projection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html"><i class="fa fa-check"></i><b>2</b> Cartography for Epidemiology I</a>
<ul>
<li class="chapter" data-level="2.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>2.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#learning-objectives-w2"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives, w2</a></li>
<li class="chapter" data-level="2.1.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#additional-resources-w2"><i class="fa fa-check"></i><b>2.1.2</b> Additional Resources, w2</a></li>
<li class="chapter" data-level="2.1.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#important-vocabulary-w2"><i class="fa fa-check"></i><b>2.1.3</b> Important Vocabulary, w2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-thinking-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.2</b> Spatial Thinking in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#color-choices"><i class="fa fa-check"></i><b>2.2.1</b> Color choices</a></li>
<li class="chapter" data-level="2.2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#choropleth-binning-styles"><i class="fa fa-check"></i><b>2.2.2</b> Choropleth binning styles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-analysis-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.3</b> Spatial Analysis in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-numerator-data"><i class="fa fa-check"></i><b>2.3.1</b> Obtaining and preparing numerator data</a></li>
<li class="chapter" data-level="2.3.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-denominator-or-contextual-data"><i class="fa fa-check"></i><b>2.3.2</b> Obtaining and preparing denominator or contextual data</a></li>
<li class="chapter" data-level="2.3.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-geographic-data"><i class="fa fa-check"></i><b>2.3.3</b> Obtaining and preparing geographic data</a></li>
<li class="chapter" data-level="2.3.4" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#merging-attributes-and-geography"><i class="fa fa-check"></i><b>2.3.4</b> Merging Attributes and Geography</a></li>
<li class="chapter" data-level="2.3.5" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#mapping-mortality-uninsured"><i class="fa fa-check"></i><b>2.3.5</b> Mapping Mortality &amp; Uninsured</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html"><i class="fa fa-check"></i><b>3</b> Cartography for Epidemiology II</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#learning-objectives-w3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives, w3</a></li>
<li class="chapter" data-level="3.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#additional-resources-w3"><i class="fa fa-check"></i><b>3.2</b> Additional resources, w3</a></li>
<li class="chapter" data-level="3.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#important-vocabulary-w3"><i class="fa fa-check"></i><b>3.3</b> Important Vocabulary, w3</a></li>
<li class="chapter" data-level="3.4" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#spatial-thinking-in-epidemiology-w3"><i class="fa fa-check"></i><b>3.4</b> Spatial Thinking in Epidemiology, w3</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risks-of-privacy-breaches-in-collection-of-geospatial-information"><i class="fa fa-check"></i><b>3.4.1</b> Risks of privacy breaches in collection of geospatial information</a></li>
<li class="chapter" data-level="3.4.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-confidentiality-breaches-through-unintentional-de-identification"><i class="fa fa-check"></i><b>3.4.2</b> Risk of confidentiality breaches through unintentional de-identification</a></li>
<li class="chapter" data-level="3.4.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-stigmatization-of-place"><i class="fa fa-check"></i><b>3.4.3</b> Risk of stigmatization of place</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html"><i class="fa fa-check"></i><b>4</b> Disease Mapping I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#getting-ready-w4"><i class="fa fa-check"></i><b>4.1</b> Getting ready, w4</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#learning-objectives-w4"><i class="fa fa-check"></i><b>4.1.1</b> Learning objectives, w4</a></li>
<li class="chapter" data-level="4.1.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#additional-resources-w4"><i class="fa fa-check"></i><b>4.1.2</b> Additional Resources, w4</a></li>
<li class="chapter" data-level="4.1.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#important-vocabulary-w4"><i class="fa fa-check"></i><b>4.1.3</b> Important Vocabulary, w4</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-thinking-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.2</b> Spatial Thinking in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#why-do-we-need-disease-mapping"><i class="fa fa-check"></i><b>4.2.1</b> Why do we need disease mapping?</a></li>
<li class="chapter" data-level="4.2.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#using-statistics-and-probability-models-to-improve-disease-mapping"><i class="fa fa-check"></i><b>4.2.2</b> Using statistics and probability models to improve disease mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-analysis-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.3</b> Spatial Analysis in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-is-there-spatial-heterogeneity"><i class="fa fa-check"></i><b>4.3.1</b> Disease mapping: Is there spatial heterogeneity?</a></li>
<li class="chapter" data-level="4.3.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-how-precise-are-county-estimates"><i class="fa fa-check"></i><b>4.3.2</b> Disease mapping: How precise are county estimates?</a></li>
<li class="chapter" data-level="4.3.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-adjusting-for-covariates"><i class="fa fa-check"></i><b>4.3.3</b> Disease mapping: Adjusting for covariates</a></li>
<li class="chapter" data-level="4.3.4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-rate-stabilization-with-global-empirical-bayes"><i class="fa fa-check"></i><b>4.3.4</b> Disease mapping: Rate stabilization with global Empirical Bayes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html"><i class="fa fa-check"></i><b>5</b> Disease Mapping II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#getting-ready-w5"><i class="fa fa-check"></i><b>5.1</b> Getting Ready, w5</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#w5-learning-objectives"><i class="fa fa-check"></i><b>5.1.1</b> w5 Learning objectives</a></li>
<li class="chapter" data-level="5.1.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#additional-resources-w5"><i class="fa fa-check"></i><b>5.1.2</b> Additional Resources, w5</a></li>
<li class="chapter" data-level="5.1.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#important-vocabulary-w5"><i class="fa fa-check"></i><b>5.1.3</b> Important Vocabulary, w5</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-thinking-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.2</b> Spatial Thinking in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#an-argument-for-the-relevance-of-space"><i class="fa fa-check"></i><b>5.2.1</b> An argument for the relevance of space</a></li>
<li class="chapter" data-level="5.2.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#on-making-meaning-from-neighbors"><i class="fa fa-check"></i><b>5.2.2</b> On making meaning from neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-analysis-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.3</b> Spatial Analysis in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-contiguity-neighbor-objects"><i class="fa fa-check"></i><b>5.3.1</b> Creating contiguity neighbor objects</a></li>
<li class="chapter" data-level="5.3.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-k-nearest-neighbors"><i class="fa fa-check"></i><b>5.3.2</b> Creating k-nearest neighbors</a></li>
<li class="chapter" data-level="5.3.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-graph-based-triangle-neighbor-objects"><i class="fa fa-check"></i><b>5.3.3</b> Creating Graph-based triangle neighbor objects</a></li>
<li class="chapter" data-level="5.3.4" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-fixed-distance-neighbors"><i class="fa fa-check"></i><b>5.3.4</b> Creating fixed-distance neighbors</a></li>
<li class="chapter" data-level="5.3.5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#from-spatial-neighbors-to-spatial-disease-mapping"><i class="fa fa-check"></i><b>5.3.5</b> From spatial neighbors to spatial Disease Mapping</a></li>
<li class="chapter" data-level="5.3.6" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-empirical-bayes"><i class="fa fa-check"></i><b>5.3.6</b> Spatial Empirical Bayes</a></li>
<li class="chapter" data-level="5.3.7" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#final-thoughts-making-choices"><i class="fa fa-check"></i><b>5.3.7</b> Final thoughts: Making choices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html"><i class="fa fa-check"></i><b>6</b> Disease Mapping III</a>
<ul>
<li class="chapter" data-level="6.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#getting-ready-w6"><i class="fa fa-check"></i><b>6.1</b> Getting Ready, w6</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#learning-objectives-w6"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives, w6</a></li>
<li class="chapter" data-level="6.1.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#additional-resources-w6"><i class="fa fa-check"></i><b>6.1.2</b> Additional Resources, w6</a></li>
<li class="chapter" data-level="6.1.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#important-vocabulary-w6"><i class="fa fa-check"></i><b>6.1.3</b> Important Vocabulary, w6</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-thinking-in-epidemiology-w6"><i class="fa fa-check"></i><b>6.2</b> Spatial Thinking in Epidemiology, w6</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#revisiting-spatial-point-processes"><i class="fa fa-check"></i><b>6.2.1</b> Revisiting spatial point processes</a></li>
<li class="chapter" data-level="6.2.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-is-a-kernel-density-estimator"><i class="fa fa-check"></i><b>6.2.2</b> What is a kernel density estimator?</a></li>
<li class="chapter" data-level="6.2.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#limitations-in-kernel-density-estimation"><i class="fa fa-check"></i><b>6.2.3</b> Limitations in kernel density estimation</a></li>
<li class="chapter" data-level="6.2.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#uses-for-kernel-density-estimation-kde-in-spatial-epidemiology"><i class="fa fa-check"></i><b>6.2.4</b> Uses for kernel density estimation (KDE) in spatial epidemiology</a></li>
<li class="chapter" data-level="6.2.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#guide-to-the-rest-of-this-section"><i class="fa fa-check"></i><b>6.2.5</b> Guide to the rest of this section…</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-point-processes"><i class="fa fa-check"></i><b>6.3</b> Spatial Analysis in Epidemiology: Kernel estimation of point processes</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#preparing-packages-and-data"><i class="fa fa-check"></i><b>6.3.1</b> Preparing packages and data</a></li>
<li class="chapter" data-level="6.3.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#introducing-a-new-spatial-data-class-ppp"><i class="fa fa-check"></i><b>6.3.2</b> Introducing a new spatial data class: <code>ppp</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-the-ppp-objects"><i class="fa fa-check"></i><b>6.3.3</b> Creating the <code>ppp</code> objects</a></li>
<li class="chapter" data-level="6.3.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#bandwidth-selection"><i class="fa fa-check"></i><b>6.3.4</b> Bandwidth selection</a></li>
<li class="chapter" data-level="6.3.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-kernel-density-surfaces"><i class="fa fa-check"></i><b>6.3.5</b> Estimating Kernel Density surfaces</a></li>
<li class="chapter" data-level="6.3.6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-manually"><i class="fa fa-check"></i><b>6.3.6</b> Creating relative risk surface manually</a></li>
<li class="chapter" data-level="6.3.7" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-with-risk-function"><i class="fa fa-check"></i><b>6.3.7</b> Creating relative risk surface with <code>risk()</code> function</a></li>
<li class="chapter" data-level="6.3.8" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#using-functions-to-map-rr-with-tmap"><i class="fa fa-check"></i><b>6.3.8</b> Using functions to map RR with <code>tmap</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-areal-data"><i class="fa fa-check"></i><b>6.4</b> Spatial Analysis in Epidemiology: Kernel estimation of areal data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>6.4.1</b> Packages and data</a></li>
<li class="chapter" data-level="6.4.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-bandwidth-for-kernel-density-estimates"><i class="fa fa-check"></i><b>6.4.2</b> What bandwidth for kernel density estimates?</a></li>
<li class="chapter" data-level="6.4.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#geographically-weighted-summary-statistics-gwss"><i class="fa fa-check"></i><b>6.4.3</b> Geographically weighted summary statistics: <code>gwss()</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#calculating-pseudo-p-values-for-smoothed-estimates"><i class="fa fa-check"></i><b>6.4.4</b> Calculating pseudo p-values for smoothed estimates</a></li>
<li class="chapter" data-level="6.4.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-geographically-weighted-bivariate-statistics"><i class="fa fa-check"></i><b>6.4.5</b> Estimating geographically-weighted bivariate statistics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html"><i class="fa fa-check"></i><b>7</b> Disease Mapping IV</a>
<ul>
<li class="chapter" data-level="7.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#getting-ready-w7"><i class="fa fa-check"></i><b>7.1</b> Getting Ready, w7</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#learning-objectives-w7"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives, w7</a></li>
<li class="chapter" data-level="7.1.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#additional-resources-w7"><i class="fa fa-check"></i><b>7.1.2</b> Additional Resources, w7</a></li>
<li class="chapter" data-level="7.1.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#important-vocabulary-w7"><i class="fa fa-check"></i><b>7.1.3</b> Important Vocabulary, w7</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-thinking-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.2</b> Spatial Thinking in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#what-is-bayesian-inference"><i class="fa fa-check"></i><b>7.2.1</b> What is <em>Bayesian Inference</em>?</a></li>
<li class="chapter" data-level="7.2.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#bayesian-inference-in-spatial-epidemiology"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian inference in spatial epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-analysis-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.3</b> Spatial Analysis in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>7.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="7.3.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#preparing-for-carbayes"><i class="fa fa-check"></i><b>7.3.2</b> Preparing for <code>CARBayes()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#fitting-a-besag-york-mollie-bym-bayesian-model"><i class="fa fa-check"></i><b>7.3.3</b> Fitting a <em>Besag-York-Mollie (BYM)</em> Bayesian model</a></li>
<li class="chapter" data-level="7.3.4" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#summarizing-carbayes-model-output"><i class="fa fa-check"></i><b>7.3.4</b> Summarizing <code>CARBayes</code> model output</a></li>
<li class="chapter" data-level="7.3.5" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#making-inference-from-bayesian-posteriors"><i class="fa fa-check"></i><b>7.3.5</b> Making inference from Bayesian posteriors</a></li>
<li class="chapter" data-level="7.3.6" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#extracting-summaries-for-mapping-or-analysis"><i class="fa fa-check"></i><b>7.3.6</b> Extracting summaries for mapping or analysis</a></li>
<li class="chapter" data-level="7.3.7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#plot-raw-versus-smoothed"><i class="fa fa-check"></i><b>7.3.7</b> Plot raw versus smoothed</a></li>
<li class="chapter" data-level="7.3.8" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-rates"><i class="fa fa-check"></i><b>7.3.8</b> Mapping rates</a></li>
<li class="chapter" data-level="7.3.9" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-exceedance-probability"><i class="fa fa-check"></i><b>7.3.9</b> Mapping exceedance probability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html"><i class="fa fa-check"></i><b>8</b> Spatial Structure and Clustering I</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#w8-learning-objectives"><i class="fa fa-check"></i><b>8.1</b> w8 Learning objectives</a></li>
<li class="chapter" data-level="8.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#w8-additional-resources"><i class="fa fa-check"></i><b>8.2</b> w8 Additional Resources</a></li>
<li class="chapter" data-level="8.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#w8-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>8.3</b> w8 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="8.4" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#w8-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>8.4</b> w8 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html"><i class="fa fa-check"></i><b>9</b> Spatial Structure and Clustering II</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#w9-learning-objectives"><i class="fa fa-check"></i><b>9.1</b> w9 Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#w9-additional-resources"><i class="fa fa-check"></i><b>9.2</b> w9 Additional Resources</a></li>
<li class="chapter" data-level="9.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#w9-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>9.3</b> w9 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="9.4" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#w9-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>9.4</b> w9 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html"><i class="fa fa-check"></i><b>10</b> Spatial Regression I</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#w10-learning-objectives"><i class="fa fa-check"></i><b>10.1</b> w10 Learning objectives</a></li>
<li class="chapter" data-level="10.2" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#w10-additional-resources"><i class="fa fa-check"></i><b>10.2</b> w10 Additional Resources</a></li>
<li class="chapter" data-level="10.3" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#w10-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>10.3</b> w10 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="10.4" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#w10-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>10.4</b> w10 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html"><i class="fa fa-check"></i><b>11</b> Spatial Regression II</a>
<ul>
<li class="chapter" data-level="11.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-learning-objectives"><i class="fa fa-check"></i><b>11.1</b> w11 Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-additional-resources"><i class="fa fa-check"></i><b>11.2</b> w11 Additional Resources</a></li>
<li class="chapter" data-level="11.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>11.3</b> w11 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="11.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>11.4</b> w11 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html"><i class="fa fa-check"></i><b>12</b> Spatial Regression III</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-learning-objectives"><i class="fa fa-check"></i><b>12.1</b> w12 Learning objectives</a></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-additional-resources"><i class="fa fa-check"></i><b>12.2</b> w12 Additional Resources</a></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>12.3</b> w12 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="12.4" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>12.4</b> w12 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="wrap-up-project.html"><a href="wrap-up-project.html"><i class="fa fa-check"></i><b>13</b> Wrap-up &amp; Project</a>
<ul>
<li class="chapter" data-level="13.1" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-learning-objectives"><i class="fa fa-check"></i><b>13.1</b> w13 Learning objectives</a></li>
<li class="chapter" data-level="13.2" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-additional-resources"><i class="fa fa-check"></i><b>13.2</b> w13 Additional Resources</a></li>
<li class="chapter" data-level="13.3" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>13.3</b> w13 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="13.4" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>13.4</b> w13 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="part"><span><b>III Appendices</b></span></li>
<li class="chapter" data-level="14" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html"><i class="fa fa-check"></i><b>14</b> Tips for reproducibility in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i>Additional Resources</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflows-to-enhance-reproducibility"><i class="fa fa-check"></i>Workflows to enhance reproducibility</a>
<ul>
<li><a href="tips-for-reproducibility-in-r.html#using-projects-in-r">Using Projects in <code>R</code></a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#understanding-directory-and-file-path-names-in-r">Understanding directory and file path names in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-location-within-the-working-directory"><i class="fa fa-check"></i>Specify a location within the working directory</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-relative-location-outside-the-working-directory"><i class="fa fa-check"></i>Specify a relative location outside the working directory</a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#why-r-notebooks">Why <code>R Notebooks</code>?</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#what-you-need-to-know"><i class="fa fa-check"></i>What you need to know</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#important-r-notebook-functions"><i class="fa fa-check"></i>Important R Notebook functions</a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#the-yaml"><i class="fa fa-check"></i>The YAML</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#typing-text"><i class="fa fa-check"></i>Typing text</a></li>
<li><a href="tips-for-reproducibility-in-r.html#adding-r-code">Adding <code>R</code> Code</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#making-tables"><i class="fa fa-check"></i>Making tables</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflow"><i class="fa fa-check"></i>Workflow</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#optional-functions"><i class="fa fa-check"></i>Optional functions</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#customizing-your-yaml"><i class="fa fa-check"></i>Customizing your YAML</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#simple-formatting-of-your-notebook"><i class="fa fa-check"></i>Simple formatting of your Notebook</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#text-formatting"><i class="fa fa-check"></i>Text formatting</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#final-note"><i class="fa fa-check"></i>Final Note</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sf-overview.html"><a href="sf-overview.html"><i class="fa fa-check"></i><b>15</b> Tips for working with <code>sf</code> data class</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sf-overview.html"><a href="sf-overview.html#st_set_geom"><i class="fa fa-check"></i><b>15.1</b> <code>st_set_geom()</code></a></li>
<li class="chapter" data-level="15.2" data-path="sf-overview.html"><a href="sf-overview.html#st-as-sf"><i class="fa fa-check"></i><b>15.2</b> <code>st_as_sf()</code></a></li>
<li class="chapter" data-level="15.3" data-path="sf-overview.html"><a href="sf-overview.html#st_crs"><i class="fa fa-check"></i><b>15.3</b> <code>st_crs()</code></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>16</b> Tips for using <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="16.1" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>16.1</b> <code>select()</code></a></li>
<li class="chapter" data-level="16.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>16.2</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="16.3" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>16.3</b> <code>filter()</code></a></li>
<li class="chapter" data-level="16.4" data-path="dplyr.html"><a href="dplyr.html#arrange"><i class="fa fa-check"></i><b>16.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="16.5" data-path="dplyr.html"><a href="dplyr.html#pipe-operator"><i class="fa fa-check"></i><b>16.5</b> <code>%&gt;%</code> Pipe operator</a></li>
<li class="chapter" data-level="16.6" data-path="dplyr.html"><a href="dplyr.html#group_by-and-summarise"><i class="fa fa-check"></i><b>16.6</b> <code>group_by()</code> and <code>summarise()</code></a></li>
<li class="chapter" data-level="16.7" data-path="dplyr.html"><a href="dplyr.html#join"><i class="fa fa-check"></i><b>16.7</b> <code>join()</code></a></li>
<li class="chapter" data-level="16.8" data-path="dplyr.html"><a href="dplyr.html#pivot_"><i class="fa fa-check"></i><b>16.8</b> Reshaping (transposing) data</a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="dplyr.html"><a href="dplyr.html#pivot_longer-for-going-from-wide-to-long"><i class="fa fa-check"></i><b>16.8.1</b> <code>pivot_longer()</code> for going from wide to long</a></li>
<li class="chapter" data-level="16.8.2" data-path="dplyr.html"><a href="dplyr.html#pivot_wider"><i class="fa fa-check"></i><b>16.8.2</b> <code>pivot_wider()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="intro-tmap.html"><a href="intro-tmap.html"><i class="fa fa-check"></i><b>17</b> Tips for using <code>tmap</code></a>
<ul>
<li class="chapter" data-level="17.1" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-mode"><i class="fa fa-check"></i><b>17.1</b> <code>tmap</code> mode</a></li>
<li class="chapter" data-level="17.2" data-path="intro-tmap.html"><a href="intro-tmap.html#qtm"><i class="fa fa-check"></i><b>17.2</b> Quick maps: <code>qtm()</code></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-polygons"><i class="fa fa-check"></i><b>17.2.1</b> Customizing <code>qtm()</code> for polygons</a></li>
<li class="chapter" data-level="17.2.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-lines"><i class="fa fa-check"></i><b>17.2.2</b> Customizing <code>qtm()</code> for lines</a></li>
<li class="chapter" data-level="17.2.3" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-points"><i class="fa fa-check"></i><b>17.2.3</b> Customizing <code>qtm()</code> for points</a></li>
<li class="chapter" data-level="17.2.4" data-path="intro-tmap.html"><a href="intro-tmap.html#finding-valid-color-options"><i class="fa fa-check"></i><b>17.2.4</b> Finding valid color options</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="intro-tmap.html"><a href="intro-tmap.html#building-maps-with-tmap"><i class="fa fa-check"></i><b>17.3</b> Building maps with <code>tmap</code></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="intro-tmap.html"><a href="intro-tmap.html#building-blocks-in-tmap"><i class="fa fa-check"></i><b>17.3.1</b> Building blocks in <code>tmap</code></a></li>
<li class="chapter" data-level="17.3.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-text-on-maps"><i class="fa fa-check"></i><b>17.3.2</b> Customizing text on maps</a></li>
<li class="chapter" data-level="17.3.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-two-or-more-spatial-objects-in-one-map"><i class="fa fa-check"></i><b>17.3.3</b> Adding two or more spatial objects in one map</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-layout-and-map-elements"><i class="fa fa-check"></i><b>17.4</b> Controlling layout and map elements</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="intro-tmap.html"><a href="intro-tmap.html#understanding-the-graphic-space-in-tmap"><i class="fa fa-check"></i><b>17.4.1</b> Understanding the graphic space in <code>tmap</code></a></li>
<li class="chapter" data-level="17.4.2" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-map-layout"><i class="fa fa-check"></i><b>17.4.2</b> Controlling map layout</a></li>
<li class="chapter" data-level="17.4.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-map-elements"><i class="fa fa-check"></i><b>17.4.3</b> Adding map elements</a></li>
<li class="chapter" data-level="17.4.4" data-path="intro-tmap.html"><a href="intro-tmap.html#change-the-global-style-of-a-map"><i class="fa fa-check"></i><b>17.4.4</b> Change the global style of a map</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="intro-tmap.html"><a href="intro-tmap.html#making-small-multiple-maps"><i class="fa fa-check"></i><b>17.5</b> Making small-multiple maps</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-as-a-vector-of-variables"><i class="fa fa-check"></i><b>17.5.1</b> Small multiples as a vector of variables</a></li>
<li class="chapter" data-level="17.5.2" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-facet"><i class="fa fa-check"></i><b>17.5.2</b> Small multiples with facets</a></li>
<li class="chapter" data-level="17.5.3" data-path="intro-tmap.html"><a href="intro-tmap.html#facets-for-time-series"><i class="fa fa-check"></i><b>17.5.3</b> Facets for time-series</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-with-tmap_arrange"><i class="fa fa-check"></i><b>17.6</b> Small multiples with <code>tmap_arrange()</code></a></li>
<li class="chapter" data-level="17.7" data-path="intro-tmap.html"><a href="intro-tmap.html#summarizing-small-multiples"><i class="fa fa-check"></i><b>17.7</b> Summarizing small multiples</a></li>
<li class="chapter" data-level="17.8" data-path="intro-tmap.html"><a href="intro-tmap.html#saving-maps"><i class="fa fa-check"></i><b>17.8</b> Saving maps</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="disease-mapping-iii" class="section level1" number="6">
<h1><span class="header-section-number">Week 6</span> Disease Mapping III</h1>
<div id="getting-ready-w6" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Getting Ready, w6</h2>
<div id="learning-objectives-w6" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Learning objectives, w6</h3>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; width: 100%; margin-left: auto; margin-right: auto;  " id="learning-ob">
<caption style="caption-side: top; text-align: center;"><span id="tab:learning-ob">TABLE 1.1: </span> Learning objectives by weekly module</caption><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(208, 211, 212); font-weight: bold;">After this module you should be able to…</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(250, 229, 211); font-weight: normal;">Discuss the meaning and interpretation of basic functions of spatial point processes including intensity, stationarity, heterogeneity</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 6pt; background-color: rgb(245, 203, 167); font-weight: normal;">Produce spatially smoothed estimates of epidemiologic parameters using kernel density estimators for point and polygon data</td></tr>
</table>

</div>
<div id="additional-resources-w6" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Additional Resources, w6</h3>
<ul>
<li><a href="https://training.fws.gov/courses/references/tutorials/geospatial/CSP7304/documents/PointPatterTutorial.pdf">Adrian Baddeley tutorial on analysis spatial point processes</a></li>
<li>Hazelton. Kernel Smoothing Methods. Chapter 10, Handbook of Spatial Epidemiology. <em>Posted on Canvas</em></li>
</ul>
</div>
<div id="important-vocabulary-w6" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Important Vocabulary, w6</h3>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; width: 90%; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-124">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-124">TABLE 6.1: </span> Vocabulary for Week 6</caption><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(84, 153, 199); font-weight: bold;"><span style="color: rgb(255, 255, 255);">Term</span></th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(84, 153, 199); font-weight: bold;"><span style="color: rgb(255, 255, 255);">Definition</span></th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Bandwidth</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A measure of the width or spatial extent of a two-dimensional kernel density estimator. The bandwidth is the key to controlling how much smoothing occurs, with larger bandwidths producing more smooth surfaces, and smaller bandwidths producing less smooth surfaces</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Bandwidth, adaptive</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">An adaptive bandwith means the width or search radius of the spatial kernel density estimator varies or adapts through space, usually to maintain a constant number of points within the window. The result is that in areas with few points there is more smoothing, whereas in areas with many points there is more granularity</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Bandwidth, fixed</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A fixed bandwidth means the width or search radius of the spatial kernel density estimator is constant (fixed) for the full study region</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Geographic-weighting</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">A method for calculating summary weighted statistics by relying on a kernel density estimator to describe the weights in local summaries.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Homogenous Poisson Point Process</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A spatial statistical assumption that the count of events in an arbitrarily small area is distributed Poisson with mean lambda for all regions</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Inhomogenous Poisson Point Process</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">A spatial statistical assumption that the count of events in an arbitrarily small area is distributed Poisson with mean lambda that varies through space as a function of the underlying population at risk. This is true for most spatial epidemiology.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Kernel density estimator</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A non-parametric way to estimate the probability distribution function of a random variable. In spatial (e.g. 2-d) kernel density estimation, it is a way to describe the spatially continuous variation in the intensity of events (points).</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(169, 204, 227); font-weight: bold;">Spatial density</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(169, 204, 227); font-weight: normal;">A standardized metric of spatial intensity. Related to a probability density function, it is a proportionate indicator of how much of the total events occur in a specific region. In kernel density estimation, the density surface integrates (or sums) to 1 across a study region.</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 2pt 2pt 6pt; background-color: rgb(212, 230, 241); font-weight: bold;">Spatial intensity</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 1pt 1pt 1pt 1pt; border-top-color: rgb(255, 255, 255);  border-right-color: rgb(255, 255, 255);  border-bottom-color: rgb(255, 255, 255);  border-left-color: rgb(255, 255, 255); padding: 2pt 6pt 2pt 2pt; background-color: rgb(212, 230, 241); font-weight: normal;">A measure of the ratio of events at specific points to a unit of area. Spatial intensity describes the spatially continuous surface of event occurrence. In kernel density estimation, a spatial intensity surface integrates (or sums) to the sample size across a study region.</td></tr>
</table>

</div>
</div>
<div id="spatial-thinking-in-epidemiology-w6" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Spatial Thinking in Epidemiology, w6</h2>
<div id="revisiting-spatial-point-processes" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Revisiting spatial point processes</h3>
<p>People exist in places, but they are not uniformly nor randomly distributed. More live in cities; fewer live in rural area. But conditional on <em>where</em> people actually live or work or play, under a null expectation we could treat the occurrence of health events (e.g. disease, death, behaviors) as random variables, and leverage the tools of statistics to characterize when occurrence is what we would expect versus when it is something unusual.</p>
<p>In spatial analysis, we treat health events as random events among individuals located in space. Thus, conditional on where people are, we might assume that the occurrence of events is generated according to the assumed probability distribution. The utility of the <em>Poisson Point Process</em> becomes apparent when we see that we could divide a region into very small sub-regions and count the number of events within each, assuming that count follows a Poisson distribution.</p>
<div class="figure"><span id="fig:unnamed-chunk-125"></span>
<img src="images/quadrat.png" alt="Poisson point process"  />
<p class="caption">
FIGURE 6.1: Poisson point process
</p>
</div>
<p>In the above figure, we quantify the <em>spatial intensity</em> of events by calculating <span class="math inline">\(\lambda = \frac{n}{area}\)</span>. Thus, all of our statistical analysis to date is premised on this idea that the spatial location of points can be interpreted through the lens of a <em>Poisson</em> probability distribution. But what if we could calculate the <em>spatial intensity</em> more continuously, without the constraint of a specific parametric distribution, and without using the possibly arbitrary boundaries and zoning schemes of areal geographic units such as census tracts, zip codes, or counties?</p>
<p><em>Spatial point process</em> analysis focuses on characterizing patterns derived directly from the location of the points themselves, without arbitrary aggregation. The study of <em>point process analysis</em> is broad, but we will focus on one particularly flexible strategy this week: <strong>kernel density estimation</strong> (KDE). Kernel density estimation has several features making it useful for spatial epidemiology including:</p>
<ul>
<li>It is non-parametric, meaning it does not rely on a specific probability distribution (e.g. Poisson, negative binomial)</li>
<li>It provides an alternative means for characterizing <em>local neighbors</em>. The strategy of the KDE estimators is most similar to <em>inverse distance weighting</em></li>
<li>It can be used as a primary tool, or can be an intermediate step for creating <em>spatial weights</em>, as we will see in <em>geographically weighted regression</em></li>
<li>While it is really designed for analyzing <em>points</em>, we can use it on areal/polygon data as well.</li>
</ul>
</div>
<div id="what-is-a-kernel-density-estimator" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> What is a kernel density estimator?</h3>
<p>A <em>kernel</em> is a function (e.g. a shape) centered over each point of data. For example, a Gaussian kernel means there is a Gaussian bell-shaped curve centered over each point; the width of the curve is defined by a parameter, <span class="math inline">\(h\)</span>, which stands for the <em>bandwidth</em>.</p>
<div class="figure"><span id="fig:unnamed-chunk-126"></span>
<img src="images/kde2.png" alt="Kernel density estimator"  />
<p class="caption">
FIGURE 6.2: Kernel density estimator
</p>
</div>
<p>To estimate the <em>spatial intensity</em> of points, <span class="math inline">\(\hat{\lambda}\)</span>, we can sum up the area under all of the kernels to estimate an overall <em>kernel density</em> at each location. This <em>kernel density estimate</em> essentially reports a spatially continuous summary of the <em>local intensity</em> of events.</p>
<p>The result is that we can summarize a study region with spatially-referenced point data using a <em>spatially continuous intensity surface</em>. The analyst decides on how <em>smooth</em> or <em>bumpy</em> the surface should be by increasing or decreasing the value of the bandwidth parameter, <span class="math inline">\(h\)</span>. As we will see below, the decision about bandwidth could be made subjectively (e.g. to produce a visually appealing surface), or by minimizing error or through cross-validation.</p>
<div class="figure"><span id="fig:unnamed-chunk-127"></span>
<img src="images/kde3.jpg" alt="Kernel density smoothing"  />
<p class="caption">
FIGURE 6.3: Kernel density smoothing
</p>
</div>
</div>
<div id="limitations-in-kernel-density-estimation" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Limitations in kernel density estimation</h3>
<p>There are several features of real data that can limit the accurate estimation of a <em>true</em> underlying spatial intensity surface. Here are a few:</p>
<ul>
<li><strong>Study region and edge effects</strong>: In almost any situation, the data available in a given dataset represents only a subset of the universe of points and events of interest. We can only carry out KDE on available data, and if there are boundaries to where data is collected (e.g. only within a given state boundary), then the intensity of points near boundaries may be mis-estimated due to missing data. Several of the statistical smoothers below have options to incorporate adjustments for these <em>edge effects</em>.</li>
<li><strong>Determining bandwidth</strong>: The choice of the kernel bandwidth is perhaps the most influential decision driving how the final results appear. While occasionally there may be theoretical grounds for <em>a priori</em> specification of bandwidth, often the decision is one of <em>subjective analyst choice</em> (typically not ideal) or of statistical optimization. In the sections below there is discussion of <em>fixed</em> versus <em>adaptive</em> bandwidths, as well as some algorithms for selecting values or at least upper or lower bounds.</li>
</ul>
</div>
<div id="uses-for-kernel-density-estimation-kde-in-spatial-epidemiology" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Uses for kernel density estimation (KDE) in spatial epidemiology</h3>
<p>Because kernel density estimation is the only method we will learn this semester for working with <em>point data</em>, it should be clear that this is one major application. However, more generally, KDE has broad applications. Here are some examples of when you might think about using kernel density estimates:</p>
<ul>
<li>For producing spatially continuous (typically <em>raster</em>) surfaces representing disease risk. This is the application most consistent with disease mapping, where the purpose is to describe spatial heterogeneity in disease <em>intensity</em> or risk.</li>
<li>For summarizing point-referenced resources (e.g. retail food outlets; health care clinics; toxic emitters; etc) as an <em>exposure surface</em>. This strategy is an alternative to calculating custom distances between each event point and every other resource or exposure. Instead, the kernel density surface summarizes the <em>average exposure</em> to all resources at any given point in space.</li>
<li>For smoothing and summarizing data measured at an areal or polygon unit. While KDE is optimized for point data, it is possible to extend it to smoothing any data (exposure, covariate, or health outcome) measured or reported at an ecologic areal unit.</li>
<li>Building on the extension of KDE to polygons, we can summarize social or economic <em>exposure surfaces</em>. This is a useful way to extend socio-economic-cultural measures that might be available at census geography to represent them as not only contained within specific boundaries, but as being explicitly spatially situated.</li>
</ul>
<p>In the next section, we introduce two different uses of kernel density estimation:</p>
<ol style="list-style-type: decimal">
<li>First is the intensity estimation of spatial point processes consistent with the description above.</li>
<li>Second, we illustrate the use of kernel density estimators to create <em>weights</em> for <em>geographically-weighted summary statistics</em>, including the spatially varying mean risk or rate. This strategy can be applied to either <em>points</em> or to <em>polygons</em>.</li>
</ol>
</div>
<div id="guide-to-the-rest-of-this-section" class="section level3" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> Guide to the rest of this section…</h3>
<p>There is a lot of content contained in this module. It is worth highlighting some broad distinctions to help you navigate.</p>
<p><strong>The first section</strong> focuses on tools using the <code>sparr</code> and <code>spatstat</code> packages to create kernel density estimates from <em>point data</em>. This includes:</p>
<ul>
<li>Creating <code>ppp</code> objects for <em>planar point processes</em></li>
<li>Creating <code>owin</code> objects to define study regions</li>
<li>Discussion of several different strategies for selecting a <em>kernel bandwidth</em> which dictates smoothing</li>
<li>Creation of kernel density surfaces of single point processes</li>
<li>Creation of kernel density <em>relative risk</em> surfaces contrasting the ratio of numerator to denominator intensity</li>
<li>Visualizing the output in several ways.</li>
</ul>
<p><strong>The second section</strong> introduces a seemingly quite distinct strategy for incorporating kernel density estimators into spatial epidemiology. It introduces tools for calculating <em>geographically weighted summary statistics</em> to characterize spatial heterogeneity. These tools use kernel density estimators to geographically weight observations, and can be applied to <em>points</em> or <em>polygons</em>. This section includes:</p>
</div>
</div>
<div id="spatial-analysis-in-epidemiology-kernel-estimation-of-point-processes" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Spatial Analysis in Epidemiology: Kernel estimation of point processes</h2>
<p>This section has three specific objectives:</p>
<ol style="list-style-type: decimal">
<li>Introduce a new spatial data class in <code>R</code>, <code>ppp</code>, which is necessary for executing the kernel estimation functions</li>
<li>Introduce kernel density estimation of spatial point processes, including selection of fixed bandwidths, and use of adaptive bandwidths</li>
<li>Introduce spatial <em>relative risk surfaces</em>, including estimation of tolerance contours</li>
</ol>
<div id="preparing-packages-and-data" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Preparing packages and data</h3>
<p>There are several new packages that will be required for this work:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="disease-mapping-iii.html#cb104-1"></a><span class="kw">library</span>(sparr)         <span class="co"># A package for estimating spatial intensity and relative risk</span></span>
<span id="cb104-2"><a href="disease-mapping-iii.html#cb104-2"></a><span class="kw">library</span>(spatstat)      <span class="co"># A package with tools that underly the sparr package</span></span>
<span id="cb104-3"><a href="disease-mapping-iii.html#cb104-3"></a><span class="kw">library</span>(maptools)      <span class="co"># This has a helper function for working with ppp class data</span></span>
<span id="cb104-4"><a href="disease-mapping-iii.html#cb104-4"></a><span class="kw">library</span>(raster)        <span class="co"># The outputs of these KDE functions will be raster. This package gives us tools for working with rasters</span></span></code></pre></div>
<p>In addition to those new packages, we will also need the <code>sp</code> package. Recall that we have only worked with <code>sf</code> class data up until now, although we learned that <code>sp</code> was the <em>older format</em> for spatial data in <code>R</code>. Some packages and functions (including <code>sparr</code> and <code>spatstat</code>) have not incorporated compatibility with <code>sf</code> data, so we will need to convert some particular objects from <code>sf</code> to <code>sp</code> before moving forward.</p>
<p>The data used in this example, and in the lab, concerns the exact <span class="math inline">\(x,y\)</span> residential location of all births in Dekalb and Fulton county, including indication of infants who subsequently died within the first year of life.</p>
<blockquote>
<p>NOTE: These data are simulated based on approximate patterns. This is <strong>not a representation of actual point data</strong>.</p>
</blockquote>
<p>The spatial point location for births and infant deaths are in two separate files. In addition a polygon file providing the outline for Dekalb and Fulton counties is provided to describe the <em>study window</em>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="disease-mapping-iii.html#cb105-1"></a><span class="co"># This is points for births in Dekalb/Fulton county</span></span>
<span id="cb105-2"><a href="disease-mapping-iii.html#cb105-2"></a>b_point &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;birth_points.gpkg&#39;</span>)</span>
<span id="cb105-3"><a href="disease-mapping-iii.html#cb105-3"></a></span>
<span id="cb105-4"><a href="disease-mapping-iii.html#cb105-4"></a><span class="co"># This is points for deaths in Dekalb/Fulton county</span></span>
<span id="cb105-5"><a href="disease-mapping-iii.html#cb105-5"></a>d_point &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;death_points.gpkg&#39;</span>) </span>
<span id="cb105-6"><a href="disease-mapping-iii.html#cb105-6"></a></span>
<span id="cb105-7"><a href="disease-mapping-iii.html#cb105-7"></a><span class="co"># This is an outline of Dekalb/Fulton county to be used as a study &#39;window&#39;</span></span>
<span id="cb105-8"><a href="disease-mapping-iii.html#cb105-8"></a>county &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;DekalbFultonWindow.gpkg&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb105-9"><a href="disease-mapping-iii.html#cb105-9"></a><span class="st">  </span><span class="kw">as</span>(<span class="st">&#39;Spatial&#39;</span>)</span></code></pre></div>
<p>In the code above, note the us of the function <code>as('Spatial')</code> for the object <code>county</code>. This is a conversion step, translating the <code>sf</code> object to an object of class <code>sp</code>. It is only necessary in this particular case for the polygon file representing the <em>study window</em> because the functions the create that window expect data of class <code>sp</code>. In contrast we can extract the coordinates from an <code>sf</code> point object, without a need to convert to <code>sp</code> first.</p>
</div>
<div id="introducing-a-new-spatial-data-class-ppp" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Introducing a new spatial data class: <code>ppp</code></h3>
<p>Much of the statistical methods for spatial point process actually developed out of <em>ecology</em>, and the methods are only merging with the other spatial analysis and spatial epidemiology fields in recent years. One consequence of this history, is that the early developers of these methods in <code>R</code> defined their own spatial data class called <code>ppp</code> for point pattern data in a two-dimensional plane.</p>
<p>To create a <code>ppp</code> data object we need, at a minimum, two things: a matrix of <span class="math inline">\(x,y\)</span> coordinates for event points, and a definition for the <em>spatial window</em> or study region. This <em>window</em> is necessary because nearly any data set is a sub-sample of the universe of possible <em>points</em>, and analysis of point processes requires appreciation for the bounds of sampling. We define the window formally in <code>R</code> as an object of class <code>owin</code>, and it can be a rectangular bounding box (e.g. the outline of the available data), or a customized polygon. We will use the outline of Dekalb &amp; Fulton counties as the customized <em>spatial window</em> for the observation of births and infant deaths. Note that the function below to create the <code>owin</code> object only works on <code>sp</code> class <code>SpatialPolygons</code>. That is why we converted the polygon file to class <code>sp</code> when we imported (above).</p>
<p>You can see from the summary and the plot what this <code>owin</code> object looks like.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="disease-mapping-iii.html#cb106-1"></a>county_owin &lt;-<span class="st"> </span>maptools<span class="op">::</span><span class="kw">as.owin.SpatialPolygons</span>(county)</span>
<span id="cb106-2"><a href="disease-mapping-iii.html#cb106-2"></a><span class="kw">summary</span>(county_owin)</span></code></pre></div>
<pre><code>## Window: polygonal boundary
## single connected closed polygon with 698 vertices
## enclosing rectangle: [1026366.3, 1098719.2] x [1220671, 1302019.3] units
##                      (72350 x 81350 units)
## Window area = 2086320000 square units
## Fraction of frame area: 0.354</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="disease-mapping-iii.html#cb108-1"></a><span class="kw">plot</span>(county_owin)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
</div>
<div id="creating-the-ppp-objects" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Creating the <code>ppp</code> objects</h3>
<p>Now we will use the function <code>ppp()</code> to create objects of class <code>ppp</code> for each of the <em>spatial point</em> files, <code>b_point</code> (representing locations of all births), and <code>d_point</code> (representing locations of all deaths). Doing so requires definition of the <em>study window</em> defined above as the object name <code>countr_owin</code> of class <code>owin</code>. Again, the study window delineates what is <em>in</em> versus <em>out</em> of the study area and demarcates <em>edges</em> of the study region. You can look at the help documentation for the function <code>ppp()</code> to see the arguments. Note that because the function requires specification of the <span class="math inline">\(x,y\)</span> locations as two separate vectors, we extract the coordinate values from our <code>sf</code> object using <code>st_coordinates()</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="disease-mapping-iii.html#cb109-1"></a><span class="co"># Create the birth ppp object</span></span>
<span id="cb109-2"><a href="disease-mapping-iii.html#cb109-2"></a>b_ppp &lt;-<span class="st"> </span><span class="kw">ppp</span>(<span class="dt">x =</span> <span class="kw">st_coordinates</span>(b_point)[, <span class="dv">1</span>], </span>
<span id="cb109-3"><a href="disease-mapping-iii.html#cb109-3"></a>             <span class="dt">y =</span> <span class="kw">st_coordinates</span>(b_point)[, <span class="dv">2</span>],</span>
<span id="cb109-4"><a href="disease-mapping-iii.html#cb109-4"></a>             <span class="dt">window =</span> county_owin)</span>
<span id="cb109-5"><a href="disease-mapping-iii.html#cb109-5"></a></span>
<span id="cb109-6"><a href="disease-mapping-iii.html#cb109-6"></a><span class="co"># Create the death ppp object</span></span>
<span id="cb109-7"><a href="disease-mapping-iii.html#cb109-7"></a>d_ppp &lt;-<span class="st"> </span><span class="kw">ppp</span>(<span class="dt">x =</span> <span class="kw">st_coordinates</span>(d_point)[, <span class="dv">1</span>], </span>
<span id="cb109-8"><a href="disease-mapping-iii.html#cb109-8"></a>             <span class="dt">y =</span> <span class="kw">st_coordinates</span>(d_point)[, <span class="dv">2</span>],</span>
<span id="cb109-9"><a href="disease-mapping-iii.html#cb109-9"></a>             <span class="dt">window =</span> county_owin)</span></code></pre></div>
<p>As you might expect, there are built-in methods (from the <code>spatstat</code> package) to summarize and plot <code>ppp</code> objects.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="disease-mapping-iii.html#cb110-1"></a><span class="kw">summary</span>(d_ppp)</span></code></pre></div>
<pre><code>## Planar point pattern:  701 points
## Average intensity 3.359978e-07 points per square unit
## 
## Coordinates are given to 2 decimal places
## i.e. rounded to the nearest multiple of 0.01 units
## 
## Window: polygonal boundary
## single connected closed polygon with 698 vertices
## enclosing rectangle: [1026366.3, 1098719.2] x [1220671, 1302019.3] units
##                      (72350 x 81350 units)
## Window area = 2086320000 square units
## Fraction of frame area: 0.354</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="disease-mapping-iii.html#cb112-1"></a><span class="kw">plot</span>(d_ppp)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>The summary includes information about the overall <em>spatial intensity</em> (e.g. events per unit area), as well as the number of points, and the observational window. The plot for <code>d_ppp</code> should look just like a plot of <code>d_point</code> as they both contain the same information. Of note, if you repeat the above code for all of the birth events, <code>b_point</code>, the plot will be less readable because there are over 94,000 births as compared with only 705 deaths!</p>
</div>
<div id="bandwidth-selection" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Bandwidth selection</h3>
<p>As discussed above, and in lecture, the kernel density estimation requires the analyst to specify a <em>kernel function</em> (e.g. a Gaussian kernel, or a quartic bi-weight kernel), and a <em>kernel bandwidth</em>. Of the two, the bandwidth is substantially more impactful on results than choice of kernel function.</p>
<p>As a reminder, the <em>bandwidth</em> (sometimes indicated by variable <span class="math inline">\(h\)</span>) describes the <em>width</em> or <em>radius</em> of the kernel function, and as a result dictates how <em>smooth</em> the resulting intensity surface will be. A small bandwidth will produce a bumpier or rougher surface, whereas a larger bandwidth will result in more smoothing. Relating this to our work in previous weeks, the <em>bandwidth</em> is also a representation of <em>local</em>. In other words it defines which sets of points will be considered <em>close</em> and which are not.</p>
<p>There are two general kinds of bandwidth settings:</p>
<ol style="list-style-type: decimal">
<li><strong>Fixed bandwidths:</strong> A single value if <span class="math inline">\(h\)</span> designates that the width of the kernel (and thus the resulting smoothness of the estimated intensity surface) is the same for the entire study region. Fixed bandwidths are commonly used, and sensible for a study region with relatively homogenous population at risk. However choosing a single value can be challenging in practice when the density of points varies substantially across the study region, as could be the case when your study region includes a range from very urban to very rural.</li>
<li><strong>Adaptive bandwidths:</strong> As the name implies, this approach changes or <em>adapts</em> the size of the kernel density bandwidth according to the density of points (data) in differing sub-areas of the overall study region. The result is relatively more smoothing (larger bandwidth) in areas with sparse point data, and relatively less smoothing (smaller bandwidth) in areas with more point density.</li>
</ol>
<p>While not exactly the same, the specification of bandwidth is conceptually similar to the varying approaches to defining spatial neighbors of polygons. The <em>fixed bandwidth</em> is similar to a <em>fixed-distance buffer</em> or <em>inverse-distance</em> definition, whereas the <em>adaptive bandwidth</em> is similar in some ways to a <em>k-nearest neighbors</em> in that the distance adjusts according to density of units.</p>
<div id="fixed-bandwidth-methods" class="section level4" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> Fixed bandwidth methods</h4>
<p>If you prefer a <em>fixed bandwidth</em>, the first challenge is choosing what it should be. One option for selecting a <em>fixed bandwidth</em> is to incorporate theory or prior knowledge about the process of interest. For instance, if you are trying to understand whether the prevalence of diabetes is related to local food environment in an urban area, you might want a bandwidth which helps illuminate differences in diabetes <em>intensity</em> at a scale consistent with the food environment. For instance a bandwidth of <em>1-mile</em> might be more reasonable in urban areas than one of <em>50-miles</em>, as the latter would likely smooth away all of the local variation of interest.</p>
<p>However, it is not uncommon that theory or prior knowledge are insufficient to make a clear choice, or that data sparsity mandates an alternate approach driven by concern for stable estimates. The package <code>sparr</code> has several functions designed to use primarily statistical optimization for estimating an <em>‘optimum’</em> bandwidth. We will introduce two commonly used statistical bandwidth selection optimizers:</p>
<ol style="list-style-type: decimal">
<li><strong>Cross-validation:</strong> this approach divides the data into subsets, using one subset to choose a bandwidth, and comparing the performance on other subsets. The goal is to find a value that works <em>‘best’</em> (e.g. optimize a statistical parameter across multiple iterations). The approach is computationally intensive for large datasets, and in some instances will result in a bandwidth value that is <em>too small</em>. As discussed in note below, cross-validation can result in <em>too small</em> bandwidth estimation.</li>
<li><strong>Oversmoothing:</strong> this is an alternate approach that aims to identify the maximum amount of smoothing necessary for minimizing statistical error. By definition it is a <em>maximum</em> value rather than an <em>ideal</em> or <em>optimal</em> value, but can be useful in setting bounds.</li>
</ol>

<div class="rmdnote">
The <code>sparr</code> package actually three <em>cross-validation</em> approaches to estimation: <code>LCSV.density</code> (least squares cross validated); <code>LIK.density</code> (likelihood cross-validated); and <code>SLIK.adapt</code> (described as an experimental likelihood cross-validation for adaptive). Each is ‘optimizing’ a different thing…the <code>LSCV.density</code> minimizes an unbiased estimate of the mean integrated squared error (MISE) whereas <code>LIK.density</code> maximizes cross-validated leave one out average of the log-likelihood of the density estimate.
If you look at the help documentation for these you will see (near the bottom) a prominent warning message. It reports that “CV for bandwidth selection is notoriously unstable in practice and has a tendency to produced rather small bandwidths…”
</div>
</div>
<div id="cross-validation-with-lik.density" class="section level4" number="6.3.4.2">
<h4><span class="header-section-number">6.3.4.2</span> Cross-validation with <code>LIK.density()</code></h4>
<p><code>LIK.density()</code> uses likelihood estimation of cross-validation optimal bandwidth. For the <em>death</em> dataset, <code>d_ppp</code>, it runs in just a few seconds. However it took &gt; 5 minutes to produce a value on the much larger <em>births</em> dataset, <code>b_ppp</code>. This code lets you try it to see what it produces:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="disease-mapping-iii.html#cb113-1"></a>h_LIK_d &lt;-<span class="st"> </span><span class="kw">LIK.density</span>(d_ppp)</span></code></pre></div>
<pre><code>## Searching for optimal h in [27.463186212964, 12058.8149770359]...Done.</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="disease-mapping-iii.html#cb115-1"></a><span class="kw">print</span>(h_LIK_d)</span></code></pre></div>
<pre><code>## [1] 1613.661</code></pre>
<p>If you examine the object returned (<code>h_LIK_d</code>), you’ll see it is just a single number. This is the value of <span class="math inline">\(h\)</span>, or the optimized bandwidth. It is, in other words, the radius of the 2-dimensional kernel density function in the units of the data, which is <em>meters</em> in this case (e.g. the original data were <em>Albers Equal Area</em> projected). So this means that the optimum kernel will have a radius of just over 1.5 kilometers.</p>
</div>
<div id="oversmoothing-algorithm-with-function-os" class="section level4" number="6.3.4.3">
<h4><span class="header-section-number">6.3.4.3</span> Oversmoothing algorithm with function <code>OS()</code></h4>
<p>This approach is much less computationally intense, and thus feasible for both of our spatial point processes. As we will see below, we can use the value returned from <code>OS()</code> as a <em>pilot value</em> for <em>adaptive bandwidth</em> estimation. In other words it provides a kind of reference or starting point for the adaptation process.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="disease-mapping-iii.html#cb117-1"></a>h_os_d &lt;-<span class="st"> </span><span class="kw">OS</span>(d_ppp)</span>
<span id="cb117-2"><a href="disease-mapping-iii.html#cb117-2"></a>h_os_b &lt;-<span class="st"> </span><span class="kw">OS</span>(b_ppp)</span>
<span id="cb117-3"><a href="disease-mapping-iii.html#cb117-3"></a></span>
<span id="cb117-4"><a href="disease-mapping-iii.html#cb117-4"></a><span class="kw">print</span>(h_os_d)</span></code></pre></div>
<pre><code>## [1] 4257.798</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="disease-mapping-iii.html#cb119-1"></a><span class="kw">print</span>(h_os_b)</span></code></pre></div>
<pre><code>## [1] 1897.371</code></pre>
<p>Note that the <em>birth</em> data have a smaller optimal bandwidth (<code>h_os_b</code>) because there are more points. More points means more information is available for more granular smoothing, whereas the relatively more sparse <em>death</em> data have a larger over smoothing bandwidth (<code>h_os_d</code>).</p>
</div>
<div id="selecting-a-common-bandwidth-for-both-numerator-and-denominator" class="section level4" number="6.3.4.4">
<h4><span class="header-section-number">6.3.4.4</span> Selecting a common bandwidth for both numerator and denominator</h4>
<p>One challenge in bandwidth selection is that we typically have two related spatial point processes (e.g. the numerator, death events; and the denominator, birth events). Therefore we don’t want only a single KDE, but instead we will need to consider a numerator representing the spatial intensity of deaths, and a denominator representing the spatial intensity of all live births at risk. This raises the question of whether there should be a common bandwidth for both, or whether each should be optimized separately.</p>
<p>While there may be only minor differences in the <em>absolute intensity</em> under different bandwidths in a single point process, taking the ratio of two intensity surfaces can exaggerate small differences to be quite large. There are functions for estimating a single, joint, optimum for the bandwidth. The function <code>LSCV.risk()</code> does just what the <code>LIK.density()</code> above did, but with two spatial point processes. The code example is below, but like the previous example, the cross-validation approach to the birth data set takes an excessive amount of time (at least for this exercise).</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="disease-mapping-iii.html#cb121-1"></a><span class="co">#h_LSCV_risk &lt;- LSCV.risk(d_ppp, b_ppp)</span></span></code></pre></div>
</div>
<div id="adaptive-bandwidth-methods" class="section level4" number="6.3.4.5">
<h4><span class="header-section-number">6.3.4.5</span> Adaptive bandwidth methods</h4>
<p>Adaptive methods are specified <em>at the time of kernel density estimation</em>. While the bandwidth is not constant, but instead <em>adaptive</em>, we usually still need to specify a <em>pilot bandwidth</em>, which is a reference point from which adaptation occurs. As mentioned above, the <em>oversmoothing</em> approach from <code>OS()</code> can be used as a pilot value.</p>
</div>
</div>
<div id="estimating-kernel-density-surfaces" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Estimating Kernel Density surfaces</h3>
<p>We now turn to the actual estimation of kernel density approximations of the underlying <em>spatial intensity</em> of disease. The approach in this lab is to first illustrate how to estimate separate densities for each point process (e.g. of <em>deaths</em> and of <em>births</em>), and then to demonstrate two strategies for creating <em>spatial relative risk surfaces</em>, which is generally the target output for spatial epidemiologists.</p>
<p>Of note, this discussion will demonstrate use of both <em>fixed</em> and <em>adaptive</em> bandwidths. In general adaptive bandwidths may be the most practical approach <em>in the absence of theoretical or empirical preference</em> otherwise. However there are instances where <em>fixed bandwidths</em> (either theoretically informed, or as derived from CV or oversmoothing algorithms) are desired, and thus seeing both in action is useful.</p>
<div id="bivariate.density-for-kde-of-single-point-process" class="section level4" number="6.3.5.1">
<h4><span class="header-section-number">6.3.5.1</span> <code>bivariate.density()</code> for KDE of single point process</h4>
<p>There are actually several <code>R</code> packages that accomplish kernel density estimation, but one that is particularly useful for spatial epidemiology (where the kernel density estimator must be 2-dimensional and not just 1-dimensional) is the <code>sparr</code> package, which stands for <em>Spatial and Spatiotemporal Relative Risk</em>.</p>
<p>The <code>sparr</code> function <code>bivariate.density()</code> is a flexible and useful tool for carrying out KDE with either <em>fixed</em> or <em>adaptive</em> bandwidths. There are many arguments for <code>bivariate.density()</code> (see help documentation), but there are several worth specifically highlighting here.</p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>pp</code></strong></td>
<td>This first argument expects a <em>single</em> point process object of class <code>ppp</code>. We will use either <code>d_ppp</code> or <code>b_ppp</code></td>
</tr>
<tr class="even">
<td><strong><code>h0</code></strong></td>
<td>This argument specifies the <em>global fixed</em> bandwidth, if desired. This could be a theoretically-informed value, or derived from an optimization algorithm (e.g. see above)</td>
</tr>
<tr class="odd">
<td><strong><code>hp</code></strong></td>
<td>If conducting <em>adaptive bandwidth</em> estimation, a single <em>pilot bandwidth</em> is still required, and this is where to specify it.</td>
</tr>
<tr class="even">
<td><strong><code>adapt</code></strong></td>
<td>This logical argument is <code>FALSE</code> by default, but set to <code>TRUE</code> if you want adaptive bandwidth estimation</td>
</tr>
<tr class="odd">
<td><strong><code>edge</code></strong></td>
<td>Because a given dataset is invariably a subset of the real world, there are likely <em>edges</em> where there is an artificially abrupt cessation of information. The result is a potentially biased intensity estimation at the study region edges. However there are correction factors. We will choose the <code>edge = 'diggle'</code> specification here</td>
</tr>
<tr class="even">
<td><strong><code>intensity</code></strong></td>
<td>Up until now we have used the words <strong>intensity</strong> and <strong>density</strong> as if they are synonymous for point process parameter, but that is not the case. <strong>Intensity</strong> is the <em>average number of points per unit area</em>. The <strong>density</strong> is proportionate to the <em>intensity</em>, but scaled so that all values in the study region <em>sum to 1</em>. In other words a <strong>density surface</strong> is a proper probability density function. By default, <code>intensity = FALSE</code> which means that by default <code>bivariate.density()</code> produces a <em>density surface</em>. If you want <em>intensity</em>, set <code>intensity = TRUE</code>.</td>
</tr>
</tbody>
</table>
</div>
<div id="fixed-bandwidth-kde-with-bivariate.density" class="section level4" number="6.3.5.2">
<h4><span class="header-section-number">6.3.5.2</span> Fixed bandwidth KDE with <code>bivariate.density()</code></h4>
<p>First, let’s try a basic version that uses the <em>oversmooth</em> estimate for each point process.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="disease-mapping-iii.html#cb122-1"></a>death_kde &lt;-<span class="st"> </span><span class="kw">bivariate.density</span>(<span class="dt">pp =</span> d_ppp, <span class="dt">h0 =</span> h_os_d, <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>)</span>
<span id="cb122-2"><a href="disease-mapping-iii.html#cb122-2"></a>birth_kde &lt;-<span class="st"> </span><span class="kw">bivariate.density</span>(<span class="dt">pp =</span> b_ppp, <span class="dt">h0 =</span> h_os_b, <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>)</span></code></pre></div>
<p>You can explore the objects produced by the function call. For instance, they are <code>list</code> objects, with named sub-elements:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="disease-mapping-iii.html#cb123-1"></a><span class="kw">summary</span>(birth_kde)</span></code></pre></div>
<pre><code>## Bivariate Kernel Density/Intensity Estimate
## 
## Bandwidth
##   Fixed smoothing with h0 = 1897.371 units (to 4 d.p.)
## 
## No. of observations
##   94373 
## 
## Spatial bound
##   Type: polygonal
##   2D enclosure: [1026366, 1098719] x [1220671, 1302019]
## 
## Evaluation
##   128 x 128 rectangular grid
##   5808 grid cells out of 16384 fall inside study region
##   Density/intensity range [6.313906e-14, 1.585466e-09]</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="disease-mapping-iii.html#cb125-1"></a><span class="kw">names</span>(birth_kde)</span></code></pre></div>
<pre><code>## [1] &quot;z&quot;         &quot;h0&quot;        &quot;hp&quot;        &quot;h&quot;         &quot;him&quot;       &quot;q&quot;        
## [7] &quot;gamma&quot;     &quot;geometric&quot; &quot;pp&quot;</code></pre>
<p>There is also some plotting functionality built into the <code>sparr</code> package that allows us to quickly visualize the resulting density plot.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="disease-mapping-iii.html#cb127-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb127-2"><a href="disease-mapping-iii.html#cb127-2"></a><span class="kw">plot</span>(birth_kde, <span class="dt">main =</span> <span class="st">&#39;Birth density&#39;</span>)</span>
<span id="cb127-3"><a href="disease-mapping-iii.html#cb127-3"></a><span class="kw">plot</span>(death_kde, <span class="dt">main =</span> <span class="st">&#39;Death density&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="disease-mapping-iii.html#cb128-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="adaptive-bandwidth-kde-with-bivariate.density" class="section level4" number="6.3.5.3">
<h4><span class="header-section-number">6.3.5.3</span> Adaptive bandwidth KDE with <code>bivariate.density()</code></h4>
<p>As discussed above, an alternative to a single <em>fixed bandwidth</em>, is implementation of an algorithm that changes (<em>adapts</em>) the bandwidth across the study region in response to the density or sparseness of the data. This approach still requires specification of a <em>global</em> bandwidth, and the adaptation is a multiplier making the global smaller or larger as needed. In this code we use the argument <code>h0 =</code> to specify a <em>pilot bandwidth</em>. Because <em>adaptive bandwidth KDE</em> requires adjustment across the study region, you will notice that these functions take longer than the <em>fixed bandwidth</em> above, especially the large birth point process.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="disease-mapping-iii.html#cb129-1"></a>death_kde_adapt &lt;-<span class="st"> </span><span class="kw">bivariate.density</span>(d_ppp, </span>
<span id="cb129-2"><a href="disease-mapping-iii.html#cb129-2"></a>                                     <span class="dt">h0 =</span> h_os_d, </span>
<span id="cb129-3"><a href="disease-mapping-iii.html#cb129-3"></a>                                     <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>, </span>
<span id="cb129-4"><a href="disease-mapping-iii.html#cb129-4"></a>                                     <span class="dt">adapt =</span> <span class="ot">TRUE</span>,</span>
<span id="cb129-5"><a href="disease-mapping-iii.html#cb129-5"></a>                                     <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb129-6"><a href="disease-mapping-iii.html#cb129-6"></a>birth_kde_adapt &lt;-<span class="st"> </span><span class="kw">bivariate.density</span>(b_ppp, </span>
<span id="cb129-7"><a href="disease-mapping-iii.html#cb129-7"></a>                                     <span class="dt">h0 =</span> h_os_b, </span>
<span id="cb129-8"><a href="disease-mapping-iii.html#cb129-8"></a>                                     <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>,</span>
<span id="cb129-9"><a href="disease-mapping-iii.html#cb129-9"></a>                                     <span class="dt">adapt =</span> <span class="ot">TRUE</span>,</span>
<span id="cb129-10"><a href="disease-mapping-iii.html#cb129-10"></a>                                     <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb129-11"><a href="disease-mapping-iii.html#cb129-11"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb129-12"><a href="disease-mapping-iii.html#cb129-12"></a><span class="kw">plot</span>(birth_kde_adapt, <span class="dt">main =</span> <span class="st">&#39;Birth density</span><span class="ch">\n</span><span class="st">(adaptive h)&#39;</span>)</span>
<span id="cb129-13"><a href="disease-mapping-iii.html#cb129-13"></a><span class="kw">plot</span>(death_kde_adapt, <span class="dt">main =</span> <span class="st">&#39;Death density</span><span class="ch">\n</span><span class="st">(adaptive h)&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="disease-mapping-iii.html#cb130-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Does this result from the <em>adaptive</em> bandwidth look different from the <em>fixed</em> bandwidth? <em>Not really</em>. The reason is because the units of measurement (intensity) are so small that differences are not apparent. However the differences become more apparent when we take the ratio of the two surfaces, which we will do below.</p>
</div>
<div id="plotting-kde-estimates-with-tmap" class="section level4" number="6.3.5.4">
<h4><span class="header-section-number">6.3.5.4</span> Plotting KDE estimates with <code>tmap</code></h4>
<p>It is handy that the <code>sparr</code> package has some built-in plotting functionality to quickly visualize the results. However you may want to have more control over the plotting, for instance in <code>tmap</code> or even in <code>ggplot2</code>.</p>
<p>If you recall the named elements in the <code>list</code> object returned by <code>bivariate.density()</code>, the first is called <code>z</code>, and this is the density surface itself.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="disease-mapping-iii.html#cb131-1"></a><span class="kw">class</span>(birth_kde<span class="op">$</span>z)</span></code></pre></div>
<pre><code>## [1] &quot;im&quot;</code></pre>
<p>The class of this object is <code>im</code> for <em>image</em>. However for almost any spatial plotting or operation outside of <code>sparr</code> and <code>spatstat</code>, we want this data in the <code>raster</code> class rather than this <code>im</code> format (fundamentally the data <em>is</em> a raster model, but the data structure in <code>R</code> is not quite the same as the data structure of class <code>raster</code>). We can convert <code>im</code> to <code>raster</code> class like this:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="disease-mapping-iii.html#cb133-1"></a>death_kde_raster &lt;-<span class="st"> </span><span class="kw">raster</span>(death_kde_adapt<span class="op">$</span>z,</span>
<span id="cb133-2"><a href="disease-mapping-iii.html#cb133-2"></a>                           <span class="dt">crs =</span> <span class="st">&quot;+init=epsg:5070&quot;</span>)</span>
<span id="cb133-3"><a href="disease-mapping-iii.html#cb133-3"></a>birth_kde_raster &lt;-<span class="st"> </span><span class="kw">raster</span>(birth_kde_adapt<span class="op">$</span>z,</span>
<span id="cb133-4"><a href="disease-mapping-iii.html#cb133-4"></a>                           <span class="dt">crs =</span> <span class="st">&quot;+init=epsg:5070&quot;</span>)</span></code></pre></div>
<p>NOtice in the code above the specification of <code>crs = "+init=epsg:5070"</code>. The <code>im</code> object lost all information about the original <em>coordinate reference system</em> (CRS) or <em>projection</em>. However, we need our raster object to have this CRS information to plot properly in <code>tmap</code>. We know that the original point data were <em>projected</em> in <em>Albers Equal Area</em>, specificlly with <em>EPSG code</em> of 5070. So we re-define that when creating the rasters above.</p>
<p>Now we can plot these in <code>tmap</code>:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="disease-mapping-iii.html#cb134-1"></a><span class="co"># Create map of death surface</span></span>
<span id="cb134-2"><a href="disease-mapping-iii.html#cb134-2"></a>m1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(death_kde_raster) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-3"><a href="disease-mapping-iii.html#cb134-3"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb134-4"><a href="disease-mapping-iii.html#cb134-4"></a>            <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb134-5"><a href="disease-mapping-iii.html#cb134-5"></a>            <span class="dt">n =</span> <span class="dv">9</span>,</span>
<span id="cb134-6"><a href="disease-mapping-iii.html#cb134-6"></a>            <span class="dt">title =</span> <span class="st">&#39;Death density&#39;</span>) <span class="op">+</span></span>
<span id="cb134-7"><a href="disease-mapping-iii.html#cb134-7"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.format =</span> <span class="kw">list</span>(<span class="dt">scientific =</span> T))</span>
<span id="cb134-8"><a href="disease-mapping-iii.html#cb134-8"></a></span>
<span id="cb134-9"><a href="disease-mapping-iii.html#cb134-9"></a><span class="co"># Create map of birth surface</span></span>
<span id="cb134-10"><a href="disease-mapping-iii.html#cb134-10"></a>m2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(birth_kde_raster) <span class="op">+</span></span>
<span id="cb134-11"><a href="disease-mapping-iii.html#cb134-11"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb134-12"><a href="disease-mapping-iii.html#cb134-12"></a>            <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb134-13"><a href="disease-mapping-iii.html#cb134-13"></a>            <span class="dt">n =</span> <span class="dv">9</span>,</span>
<span id="cb134-14"><a href="disease-mapping-iii.html#cb134-14"></a>            <span class="dt">title =</span> <span class="st">&#39;Birth density&#39;</span>) <span class="op">+</span></span>
<span id="cb134-15"><a href="disease-mapping-iii.html#cb134-15"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.format =</span> <span class="kw">list</span>(<span class="dt">scientific =</span> T))</span>
<span id="cb134-16"><a href="disease-mapping-iii.html#cb134-16"></a></span>
<span id="cb134-17"><a href="disease-mapping-iii.html#cb134-17"></a><span class="co"># plot 2-panel arrangment</span></span>
<span id="cb134-18"><a href="disease-mapping-iii.html#cb134-18"></a><span class="kw">tmap_arrange</span>(m1, m2)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-145-1.png" width="672" />
Notice how the resulting maps look a little <em>pixely</em>. There are two reasons contributing this. First, the code above specified the colors in quantiles in order to get a range despite possibly skewed values. But you could try re-plotting the above plots setting <code>style = 'cont'</code> for <em>continuous</em> color palette, and comment out the <code>n=9</code>. You will see that this produces a much <em>smoother</em> looking plot. The difference between the plots with <code>style = 'cont'</code> and <code>style = 'quantile'</code> is the gradation of color in the intermediate levels of intensity.</p>
<p>But the other reason for the pixelation is because the original call to <code>bivariate.density()</code> used the default output resolution of 128 x 128 grid cells. This was done for computational efficiency. However, note that if you want a higher-resolution surface (e.g. for publication, presentation), you can increase by specifying <code>resolution =</code> in the creation of the KDE surface in the original call to <code>bivariate.density()</code>.</p>
</div>
</div>
<div id="creating-relative-risk-surface-manually" class="section level3" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> Creating relative risk surface manually</h3>
<p>Up until now, we have only created the KDE surface for the <em>death</em> and <em>birth</em> points separately. But for epidemiology, we rarely care about numerator and denominator separately! So how do we put these two together into a more informative disease map?</p>
<p><em>Raster algebra</em> is a term for arithmetic and algebraic manipulation of raster grids. Recall that a <em>raster</em> data set is simply a array of numbers. The numbered value of each grid-point represents the mean density or intensity of points per unit-area, and is mapped as color to make the plot. Because it is simply a matrix of numbers, we can take two rasters of the same resolution and study area and add, subtract, multiply, log-transform, or otherwise operate on them arithmetically.</p>
<p>For instance to manually create <em>spatial relative risk surface</em> we simply take the ratio of two KDE density surfaces. The result is a relative measure akin to the SMR: it quantifies the relative deviation of each area from an overall average value. So values below 1 are areas with <em>lower than average risk</em>, meaning that the intensity of <em>deaths</em> is less than the intensity of <em>live births</em>, and values above 1 have <em>higher than average risk</em> (the intensity of <em>deaths</em> is greater than the intensity of <em>live births</em>).</p>

<div class="rmdnote">
For interpretting the <em>ratio of two kernel surfaces</em> take care to distinguish between the <strong>spatial intensity</strong> (number of point events per unit area; the value integrates or sums to the total number of points across the study region) versus the <strong>spatial density</strong> (probability of a point event occuring at this location, conditional on total number of points; integrates to 1 across the study region). The distinction is important. The default output of <code>bivariate.density()</code> function is a <em>spatial density surface</em>. The ratio of two density (probability) surfaces will take the value of 1.0 when the probability of a death at that location is proportionate to the probability of a birth at that location. In contrast the ratio of two intensity surfaces is interpretted as an absolute measure (e.g. risk, rate, prevalence) ranging from zero to 1. If you choose <code>intensity = TRUE</code> when specifying the <code>bivariate.density()</code> function you will get the intensity rather than (default) density surface.
</div>
<p>In the <code>tmap</code> call I <em>flipped</em> the color ramp by using the negative sign in front of the name of the ramp. I also specified a continuous style rather than discrete (e.g. <code>quantile</code>), and specified some legend breaks.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="disease-mapping-iii.html#cb135-1"></a><span class="co"># Create risk surface as ratio of death density to birth density</span></span>
<span id="cb135-2"><a href="disease-mapping-iii.html#cb135-2"></a>risk &lt;-<span class="st"> </span>death_kde_raster <span class="op">/</span><span class="st"> </span>birth_kde_raster</span>
<span id="cb135-3"><a href="disease-mapping-iii.html#cb135-3"></a></span>
<span id="cb135-4"><a href="disease-mapping-iii.html#cb135-4"></a><span class="co"># Map it...</span></span>
<span id="cb135-5"><a href="disease-mapping-iii.html#cb135-5"></a><span class="kw">tm_shape</span>(risk) <span class="op">+</span><span class="st"> </span></span>
<span id="cb135-6"><a href="disease-mapping-iii.html#cb135-6"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">palette =</span> <span class="st">&#39;-RdYlGn&#39;</span>,</span>
<span id="cb135-7"><a href="disease-mapping-iii.html#cb135-7"></a>            <span class="dt">style =</span> <span class="st">&#39;cont&#39;</span>,</span>
<span id="cb135-8"><a href="disease-mapping-iii.html#cb135-8"></a>            <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>,   <span class="fl">1.1</span>, <span class="dv">2</span>, <span class="fl">4.9</span>),</span>
<span id="cb135-9"><a href="disease-mapping-iii.html#cb135-9"></a>            <span class="dt">title =</span> <span class="st">&#39;IMR SMR&#39;</span>) </span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p>Now we can more clearly see regions of <em>higher risk</em> and <em>lower risk</em> of infant mortality!</p>
</div>
<div id="creating-relative-risk-surface-with-risk-function" class="section level3" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> Creating relative risk surface with <code>risk()</code> function</h3>
<p>The preceding <em>manual</em> approach created two separate kernel density surfaces, and then manually relied on raster algebra to create the spatial relative risk surface. This is useful to know because you may use KDE in other setting where you only work with a single spatial point process (e.g. imagine that instead of estimating disease intensity, you wish to estimate an <em>exposure</em> density surface).</p>
<p>However, the <code>sparr</code> package provides a shortcut for estimation of spatial relative risk surfaces in the function <code>risk()</code>. It takes a numerator and denominator <code>ppp</code> object as arguments and calculates the spatial relative risk surface automatically.</p>
<p>As a demonstration of comparing four arbitrary, fixed bandwidths for the purposes of data exploration, below we estimate four distinct spatial relative risk surfaces, as well as one adaptive KDE. In each case notice the first two arguments are the numerator and denominator <code>ppp</code> object. The next argument is a pre-specified fixed bandwidth (e.g. 1000, 2000, 4000, and 8000 meters).</p>
<p>This function also illustrates another <em>feature</em> which allows us to quantify statistical precision by creating <em>tolerance contours</em>. Tolerance contours are simply lines which encircle regions that are statistically significant below a given threshold. The argument <code>tolerate = T</code> tells the function to estimate <em>asymptotic</em> p-values testing the null hypothesis that the local relative risk of death is equal across the study region.</p>
<p>By default, the function estimates the <em>log relative risk</em>, which is a helpful reminder that the <em>relative risk</em> is asymmetric. However, we understand ratio measures, and will be careful to plot the results appropriately. For that reason, I set <code>log = FALSE</code>, although obviously you could omit that and keep everything on the <code>log</code> scale.</p>
<p><strong>NOTE:</strong> The <em>fixed bandwidth</em> <code>risk()</code> functions will run quickly, but once again, the <em>adaptive bandwidth</em> is more computationally intensive, and will take longer.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="disease-mapping-iii.html#cb136-1"></a>imr1000 &lt;-<span class="st"> </span><span class="kw">risk</span>(d_ppp, b_ppp, <span class="dt">h0 =</span> <span class="dv">1000</span>, </span>
<span id="cb136-2"><a href="disease-mapping-iii.html#cb136-2"></a>            <span class="dt">tolerate =</span> T,</span>
<span id="cb136-3"><a href="disease-mapping-iii.html#cb136-3"></a>            <span class="dt">verbose =</span> F, </span>
<span id="cb136-4"><a href="disease-mapping-iii.html#cb136-4"></a>            <span class="dt">log =</span> F,</span>
<span id="cb136-5"><a href="disease-mapping-iii.html#cb136-5"></a>            <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>)</span>
<span id="cb136-6"><a href="disease-mapping-iii.html#cb136-6"></a></span>
<span id="cb136-7"><a href="disease-mapping-iii.html#cb136-7"></a>imr2000 &lt;-<span class="st"> </span><span class="kw">risk</span>(d_ppp, b_ppp, <span class="dt">h0 =</span> <span class="dv">2000</span>, </span>
<span id="cb136-8"><a href="disease-mapping-iii.html#cb136-8"></a>            <span class="dt">tolerate =</span> T,</span>
<span id="cb136-9"><a href="disease-mapping-iii.html#cb136-9"></a>            <span class="dt">log =</span> F,</span>
<span id="cb136-10"><a href="disease-mapping-iii.html#cb136-10"></a>            <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>,</span>
<span id="cb136-11"><a href="disease-mapping-iii.html#cb136-11"></a>            <span class="dt">verbose =</span> F)</span>
<span id="cb136-12"><a href="disease-mapping-iii.html#cb136-12"></a></span>
<span id="cb136-13"><a href="disease-mapping-iii.html#cb136-13"></a>imr4000 &lt;-<span class="st"> </span><span class="kw">risk</span>(d_ppp, b_ppp, <span class="dt">h0 =</span> <span class="dv">4000</span>, </span>
<span id="cb136-14"><a href="disease-mapping-iii.html#cb136-14"></a>            <span class="dt">tolerate =</span> T,</span>
<span id="cb136-15"><a href="disease-mapping-iii.html#cb136-15"></a>            <span class="dt">log =</span> F,</span>
<span id="cb136-16"><a href="disease-mapping-iii.html#cb136-16"></a>            <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>,</span>
<span id="cb136-17"><a href="disease-mapping-iii.html#cb136-17"></a>            <span class="dt">verbose =</span> F)</span>
<span id="cb136-18"><a href="disease-mapping-iii.html#cb136-18"></a></span>
<span id="cb136-19"><a href="disease-mapping-iii.html#cb136-19"></a>imr8000 &lt;-<span class="st"> </span><span class="kw">risk</span>(d_ppp, b_ppp, <span class="dt">h0 =</span> <span class="dv">8000</span>, </span>
<span id="cb136-20"><a href="disease-mapping-iii.html#cb136-20"></a>            <span class="dt">tolerate =</span> T,</span>
<span id="cb136-21"><a href="disease-mapping-iii.html#cb136-21"></a>            <span class="dt">log =</span> F,</span>
<span id="cb136-22"><a href="disease-mapping-iii.html#cb136-22"></a>            <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>,</span>
<span id="cb136-23"><a href="disease-mapping-iii.html#cb136-23"></a>            <span class="dt">verbose =</span> F)</span>
<span id="cb136-24"><a href="disease-mapping-iii.html#cb136-24"></a></span>
<span id="cb136-25"><a href="disease-mapping-iii.html#cb136-25"></a>imradapt &lt;-<span class="st"> </span><span class="kw">risk</span>(d_ppp, b_ppp, </span>
<span id="cb136-26"><a href="disease-mapping-iii.html#cb136-26"></a>                 <span class="dt">h0 =</span> h_os_d, </span>
<span id="cb136-27"><a href="disease-mapping-iii.html#cb136-27"></a>                 <span class="dt">adapt =</span> T, </span>
<span id="cb136-28"><a href="disease-mapping-iii.html#cb136-28"></a>                 <span class="dt">tolerate =</span> T,</span>
<span id="cb136-29"><a href="disease-mapping-iii.html#cb136-29"></a>                 <span class="dt">log =</span> F,</span>
<span id="cb136-30"><a href="disease-mapping-iii.html#cb136-30"></a>                 <span class="dt">edge =</span> <span class="st">&#39;diggle&#39;</span>,</span>
<span id="cb136-31"><a href="disease-mapping-iii.html#cb136-31"></a>                 <span class="dt">verbose =</span> F)</span></code></pre></div>
<p>Examine the contents of one of these objects. The summary show us the range of the estimated risk, the resolution of the evaluation grid, and the number of points evaluated.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="disease-mapping-iii.html#cb137-1"></a><span class="kw">summary</span>(imr1000)</span></code></pre></div>
<pre><code>## Log-Relative Risk Function.
## 
## Estimated risk range [-8.216873e-14, 11.05946]
## 
## --Numerator (case) density--
## Bivariate Kernel Density/Intensity Estimate
## 
## Bandwidth
##   Fixed smoothing with h0 = 1000 units (to 4 d.p.)
## 
## No. of observations
##   701 
## 
## Spatial bound
##   Type: polygonal
##   2D enclosure: [1026366, 1098719] x [1220671, 1302019]
## 
## Evaluation
##   128 x 128 rectangular grid
##   5808 grid cells out of 16384 fall inside study region
##   Density/intensity range [-1.82875e-25, 2.78467e-09]
## 
## --Denominator (control) density--
## Bivariate Kernel Density/Intensity Estimate
## 
## Bandwidth
##   Fixed smoothing with h0 = 1000 units (to 4 d.p.)
## 
## No. of observations
##   94373 
## 
## Spatial bound
##   Type: polygonal
##   2D enclosure: [1026366, 1098719] x [1220671, 1302019]
## 
## Evaluation
##   128 x 128 rectangular grid
##   5808 grid cells out of 16384 fall inside study region
##   Density/intensity range [2.143127e-16, 2.383589e-09]</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="disease-mapping-iii.html#cb139-1"></a><span class="kw">names</span>(imr1000)</span></code></pre></div>
<pre><code>## [1] &quot;rr&quot; &quot;f&quot;  &quot;g&quot;  &quot;P&quot;</code></pre>

<div class="rmdcaution">
<strong>BEWARE</strong>: You can see that the range of the estimated risk is <span class="math inline">\([-8.216873e-14, 11.05946]\)</span>. The lower bound is in practical terms zero (e.g. it is very, very small), but counter-intuitively it is also <em>negative</em>! How could we estimated <em>negative risk</em>? The answer seems to be related to the Diggle edge correction. For example if you substitute <code>edge = 'uniform'</code> the anomaly goes away. This is likely because edge correction (which in the big picture is a valuable strategy) reweights regions and may result in specific location estimates that become negative.
</div>
<p>Once again, we can use built-in plotting functionality from <code>sparr</code> to produce maps of the <em>spatial relative risk surface</em> and the tolerance contours. (NOTE: the default legend works best for <em>log relative risk</em>, but doesn’t behave well for the <em>relative risk</em> because it treats the distance from 0 to 1 as the same as the distance from 1 to 2, or 4 to 5).</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="disease-mapping-iii.html#cb141-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb141-2"><a href="disease-mapping-iii.html#cb141-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb141-3"><a href="disease-mapping-iii.html#cb141-3"></a><span class="kw">plot</span>(imr1000)</span>
<span id="cb141-4"><a href="disease-mapping-iii.html#cb141-4"></a><span class="kw">plot</span>(imr2000)</span>
<span id="cb141-5"><a href="disease-mapping-iii.html#cb141-5"></a><span class="kw">plot</span>(imr4000)</span>
<span id="cb141-6"><a href="disease-mapping-iii.html#cb141-6"></a><span class="kw">plot</span>(imr8000)</span>
<span id="cb141-7"><a href="disease-mapping-iii.html#cb141-7"></a><span class="kw">plot</span>(imradapt)</span>
<span id="cb141-8"><a href="disease-mapping-iii.html#cb141-8"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>While the code above plots these side-by-side, you might find it easier to plot them one at a time and zoom in closer. Notice the contour lines for <span class="math inline">\(p&lt;0.05\)</span>. Also notice how the risk surface becomes smoother as the fixed bandwidth transitions from <span class="math inline">\(1km\)</span> to <span class="math inline">\(8km\)</span>. Finally, notice how the <em>adaptive</em> bandwidth is consistent with the other maps, but seems to balance the detail between the 2000 meter and 4000 meter definitions.</p>
</div>
<div id="using-functions-to-map-rr-with-tmap" class="section level3" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> Using functions to map RR with <code>tmap</code></h3>
<p>When we begin plotting several maps, the conversion from the <code>im</code> to <code>raster</code> and the code for producing map panels can feel cumbersome. While the following section is not required, it is a demonstration of how you can write simple custom functions in <code>R</code> to speed up repetitive tasks.</p>
<p>A function in <code>R</code> is like a macro in SAS; it is simply a set of instructions that accepts <em>arguments</em> (inputs), carries out some action on those inputs, and then <em>returns</em> some output.</p>
<p>This is a function that accepts a single <em>argument</em>, labeled simply <code>x</code> here. The expectation is that <code>x</code> should be the output of the above <code>risk()</code> function. Notice how the function first extracts the spatial relative risk surface (e.g. <code>x$rr</code>), and then assigns the appropriate projection (it got stripped off some where along the way).</p>
<p>Then the function extracts the <em>probability map</em> which is the set of pixel-specific p-values. The <code>rasterToContour()</code> function takes this raster and creates contour lines with the specified levels corresponding to a 95% tolerance contour. Finally, the use of the <code>return()</code> tells what should be returned when the function is called.</p>
<p>Once you write a function, it need only be loaded once in a given session; afterwords you can <em>call</em> it by using <code>prepRaster(x = my_risk_object)</code>.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="disease-mapping-iii.html#cb142-1"></a><span class="co">### --- prepRaster() function --- </span><span class="al">###</span></span>
<span id="cb142-2"><a href="disease-mapping-iii.html#cb142-2"></a>prepRaster &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb142-3"><a href="disease-mapping-iii.html#cb142-3"></a>  rr &lt;-<span class="st"> </span><span class="kw">raster</span>(x<span class="op">$</span>rr,</span>
<span id="cb142-4"><a href="disease-mapping-iii.html#cb142-4"></a>               <span class="dt">crs =</span> <span class="st">&quot;+init=epsg:5070&quot;</span>)</span>
<span id="cb142-5"><a href="disease-mapping-iii.html#cb142-5"></a></span>
<span id="cb142-6"><a href="disease-mapping-iii.html#cb142-6"></a>  p_raster &lt;-<span class="st"> </span><span class="kw">raster</span>(x<span class="op">$</span>P,</span>
<span id="cb142-7"><a href="disease-mapping-iii.html#cb142-7"></a>               <span class="dt">crs =</span> <span class="st">&quot;+init=epsg:5070&quot;</span>)</span>
<span id="cb142-8"><a href="disease-mapping-iii.html#cb142-8"></a>  plines &lt;-<span class="st"> </span><span class="kw">rasterToContour</span>(p_raster, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="fl">0.025</span>,  <span class="fl">0.975</span>))</span>
<span id="cb142-9"><a href="disease-mapping-iii.html#cb142-9"></a>  </span>
<span id="cb142-10"><a href="disease-mapping-iii.html#cb142-10"></a>  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">rr=</span>rr,<span class="dt">plines=</span>plines))</span>
<span id="cb142-11"><a href="disease-mapping-iii.html#cb142-11"></a>} <span class="co">## </span><span class="re">END</span><span class="co"> prepRaster() ##</span></span></code></pre></div>
<p>While we’re on a roll, we could also write a function for producing a <code>tmap</code> panel:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="disease-mapping-iii.html#cb143-1"></a><span class="co">### --- make_map() function to create panel maps --- </span><span class="al">###</span></span>
<span id="cb143-2"><a href="disease-mapping-iii.html#cb143-2"></a>make_map &lt;-<span class="st"> </span><span class="cf">function</span>(x, bw){</span>
<span id="cb143-3"><a href="disease-mapping-iii.html#cb143-3"></a>  mtitle &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;IMR - &#39;</span>, bw, <span class="st">&#39; smooth&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb143-4"><a href="disease-mapping-iii.html#cb143-4"></a>  <span class="kw">tm_shape</span>(x<span class="op">$</span>rr) <span class="op">+</span></span>
<span id="cb143-5"><a href="disease-mapping-iii.html#cb143-5"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">palette =</span> <span class="st">&#39;-RdYlGn&#39;</span>,</span>
<span id="cb143-6"><a href="disease-mapping-iii.html#cb143-6"></a>            <span class="dt">style =</span> <span class="st">&#39;cont&#39;</span>,</span>
<span id="cb143-7"><a href="disease-mapping-iii.html#cb143-7"></a>            <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>,   <span class="fl">1.1</span>, <span class="dv">2</span>, <span class="fl">4.9</span>),</span>
<span id="cb143-8"><a href="disease-mapping-iii.html#cb143-8"></a>            <span class="dt">midpoint =</span> <span class="ot">NA</span>,</span>
<span id="cb143-9"><a href="disease-mapping-iii.html#cb143-9"></a>            <span class="dt">title =</span> <span class="st">&#39;IMR SMR&#39;</span>) <span class="op">+</span></span>
<span id="cb143-10"><a href="disease-mapping-iii.html#cb143-10"></a><span class="st">  </span><span class="kw">tm_shape</span>(x<span class="op">$</span>plines) <span class="op">+</span></span>
<span id="cb143-11"><a href="disease-mapping-iii.html#cb143-11"></a><span class="st">  </span><span class="kw">tm_lines</span>(<span class="dt">col =</span> <span class="st">&#39;level&#39;</span>,</span>
<span id="cb143-12"><a href="disease-mapping-iii.html#cb143-12"></a>           <span class="dt">legend.col.show =</span> F) <span class="op">+</span><span class="st"> </span></span>
<span id="cb143-13"><a href="disease-mapping-iii.html#cb143-13"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">main.title =</span> mtitle,</span>
<span id="cb143-14"><a href="disease-mapping-iii.html#cb143-14"></a>            <span class="dt">legend.format =</span> <span class="kw">list</span>(<span class="dt">digits =</span> <span class="dv">1</span>)) </span>
<span id="cb143-15"><a href="disease-mapping-iii.html#cb143-15"></a>} <span class="co">## </span><span class="re">END</span><span class="co"> make_map() function ##</span></span></code></pre></div>
<p>The result of this work is that we can easily (and more compactly), map the four fixed-bandwidth spatial relative risk surfaces.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="disease-mapping-iii.html#cb144-1"></a><span class="co"># First convert to raster and extract p-value contours</span></span>
<span id="cb144-2"><a href="disease-mapping-iii.html#cb144-2"></a>rr_<span class="dv">1000</span> &lt;-<span class="st"> </span><span class="kw">prepRaster</span>(imr1000)</span>
<span id="cb144-3"><a href="disease-mapping-iii.html#cb144-3"></a>rr_<span class="dv">2000</span> &lt;-<span class="st"> </span><span class="kw">prepRaster</span>(imr2000)</span>
<span id="cb144-4"><a href="disease-mapping-iii.html#cb144-4"></a>rr_<span class="dv">4000</span> &lt;-<span class="st"> </span><span class="kw">prepRaster</span>(imr4000)</span>
<span id="cb144-5"><a href="disease-mapping-iii.html#cb144-5"></a>rr_<span class="dv">8000</span> &lt;-<span class="st"> </span><span class="kw">prepRaster</span>(imr8000)</span>
<span id="cb144-6"><a href="disease-mapping-iii.html#cb144-6"></a>rr_adapt &lt;-<span class="st"> </span><span class="kw">prepRaster</span>(imradapt)</span>
<span id="cb144-7"><a href="disease-mapping-iii.html#cb144-7"></a></span>
<span id="cb144-8"><a href="disease-mapping-iii.html#cb144-8"></a><span class="co"># Then produce map panels</span></span>
<span id="cb144-9"><a href="disease-mapping-iii.html#cb144-9"></a>m1000 &lt;-<span class="st"> </span><span class="kw">make_map</span>(rr_<span class="dv">1000</span>, <span class="st">&#39;1 km&#39;</span>)</span>
<span id="cb144-10"><a href="disease-mapping-iii.html#cb144-10"></a>m2000 &lt;-<span class="st"> </span><span class="kw">make_map</span>(rr_<span class="dv">2000</span>, <span class="st">&#39;2 km&#39;</span>)</span>
<span id="cb144-11"><a href="disease-mapping-iii.html#cb144-11"></a>m4000 &lt;-<span class="st"> </span><span class="kw">make_map</span>(rr_<span class="dv">4000</span>, <span class="st">&#39;4 km&#39;</span>)</span>
<span id="cb144-12"><a href="disease-mapping-iii.html#cb144-12"></a>m8000 &lt;-<span class="st"> </span><span class="kw">make_map</span>(rr_<span class="dv">8000</span>, <span class="st">&#39;8 km&#39;</span>)</span>
<span id="cb144-13"><a href="disease-mapping-iii.html#cb144-13"></a>mapadapt &lt;-<span class="st"> </span><span class="kw">make_map</span>(rr_adapt, <span class="st">&#39;adaptive&#39;</span>)</span>
<span id="cb144-14"><a href="disease-mapping-iii.html#cb144-14"></a></span>
<span id="cb144-15"><a href="disease-mapping-iii.html#cb144-15"></a><span class="kw">tmap_arrange</span>(m1000, m2000, m4000, m8000,mapadapt, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
</div>
</div>
<div id="spatial-analysis-in-epidemiology-kernel-estimation-of-areal-data" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Spatial Analysis in Epidemiology: Kernel estimation of areal data</h2>
<p>In the preceding section we saw how to use KDE for estimating a smooth <em>spatial intensity surface</em> from a spatial point process. In this section we introduce <em>geographically-weighted</em> statistics that are extendable to areal units and not only points. There were three key features about the use of KDE from the preceding section that we will extend on here:</p>
<ol style="list-style-type: decimal">
<li><em>KDE are not only for points</em> - while the whole notion of the kernel density estimation process is indeed connected to the <span class="math inline">\(x,y\)</span> point location, this does not mean we cannot take advantage of the non-parametric smoothing for other kinds of data, such as polygons. Typically the centroid (geometric center) of a polygon is used as the stand-in for point when KDE is done with polygons.</li>
<li><em>KDE is not only for binary values</em> - a spatial point process is by definition the a description of the location of discrete points representing a discrete state. For instance in section above, we visualized the spatial intensity surface of infant deaths, and separately the surface of live births. But what if we want to measure a <em>continuous value</em> rather than a discrete, binary state at spatial locations? The mechanics of KDE can still be helpful!</li>
<li><em>KDE is a kind of spatial weighting procedure</em> - this was true in Part A as well…the <em>spatial intensity</em> is essentially the spatially-weighted number of points surrounding an index location divided by the area under the kernel function. In this lab the primary use of the kernel function is to produce weights for calculating weighted-statistics including <em>mean</em>, <em>median</em>, etc of any quantity that is measured.</li>
</ol>
<p>This lab introduces a function in the package <code>GWmodel</code> (e.g. <em>geographically weighted models</em>) that is very useful for exploratory spatial data analysis. The function <code>gwss()</code> stands for <em>geographically weighted summary statistics</em>, and uses the non-parametric spatial weighting of a kernel density function to compute <em>locally varying descriptive statistics</em> such as the <em>mean</em>, <em>median</em>, <em>standard deviation</em>, <em>correlation</em>, and more. And while it certainly works for data represented as <span class="math inline">\(x,y\)</span> points, it can also work for polygon data.</p>
<p>What this means is that the <code>gwss()</code> function can be useful for exploring spatial heterogeneity as a form of <em>local spatial non-stationarity</em>. Recall that <em>spatial stationarity</em> is the notion that a statistical parameter is <em>global</em> or <em>constant</em> across space? We previously encountered <em>stationarity</em> as the opposite of <em>spatial heterogeneity</em>. In that context we were referring to the <em>risk</em> or <em>prevalence</em> of health states. But <strong>any statistic</strong> can be <em>stationary</em> (constant) or <em>non-stationary</em> (spatially varying).</p>
<p>The objective of this section is to extend our understanding of the utility of <em>kernel density functions</em> beyond simply computing <em>intensity</em> or <em>density</em> surfaces to seeing them as a tool for creating <em>spatially local</em> weights for any statistical function. We will use the same study region (Fulton and Dekalb counties), but now will be looking at several socio-contextual <em>covariates</em> derived from the American Community Survey to be considered along with the infant mortality rate produced above.</p>
<p>This section focuses primarily on the <code>gwss()</code> function to accomplish the following tasks:</p>
<ul>
<li>Estimate a statistically-optimal <em>fixed bandwidth</em> and explore <em>adaptive bandwidths</em> for use with the <code>gwss()</code> function</li>
<li>Calculate local, spatially-weighted <em>mean</em>, <em>median</em>, <em>SD</em>, and <em>IQR</em> for four census-tract level continuous measures using kernel density functions</li>
<li>Using Monte Carlo simulation to produces significance contours on our estimates of local, spatially-weighted summary statistics</li>
<li>Calculate local, spatially-weighted <em>bivariate statistics</em> summarizing how the correlations (Pearson and Spearman) of pairs of variables varies through space</li>
</ul>
<p>At the completion of this lab you should be able to carry out univariate and bivariate descriptive statistical analysis of a spatial dataset with continuous measures.</p>
<div id="packages-and-data" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Packages and data</h3>
<p>The new package introduced here is <code>GWmodel</code>, but several other familiar packages will also be useful:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="disease-mapping-iii.html#cb145-1"></a><span class="kw">library</span>(tidyverse) <span class="co"># For data piping and manipulationlibrary(GWmodel)   # Has the function gwss() </span></span>
<span id="cb145-2"><a href="disease-mapping-iii.html#cb145-2"></a><span class="kw">library</span>(sf)        <span class="co"># For import of sf data</span></span>
<span id="cb145-3"><a href="disease-mapping-iii.html#cb145-3"></a><span class="kw">library</span>(sp)        <span class="co"># For conversion to sp, required for GWmodel</span></span>
<span id="cb145-4"><a href="disease-mapping-iii.html#cb145-4"></a><span class="kw">library</span>(tmap)      <span class="co"># For mapping</span></span></code></pre></div>
<p>The methods introduced in this section will work for either <em>spatial points</em> or <em>spatial polygons</em>. However for this example we will demonstrate their use specifically for <em>spatial polygons</em>, and more specifically polygons representing the census tracts in Fulton and Dekalb counties. This dataset has 345 census tract polygons (4 tracts were deleted due to missing values), and summarizes five summary measures of each tract:</p>
<table>
<colgroup>
<col width="33%" />
<col width="66%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>GEOID</code></td>
<td>Unique ID for each census tract unit</td>
</tr>
<tr class="even">
<td><code>pctNOHS</code></td>
<td>% of adults over 25 without a high school diploma or GED</td>
</tr>
<tr class="odd">
<td><code>pctPOV</code></td>
<td>% of the population living below the federal poverty line</td>
</tr>
<tr class="even">
<td><code>ICE_INCOME_all</code></td>
<td>Index of Concentration at the Extremes, which is an index of the concentration of poverty and affluence. It ranges from -1 (concentrated poverty) to +1 (concentrated affluence), with values near zero having equal income distribution</td>
</tr>
<tr class="odd">
<td><code>pctMOVE</code></td>
<td>% of households who moved in the past 12 months</td>
</tr>
<tr class="even">
<td><code>pctOWNDER_OCC</code></td>
<td>% of households occupied by owners (e.g. rather than renters)</td>
</tr>
</tbody>
</table>
<p>First, we read in the <code>gpkg</code> data as an <code>sf</code> object, and then convert it to <code>sp</code> for use with <code>GWmodel</code>. As with the <code>sparr</code> package, <code>GWmodel</code> is not yet fully <code>sf</code> compliant so we are forced to use <code>sp</code> data classes. This will likely change at some point in the future.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="disease-mapping-iii.html#cb146-1"></a><span class="co"># This is Dekalb/Fulton census tracts</span></span>
<span id="cb146-2"><a href="disease-mapping-iii.html#cb146-2"></a>atl &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;Fulton-Dekalb-covariates.gpkg&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb146-3"><a href="disease-mapping-iii.html#cb146-3"></a><span class="st">  </span><span class="kw">as</span>(<span class="st">&#39;Spatial&#39;</span>) <span class="co"># convert to sp class</span></span></code></pre></div>
<div id="mapping-the-observed-values" class="section level4" number="6.4.1.1">
<h4><span class="header-section-number">6.4.1.1</span> Mapping the observed values</h4>
<p>Before we begin, it is useful to better understand this new dataset. You can examine the variables using <code>summary()</code>. You can also map them to see their spatial distribution. <em>Recall that the <code>tmap</code> package works for both <code>sf</code> and <code>sp</code> data!</em> This means that we can map the object in the <em>‘usual manner’</em> even though we converted it to <code>sp</code>.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="disease-mapping-iii.html#cb147-1"></a><span class="co"># First map the 4 variables that are %</span></span>
<span id="cb147-2"><a href="disease-mapping-iii.html#cb147-2"></a><span class="kw">tm_shape</span>(atl) <span class="op">+</span><span class="st"> </span></span>
<span id="cb147-3"><a href="disease-mapping-iii.html#cb147-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;pctNOHS&#39;</span>, <span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>, <span class="st">&#39;pctOWNER_OCC&#39;</span>),</span>
<span id="cb147-4"><a href="disease-mapping-iii.html#cb147-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>) <span class="op">+</span></span>
<span id="cb147-5"><a href="disease-mapping-iii.html#cb147-5"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p>The <em>Index of Concentration at the Extremes (ICE)</em> ranges from -1 to +1. A value of <span class="math inline">\(-1\)</span> occurs where everyone in the tract is poor; a value of <span class="math inline">\(+1\)</span> occurs in tracts where everyone is affluent; a value of <span class="math inline">\(0\)</span> suggests that either there is a balance of affluence and poverty, or alternatively that everyone is ‘<em>middle income</em>’. Therefore it makes sense to map it separately because it will inevitably need a <em>divergent</em> color ramp.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="disease-mapping-iii.html#cb148-1"></a><span class="kw">tm_shape</span>(atl) <span class="op">+</span></span>
<span id="cb148-2"><a href="disease-mapping-iii.html#cb148-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;ICE_INCOME_all&#39;</span>,</span>
<span id="cb148-3"><a href="disease-mapping-iii.html#cb148-3"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb148-4"><a href="disease-mapping-iii.html#cb148-4"></a>          <span class="dt">palette =</span> <span class="st">&#39;div&#39;</span>) <span class="op">+</span></span>
<span id="cb148-5"><a href="disease-mapping-iii.html#cb148-5"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
</div>
<div id="why-are-we-using-kde-on-these-data" class="section level4" number="6.4.1.2">
<h4><span class="header-section-number">6.4.1.2</span> Why are we using KDE on these data?</h4>
<p>There could be at least two general reasons you might think to use a spatial smoothing approach such as KDE for continuous data such as these:</p>
<ol style="list-style-type: decimal">
<li>You believe the estimates at each for each spatial unit (polygons in this case, but could be points) are statistically unstable, and you believe that averaging them with their neighbors will produce a more reliable estimate of the parameter of interest; or</li>
<li>You are interested in identifying spatial patterns or trends that are possibly <em>larger scale</em> than the data units themselves. For instance you might be looking for regions of the city where there is apparent clustering of poverty, home ownership, or residential instability. In other words you suspect that people are not only exposed to values within the boundaries of their tracts, but also to nearby environments.</li>
</ol>
</div>
</div>
<div id="what-bandwidth-for-kernel-density-estimates" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> What bandwidth for kernel density estimates?</h3>
<p>Recall that the decision about the <em>bandwidth</em> of the kernel density function is one of the most influential to in using KDE for spatial epidemiology. The reason is because the <em>bandwidth</em> defines the <em>smoothness</em> or <em>bumpiness</em> of the statistical estimation, and different choices can produce dramatically different results.</p>
<p>Once again, we might have theoretically important criteria for selecting a bandwidth, or we could use a statistical optimization approach. In <code>GWmodel</code> the function <code>bw.gwss.average()</code> is used for estimating the <em>‘optimal’</em> bandwidth for estimating the spatially varying <em>mean</em> or <em>median</em> using cross-validation. There is no specific function for other statistics (e.g. the <em>SD</em>, <em>IQR</em>, or <em>correlation coefficients</em>). Because the spatial structure might be different for each variable, we can evaluate all variables:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="disease-mapping-iii.html#cb149-1"></a><span class="co"># Fixed bandwidth selection</span></span>
<span id="cb149-2"><a href="disease-mapping-iii.html#cb149-2"></a><span class="kw">bw.gwss.average</span>(atl, <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>, </span>
<span id="cb149-3"><a href="disease-mapping-iii.html#cb149-3"></a>                              <span class="st">&#39;pctOWNER_OCC&#39;</span>, <span class="st">&#39;ICE_INCOME_all&#39;</span>))</span></code></pre></div>
<pre><code>##                   pctPOV   pctPOV  pctMOVE pctOWNER_OCC ICE_INCOME_all
## Local Mean bw   58801.33 58801.33 58801.33     65740.07       65740.07
## Local Median bw 65740.07 65740.07 58801.33     70028.45       65353.39</code></pre>
<p>These numbers are in the units of the map, which are meters. This suggests that the we need a pretty large fixed bandwidth (between 58 and 70 km!), at least to minimize the error as determined from the cross-validation approach.</p>
<p>We could also estimate the optimal <em>adaptive bandwidth</em> approach. <strong>NOTE:</strong> adaptive bandwidth in <code>GWmodel</code> works a little differently from how it did in the <code>sparr</code> package. When we choose <code>adaptive = TRUE</code> what is returned is not a distance in the units of the map (e.g. meters) but instead is <em>a number of nearest neighbors</em> that defines how large or small the kernel function <em>adapts</em>. This is important conceptually for what <em>adaptation</em> means: in <code>GWmodel</code> the unit of analysis is the census tract, not the individual person. So a census tract with 10 people and a census tract with 10,000 are assumed to have the same amount of information.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="disease-mapping-iii.html#cb151-1"></a><span class="co"># Adapative bandwidth selection</span></span>
<span id="cb151-2"><a href="disease-mapping-iii.html#cb151-2"></a><span class="kw">bw.gwss.average</span>(atl, <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctNOHS&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>, </span>
<span id="cb151-3"><a href="disease-mapping-iii.html#cb151-3"></a>                              <span class="st">&#39;pctOWNER_OCC&#39;</span>, <span class="st">&#39;ICE_INCOME_all&#39;</span>),</span>
<span id="cb151-4"><a href="disease-mapping-iii.html#cb151-4"></a>                <span class="dt">adaptive =</span> T)</span></code></pre></div>
<pre><code>##                 pctPOV pctNOHS pctMOVE pctOWNER_OCC ICE_INCOME_all
## Local Mean bw      315     268     297          337            333
## Local Median bw    297     297     315          326            315</code></pre>
<p>Again, we see the same story that the CV approach suggests a very large bandwidth. There are only 345 areal units in this dataset, and this suggests that <em>nearly all of them</em> should be included in the kernel. That would produce very little spatial variation. While the idea of a statistical optimization approach is appealing, as we discussed above, the CV methods is known to be imperfect.</p>
<p>For now we will use a more common-sense approach. It would seem that we might balance local information and spatial variation by including no more than 10% of the data in any single kernel density estimation location. So we could choose to use <span class="math inline">\(n=35\)</span> neighbors as the definition of our <em>adaptive bandwidth</em>. Note that you could alter this number to see how the results vary.</p>
</div>
<div id="geographically-weighted-summary-statistics-gwss" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Geographically weighted summary statistics: <code>gwss()</code></h3>
<p>To more fully describe and explore our <em>‘raw’</em> data, we want to summarize it by smoothing out extremes, and looking for broad spatial trends in the values. Finding a <em>local average value</em> can be done using either a <em>mean</em> or <em>median</em> to quantify <em>central tendency</em>. Obviously, if the distribution of the data within local regions is relatively normally distributed (or at least symmetric), the <em>mean</em> and <em>median</em> will be similar. But if the data are quite skewed, we might prefer the <em>median</em> as a summary measures.</p>
<p>Similarly, knowing whether (or how much) local measures are <em>alike</em> or <em>different</em> is informative. Once again we could choose a statistic that works well to describe variation for normally-distributed (or symmetric) data (e.g. the <em>standard deviation</em>), or one that performs well with non-normal or skewed data (e.g. the <em>inter-quartile range</em>). Finding <em>large values</em> of either the <em>SD</em> or <em>IQR</em> would suggest substantial <em>local heterogeneity</em> or difference in the target measure, whereas small values would suggest that local areas are relatively similar.</p>
<p>The <code>gwss()</code> function actually estimates more than just those listed above, but for now we will only focus on those measures.</p>
<p>To calculate the <em>geographically-weighted summary statistics</em> using <code>gwss()</code> we need to provide a dataset, a single variable (or vector of multiple variables), a decision about using <em>fixed</em> or <em>adaptive</em> bandwidth, and finally a specification of <code>bw</code> or bandwidth itself. And once again, the value you enter for <code>bw</code> depends on whether you select <code>adaptive = T</code> or not.</p>
<p>If <em>fixed</em> bandwidth, the value you enter is a number in the units of the map (e.g. <em>meters</em> in our case). But if you are requesting an <em>adaptive</em> bandwidth, the value for <code>bw</code> is not in <em>meters</em>, but is actually a number or <em>count</em> of how many nearest neighbors should minimally be included in the kernel density estimation at each location. As discussed above, I will use <span class="math inline">\(n=35\)</span> as an adaptive definition of neighbors. This will result in each summary estimation including approximately 10% of the total data. Because we would like what are called <em>robust</em> statistics (e.g. the <em>median</em> and <em>IQR</em> which are robust to skewed or non-normal data), we also must specify the argument <code>quantile = T</code>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="disease-mapping-iii.html#cb153-1"></a>atl.ss &lt;-<span class="st"> </span><span class="kw">gwss</span>(atl, <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctNOHS&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>, <span class="st">&#39;pctOWNER_OCC&#39;</span>,</span>
<span id="cb153-2"><a href="disease-mapping-iii.html#cb153-2"></a>                             <span class="st">&#39;ICE_INCOME_all&#39;</span>),</span>
<span id="cb153-3"><a href="disease-mapping-iii.html#cb153-3"></a>               <span class="dt">adaptive =</span> T,</span>
<span id="cb153-4"><a href="disease-mapping-iii.html#cb153-4"></a>               <span class="dt">bw =</span> <span class="dv">35</span>,</span>
<span id="cb153-5"><a href="disease-mapping-iii.html#cb153-5"></a>               <span class="dt">quantile =</span> T)</span></code></pre></div>
<p>Perhaps unintuitively, the way to get a summary of the result is not the usual <code>summary()</code>, but instead to type <code>print(atl.ss)</code>. When you do so you will see A LOT of results. We will focus for the moment on just the results at the very top (local mean; local SD) and at the very bottom (local median; local IQR) of the output.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="disease-mapping-iii.html#cb154-1"></a><span class="kw">print</span>(atl.ss)</span></code></pre></div>
<pre><code>##    ***********************************************************************
##    *                       Package   GWmodel                             *
##    ***********************************************************************
## 
##    ***********************Calibration information*************************
## 
##    Local summary statistics calculated for variables:
##     pctPOV pctNOHS pctMOVE pctOWNER_OCC ICE_INCOME_all
##    Number of summary points: 345
##    Kernel function: bisquare 
##    Summary points: the same locations as observations are used.
##    Adaptive bandwidth: 35 (number of nearest neighbours)
##    Distance metric: Euclidean distance metric is used.
## 
##    ************************Local Summary Statistics:**********************
##    Summary information for Local means:
##                           Min.   1st Qu.    Median   3rd Qu.   Max.
##    pctPOV_LM          0.050645  0.119765  0.180836  0.270868 0.3947
##    pctNOHS_LM         0.011338  0.031796  0.051985  0.079042 0.1369
##    pctMOVE_LM         0.129222  0.166627  0.185688  0.215939 0.3356
##    pctOWNER_OCC_LM    0.214225  0.421030  0.486894  0.568339 0.7545
##    ICE_INCOME_all_LM -0.363659 -0.161687 -0.010174  0.180475 0.3921
##    Summary information for local standard deviation :
##                           Min.  1st Qu.   Median  3rd Qu.   Max.
##    pctPOV_LSD         0.030466 0.080964 0.095033 0.122989 0.2000
##    pctNOHS_LSD        0.013018 0.027740 0.038529 0.055891 0.1512
##    pctMOVE_LSD        0.043404 0.062143 0.070973 0.085519 0.1594
##    pctOWNER_OCC_LSD   0.128460 0.171147 0.193042 0.236043 0.3127
##    ICE_INCOME_all_LSD 0.098726 0.153791 0.186239 0.214184 0.2949
##    Summary information for local variance :
##                              Min.    1st Qu.     Median    3rd Qu.   Max.
##    pctPOV_LVar         0.00092817 0.00655511 0.00903123 0.01512619 0.0400
##    pctNOHS_LVar        0.00016947 0.00076952 0.00148449 0.00312385 0.0229
##    pctMOVE_LVar        0.00188388 0.00386175 0.00503717 0.00731354 0.0254
##    pctOWNER_OCC_LVar   0.01650192 0.02929137 0.03726506 0.05571613 0.0978
##    ICE_INCOME_all_LVar 0.00974689 0.02365154 0.03468479 0.04587486 0.0870
##    Summary information for Local skewness:
##                            Min.  1st Qu.   Median  3rd Qu.   Max.
##    pctPOV_LSKe         -0.60296  0.40145  0.88760  1.50706 4.5718
##    pctNOHS_LSKe        -0.26353  0.80588  1.38779  2.41449 7.7612
##    pctMOVE_LSKe        -0.43164  0.27893  0.58307  0.97433 2.6409
##    pctOWNER_OCC_LSKe   -1.21089 -0.41080 -0.10531  0.17408 1.1014
##    ICE_INCOME_all_LSKe -1.03050 -0.18046  0.17660  0.55386 1.8477
##    Summary information for localized coefficient of variation:
##                             Min.    1st Qu.     Median    3rd Qu.    Max.
##    pctPOV_LCV            0.21281    0.41550    0.57740    0.73493  1.1784
##    pctNOHS_LCV           0.31989    0.49239    0.85060    1.30476  2.2432
##    pctMOVE_LCV           0.23460    0.35345    0.38736    0.42998  0.6638
##    pctOWNER_OCC_LCV      0.20111    0.35046    0.42753    0.51556  0.7493
##    ICE_INCOME_all_LCV -127.78594   -1.02921   -0.35211    1.03900 94.7817
##    Summary information for localized Covariance and Correlation between these variables:
##                                                    Min.     1st Qu.      Median
##    Cov_pctPOV.pctNOHS                       -2.2931e-03  9.0124e-04  1.8075e-03
##    Cov_pctPOV.pctMOVE                       -2.9894e-03  9.0789e-04  2.2298e-03
##    Cov_pctPOV.pctOWNER_OCC                  -3.9120e-02 -2.0229e-02 -1.4517e-02
##    Cov_pctPOV.ICE_INCOME_all                -5.4587e-02 -2.1778e-02 -1.4607e-02
##    Cov_pctNOHS.pctMOVE                      -6.0672e-03  3.6009e-05  3.3180e-04
##    Cov_pctNOHS.pctOWNER_OCC                 -2.8576e-02 -5.1983e-03 -2.4969e-03
##    Cov_pctNOHS.ICE_INCOME_all               -2.7722e-02 -5.4109e-03 -2.7900e-03
##    Cov_pctMOVE.pctOWNER_OCC                 -2.6759e-02 -1.2237e-02 -8.3927e-03
##    Cov_pctMOVE.ICE_INCOME_all               -1.7867e-02 -8.4677e-03 -5.4038e-03
##    Cov_pctOWNER_OCC.ICE_INCOME_all           7.1964e-03  2.0528e-02  3.1021e-02
##    Corr_pctPOV.pctNOHS                      -3.1700e-01  3.3020e-01  5.2838e-01
##    Corr_pctPOV.pctMOVE                      -3.3127e-01  1.5775e-01  3.3672e-01
##    Corr_pctPOV.pctOWNER_OCC                 -9.2603e-01 -7.6823e-01 -7.0198e-01
##    Corr_pctPOV.ICE_INCOME_all               -9.2121e-01 -8.5519e-01 -8.0585e-01
##    Corr_pctNOHS.pctMOVE                     -5.5520e-01  9.4979e-03  1.3477e-01
##    Corr_pctNOHS.pctOWNER_OCC                -7.4225e-01 -4.9593e-01 -3.8022e-01
##    Corr_pctNOHS.ICE_INCOME_all              -7.9348e-01 -5.4559e-01 -4.4696e-01
##    Corr_pctMOVE.pctOWNER_OCC                -8.9115e-01 -7.4688e-01 -6.1343e-01
##    Corr_pctMOVE.ICE_INCOME_all              -8.1724e-01 -5.9481e-01 -4.5800e-01
##    Corr_pctOWNER_OCC.ICE_INCOME_all          4.7611e-01  7.3645e-01  8.1386e-01
##    Spearman_rho_pctPOV.pctNOHS              -3.1371e-01  3.9993e-01  5.5699e-01
##    Spearman_rho_pctPOV.pctMOVE              -3.3896e-01  2.1551e-01  3.7424e-01
##    Spearman_rho_pctPOV.pctOWNER_OCC         -9.3274e-01 -7.7236e-01 -6.9983e-01
##    Spearman_rho_pctPOV.ICE_INCOME_all       -9.4569e-01 -8.7641e-01 -8.3931e-01
##    Spearman_rho_pctNOHS.pctMOVE             -4.0721e-01  5.7272e-02  1.7412e-01
##    Spearman_rho_pctNOHS.pctOWNER_OCC        -8.2880e-01 -5.5182e-01 -4.2840e-01
##    Spearman_rho_pctNOHS.ICE_INCOME_all      -8.4054e-01 -6.4764e-01 -5.2497e-01
##    Spearman_rho_pctMOVE.pctOWNER_OCC        -8.8511e-01 -7.3142e-01 -6.1950e-01
##    Spearman_rho_pctMOVE.ICE_INCOME_all      -8.3299e-01 -5.6000e-01 -4.2841e-01
##    Spearman_rho_pctOWNER_OCC.ICE_INCOME_all  4.5487e-01  7.1234e-01  7.9728e-01
##                                                 3rd Qu.    Max.
##    Cov_pctPOV.pctNOHS                        3.3044e-03  0.0180
##    Cov_pctPOV.pctMOVE                        4.4672e-03  0.0099
##    Cov_pctPOV.pctOWNER_OCC                  -9.5637e-03 -0.0016
##    Cov_pctPOV.ICE_INCOME_all                -9.5779e-03 -0.0023
##    Cov_pctNOHS.pctMOVE                       7.4840e-04  0.0038
##    Cov_pctNOHS.pctOWNER_OCC                 -1.2187e-03  0.0065
##    Cov_pctNOHS.ICE_INCOME_all               -1.5736e-03  0.0039
##    Cov_pctMOVE.pctOWNER_OCC                 -5.5655e-03  0.0056
##    Cov_pctMOVE.ICE_INCOME_all               -2.2195e-03  0.0149
##    Cov_pctOWNER_OCC.ICE_INCOME_all           4.4465e-02  0.0689
##    Corr_pctPOV.pctNOHS                       7.0916e-01  0.9313
##    Corr_pctPOV.pctMOVE                       5.1942e-01  0.7694
##    Corr_pctPOV.pctOWNER_OCC                 -6.0482e-01 -0.3121
##    Corr_pctPOV.ICE_INCOME_all               -7.3805e-01 -0.2913
##    Corr_pctNOHS.pctMOVE                      3.0081e-01  0.6833
##    Corr_pctNOHS.pctOWNER_OCC                -2.2829e-01  0.4213
##    Corr_pctNOHS.ICE_INCOME_all              -3.2308e-01  0.3913
##    Corr_pctMOVE.pctOWNER_OCC                -4.3310e-01  0.2776
##    Corr_pctMOVE.ICE_INCOME_all              -1.8902e-01  0.5593
##    Corr_pctOWNER_OCC.ICE_INCOME_all          8.6813e-01  0.9618
##    Spearman_rho_pctPOV.pctNOHS               7.0454e-01  0.9311
##    Spearman_rho_pctPOV.pctMOVE               5.2948e-01  0.7608
##    Spearman_rho_pctPOV.pctOWNER_OCC         -6.2123e-01 -0.3108
##    Spearman_rho_pctPOV.ICE_INCOME_all       -7.7469e-01 -0.3117
##    Spearman_rho_pctNOHS.pctMOVE              3.0311e-01  0.5853
##    Spearman_rho_pctNOHS.pctOWNER_OCC        -2.4547e-01  0.2446
##    Spearman_rho_pctNOHS.ICE_INCOME_all      -3.8136e-01  0.1699
##    Spearman_rho_pctMOVE.pctOWNER_OCC        -4.5014e-01  0.3082
##    Spearman_rho_pctMOVE.ICE_INCOME_all      -1.7360e-01  0.4005
##    Spearman_rho_pctOWNER_OCC.ICE_INCOME_all  8.5241e-01  0.9477
##    Summary information for Local median:
##                               Min.   1st Qu.    Median   3rd Qu.   Max.
##    pctPOV_Median          0.042468  0.090310  0.161004  0.251916 0.3919
##    pctNOHS_Median         0.003663  0.014632  0.042506  0.068828 0.1053
##    pctMOVE_Median         0.095830  0.158633  0.186185  0.201781 0.3108
##    pctOWNER_OCC_Median    0.191905  0.391960  0.490220  0.602281 0.8389
##    ICE_INCOME_all_Median -0.384111 -0.195011 -0.023930  0.170068 0.3830
##    Summary information for Interquartile range:
##                            Min.   1st Qu.    Median   3rd Qu.   Max.
##    pctPOV_IQR         0.0272517 0.0846864 0.1150697 0.1709975 0.3370
##    pctNOHS_IQR        0.0071992 0.0233457 0.0362078 0.0567798 0.1961
##    pctMOVE_IQR        0.0492332 0.0777156 0.0943680 0.1143242 0.2195
##    pctOWNER_OCC_IQR   0.0695205 0.2406716 0.2930468 0.3634722 0.6663
##    ICE_INCOME_all_IQR 0.0741381 0.1853240 0.2307883 0.2932845 0.5597
##    Summary information for Quantile imbalance:
##                            Min.    1st Qu.     Median    3rd Qu.   Max.
##    pctPOV_QI         -0.8423900 -0.3575769 -0.1613870  0.0836692 0.7498
##    pctNOHS_QI        -0.9376945 -0.5163889 -0.2601448  0.0084147 0.4966
##    pctMOVE_QI        -0.7152669 -0.2848576 -0.0713806  0.1454639 0.7001
##    pctOWNER_OCC_QI   -0.7647186 -0.1424103  0.0614975  0.2285407 0.7302
##    ICE_INCOME_all_QI -0.8670434 -0.2368184 -0.0310687  0.1636269 0.8803
## 
##    ************************************************************************</code></pre>
<p>What the summary gives you is information for the range of <em>smoothed</em> values for each statistic, and for each variable. Spend some time looking at these to think about what they mean. Notice, for example the <em>names</em> of the variables. All of the estimates of the <em>geographically weighted mean</em> end with <code>_LM</code> which stands for <em>local mean</em>. Similarly the estimates of <em>geographically weighted standard deviation</em> end with <code>_LSD</code> for <em>local SD</em>.</p>
<div id="mapping-gwss-results" class="section level4" number="6.4.3.1">
<h4><span class="header-section-number">6.4.3.1</span> Mapping <code>gwss</code> results</h4>
<p>How do we <strong>see</strong> the results? Try looking at our result:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="disease-mapping-iii.html#cb156-1"></a><span class="kw">names</span>(atl.ss)</span></code></pre></div>
<pre><code>##  [1] &quot;SDF&quot;      &quot;vars&quot;     &quot;kernel&quot;   &quot;adaptive&quot; &quot;bw&quot;       &quot;p&quot;       
##  [7] &quot;theta&quot;    &quot;longlat&quot;  &quot;DM.given&quot; &quot;sp.given&quot; &quot;quantile&quot;</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="disease-mapping-iii.html#cb158-1"></a><span class="kw">summary</span>(atl.ss)</span></code></pre></div>
<pre><code>##          Length Class                    Mode     
## SDF      345    SpatialPolygonsDataFrame S4       
## vars       5    -none-                   character
## kernel     1    -none-                   character
## adaptive   1    -none-                   logical  
## bw         1    -none-                   numeric  
## p          1    -none-                   numeric  
## theta      1    -none-                   numeric  
## longlat    1    -none-                   logical  
## DM.given   1    -none-                   logical  
## sp.given   1    -none-                   logical  
## quantile   1    -none-                   logical</code></pre>
<p>There are many <em>sub-objects</em> within the main result object. But the first one, always called <code>SDF</code> has class <code>SpatialPolygonsDataFrame</code>. The is basically the <code>sp</code> version of a polygon spatial file. If you examine it more closely (e.g. try <code>summary(atl.ss$SDF))</code> to see what happens) you will see that it has the information we need to make maps (e.g. it is a spatial object with attribute data).</p>
<p>First, let’s map <em>geographically-weighted median</em> value for each of the statistics:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="disease-mapping-iii.html#cb160-1"></a><span class="co"># Map geographically-weighted Median</span></span>
<span id="cb160-2"><a href="disease-mapping-iii.html#cb160-2"></a><span class="kw">tm_shape</span>(atl.ss<span class="op">$</span>SDF) <span class="op">+</span><span class="st"> </span></span>
<span id="cb160-3"><a href="disease-mapping-iii.html#cb160-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;pctPOV_Median&#39;</span>, <span class="st">&#39;pctNOHS_Median&#39;</span>, <span class="st">&#39;pctMOVE_Median&#39;</span>, <span class="st">&#39;pctOWNER_OCC_Median&#39;</span>),</span>
<span id="cb160-4"><a href="disease-mapping-iii.html#cb160-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>) <span class="op">+</span></span>
<span id="cb160-5"><a href="disease-mapping-iii.html#cb160-5"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>And we can also examine the local variation or diversity in values by mapping the <em>geographically-weighted IQR</em></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="disease-mapping-iii.html#cb161-1"></a><span class="co"># Map geographically-weighted IQR</span></span>
<span id="cb161-2"><a href="disease-mapping-iii.html#cb161-2"></a><span class="kw">tm_shape</span>(atl.ss<span class="op">$</span>SDF) <span class="op">+</span><span class="st"> </span></span>
<span id="cb161-3"><a href="disease-mapping-iii.html#cb161-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;pctPOV_IQR&#39;</span>, <span class="st">&#39;pctNOHS_IQR&#39;</span>, <span class="st">&#39;pctMOVE_IQR&#39;</span>, <span class="st">&#39;pctOWNER_OCC_IQR&#39;</span>),</span>
<span id="cb161-4"><a href="disease-mapping-iii.html#cb161-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>) <span class="op">+</span></span>
<span id="cb161-5"><a href="disease-mapping-iii.html#cb161-5"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<p>Remember, places with <em>higher IQR</em> have <em>larger local differences</em> in the values. Are the places of high variability similar to, or different from, the places with high median values?</p>
<p>You can now repeat the above code for the <code>ICE_INCOME_all</code> variable, and also repeat all variables looking at the <em>mean</em> and <em>SD</em> rather than the <em>median</em> and <em>IQR</em>. Is there evidence that the <em>local mean</em> and <em>local median</em> are different?</p>
</div>
</div>
<div id="calculating-pseudo-p-values-for-smoothed-estimates" class="section level3" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Calculating pseudo p-values for smoothed estimates</h3>
<p>The motivation for much of disease mapping is the detection of <em>spatial heterogeneity</em> and <em>spatial dependence</em> in epidemiologic data. <em>Spatial heterogeneity</em> in a statistical parameter means that values are <em>truly different</em> in some locations compared to others. <em>Spatial dependence</em> in a random variable means that the values in one location tend to be more correlated with values in nearby locations than with values in distant locations.</p>
<p>A related idea is that of <em>spatial stationarity</em> which implies that the value for a summary of data (e.g. the <em>spatially-local mean</em>) is location independent. In other words if you divided your study region into 10 equal-sized sub-regions, the <em>mean</em> value would be approximately the same in each. In contrast, <em>spatial non-stationarity</em> means that the local summaries are location-dependent. For example the estimate of the <em>spatially local mean</em> could be different in one sub-region compared to another.</p>
<p>Note that <em>spatial non-stationarity</em> implies both <strong>heterogeneity</strong> in the parameter of interest (values are not the same everywhere) <strong>and spatial dependence</strong> of the observations (near values are more correlated than distant values). If there were only <em>heterogeneity</em>, but not <em>dependence</em> we would expect, on average, that local summaries of statistics would still be <em>stationary</em>.</p>
<p>We can restate some of the above definitions in the form of testable hypotheses to evaluate in our disease mapping analysis. First note that in this example we have multiple candidate <em>random variables</em> (e.g. <code>pctPOV</code>, <code>pctMOVE</code>, <code>ICE_INCOME_all</code>, …), as well as multiple candidate statistical parameters (e.g. the <em>mean</em>, <em>median</em>, <em>SD</em>, <em>IQR</em>, …). To hone in on the questions at hand, let us assume we are interested in describing the <em>mean</em> value of the random variable <code>pctPOV</code>. The use of kernel density functions applied to spatial data are particularly well suited for testing of <em>spatial stationarity</em> versus <em>spatial non-stationarity</em> of statistic parameters.</p>
<p>As noted above, the question about <em>spatial stationarity</em> hinges largely on the presence of <em>spatial dependence</em> versus <em>spatial independence</em> of observed values. Therefore, under a <em>null hypothesis</em>, <span class="math inline">\(H_0:\)</span>, we might posit that the observed values of <code>pctPOV</code> are independent of one another, and therefore any <em>spatially local mean</em> estimate of <code>pctPOV</code> would be location independent (e.g. the summary in one location would, on average, be the same as the summary in another location). The <em>alternative hypothesis</em>, <span class="math inline">\(H_A:\)</span>, is that the values of <code>pctPOV</code> are <em>spatially dependent</em> and therefore any <em>spatially local mean</em> estimate of <code>pctPOV</code> could be location dependent (e.g. not equal to a single <em>global</em> value, nor to every other location-specif value).</p>
<p>How can we test this hypothesis? As we have seen previously, hypothesis testing with spatial data is made more challenging by the complex structure of the data, and difficulty making plausible assumptions under conventional statistical rules. One effective empirical solution to the complexity is to carry out <em>Monte Carlo permutation testing</em> of the null hypothesis. The idea with permutation testing, is that we can empirically simulate what we believe the data would look like under the <em>null distribution</em>. Then we can compare our <em>observed</em> data to the simulated <em>null distribution</em> to describe how unusual our observations were, given what would have been expected due to chance alone.</p>
<p>Permutation testing is particularly well-suited to questions about <em>spatial independence</em> versus <em>spatial dependence</em>, because it is not hard to conceive of what it means to have data values independent of one another. For example, imagine that our random variable, <code>pctPOV</code> has been measured on 345 units, as it has here. Under the <em>null hypothesis</em> of spatial independence, the geographic location of the measures is irrelevant. For example if we took the exact same vector of <span class="math inline">\(n=345\)</span> values of <code>pctPOV</code> and randomly changed their geographic location, it should not matter because we assume, under the null, that geographic location is irrelevant. If we were to randomly reassign the vector of <span class="math inline">\(n=345\)</span> values of <code>pctPOV</code> to different locations many, many times we would begin to see a <em>distribution of arrangements under the null hypothesis</em>, e.g. spatial independence.</p>

<div class="rmdnote">
<p><strong>What is permutation testing doing?</strong></p>
<ul>
<li>First, the measure of interest in this case is the geographically-weighted average of a variable, say pctPOV. So each region will have its own <em>spatially weighted average</em> calculated as the weighted average of it’s own neighbors (as defined by the kernel).</li>
<li>Under the null, we assume that the value of an individual region’s <code>pctPOV</code> is independent of the value of the value in its neighbors. Therefore, the permutations are an empirical way to approximate this null assumption by randomly re-assigning the known values to different geographic locations.</li>
<li>Each time we randomly reassign a set of locations, we repeat the process of creating the geographically weighted average of the variable, e.g. <code>pctPOV</code>. After doing this a lot of times, we have a distribution of what the geographically weighted <code>pctPOV</code> for each individual region would look like if the null (spatial independence) were true.</li>
<li>We can then compare our <em>single observed realization</em> of the geographically-weighted <code>pctPov</code> in each region to the long list of hypothetical values (under the null) to see how typical or unusual our observed data are. Essentially the pseudo p-value is just the rank-ordered percentile of the observed data in relation to the range of values under the null.</li>
<li>The number of random permutations guides the precision of our eventual pseudo-p-value. Our p-value could theoretically be smaller if we have more null permutations. For instance if we compare <span class="math inline">\(n=1\)</span> observed realization of the data with <span class="math inline">\(n=99\)</span> null permutations the very most extreme statement we could make is that our data is more extreme at <span class="math inline">\(p = \frace{1}{100} = 0.01\)</span> level. In contrast if we had <span class="math inline">\(n=1\)</span> observed realizations and <span class="math inline">\(n=999\)</span> random permutations under the null the most extreme our data could be is <span class="math inline">\(p = \frac{1}{1000} = 0.001\)</span>.
</div></li>
</ul>
<p>This is what the function <code>gwss.montecarlo()</code> does. In the specific context of the <em>geographically weighted summary statistics</em>, the function follows a 3-step process:</p>
<ol style="list-style-type: decimal">
<li>First it will randomly reassign the location of variables of interest <span class="math inline">\(n\)</span> times (where <span class="math inline">\(n\)</span> specified by user, but typically reasonably large)</li>
<li>Second, for each random permutation of the random variable (e.g. <code>pctPOV</code>), the summary statistic (e.g. the <em>spatially-weighted local mean</em> of <code>pctPOV</code>) is calculated.<br />
</li>
<li>Finally, the <em>observed</em> results (e.g. the <em>spatially-weighted mean</em> of <code>pctPOV</code> calculated using our original <code>gwss()</code>) is compared to the <em>null distribution</em>. If we calculated <span class="math inline">\(n=999\)</span> random permutations, then we would have <span class="math inline">\(n=1000\)</span> versions of the summarized statistic, including the observed. The <em>pseudo p-value</em> is calculated as the number of times for each spatial unit that the <em>observed</em> value is <em>more extreme</em> than what would be expected under the null. For example if we defined <em>extreme</em> as being something that happens fewer than 5% of the time by random chance alone, then we might classify our observed value as <em>extreme</em> (and thus <em>significant</em>) if our observed value was either less than the lower 2.5% of the null values, or greater than the upper 97.5% of the null values.</li>
</ol>
<p>It might sound like a lot of things are happening. Mechanically it is a relatively straightforward procedure, but it can be time consuming, particularly when you have a lot of permutations of the null. Here we carry out the Monte Carlo permutation test for geographically-weighted statistics on a single variable, <code>pctPOV</code>. Most of the arguments are familiar, but we now must specify how many permutations or <em>simulations</em> we wish by using the arguments <code>nsim =</code>. On my computer, it took less than 1 minute to run with <span class="math inline">\(n=499\)</span> permutations. Note that because we request <span class="math inline">\(n=499\)</span> simulations, when combined with our <em>observed</em> data, there will be <span class="math inline">\(n=500\)</span> total values of the <em>spatially-weighted mean</em> value of <code>pctPOV</code> to compare.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="disease-mapping-iii.html#cb162-1"></a>p.val &lt;-<span class="st"> </span><span class="kw">gwss.montecarlo</span>(atl, <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>), </span>
<span id="cb162-2"><a href="disease-mapping-iii.html#cb162-2"></a>                         <span class="dt">adaptive =</span> T,</span>
<span id="cb162-3"><a href="disease-mapping-iii.html#cb162-3"></a>                         <span class="dt">bw =</span> <span class="dv">35</span>,</span>
<span id="cb162-4"><a href="disease-mapping-iii.html#cb162-4"></a>                         <span class="dt">nsim =</span> <span class="dv">499</span>)</span>
<span id="cb162-5"><a href="disease-mapping-iii.html#cb162-5"></a></span>
<span id="cb162-6"><a href="disease-mapping-iii.html#cb162-6"></a><span class="kw">summary</span>(p.val)</span></code></pre></div>
<pre><code>##    pctPOV_LM        pctMOVE_LM       pctPOV_LSD      pctMOVE_LSD    
##  Min.   :0.0000   Min.   :0.0040   Min.   :0.0000   Min.   :0.0040  
##  1st Qu.:0.2540   1st Qu.:0.2500   1st Qu.:0.2480   1st Qu.:0.2520  
##  Median :0.4960   Median :0.5000   Median :0.5000   Median :0.5100  
##  Mean   :0.5009   Mean   :0.5009   Mean   :0.5003   Mean   :0.5017  
##  3rd Qu.:0.7420   3rd Qu.:0.7360   3rd Qu.:0.7520   3rd Qu.:0.7480  
##  Max.   :0.9980   Max.   :0.9980   Max.   :0.9980   Max.   :0.9980  
##   pctPOV_LVar      pctMOVE_LVar     pctPOV_LSKe      pctMOVE_LSKe   
##  Min.   :0.0000   Min.   :0.0040   Min.   :0.0020   Min.   :0.0020  
##  1st Qu.:0.2480   1st Qu.:0.2520   1st Qu.:0.2520   1st Qu.:0.2540  
##  Median :0.5000   Median :0.5100   Median :0.4980   Median :0.5000  
##  Mean   :0.5003   Mean   :0.5017   Mean   :0.4999   Mean   :0.5006  
##  3rd Qu.:0.7520   3rd Qu.:0.7480   3rd Qu.:0.7520   3rd Qu.:0.7500  
##  Max.   :0.9980   Max.   :0.9980   Max.   :0.9980   Max.   :0.9980  
##    pctPOV_LCV      pctMOVE_LCV     Cov_pctPOV.pctMOVE Corr_pctPOV.pctMOVE
##  Min.   :0.0000   Min.   :0.0020   Min.   :0.0020     Min.   :0.0020     
##  1st Qu.:0.2540   1st Qu.:0.2480   1st Qu.:0.2480     1st Qu.:0.2560     
##  Median :0.5000   Median :0.5040   Median :0.4980     Median :0.5040     
##  Mean   :0.4999   Mean   :0.5009   Mean   :0.5001     Mean   :0.5007     
##  3rd Qu.:0.7540   3rd Qu.:0.7320   3rd Qu.:0.7480     3rd Qu.:0.7560     
##  Max.   :0.9980   Max.   :0.9980   Max.   :0.9980     Max.   :0.9980     
##  Spearman_rho_pctPOV.pctMOVE
##  Min.   :0.0040             
##  1st Qu.:0.2560             
##  Median :0.4980             
##  Mean   :0.5005             
##  3rd Qu.:0.7540             
##  Max.   :0.9980</code></pre>
<p>You can now examine the result. First you might find that what is returned is of class <code>matrix</code>. You will notice that there are columns for all 5 of the primary summary statistics estimated by <code>gwss</code> (e.g. the <em>local mean</em>, <code>_LM</code>; the <em>local SD</em>, <code>_LSD</code>; the <em>local variance</em>, <code>_LVar</code>; the <em>local skewness</em>, <code>_LSKe</code>; and the <em>local coefficient of variation</em>, <code>_LCV</code>).</p>
<p>The numbers in each column are values that range from 0 to 1. These numbers are <em>percentiles</em> reflecting the <em>rank</em> location of the single <em>spatially weighted local mean</em> of <code>pctPOV</code> from the <em>observed</em> data as compared to the <span class="math inline">\(n=499\)</span> versions where spatial location was randomly assigned. To calculate a 2-side pseudo p-value at the conventional 0.05 threshold, we would be interested in which census tracts the <em>observed</em> data were either in the very lowest 2.5% or the very highest 2.5% of the null distribution. In other words we could ask which census tracts were observed to have a spatially-weighted local mean value that is <em>extreme</em> as compared to what would happen by chance alone.</p>
<p><strong>NOTE</strong> the percentile values come from a specific set of randomly distributed simulations. Repeating the procedure could produce <em>slightly</em> different values from what is printed above simply due to random variation. But based on the <em>Central Limit Theorem</em>, we believe that as the number of the simulations grows larger, the more consistent the results will be.</p>
<p>However the result returned is not easy to use just as it is. How could we convert it into something we could map? Below, we can test which census tracts were <em>extreme</em> under the above definition, and then make a new spatial object that includes only <em>significant</em> tracts.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="disease-mapping-iii.html#cb164-1"></a><span class="co"># First, create TRUE/FALSE vectors testing whether column 1 (pctPOV_LM) is extreme</span></span>
<span id="cb164-2"><a href="disease-mapping-iii.html#cb164-2"></a><span class="co"># I am using 2 significance levels: 90% and 95%</span></span>
<span id="cb164-3"><a href="disease-mapping-iii.html#cb164-3"></a>sig95 &lt;-<span class="st"> </span>p.val[, <span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.025</span> <span class="op">|</span><span class="st"> </span>p.val[, <span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.975</span></span>
<span id="cb164-4"><a href="disease-mapping-iii.html#cb164-4"></a>sig90 &lt;-<span class="st"> </span>p.val[, <span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">|</span><span class="st"> </span>p.val[, <span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.95</span></span>
<span id="cb164-5"><a href="disease-mapping-iii.html#cb164-5"></a></span>
<span id="cb164-6"><a href="disease-mapping-iii.html#cb164-6"></a><span class="co"># Second create a spatial object that ONLY contains significant tracts</span></span>
<span id="cb164-7"><a href="disease-mapping-iii.html#cb164-7"></a>atl.sig95 &lt;-<span class="st"> </span>atl[sig95, ] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb164-8"><a href="disease-mapping-iii.html#cb164-8"></a><span class="st">  </span><span class="kw">aggregate</span>(<span class="dt">dissolve =</span> T, <span class="dt">FUN =</span> mean) <span class="co"># this is sp code to merge adjacent tracts</span></span>
<span id="cb164-9"><a href="disease-mapping-iii.html#cb164-9"></a></span>
<span id="cb164-10"><a href="disease-mapping-iii.html#cb164-10"></a>atl.sig90 &lt;-<span class="st"> </span>atl[sig90, ] <span class="op">%&gt;%</span></span>
<span id="cb164-11"><a href="disease-mapping-iii.html#cb164-11"></a><span class="st">  </span><span class="kw">aggregate</span>(<span class="dt">disolve =</span> T, <span class="dt">FUN =</span> mean)</span></code></pre></div>
<p>Now we can use the results from above to create a map summarizing our evidence in relation to the <em>null hypothesis</em> that the <em>geographically-weighted mean</em> value of <code>pctPOV</code> is <em>stationary</em>, against the <em>alternative hypothesis</em> that at least some locations have significantly more extreme local values than expected under the null.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="disease-mapping-iii.html#cb165-1"></a><span class="kw">tm_shape</span>(atl.ss<span class="op">$</span>SDF) <span class="op">+</span><span class="st"> </span></span>
<span id="cb165-2"><a href="disease-mapping-iii.html#cb165-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;pctPOV_LM&#39;</span>, </span>
<span id="cb165-3"><a href="disease-mapping-iii.html#cb165-3"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb165-4"><a href="disease-mapping-iii.html#cb165-4"></a>          <span class="dt">title =</span> <span class="st">&#39;Local Average % Poverty&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb165-5"><a href="disease-mapping-iii.html#cb165-5"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb165-6"><a href="disease-mapping-iii.html#cb165-6"></a><span class="kw">tm_shape</span>(atl.sig90) <span class="op">+</span></span>
<span id="cb165-7"><a href="disease-mapping-iii.html#cb165-7"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb165-8"><a href="disease-mapping-iii.html#cb165-8"></a><span class="kw">tm_shape</span>(atl.sig95) <span class="op">+</span><span class="st"> </span></span>
<span id="cb165-9"><a href="disease-mapping-iii.html#cb165-9"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span><span class="st">&#39;red&#39;</span>) <span class="op">+</span></span>
<span id="cb165-10"><a href="disease-mapping-iii.html#cb165-10"></a><span class="kw">tm_add_legend</span>(<span class="dt">type =</span> <span class="st">&#39;line&#39;</span>,</span>
<span id="cb165-11"><a href="disease-mapping-iii.html#cb165-11"></a>              <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;p &lt; 0.05&#39;</span>, <span class="st">&#39;p &lt; 0.10&#39;</span>),</span>
<span id="cb165-12"><a href="disease-mapping-iii.html#cb165-12"></a>              <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-170-1.png" width="672" /></p>
<p>What we see is that the visual inspection of the <em>geographically-weighted mean</em> of <code>pctPOV</code> suggests that there is a great deal of <em>spatial heterogeneity</em> and apparent <em>spatial non-stationarity</em>. However, the permutation test suggests that only a few regions in far North Fulton and in West Atlanta have values that are more extreme than we might expect under an assumption of spatial independence.</p>
<blockquote>
<p>NOTE: It is important to remember the hypothesis we were testing! This is not a test of whether the poverty rate is zero, nor a test of whether the poverty rate is different in some specific census tracts compared to others. This is specifically a test of whether there is spatial dependence in the data that would give rise to unexpectedly extreme local measures under the assumptions of the KDE with specified neighbors.</p>
</blockquote>
</div>
<div id="estimating-geographically-weighted-bivariate-statistics" class="section level3" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> Estimating geographically-weighted bivariate statistics</h3>
<p>The final bits of information we will examine from the <em>geographically-weighted summary statistics</em> function <code>gwss()</code> are the bivariate correlations and covariances. Any time two or more variables are supplied to the <code>gwss()</code> function, it will automatically calculate the correlation coefficients (both Pearson and Spearman), as well as measures of covariance, for every pair of variables.</p>
<p>Up until now, we have seen how the KDE function can produce a smoothed estimate of the local <em>mean</em>, <em>median</em>, <em>SD</em>, etc. But it can also show whether any correlation between pairs of variables is <em>spatially stationary</em> (the same everywhere), or <em>spatially non-stationary</em> (varies by location).</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="disease-mapping-iii.html#cb166-1"></a><span class="kw">tm_shape</span>(atl.ss<span class="op">$</span>SDF) <span class="op">+</span></span>
<span id="cb166-2"><a href="disease-mapping-iii.html#cb166-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;Spearman_rho_pctPOV.pctNOHS&#39;</span>,</span>
<span id="cb166-3"><a href="disease-mapping-iii.html#cb166-3"></a>            <span class="st">&#39;Spearman_rho_pctPOV.pctMOVE&#39;</span>,</span>
<span id="cb166-4"><a href="disease-mapping-iii.html#cb166-4"></a>            <span class="st">&#39;Spearman_rho_pctPOV.ICE_INCOME_all&#39;</span>),</span>
<span id="cb166-5"><a href="disease-mapping-iii.html#cb166-5"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>) <span class="op">+</span></span>
<span id="cb166-6"><a href="disease-mapping-iii.html#cb166-6"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-171-1.png" width="672" /></p>
<p>Two things are illustrated by these maps. First, it appears that the magnitude of correlation among these pairs of variables is larger in some areas and smaller in others. The second, is that the spatial patterns of correlation between <code>pctPOV</code> and two other variables are distinct. In other words the areas where correlation is relatively stronger or weaker are not the same.</p>
<p>We might once again ask whether these differences are more extreme than we might expect under a null hypothesis of <em>spatial independence</em> and <em>spatial stationarity</em>.</p>
<p>Previously we only conducted the <em>Monte Carlo permutation test</em> on a single variable, <code>pctPOV</code>. But if we provide two or more variables to the <code>gwss.montecarlo()</code> function, we will get pseudo p-values for both univariate and bivariate statistics. <strong>NOTE</strong> this takes more time because there is more work for the computer to do. The code below took a little over 1-minute on my computer.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="disease-mapping-iii.html#cb167-1"></a>p.val &lt;-<span class="st"> </span><span class="kw">gwss.montecarlo</span>(atl, <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&#39;pctPOV&#39;</span>, <span class="st">&#39;pctMOVE&#39;</span>), </span>
<span id="cb167-2"><a href="disease-mapping-iii.html#cb167-2"></a>                         <span class="dt">adaptive =</span> T,</span>
<span id="cb167-3"><a href="disease-mapping-iii.html#cb167-3"></a>                         <span class="dt">bw =</span> <span class="dv">35</span>,</span>
<span id="cb167-4"><a href="disease-mapping-iii.html#cb167-4"></a>                         <span class="dt">nsim =</span> <span class="dv">499</span>)</span></code></pre></div>
<p>You can use <code>summary()</code> or <code>dimnames()</code> to figure out which column you want. We want to get the permutation p-value for <code>Spearman_rho_pctPOV.pctMOVE</code>, which is in the 13th column of the matrix.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="disease-mapping-iii.html#cb168-1"></a><span class="co"># First, create TRUE/FALSE vectors testing whether column 1 (pctPOV_LM) is extreme</span></span>
<span id="cb168-2"><a href="disease-mapping-iii.html#cb168-2"></a><span class="co"># I am using 2 significance levels: 90% and 95%</span></span>
<span id="cb168-3"><a href="disease-mapping-iii.html#cb168-3"></a>sig95 &lt;-<span class="st"> </span>p.val[, <span class="dv">13</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.025</span> <span class="op">|</span><span class="st"> </span>p.val[, <span class="dv">13</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.975</span></span>
<span id="cb168-4"><a href="disease-mapping-iii.html#cb168-4"></a>sig90 &lt;-<span class="st"> </span>p.val[, <span class="dv">13</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">|</span><span class="st"> </span>p.val[, <span class="dv">13</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.95</span></span>
<span id="cb168-5"><a href="disease-mapping-iii.html#cb168-5"></a></span>
<span id="cb168-6"><a href="disease-mapping-iii.html#cb168-6"></a><span class="co"># Second create a spatial object that ONLY contains significant tracts</span></span>
<span id="cb168-7"><a href="disease-mapping-iii.html#cb168-7"></a>atl.sig95 &lt;-<span class="st"> </span>atl[sig95, ] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-8"><a href="disease-mapping-iii.html#cb168-8"></a><span class="st">  </span><span class="kw">aggregate</span>(<span class="dt">dissolve =</span> T, <span class="dt">FUN =</span> mean) </span>
<span id="cb168-9"><a href="disease-mapping-iii.html#cb168-9"></a></span>
<span id="cb168-10"><a href="disease-mapping-iii.html#cb168-10"></a>atl.sig90 &lt;-<span class="st"> </span>atl[sig90, ] <span class="op">%&gt;%</span></span>
<span id="cb168-11"><a href="disease-mapping-iii.html#cb168-11"></a><span class="st">  </span><span class="kw">aggregate</span>(<span class="dt">disolve =</span> T, <span class="dt">FUN =</span> mean)</span></code></pre></div>
<p>Now we can map the correlation between <code>pctPOV</code> and <code>pctMOVE</code> along with the significance test.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="disease-mapping-iii.html#cb169-1"></a><span class="kw">tm_shape</span>(atl.ss<span class="op">$</span>SDF) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-2"><a href="disease-mapping-iii.html#cb169-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;Spearman_rho_pctPOV.pctMOVE&#39;</span>, </span>
<span id="cb169-3"><a href="disease-mapping-iii.html#cb169-3"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb169-4"><a href="disease-mapping-iii.html#cb169-4"></a>          <span class="dt">title =</span> <span class="st">&#39;Local correlation Poverty</span><span class="ch">\n</span><span class="st">&amp; Residential instability&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-5"><a href="disease-mapping-iii.html#cb169-5"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-6"><a href="disease-mapping-iii.html#cb169-6"></a><span class="kw">tm_shape</span>(atl.sig90) <span class="op">+</span></span>
<span id="cb169-7"><a href="disease-mapping-iii.html#cb169-7"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-8"><a href="disease-mapping-iii.html#cb169-8"></a><span class="kw">tm_shape</span>(atl.sig95) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-9"><a href="disease-mapping-iii.html#cb169-9"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span><span class="st">&#39;red&#39;</span>) <span class="op">+</span></span>
<span id="cb169-10"><a href="disease-mapping-iii.html#cb169-10"></a><span class="kw">tm_add_legend</span>(<span class="dt">type =</span> <span class="st">&#39;line&#39;</span>,</span>
<span id="cb169-11"><a href="disease-mapping-iii.html#cb169-11"></a>              <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;p &lt; 0.05&#39;</span>, <span class="st">&#39;p &lt; 0.10&#39;</span>),</span>
<span id="cb169-12"><a href="disease-mapping-iii.html#cb169-12"></a>              <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="disease-mapping-ii.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="disease-mapping-iv.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mkram01/EPI563-SpatialEPI/edit/master/06-disease-mapping-3.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"toc_depth": 2,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
