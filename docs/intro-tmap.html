<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 16 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2020</title>
  <meta name="description" content="Week 16 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 16 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="mkram01/EPI563-SpatialEPI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 16 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2020" />
  
  
  

<meta name="author" content="Michael Kramer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html"/>

<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>How to use this eBook</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#strategy-for-using-this-ebook"><i class="fa fa-check"></i>Strategy for using this eBook</a></li>
</ul></li>
<li class="part"><span><b>I Getting ready…</b></span></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a>
<ul>
<li><a href="software-installation.html#installing-r-on-your-computer">Installing <code>R</code> on your computer</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#installing-rstudio-on-your-computer"><i class="fa fa-check"></i>Installing RStudio on your computer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html"><i class="fa fa-check"></i>Installing packages for this course</a>
<ul>
<li><a href="installing-packages-for-this-course.html#installing-rtools40">Installing <code>Rtools40</code></a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-general-data-science"><i class="fa fa-check"></i>Installing packages used for general data science</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-use-for-geographic-data"><i class="fa fa-check"></i>Installing packages use for geographic data</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-data-manipulation-visualization"><i class="fa fa-check"></i>Installing packages used for spatial data manipulation &amp; visualization</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-analysis"><i class="fa fa-check"></i>Installing packages used for spatial analysis</a></li>
</ul></li>
<li class="part"><span><b>II Weekly Modules</b></span></li>
<li class="chapter" data-level="1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html"><i class="fa fa-check"></i><b>1</b> Locating Spatial Epidemiology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>1.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#learning-objectives"><i class="fa fa-check"></i><b>1.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i><b>1.1.2</b> Additional Resources</a></li>
<li class="chapter" data-level="1.1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#important-vocabulary"><i class="fa fa-check"></i><b>1.1.3</b> Important Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>1.2</b> Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>1.3</b> Spatial Analysis in Epidemiology</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-data-storage-foramts"><i class="fa fa-check"></i><b>1.3.1</b> Spatial data storage foramts</a></li>
<li class="chapter" data-level="1.3.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#representing-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.2</b> Representing spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#benefits-of-sf-data-classes"><i class="fa fa-check"></i><b>1.3.3</b> Benefits of <code>sf</code> data classes</a></li>
<li class="chapter" data-level="1.3.4" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.4</b> Working with spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#basic-visual-inspectionplots"><i class="fa fa-check"></i><b>1.3.5</b> Basic visual inspection/plots</a></li>
<li class="chapter" data-level="1.3.6" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-crs-and-projection"><i class="fa fa-check"></i><b>1.3.6</b> Working with CRS and projection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html"><i class="fa fa-check"></i><b>2</b> Cartography for Epidemiology I</a>
<ul>
<li class="chapter" data-level="2.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>2.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#learning-objectives-w2"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives, w2</a></li>
<li class="chapter" data-level="2.1.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#additional-resources-w2"><i class="fa fa-check"></i><b>2.1.2</b> Additional Resources, w2</a></li>
<li class="chapter" data-level="2.1.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#important-vocabulary-w2"><i class="fa fa-check"></i><b>2.1.3</b> Important Vocabulary, w2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-thinking-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.2</b> Spatial Thinking in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#color-choices"><i class="fa fa-check"></i><b>2.2.1</b> Color choices</a></li>
<li class="chapter" data-level="2.2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#choropleth-binning-styles"><i class="fa fa-check"></i><b>2.2.2</b> Choropleth binning styles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-analysis-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.3</b> Spatial Analysis in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-numerator-data"><i class="fa fa-check"></i><b>2.3.1</b> Obtaining and preparing numerator data</a></li>
<li class="chapter" data-level="2.3.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-denominator-or-contextual-data"><i class="fa fa-check"></i><b>2.3.2</b> Obtaining and preparing denominator or contextual data</a></li>
<li class="chapter" data-level="2.3.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-geographic-data"><i class="fa fa-check"></i><b>2.3.3</b> Obtaining and preparing geographic data</a></li>
<li class="chapter" data-level="2.3.4" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#merging-attributes-and-geography"><i class="fa fa-check"></i><b>2.3.4</b> Merging Attributes and Geography</a></li>
<li class="chapter" data-level="2.3.5" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#mapping-mortality-uninsured"><i class="fa fa-check"></i><b>2.3.5</b> Mapping Mortality &amp; Uninsured</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html"><i class="fa fa-check"></i><b>3</b> Cartography for Epidemiology II</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#learning-objectives-w3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives, w3</a></li>
<li class="chapter" data-level="3.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#additional-resources-w3"><i class="fa fa-check"></i><b>3.2</b> Additional resources, w3</a></li>
<li class="chapter" data-level="3.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#important-vocabulary-w3"><i class="fa fa-check"></i><b>3.3</b> Important Vocabulary, w3</a></li>
<li class="chapter" data-level="3.4" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#spatial-thinking-in-epidemiology-w3"><i class="fa fa-check"></i><b>3.4</b> Spatial Thinking in Epidemiology, w3</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risks-of-privacy-breaches-in-collection-of-geospatial-information"><i class="fa fa-check"></i><b>3.4.1</b> Risks of privacy breaches in collection of geospatial information</a></li>
<li class="chapter" data-level="3.4.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-confidentiality-breaches-through-unintentional-de-identification"><i class="fa fa-check"></i><b>3.4.2</b> Risk of confidentiality breaches through unintentional de-identification</a></li>
<li class="chapter" data-level="3.4.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-stigmatization-of-place"><i class="fa fa-check"></i><b>3.4.3</b> Risk of stigmatization of place</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html"><i class="fa fa-check"></i><b>4</b> Disease Mapping I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#getting-ready-w4"><i class="fa fa-check"></i><b>4.1</b> Getting ready, w4</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#learning-objectives-w4"><i class="fa fa-check"></i><b>4.1.1</b> Learning objectives, w4</a></li>
<li class="chapter" data-level="4.1.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#additional-resources-w4"><i class="fa fa-check"></i><b>4.1.2</b> Additional Resources, w4</a></li>
<li class="chapter" data-level="4.1.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#important-vocabulary-w4"><i class="fa fa-check"></i><b>4.1.3</b> Important Vocabulary, w4</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-thinking-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.2</b> Spatial Thinking in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#why-do-we-need-disease-mapping"><i class="fa fa-check"></i><b>4.2.1</b> Why do we need disease mapping?</a></li>
<li class="chapter" data-level="4.2.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#using-statistics-and-probability-models-to-improve-disease-mapping"><i class="fa fa-check"></i><b>4.2.2</b> Using statistics and probability models to improve disease mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-analysis-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.3</b> Spatial Analysis in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-is-there-spatial-heterogeneity"><i class="fa fa-check"></i><b>4.3.1</b> Disease mapping: Is there spatial heterogeneity?</a></li>
<li class="chapter" data-level="4.3.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-how-precise-are-county-estimates"><i class="fa fa-check"></i><b>4.3.2</b> Disease mapping: How precise are county estimates?</a></li>
<li class="chapter" data-level="4.3.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-adjusting-for-covariates"><i class="fa fa-check"></i><b>4.3.3</b> Disease mapping: Adjusting for covariates</a></li>
<li class="chapter" data-level="4.3.4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-rate-stabilization-with-global-empirical-bayes"><i class="fa fa-check"></i><b>4.3.4</b> Disease mapping: Rate stabilization with global Empirical Bayes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html"><i class="fa fa-check"></i><b>5</b> Disease Mapping II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#getting-ready-w5"><i class="fa fa-check"></i><b>5.1</b> Getting Ready, w5</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#w5-learning-objectives"><i class="fa fa-check"></i><b>5.1.1</b> w5 Learning objectives</a></li>
<li class="chapter" data-level="5.1.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#additional-resources-w5"><i class="fa fa-check"></i><b>5.1.2</b> Additional Resources, w5</a></li>
<li class="chapter" data-level="5.1.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#important-vocabulary-w5"><i class="fa fa-check"></i><b>5.1.3</b> Important Vocabulary, w5</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-thinking-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.2</b> Spatial Thinking in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#an-argument-for-the-relevance-of-space"><i class="fa fa-check"></i><b>5.2.1</b> An argument for the relevance of space</a></li>
<li class="chapter" data-level="5.2.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#on-making-meaning-from-neighbors"><i class="fa fa-check"></i><b>5.2.2</b> On making meaning from neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-analysis-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.3</b> Spatial Analysis in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-contiguity-neighbor-objects"><i class="fa fa-check"></i><b>5.3.1</b> Creating contiguity neighbor objects</a></li>
<li class="chapter" data-level="5.3.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-k-nearest-neighbors"><i class="fa fa-check"></i><b>5.3.2</b> Creating k-nearest neighbors</a></li>
<li class="chapter" data-level="5.3.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-graph-based-triangle-neighbor-objects"><i class="fa fa-check"></i><b>5.3.3</b> Creating Graph-based triangle neighbor objects</a></li>
<li class="chapter" data-level="5.3.4" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-fixed-distance-neighbors"><i class="fa fa-check"></i><b>5.3.4</b> Creating fixed-distance neighbors</a></li>
<li class="chapter" data-level="5.3.5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#from-spatial-neighbors-to-spatial-disease-mapping"><i class="fa fa-check"></i><b>5.3.5</b> From spatial neighbors to spatial Disease Mapping</a></li>
<li class="chapter" data-level="5.3.6" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-empirical-bayes"><i class="fa fa-check"></i><b>5.3.6</b> Spatial Empirical Bayes</a></li>
<li class="chapter" data-level="5.3.7" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#final-thoughts-making-choices"><i class="fa fa-check"></i><b>5.3.7</b> Final thoughts: Making choices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html"><i class="fa fa-check"></i><b>6</b> Disease Mapping III</a>
<ul>
<li class="chapter" data-level="6.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#getting-ready-w6"><i class="fa fa-check"></i><b>6.1</b> Getting Ready, w6</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#learning-objectives-w6"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives, w6</a></li>
<li class="chapter" data-level="6.1.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#additional-resources-w6"><i class="fa fa-check"></i><b>6.1.2</b> Additional Resources, w6</a></li>
<li class="chapter" data-level="6.1.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#important-vocabulary-w6"><i class="fa fa-check"></i><b>6.1.3</b> Important Vocabulary, w6</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-thinking-in-epidemiology-w6"><i class="fa fa-check"></i><b>6.2</b> Spatial Thinking in Epidemiology, w6</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#revisiting-spatial-point-processes"><i class="fa fa-check"></i><b>6.2.1</b> Revisiting spatial point processes</a></li>
<li class="chapter" data-level="6.2.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-is-a-kernel-density-estimator"><i class="fa fa-check"></i><b>6.2.2</b> What is a kernel density estimator?</a></li>
<li class="chapter" data-level="6.2.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#limitations-in-kernel-density-estimation"><i class="fa fa-check"></i><b>6.2.3</b> Limitations in kernel density estimation</a></li>
<li class="chapter" data-level="6.2.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#uses-for-kernel-density-estimation-kde-in-spatial-epidemiology"><i class="fa fa-check"></i><b>6.2.4</b> Uses for kernel density estimation (KDE) in spatial epidemiology</a></li>
<li class="chapter" data-level="6.2.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#guide-to-the-rest-of-this-section"><i class="fa fa-check"></i><b>6.2.5</b> Guide to the rest of this section…</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-point-processes"><i class="fa fa-check"></i><b>6.3</b> Spatial Analysis in Epidemiology: Kernel estimation of point processes</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#preparing-packages-and-data"><i class="fa fa-check"></i><b>6.3.1</b> Preparing packages and data</a></li>
<li class="chapter" data-level="6.3.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#introducing-a-new-spatial-data-class-ppp"><i class="fa fa-check"></i><b>6.3.2</b> Introducing a new spatial data class: <code>ppp</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-the-ppp-objects"><i class="fa fa-check"></i><b>6.3.3</b> Creating the <code>ppp</code> objects</a></li>
<li class="chapter" data-level="6.3.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#bandwidth-selection"><i class="fa fa-check"></i><b>6.3.4</b> Bandwidth selection</a></li>
<li class="chapter" data-level="6.3.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-kernel-density-surfaces"><i class="fa fa-check"></i><b>6.3.5</b> Estimating Kernel Density surfaces</a></li>
<li class="chapter" data-level="6.3.6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-manually"><i class="fa fa-check"></i><b>6.3.6</b> Creating relative risk surface manually</a></li>
<li class="chapter" data-level="6.3.7" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-with-risk-function"><i class="fa fa-check"></i><b>6.3.7</b> Creating relative risk surface with <code>risk()</code> function</a></li>
<li class="chapter" data-level="6.3.8" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#using-functions-to-map-rr-with-tmap"><i class="fa fa-check"></i><b>6.3.8</b> Using functions to map RR with <code>tmap</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#gwss"><i class="fa fa-check"></i><b>6.4</b> Spatial Analysis in Epidemiology: Kernel estimation of areal data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>6.4.1</b> Packages and data</a></li>
<li class="chapter" data-level="6.4.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-bandwidth-for-kernel-density-estimates"><i class="fa fa-check"></i><b>6.4.2</b> What bandwidth for kernel density estimates?</a></li>
<li class="chapter" data-level="6.4.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#geographically-weighted-summary-statistics-gwss"><i class="fa fa-check"></i><b>6.4.3</b> Geographically weighted summary statistics: <code>gwss()</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#calculating-pseudo-p-values-for-smoothed-estimates"><i class="fa fa-check"></i><b>6.4.4</b> Calculating pseudo p-values for smoothed estimates</a></li>
<li class="chapter" data-level="6.4.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-geographically-weighted-bivariate-statistics"><i class="fa fa-check"></i><b>6.4.5</b> Estimating geographically-weighted bivariate statistics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html"><i class="fa fa-check"></i><b>7</b> Disease Mapping IV</a>
<ul>
<li class="chapter" data-level="7.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#getting-ready-w7"><i class="fa fa-check"></i><b>7.1</b> Getting Ready, w7</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#learning-objectives-w7"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives, w7</a></li>
<li class="chapter" data-level="7.1.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#additional-resources-w7"><i class="fa fa-check"></i><b>7.1.2</b> Additional Resources, w7</a></li>
<li class="chapter" data-level="7.1.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#important-vocabulary-w7"><i class="fa fa-check"></i><b>7.1.3</b> Important Vocabulary, w7</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-thinking-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.2</b> Spatial Thinking in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#what-is-bayesian-inference"><i class="fa fa-check"></i><b>7.2.1</b> What is <em>Bayesian Inference</em>?</a></li>
<li class="chapter" data-level="7.2.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#bayesian-inference-in-spatial-epidemiology"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian inference in spatial epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-analysis-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.3</b> Spatial Analysis in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>7.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="7.3.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#preparing-for-carbayes"><i class="fa fa-check"></i><b>7.3.2</b> Preparing for <code>CARBayes()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#fitting-a-besag-york-mollie-bym-bayesian-model"><i class="fa fa-check"></i><b>7.3.3</b> Fitting a <em>Besag-York-Mollie (BYM)</em> Bayesian model</a></li>
<li class="chapter" data-level="7.3.4" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#summarizing-carbayes-model-output"><i class="fa fa-check"></i><b>7.3.4</b> Summarizing <code>CARBayes</code> model output</a></li>
<li class="chapter" data-level="7.3.5" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#making-inference-from-bayesian-posteriors"><i class="fa fa-check"></i><b>7.3.5</b> Making inference from Bayesian posteriors</a></li>
<li class="chapter" data-level="7.3.6" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#extracting-summaries-for-mapping-or-analysis"><i class="fa fa-check"></i><b>7.3.6</b> Extracting summaries for mapping or analysis</a></li>
<li class="chapter" data-level="7.3.7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#plot-raw-versus-smoothed"><i class="fa fa-check"></i><b>7.3.7</b> Plot raw versus smoothed</a></li>
<li class="chapter" data-level="7.3.8" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-rates"><i class="fa fa-check"></i><b>7.3.8</b> Mapping rates</a></li>
<li class="chapter" data-level="7.3.9" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-exceedance-probability"><i class="fa fa-check"></i><b>7.3.9</b> Mapping exceedance probability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html"><i class="fa fa-check"></i><b>8</b> Spatial Structure and Clustering I</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#getting-ready-w8"><i class="fa fa-check"></i><b>8.1</b> Getting Ready, w8</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#learning-objectives-w8"><i class="fa fa-check"></i><b>8.1.1</b> Learning objectives, w8</a></li>
<li class="chapter" data-level="8.1.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#additional-resources-w8"><i class="fa fa-check"></i><b>8.1.2</b> Additional Resources, w8</a></li>
<li class="chapter" data-level="8.1.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#important-vocabulary-w8"><i class="fa fa-check"></i><b>8.1.3</b> Important Vocabulary, w8</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-thinking-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.2</b> Spatial Thinking in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#two-big-questions"><i class="fa fa-check"></i><b>8.2.1</b> Two big questions…</a></li>
<li class="chapter" data-level="8.2.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#why-does-structure-or-clustering-matter"><i class="fa fa-check"></i><b>8.2.2</b> Why does structure or clustering matter?</a></li>
<li class="chapter" data-level="8.2.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#making-meaning-of-hypotheses-in-spatial-structure-testing"><i class="fa fa-check"></i><b>8.2.3</b> Making meaning of hypotheses in spatial structure testing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-analysis-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.3</b> Spatial Analysis in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>8.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="8.3.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#global-morans-i"><i class="fa fa-check"></i><b>8.3.2</b> Global Moran’s I</a></li>
<li class="chapter" data-level="8.3.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#local-morans-i"><i class="fa fa-check"></i><b>8.3.3</b> Local Moran’s I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html"><i class="fa fa-check"></i><b>9</b> Spatial Structure and Clustering II</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#getting-ready-w9"><i class="fa fa-check"></i><b>9.1</b> Getting Ready, w9</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#learning-objectives-w9"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives, w9</a></li>
<li class="chapter" data-level="9.1.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#additional-resources-w9"><i class="fa fa-check"></i><b>9.1.2</b> Additional Resources, w9</a></li>
<li class="chapter" data-level="9.1.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#important-vocabulary-w9"><i class="fa fa-check"></i><b>9.1.3</b> Important Vocabulary, w9</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-thinking-in-epidemiology-conceptual-tools-for-thinking-about-clusters"><i class="fa fa-check"></i><b>9.2</b> Spatial Thinking in Epidemiology: Conceptual tools for thinking about ‘clusters’</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#the-clustering-conundrum"><i class="fa fa-check"></i><b>9.2.1</b> The clustering conundrum</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-scan-statistics"><i class="fa fa-check"></i><b>9.3</b> Spatial Scan Statistics</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>9.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#overview-of-kulldorff-nagarwalla-scan-statistic"><i class="fa fa-check"></i><b>9.3.2</b> Overview of <em>Kulldorff &amp; Nagarwalla</em> scan statistic</a></li>
<li class="chapter" data-level="9.3.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatio-temporal-scan-statistics"><i class="fa fa-check"></i><b>9.3.3</b> Spatio-temporal scan statistics</a></li>
<li class="chapter" data-level="9.3.4" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatial-only-kulldorff-scan-statistics"><i class="fa fa-check"></i><b>9.3.4</b> Estimating <em>spatial-only</em> Kulldorff scan statistics</a></li>
<li class="chapter" data-level="9.3.5" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatio-temporal-kuldorff-scan-statistic"><i class="fa fa-check"></i><b>9.3.5</b> Estimating <em>spatio-temporal</em> Kuldorff scan statistic</a></li>
<li class="chapter" data-level="9.3.6" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.3.6</b> Concluding thoughts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatreg1.html"><a href="spatreg1.html"><i class="fa fa-check"></i><b>10</b> Spatial Regression I</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatreg1.html"><a href="spatreg1.html#getting-ready-w10"><i class="fa fa-check"></i><b>10.1</b> Getting Ready, w10</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="spatreg1.html"><a href="spatreg1.html#learning-objectives-w10"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives, w10</a></li>
<li class="chapter" data-level="10.1.2" data-path="spatreg1.html"><a href="spatreg1.html#important-vocabulary-w10"><i class="fa fa-check"></i><b>10.1.2</b> Important Vocabulary, w10</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="spatreg1.html"><a href="spatreg1.html#multivariable-regression-for-exploring-spatial-data"><i class="fa fa-check"></i><b>10.2</b> Multivariable regression for exploring spatial data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="spatreg1.html"><a href="spatreg1.html#data-generating-process"><i class="fa fa-check"></i><b>10.2.1</b> Data Generating Process</a></li>
<li class="chapter" data-level="10.2.2" data-path="spatreg1.html"><a href="spatreg1.html#model-residuals-are-not-just-mistakes"><i class="fa fa-check"></i><b>10.2.2</b> Model residuals are not just mistakes</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="spatreg1.html"><a href="spatreg1.html#spatializing-aspatial-regression"><i class="fa fa-check"></i><b>10.3</b> Spatializing aspatial regression</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="spatreg1.html"><a href="spatreg1.html#data-packages"><i class="fa fa-check"></i><b>10.3.1</b> Data &amp; Packages</a></li>
<li class="chapter" data-level="10.3.2" data-path="spatreg1.html"><a href="spatreg1.html#fitting-unconditional-empty-model"><i class="fa fa-check"></i><b>10.3.2</b> Fitting unconditional (empty) model</a></li>
<li class="chapter" data-level="10.3.3" data-path="spatreg1.html"><a href="spatreg1.html#fitting-conditional-model"><i class="fa fa-check"></i><b>10.3.3</b> Fitting conditional model</a></li>
<li class="chapter" data-level="10.3.4" data-path="spatreg1.html"><a href="spatreg1.html#mapping-residuals"><i class="fa fa-check"></i><b>10.3.4</b> Mapping residuals</a></li>
<li class="chapter" data-level="10.3.5" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-tests-on-lm-models"><i class="fa fa-check"></i><b>10.3.5</b> Moran’s I tests on <code>lm</code> models</a></li>
<li class="chapter" data-level="10.3.6" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-tests-on-glm-models"><i class="fa fa-check"></i><b>10.3.6</b> Moran’s I tests on <code>glm</code> models</a></li>
<li class="chapter" data-level="10.3.7" data-path="spatreg1.html"><a href="spatreg1.html#mapping-glm-residuals"><i class="fa fa-check"></i><b>10.3.7</b> Mapping <code>glm</code> residuals</a></li>
<li class="chapter" data-level="10.3.8" data-path="spatreg1.html"><a href="spatreg1.html#morans-i-for-glm"><i class="fa fa-check"></i><b>10.3.8</b> Moran’s I for <code>glm</code></a></li>
<li class="chapter" data-level="10.3.9" data-path="spatreg1.html"><a href="spatreg1.html#final-words"><i class="fa fa-check"></i><b>10.3.9</b> Final words</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html"><i class="fa fa-check"></i><b>11</b> Spatial Regression II</a>
<ul>
<li class="chapter" data-level="11.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#getting-ready-w11"><i class="fa fa-check"></i><b>11.1</b> Getting Ready, w11</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#learning-objectives-w11"><i class="fa fa-check"></i><b>11.1.1</b> Learning objectives, w11</a></li>
<li class="chapter" data-level="11.1.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#important-vocabulary-w11"><i class="fa fa-check"></i><b>11.1.2</b> Important Vocabulary, w11</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#spatially-varying-relationships"><i class="fa fa-check"></i><b>11.2</b> Spatially varying relationships</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#non-stationarity-in-context-of-spatial-epidemiology"><i class="fa fa-check"></i><b>11.2.1</b> Non-stationarity in context of spatial epidemiology</a></li>
<li class="chapter" data-level="11.2.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#introducing-geographically-weighted-regression"><i class="fa fa-check"></i><b>11.2.2</b> Introducing geographically weighted regression</a></li>
<li class="chapter" data-level="11.2.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#making-epidemiologic-meaning-of-spatially-varying-coefficients"><i class="fa fa-check"></i><b>11.2.3</b> Making epidemiologic meaning of spatially varying coefficients</a></li>
<li class="chapter" data-level="11.2.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#distinguishing-variation-in-prevalence-from-variation-in-correlation"><i class="fa fa-check"></i><b>11.2.4</b> Distinguishing variation in <strong>prevalence</strong> from variation in <strong>correlation</strong></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#estimating-geogrpahically-weighted-regression-models"><i class="fa fa-check"></i><b>11.3</b> Estimating geogrpahically weighted regression models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>11.3.1</b> Packages and Data</a></li>
<li class="chapter" data-level="11.3.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#preparing-for-using-gwmodel"><i class="fa fa-check"></i><b>11.3.2</b> Preparing for using <code>GWModel</code></a></li>
<li class="chapter" data-level="11.3.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#defining-local-optimizing-kernel-bandwidths"><i class="fa fa-check"></i><b>11.3.3</b> Defining local: optimizing kernel bandwidths</a></li>
<li class="chapter" data-level="11.3.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>11.3.4</b> Geographically weighted regression</a></li>
<li class="chapter" data-level="11.3.5" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#checking-local-multi-collinearity"><i class="fa fa-check"></i><b>11.3.5</b> Checking local multi-collinearity</a></li>
<li class="chapter" data-level="11.3.6" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#adjusting-for-multiple-comparisons"><i class="fa fa-check"></i><b>11.3.6</b> Adjusting for multiple comparisons</a></li>
<li class="chapter" data-level="11.3.7" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#visualizing-model-inference"><i class="fa fa-check"></i><b>11.3.7</b> Visualizing model inference</a></li>
<li class="chapter" data-level="11.3.8" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#extensions"><i class="fa fa-check"></i><b>11.3.8</b> Extensions</a></li>
<li class="chapter" data-level="11.3.9" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#data-models"><i class="fa fa-check"></i><b>11.3.9</b> Data models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html"><i class="fa fa-check"></i><b>12</b> Spatial Regression III</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#getting-ready-w12"><i class="fa fa-check"></i><b>12.1</b> Getting Ready, w12</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#learning-objectives-w12"><i class="fa fa-check"></i><b>12.1.1</b> Learning objectives, w12</a></li>
<li class="chapter" data-level="12.1.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#important-vocabulary-w12"><i class="fa fa-check"></i><b>12.1.2</b> Important Vocabulary, w12</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-econometric-models-putting-dependence-right-in-the-model"><i class="fa fa-check"></i><b>12.2</b> Spatial econometric models: Putting dependence right in the model</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-spatial-econometric-models"><i class="fa fa-check"></i><b>12.2.1</b> Comparing spatial econometric models</a></li>
<li class="chapter" data-level="12.2.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-and-selecting-spatial-econometric-models"><i class="fa fa-check"></i><b>12.2.2</b> Comparing and selecting spatial econometric models</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#estimating-spatial-econometrics-models"><i class="fa fa-check"></i><b>12.3</b> Estimating spatial econometrics models</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#package-data"><i class="fa fa-check"></i><b>12.3.1</b> Package &amp; Data</a></li>
<li class="chapter" data-level="12.3.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#defining-the-study-question"><i class="fa fa-check"></i><b>12.3.2</b> Defining the study question</a></li>
<li class="chapter" data-level="12.3.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#defining-competing-definitions-of-local"><i class="fa fa-check"></i><b>12.3.3</b> Defining competing definitions of <em>local</em></a></li>
<li class="chapter" data-level="12.3.4" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#two-extremes"><i class="fa fa-check"></i><b>12.3.4</b> Two extremes</a></li>
<li class="chapter" data-level="12.3.5" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#fitting-multivariable-regression-models"><i class="fa fa-check"></i><b>12.3.5</b> Fitting multivariable regression models</a></li>
<li class="chapter" data-level="12.3.6" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-error-model-1"><i class="fa fa-check"></i><b>12.3.6</b> Spatial Error Model</a></li>
<li class="chapter" data-level="12.3.7" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#hausman-test-of-coefficients"><i class="fa fa-check"></i><b>12.3.7</b> Hausman test of coefficients</a></li>
<li class="chapter" data-level="12.3.8" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-lag-model"><i class="fa fa-check"></i><b>12.3.8</b> Spatial Lag Model</a></li>
<li class="chapter" data-level="12.3.9" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#spatial-durbin-model-1"><i class="fa fa-check"></i><b>12.3.9</b> Spatial Durbin Model</a></li>
<li class="chapter" data-level="12.3.10" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#comparing-models"><i class="fa fa-check"></i><b>12.3.10</b> Comparing Models</a></li>
<li class="chapter" data-level="12.3.11" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#impact-assessments"><i class="fa fa-check"></i><b>12.3.11</b> Impact Assessments</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Appendices</b></span></li>
<li class="chapter" data-level="13" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html"><i class="fa fa-check"></i><b>13</b> Tips for reproducibility in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i>Additional Resources</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflows-to-enhance-reproducibility"><i class="fa fa-check"></i>Workflows to enhance reproducibility</a>
<ul>
<li><a href="tips-for-reproducibility-in-r.html#using-projects-in-r">Using Projects in <code>R</code></a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#understanding-directory-and-file-path-names-in-r">Understanding directory and file path names in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-location-within-the-working-directory"><i class="fa fa-check"></i>Specify a location within the working directory</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-relative-location-outside-the-working-directory"><i class="fa fa-check"></i>Specify a relative location outside the working directory</a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#why-r-notebooks">Why <code>R Notebooks</code>?</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#what-you-need-to-know"><i class="fa fa-check"></i>What you need to know</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#important-r-notebook-functions"><i class="fa fa-check"></i>Important R Notebook functions</a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#the-yaml"><i class="fa fa-check"></i>The YAML</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#typing-text"><i class="fa fa-check"></i>Typing text</a></li>
<li><a href="tips-for-reproducibility-in-r.html#adding-r-code">Adding <code>R</code> Code</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#making-tables"><i class="fa fa-check"></i>Making tables</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflow"><i class="fa fa-check"></i>Workflow</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#optional-functions"><i class="fa fa-check"></i>Optional functions</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#customizing-your-yaml"><i class="fa fa-check"></i>Customizing your YAML</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#simple-formatting-of-your-notebook"><i class="fa fa-check"></i>Simple formatting of your Notebook</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#text-formatting"><i class="fa fa-check"></i>Text formatting</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#final-note"><i class="fa fa-check"></i>Final Note</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="sf-overview.html"><a href="sf-overview.html"><i class="fa fa-check"></i><b>14</b> Tips for working with <code>sf</code> data class</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sf-overview.html"><a href="sf-overview.html#st_set_geom"><i class="fa fa-check"></i><b>14.1</b> <code>st_set_geom()</code></a></li>
<li class="chapter" data-level="14.2" data-path="sf-overview.html"><a href="sf-overview.html#st-as-sf"><i class="fa fa-check"></i><b>14.2</b> <code>st_as_sf()</code></a></li>
<li class="chapter" data-level="14.3" data-path="sf-overview.html"><a href="sf-overview.html#st_crs"><i class="fa fa-check"></i><b>14.3</b> <code>st_crs()</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>15</b> Tips for using <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="15.1" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>15.1</b> <code>select()</code></a></li>
<li class="chapter" data-level="15.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>15.2</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="15.3" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>15.3</b> <code>filter()</code></a></li>
<li class="chapter" data-level="15.4" data-path="dplyr.html"><a href="dplyr.html#arrange"><i class="fa fa-check"></i><b>15.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="15.5" data-path="dplyr.html"><a href="dplyr.html#pipe-operator"><i class="fa fa-check"></i><b>15.5</b> <code>%&gt;%</code> Pipe operator</a></li>
<li class="chapter" data-level="15.6" data-path="dplyr.html"><a href="dplyr.html#group_by-and-summarise"><i class="fa fa-check"></i><b>15.6</b> <code>group_by()</code> and <code>summarise()</code></a></li>
<li class="chapter" data-level="15.7" data-path="dplyr.html"><a href="dplyr.html#join"><i class="fa fa-check"></i><b>15.7</b> <code>join()</code></a></li>
<li class="chapter" data-level="15.8" data-path="dplyr.html"><a href="dplyr.html#pivot_"><i class="fa fa-check"></i><b>15.8</b> Reshaping (transposing) data</a>
<ul>
<li class="chapter" data-level="15.8.1" data-path="dplyr.html"><a href="dplyr.html#pivot_longer-for-going-from-wide-to-long"><i class="fa fa-check"></i><b>15.8.1</b> <code>pivot_longer()</code> for going from wide to long</a></li>
<li class="chapter" data-level="15.8.2" data-path="dplyr.html"><a href="dplyr.html#pivot_wider"><i class="fa fa-check"></i><b>15.8.2</b> <code>pivot_wider()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="intro-tmap.html"><a href="intro-tmap.html"><i class="fa fa-check"></i><b>16</b> Tips for using <code>tmap</code></a>
<ul>
<li class="chapter" data-level="16.1" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-mode"><i class="fa fa-check"></i><b>16.1</b> <code>tmap</code> mode</a></li>
<li class="chapter" data-level="16.2" data-path="intro-tmap.html"><a href="intro-tmap.html#qtm"><i class="fa fa-check"></i><b>16.2</b> Quick maps: <code>qtm()</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-polygons"><i class="fa fa-check"></i><b>16.2.1</b> Customizing <code>qtm()</code> for polygons</a></li>
<li class="chapter" data-level="16.2.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-lines"><i class="fa fa-check"></i><b>16.2.2</b> Customizing <code>qtm()</code> for lines</a></li>
<li class="chapter" data-level="16.2.3" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-points"><i class="fa fa-check"></i><b>16.2.3</b> Customizing <code>qtm()</code> for points</a></li>
<li class="chapter" data-level="16.2.4" data-path="intro-tmap.html"><a href="intro-tmap.html#finding-valid-color-options"><i class="fa fa-check"></i><b>16.2.4</b> Finding valid color options</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="intro-tmap.html"><a href="intro-tmap.html#building-maps-with-tmap"><i class="fa fa-check"></i><b>16.3</b> Building maps with <code>tmap</code></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="intro-tmap.html"><a href="intro-tmap.html#building-blocks-in-tmap"><i class="fa fa-check"></i><b>16.3.1</b> Building blocks in <code>tmap</code></a></li>
<li class="chapter" data-level="16.3.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-text-on-maps"><i class="fa fa-check"></i><b>16.3.2</b> Customizing text on maps</a></li>
<li class="chapter" data-level="16.3.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-two-or-more-spatial-objects-in-one-map"><i class="fa fa-check"></i><b>16.3.3</b> Adding two or more spatial objects in one map</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-layout-and-map-elements"><i class="fa fa-check"></i><b>16.4</b> Controlling layout and map elements</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="intro-tmap.html"><a href="intro-tmap.html#understanding-the-graphic-space-in-tmap"><i class="fa fa-check"></i><b>16.4.1</b> Understanding the graphic space in <code>tmap</code></a></li>
<li class="chapter" data-level="16.4.2" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-map-layout"><i class="fa fa-check"></i><b>16.4.2</b> Controlling map layout</a></li>
<li class="chapter" data-level="16.4.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-map-elements"><i class="fa fa-check"></i><b>16.4.3</b> Adding map elements</a></li>
<li class="chapter" data-level="16.4.4" data-path="intro-tmap.html"><a href="intro-tmap.html#change-the-global-style-of-a-map"><i class="fa fa-check"></i><b>16.4.4</b> Change the global style of a map</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="intro-tmap.html"><a href="intro-tmap.html#making-small-multiple-maps"><i class="fa fa-check"></i><b>16.5</b> Making small-multiple maps</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-as-a-vector-of-variables"><i class="fa fa-check"></i><b>16.5.1</b> Small multiples as a vector of variables</a></li>
<li class="chapter" data-level="16.5.2" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-facet"><i class="fa fa-check"></i><b>16.5.2</b> Small multiples with facets</a></li>
<li class="chapter" data-level="16.5.3" data-path="intro-tmap.html"><a href="intro-tmap.html#facets-for-time-series"><i class="fa fa-check"></i><b>16.5.3</b> Facets for time-series</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-with-tmap_arrange"><i class="fa fa-check"></i><b>16.6</b> Small multiples with <code>tmap_arrange()</code></a></li>
<li class="chapter" data-level="16.7" data-path="intro-tmap.html"><a href="intro-tmap.html#summarizing-small-multiples"><i class="fa fa-check"></i><b>16.7</b> Summarizing small multiples</a></li>
<li class="chapter" data-level="16.8" data-path="intro-tmap.html"><a href="intro-tmap.html#saving-maps"><i class="fa fa-check"></i><b>16.8</b> Saving maps</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro-tmap" class="section level1" number="16">
<h1><span class="header-section-number">Week 16</span> Tips for using <code>tmap</code></h1>
<p>Base-R has capable data visualization and plotting capabilities, but these fall short when doing anything but the most simple maps with spatial data. Many other packages including <code>sp</code> and <code>ggplot2</code> also have functionality specifically optimized for the data visualization needs of the spatial epidemiologist. We will have brief introductions to these and other packages.</p>
<p>But for this semester the workhorse mapping/cartography tool will be the <code>tmap</code> (<em>thematic</em> mapping) package. This package builds on the <em>grammar of graphics</em> logic built into <code>ggplot2</code> where data visualizations are conceived of as a series of layers of information (e.g. axes, plot space, data points, lines, fill, legends, titles, etc) systematically stacked one on top of another. With <code>tmap</code> we start with a spatial object (e.g. a data object of either <code>sf</code> or <code>sp</code> class) and build a visualization by similarly combining or adding together sequential layers.</p>
<p>Once again, we will use data from the motor vehicle crash mortality dataset of Georgia counties (a vector polygon spatial data file), along with information about highways (vector line data file) and trama centers (vector point data).</p>
<p>First load the package, <code>tmap</code> and browse the help index:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="intro-tmap.html#cb409-1"></a><span class="co"># load the tmap and sf packages</span></span>
<span id="cb409-2"><a href="intro-tmap.html#cb409-2"></a><span class="kw">library</span>(tmap)</span>
<span id="cb409-3"><a href="intro-tmap.html#cb409-3"></a><span class="kw">library</span>(sf)</span>
<span id="cb409-4"><a href="intro-tmap.html#cb409-4"></a></span>
<span id="cb409-5"><a href="intro-tmap.html#cb409-5"></a><span class="kw">help</span>(<span class="st">&#39;tmap&#39;</span>)</span></code></pre></div>
<p>After seeing the range of functions within <code>tmap</code>, we will import three datasets all stored in the geopackage format to begin visualizing:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="intro-tmap.html#cb410-1"></a><span class="co"># import (read) three spatial datasets stored in geopackage format</span></span>
<span id="cb410-2"><a href="intro-tmap.html#cb410-2"></a>mvc &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;GA_MVC/ga_mvc.gpkg&#39;</span>)</span>
<span id="cb410-3"><a href="intro-tmap.html#cb410-3"></a>hwy &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;GA_MVC/ga_hwy.gpkg&#39;</span>)</span>
<span id="cb410-4"><a href="intro-tmap.html#cb410-4"></a>trauma &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;GA_MVC/trauma_centers.gpkg&#39;</span>)</span></code></pre></div>
<div id="tmap-mode" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> <code>tmap</code> mode</h2>
<p>One nice feature of <code>tmap</code> is that it has two <em>modes</em> for plotting maps. You may develop a general preference for one over another, although in my opinion they serve slightly different purposes.</p>
<ol style="list-style-type: decimal">
<li>The <code>plot</code> mode produces conventional <em>static</em> maps that are viewed in the plot plane or can be saved to a file. These will be the main maps for dissemination in papers, posters, or many presentations.</li>
<li>The <code>view</code> mode is a more interactive plot in an html browser-like window. This mode allows the user to interact with the map including panning, zooming, and clicking on spatial objects to view underlying data. This is great for data exploration, and has extensions for web-served maps. However it is not so useful for any non-web-based dissemination or when you want to control the map.</li>
</ol>
<p>You select the mode with the function <code>tmap_mode()</code> and either <code>'plot'</code> or <code>'view'</code> in the parentheses. Note that when you set the mode, all the subsequent maps are in that mode…you must re-submit the <code>tmap_mode()</code> call to switch back again. By default, the <code>tmap_mode()</code> is <code>'plot'</code>, which means it produces static maps. We will plot some static maps, then switch to ’<code>view'</code> mode to compare.</p>
</div>
<div id="qtm" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Quick maps: <code>qtm()</code></h2>
<p>The function <code>qtm()</code> stands for <strong>Q</strong>uick <strong>T</strong>hematic <strong>M</strong>aps, and provides a step up from the simple <code>plot()</code> functions for quickly plotting spatial objects. The fundamental argument when submitting <code>qtm()</code> is the name of the object to be plotted.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="intro-tmap.html#cb411-1"></a><span class="kw">qtm</span>(mvc)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-376-1.png" width="672" /></p>
<p>This produces the geometry but no other information (note that unlike <code>plot()</code>, it does not plot a map for every variable!).</p>
<p>To produce a choropleth map (e.g. one in which objects are shaded to represent an underlying statistic or value), simply add the name of the variable.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="intro-tmap.html#cb412-1"></a><span class="kw">qtm</span>(mvc, <span class="st">&#39;MVCRATE_05&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-377-1.png" width="672" /></p>
<p>Can you tell how the legend cut-points are determined? We’ll talk about when this matters and how to change it later.</p>
<p>Now try switching <code>tmap_mode()</code>:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="intro-tmap.html#cb413-1"></a><span class="kw">tmap_mode</span>(<span class="st">&#39;view&#39;</span>)</span></code></pre></div>
<p>Try these things in <code>view</code> mode:</p>
<ul>
<li>By default it will be visible in your R Studio Viewer pane; there is an icon with a screen and arrow that allows you to show in new window…do this so it is bigger</li>
<li>Zoom in and out</li>
<li>Pan</li>
<li>Hover over counties (what do you see with hovering?)</li>
<li>Click on counties (what do you see when you click?)</li>
<li>Underneath the zoom + / - is an icon like a stack of papers. This changes the background map (how does the background information change as you zoom in/out?)</li>
<li>Click on icon that looks like stack of pages. This lets you change the background map (assuming you are currently connected to internet)</li>
</ul>
<p>To change back (if you like) do this:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="intro-tmap.html#cb414-1"></a><span class="kw">tmap_mode</span>(<span class="st">&#39;plot&#39;</span>)</span></code></pre></div>
<div id="customizing-qtm-for-polygons" class="section level3" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> Customizing <code>qtm()</code> for polygons</h3>
<p>For polygon data, you might like to control several features including the title, the color palette, and the style by which the continuous variables are categorized in the legend.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="intro-tmap.html#cb415-1"></a><span class="kw">qtm</span>(mvc,</span>
<span id="cb415-2"><a href="intro-tmap.html#cb415-2"></a>    <span class="dt">fill =</span> <span class="st">&#39;MVCRATE_17&#39;</span>, </span>
<span id="cb415-3"><a href="intro-tmap.html#cb415-3"></a>    <span class="dt">fill.style =</span> <span class="st">&#39;quantile&#39;</span>, </span>
<span id="cb415-4"><a href="intro-tmap.html#cb415-4"></a>    <span class="dt">fill.palette =</span> <span class="st">&#39;YlGnBu&#39;</span>,</span>
<span id="cb415-5"><a href="intro-tmap.html#cb415-5"></a>    <span class="dt">fill.title =</span> <span class="st">&#39;MVC Mortality </span><span class="ch">\n</span><span class="st">(2017)&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-380-1.png" width="672" /></p>
<p>The syntax above customizes the original plot in several ways:</p>
<ul>
<li>By changing the <code>fill.style</code> (which is the style by which continuous variables are categorized in order to plot in a sequential ramp choropleth map) from the default (fixed or equal intervals) to a quantile style (by default quantiles have <span class="math inline">\(n=5\)</span> so they are <em>quintiles</em> although other schemes including <em>tertiles</em> or <em>quartiles</em> are possible also)</li>
<li>By choosing a custom color palette, in this case the Yellow-Green-Blue (<code>YlGnBu</code>) palette, which is one of several built-in options.</li>
<li>Providing a more informative title to the legend, rather than the default variable name.</li>
</ul>
</div>
<div id="customizing-qtm-for-lines" class="section level3" number="16.2.2">
<h3><span class="header-section-number">16.2.2</span> Customizing <code>qtm()</code> for lines</h3>
<p><code>qtm()</code> (and <code>tmap</code> generally) can also handle other types of spatial data including line shape objects, and can provide some customization of the results. Try these for the highway dataset:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="intro-tmap.html#cb416-1"></a><span class="kw">qtm</span>(hwy, </span>
<span id="cb416-2"><a href="intro-tmap.html#cb416-2"></a>    <span class="dt">lines.lwd =</span> <span class="dv">2</span>, </span>
<span id="cb416-3"><a href="intro-tmap.html#cb416-3"></a>    <span class="dt">lines.col =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-381-1.png" width="672" /></p>
<p>The basic plot of highways uses default colors and sizes, but the plot here uses the <code>lines.lwd=</code> argument to specify the <strong>line width</strong> or thickness. The <code>lines.col=</code> sets the color.</p>
</div>
<div id="customizing-qtm-for-points" class="section level3" number="16.2.3">
<h3><span class="header-section-number">16.2.3</span> Customizing <code>qtm()</code> for points</h3>
<p>And not surprisingly, there is similar control for point spatial objects, in this case the locations of the trauma centers.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="intro-tmap.html#cb417-1"></a><span class="kw">qtm</span>(trauma,</span>
<span id="cb417-2"><a href="intro-tmap.html#cb417-2"></a>    <span class="dt">symbols.size =</span> <span class="st">&#39;LEVEL_number&#39;</span>, </span>
<span id="cb417-3"><a href="intro-tmap.html#cb417-3"></a>    <span class="dt">symbols.shape =</span> <span class="st">&#39;LEVEL&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-382-1.png" width="672" /></p>
<p>Because <code>symbols.size</code> and <code>symbols.shape</code> were specified, the symbolized variables by modifying the size and shape. There are also settings for color. If you study the help documentation, notice that some arguments require numbers (and thus use <code>LEVEL_number</code> which is an integer) and some allow character/factors (and thus use <code>LEVEL</code>).</p>
</div>
<div id="finding-valid-color-options" class="section level3" number="16.2.4">
<h3><span class="header-section-number">16.2.4</span> Finding valid color options</h3>
<p>In base R there are many ways to specify colors including using standardized character strings, as well as HEX codes which are complicated alphanumeric labels that are used across industries to identify unique colors. Here is one of many lists of base-R color names: <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" class="uri">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a></p>
<p>However for mapping we often want not just single colors, but reasonable sets of colors for symbolizing sequential values, categorical values, or diverging values. In the coming weeks we will talk about how to choose color and style for symbolizing maps, but it is worth knowing of a quick tool in <code>tmap</code> (or actually in an add-on package you installed called <code>tmaptools</code>) for seeing built-in color palettes.</p>
<blockquote>
<p>NOTE: Occasionally this next step has caused my session of R to crash. Therefore I usually open a second instance of R Studio just to do the next thing. To do that simply go to <strong>Session</strong> in the R Studio menu and click <strong>New Session</strong>. This creates another completely independent instance of R Studio (e.g. none of the packages or data loaded in this current session are present in the new session unless you specify them).</p>
</blockquote>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="intro-tmap.html#cb418-1"></a>tmaptools<span class="op">::</span><span class="kw">palette_explorer</span>()</span></code></pre></div>
<p>Why did we use the package name (<code>tmaptools</code>) followed by a double colon (<code>::</code>)? This is a shortcut in <code>R</code> that lets you call a single function from a package without loading the package. Basically this says <em>“go look in the package called <code>tmaptools</code> and load this specified function”</em>. I use this shortcut (in general, not only for <code>tmaptools</code>) in one of two situations:</p>
<ul>
<li>There is a function with the same name in two or more packages, and specifying which package identifies the one I mean. For instance we will soon learn the package <code>dplyr</code> and the function <code>select()</code> in this package is also the name of a function in another package for handling spatial data called <code>raster</code>. So I often use <code>dplyr::select()</code> to disambiguate.</li>
<li>In situations like <code>tmaptools::palette_explorer()</code> where I really only need the one function but currently do not need anything else from the package.</li>
</ul>
<p>As you may discover with experimentation, the <code>tmaptools::palette_explorer()</code> function is actually a small interactive <em>app</em> that opens in a new window and lets you see an array of color palettes. You can see them divided by <em>sequential</em>, <em>divergent</em>, and <em>categorical</em> color ramps and you can move the slider to change how many categories and see the color ranges. The thing you want from this explorer is the abbreviated names to the left of each color ramp. You could also browse these same palettes by going to the <a href="http://colorbrewer2.org/"><em>Color Brewer website</em></a> which is a compilation of recommended color palettes for cartography.</p>
</div>
</div>
<div id="building-maps-with-tmap" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> Building maps with <code>tmap</code></h2>
<p><code>qtm()</code> is great for quickly making a map, but when you want more control over the map, you will want to shift to the full functions of <code>tmap</code>.</p>
<div id="building-blocks-in-tmap" class="section level3" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Building blocks in <code>tmap</code></h3>
<p><code>tmap</code> produces maps using the <em>grammar of graphics</em> approach which means building up a final product as the ‘sum’ of several fundamental components, plus possible options layers. There are three broad components of maps in <code>tmap</code>:</p>
<ol style="list-style-type: decimal">
<li>Specify the spatial object to map using <code>tm_shape()</code>.</li>
<li>Following the call to <code>tm_shape()</code> you generally specify the <em>layers</em> you wish to symbolize or map. In other words specifying a shape doesn’t plot anything…it just is the starting point. The <em>layers</em> are the actual things from that object/shape to plot. In the case of polygons you will usually use <code>tm_fill()</code> to specify a layer about the fill of the polygon, although other layers are available (e.g. see the <em>base</em> and <em>derived</em> layers listed when you look at <code>help('tmap')</code>).</li>
<li>Finally, in many instances you want to customize other map layout features, such as the title or the legend, and you might like to add elements such as a North arrow or a scale bar.</li>
</ol>
<p>For a given map, the various layers or steps are connected together in <code>R</code> code with a plus sign (<code>+</code>); this highlights that a map is the <strong>sum</strong> of many parts.</p>

<div class="rmdcaution">
<strong>NOTE</strong>: the use of the pipe (<code>%&gt;%</code>) and the plus (<code>+</code>) is seemingly the same in that they both connect steps together but they are not! It is perhaps unfortunate that <code>ggplot2</code> and <code>tmap</code> do not use the same pipe as <code>dplyr</code>. Beware that you choose the correct connector for the function at hand!
</div>
<p>Note that steps 1 and 2 can be repeated for as many spatial objects as you wish to layer. So if you wanted to put points and lines on top of a polygon shape, you would specify <code>tm_shape()</code> and the corresponding layers for each spatial object in turn.</p>
<p>This code replicates our first map with <code>qtm()</code>, and basically says, "Start with the object <code>mvc</code> and symbolize it with two layers: the first fills the polygons to represent <code>MVCRATE_17</code> and the second adds polygon borders:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="intro-tmap.html#cb419-1"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb419-2"><a href="intro-tmap.html#cb419-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>) <span class="op">+</span></span>
<span id="cb419-3"><a href="intro-tmap.html#cb419-3"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-385-1.png" width="672" /></p>
<p>Look at the help documentation for <code>tm_fill()</code> to see the myriad ways you can customize this map! It’s a little overwhelming, but I’d suggest looking at the <code>style</code> and <code>palette</code> arguments, and using the above-mentioned <code>palette_explorer()</code> to try out different colors and different styles for cut-points.</p>
</div>
<div id="customizing-text-on-maps" class="section level3" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Customizing text on maps</h3>
<p>There are several ways you may wish to customize the text on maps. For example you may want to provide a name for the legend, new labels for the categories, or a title, subtitle or caption for the whole map.</p>
<ul>
<li>To give a title to the legend in a map use the <code>title = 'xxx'</code> in the <code>tm_fill()</code> (or other layer function) call.</li>
<li>To change the labels of the legend</li>
<li>To add a source or credits annotation</li>
</ul>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="intro-tmap.html#cb420-1"></a>  <span class="co"># First, I create a vector of my custom legend labels</span></span>
<span id="cb420-2"><a href="intro-tmap.html#cb420-2"></a>  <span class="co"># (note, there must be same number of labels as there are categories in map)</span></span>
<span id="cb420-3"><a href="intro-tmap.html#cb420-3"></a>myLabels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Low (Q1)&#39;</span>, <span class="st">&#39;Q2&#39;</span>, <span class="st">&#39;Q3&#39;</span>, <span class="st">&#39;Q4&#39;</span>, <span class="st">&#39;Hi (Q5)&#39;</span>)</span>
<span id="cb420-4"><a href="intro-tmap.html#cb420-4"></a></span>
<span id="cb420-5"><a href="intro-tmap.html#cb420-5"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb420-6"><a href="intro-tmap.html#cb420-6"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>,</span>
<span id="cb420-7"><a href="intro-tmap.html#cb420-7"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb420-8"><a href="intro-tmap.html#cb420-8"></a>          <span class="dt">title =</span> <span class="st">&#39;MVC Rate in 2017&#39;</span>,</span>
<span id="cb420-9"><a href="intro-tmap.html#cb420-9"></a>          <span class="dt">n =</span> <span class="dv">5</span>, </span>
<span id="cb420-10"><a href="intro-tmap.html#cb420-10"></a>          <span class="dt">labels =</span> myLabels) <span class="op">+</span></span>
<span id="cb420-11"><a href="intro-tmap.html#cb420-11"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb420-12"><a href="intro-tmap.html#cb420-12"></a><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&#39;Motor Vehicle Crashes per capita in Georgia&#39;</span>,</span>
<span id="cb420-13"><a href="intro-tmap.html#cb420-13"></a>          <span class="dt">legend.outside =</span> T) <span class="op">+</span></span>
<span id="cb420-14"><a href="intro-tmap.html#cb420-14"></a><span class="kw">tm_credits</span>(<span class="st">&#39;Source: Georgia OASIS, retrieved 2019&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-386-1.png" width="672" /></p>
<blockquote>
<p>SIDE NOTE: The <code>tm_fill()</code> option creates 5 bins or categories for plotting <em>by default</em>. For that reason it was unnecessary for me to put <code>n = 5</code> to specify how many categories. However I did so to be <em>explicit</em> about the number of categories because I am provide a vector of 5 labels to correspond to the categories. Of course one could choose a non-default number of categories (e.g. <code>n = 3</code> or <code>n = 7</code>), and if custom labels are provided there should be as many labels as categories.</p>
</blockquote>
</div>
<div id="adding-two-or-more-spatial-objects-in-one-map" class="section level3" number="16.3.3">
<h3><span class="header-section-number">16.3.3</span> Adding two or more spatial objects in one map</h3>
<p>Just like in ArcGIS, additional spatial layers can be added up to produce a more informative map. For instance if we were interested in how highways and trauma centers related to motor vehicle mortality rates we could add these layers.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="intro-tmap.html#cb421-1"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span><span class="st"> </span></span>
<span id="cb421-2"><a href="intro-tmap.html#cb421-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>,</span>
<span id="cb421-3"><a href="intro-tmap.html#cb421-3"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb421-4"><a href="intro-tmap.html#cb421-4"></a>          <span class="dt">palette =</span> <span class="st">&#39;Purples&#39;</span>) <span class="op">+</span></span>
<span id="cb421-5"><a href="intro-tmap.html#cb421-5"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb421-6"><a href="intro-tmap.html#cb421-6"></a></span>
<span id="cb421-7"><a href="intro-tmap.html#cb421-7"></a><span class="kw">tm_shape</span>(hwy) <span class="op">+</span><span class="st"> </span></span>
<span id="cb421-8"><a href="intro-tmap.html#cb421-8"></a><span class="st">  </span><span class="kw">tm_lines</span>(<span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></span>
<span id="cb421-9"><a href="intro-tmap.html#cb421-9"></a><span class="st">  </span></span>
<span id="cb421-10"><a href="intro-tmap.html#cb421-10"></a><span class="kw">tm_shape</span>(trauma) <span class="op">+</span><span class="st"> </span></span>
<span id="cb421-11"><a href="intro-tmap.html#cb421-11"></a><span class="st">  </span><span class="kw">tm_bubbles</span>(<span class="dt">shape =</span> <span class="st">&#39;LEVEL&#39;</span>,</span>
<span id="cb421-12"><a href="intro-tmap.html#cb421-12"></a>             <span class="dt">col =</span> <span class="st">&#39;pink&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-387-1.png" width="672" /></p>
<p>Several things to note about above code:</p>
<ol style="list-style-type: decimal">
<li>There are three separate spatial objects plotted, and each is called by starting with <code>tm_shape()</code> followed by some additional function <em>specific to the layer</em>. See the help documentation, or the Tenekes article on Canvas for a table of which layers are available for which kinds of shapes (e.g. polygons, points, or lines).</li>
<li>Each function (e.g. each call with parentheses) is connected together with plus signs</li>
<li>Within each function (e.g. <em>within the parentheses</em>), arguments are separated with commas</li>
<li>I organize my code vertically because I think it makes it more readable than all on one line. However this is a point of style, not a requirement.</li>
</ol>
<p>Try changing these arguments or try substituting different options!</p>
</div>
</div>
<div id="controlling-layout-and-map-elements" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Controlling layout and map elements</h2>
<p>When the <em>audience</em> for your map is yourself, making it look ‘<em>just right</em>’ may not be critical. However, when you are creating a map to share with colleagues, other stakeholders, or the public, cartographic design is important for effective visual communication. <code>tmap</code> has a wide range of tools to customize the way a single map (or even a set of maps) looks. In fact there are so many that it can feel overwhelming at first. The best advice is to use the <code>help</code> documentation often, and experiment <em>a lot</em>! I will not repeat the help documentation completely, but below I provide some guidance on several common layout needs and options. Note that the focus of the examples is for <em>static maps</em> presented with <code>tmap_mode('plot')</code>. Many of the options behave the same when you are using the interactive <code>tmap_mode('view')</code>, but because interactive html plots dynamically resize, some formatting may differ. See <code>?tm_view()</code> for more information on options specific to the interactive mode.</p>
<div id="understanding-the-graphic-space-in-tmap" class="section level3" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> Understanding the graphic space in <code>tmap</code></h3>
<p>As you will see in the discussion below, there are many tools to adjust the size and position of elements so that they all fit in the way you want, and to accomplish desired graphic layout. But one recurring source of frustration is understanding which parameters move which parts of the graphical space. While it is not apparent, what you see in a plot is really a set of nested plot spaces each with border and margin width control.</p>
<p>To see these you can ‘<em>turn on</em>’ a global option called <code>design.mode</code> using the function <code>tmap_options()</code>. What this does is colorize different parts of the plot space, with messaging about the names of each space. This can help you figure out whether you need to control <code>inner.margins</code>, <code>outer.margins</code> or move things from a panel to an overall plot space.</p>
<p>This example uses a two-map plot to illustrate the information returned:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="intro-tmap.html#cb422-1"></a><span class="co"># Turn &#39;on&#39; the design.mode in tmap_options()</span></span>
<span id="cb422-2"><a href="intro-tmap.html#cb422-2"></a><span class="kw">tmap_options</span>(<span class="dt">design.mode =</span> T)</span>
<span id="cb422-3"><a href="intro-tmap.html#cb422-3"></a></span>
<span id="cb422-4"><a href="intro-tmap.html#cb422-4"></a><span class="co"># Plot a map of two rates, side by side (e.g. see small multiples below)</span></span>
<span id="cb422-5"><a href="intro-tmap.html#cb422-5"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span><span class="st"> </span></span>
<span id="cb422-6"><a href="intro-tmap.html#cb422-6"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;MVCRATE_05&#39;</span>, <span class="st">&#39;MVCRATE_17&#39;</span>),</span>
<span id="cb422-7"><a href="intro-tmap.html#cb422-7"></a>          <span class="dt">palette =</span> <span class="st">&#39;Purples&#39;</span>,</span>
<span id="cb422-8"><a href="intro-tmap.html#cb422-8"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>) <span class="op">+</span></span>
<span id="cb422-9"><a href="intro-tmap.html#cb422-9"></a><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-388-1.png" width="672" /></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="intro-tmap.html#cb423-1"></a><span class="co"># turn off the design.mode unless you want to see it on the next map you plot</span></span>
<span id="cb423-2"><a href="intro-tmap.html#cb423-2"></a><span class="kw">tmap_options</span>(<span class="dt">design.mode =</span> F)</span></code></pre></div>
<p>As you will see from the text output (which interprets the colors), there are actually several different plot spaces.</p>
<ul>
<li><code>device</code> (yellow) means the full extent of your output device, whether that be your screen, a <code>.png</code> or a <code>.pdf</code></li>
<li><code>outer.margins</code> (indicated by green) shows how far the edges of the plot area are from the edge of the graphic device</li>
<li><code>master shape</code> (indicated in red) is the actual plotted map. Below you will see instructions on how to adjusted <code>inner.margins</code>; these margins are the distance between the red area and the blue area. If you want the map to be smaller inside the frame, use <code>inner.margins</code> to shrink the size of the red area</li>
</ul>
</div>
<div id="controlling-map-layout" class="section level3" number="16.4.2">
<h3><span class="header-section-number">16.4.2</span> Controlling map layout</h3>
<p>The function <code>tm_layout()</code> controls title, margins, aspect ratio, colors, frame, legend, among many other things. Type <code>?tm_layout()</code> to review the help documentation to see the long list of arguments that you can modify. Arguments via the <code>tm_layout()</code> function are incorporated into a map by ‘<em>adding</em>’ (e.g. using the <code>+</code> sign) to a <code>tmap</code> object, just as you would add <code>tm_fill()</code> or <code>tm_borders()</code>.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="intro-tmap.html#cb424-1"></a><span class="co"># Using tm_fill and tm_layout to control layout and text</span></span>
<span id="cb424-2"><a href="intro-tmap.html#cb424-2"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb424-3"><a href="intro-tmap.html#cb424-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>,</span>
<span id="cb424-4"><a href="intro-tmap.html#cb424-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb424-5"><a href="intro-tmap.html#cb424-5"></a>          <span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb424-6"><a href="intro-tmap.html#cb424-6"></a>          <span class="dt">title =</span> <span class="st">&#39;Deaths per 100,000, </span><span class="ch">\n</span><span class="st">2017&#39;</span>) <span class="op">+</span></span>
<span id="cb424-7"><a href="intro-tmap.html#cb424-7"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb424-8"><a href="intro-tmap.html#cb424-8"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">main.title =</span> <span class="st">&#39;Car crash mortality in Georgia&#39;</span>,</span>
<span id="cb424-9"><a href="intro-tmap.html#cb424-9"></a>            <span class="dt">inner.margins =</span> <span class="kw">c</span>(<span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-389-1.png" width="672" /></p>
<p><strong>Explaining the code above</strong>:</p>
<p>Aspects of the layout were specified in different steps:</p>
<ul>
<li><code>tm_fill()</code> permits the specification of the <em>title for the legend</em>. Notice the inclusion of <code>\n</code> within the title. This is called an <em>escape character</em> and this particular one forces a line break/carriage return, which let me wrap the title of the legend onto two lines</li>
<li><code>tm_borders()</code> is familiar, but use the <code>alpha</code> argument to specify transparency in the borders, resulting in them being lighter in color. <code>alpha</code> is a parameter ranging from 0 (fully transparent, or invisible) to 1 (no transparency). You can use <code>alpha</code> in many different settings; it is useful in some maps with many units (e.g. map of all U.S. counties) to diminish the visual impact of boundaries by using transparency.</li>
<li><code>tm_layout()</code> is a function with many purposes, but here it does two things: add an overall title to the map, and adjust the spacing inside the frame line so things fit:</li>
<li><code>inner.margins</code> controls how big the mapped figure is in relation to the overall frame; using this argument is a way to squish things around so that the legend or other elements fit without bumping into each other.
<ul>
<li>The argument expects a vector of four number going <em>bottom</em>, <em>left</em>, <em>top</em>, <em>right</em></li>
<li>The values in the vector of four numbers can each range from 0 to 1, representing a relative amount of space between the <em>map object</em> and the frame. So the use of <code>inner.margins = c(0.02, 0.02, 0.1, 0.2)</code> means that there is very little extra space in the bottom and left (only 0.02 each), but more extra space at the top (0.1) and even more on the right (0.2). I arrived at these values through trial and error necessary to keep the legend from bumping into the map.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="intro-tmap.html#cb425-1"></a><span class="co"># Adding a histogram to the legend and moving the legend outside of the frame</span></span>
<span id="cb425-2"><a href="intro-tmap.html#cb425-2"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb425-3"><a href="intro-tmap.html#cb425-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>,</span>
<span id="cb425-4"><a href="intro-tmap.html#cb425-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb425-5"><a href="intro-tmap.html#cb425-5"></a>          <span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb425-6"><a href="intro-tmap.html#cb425-6"></a>          <span class="dt">title =</span> <span class="st">&#39;Deaths per 100,000, </span><span class="ch">\n</span><span class="st">2017&#39;</span>,</span>
<span id="cb425-7"><a href="intro-tmap.html#cb425-7"></a>          <span class="dt">legend.hist =</span> T) <span class="op">+</span></span>
<span id="cb425-8"><a href="intro-tmap.html#cb425-8"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb425-9"><a href="intro-tmap.html#cb425-9"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">main.title =</span> <span class="st">&#39;Car crash mortality in Georgia&#39;</span>,</span>
<span id="cb425-10"><a href="intro-tmap.html#cb425-10"></a>            <span class="dt">legend.outside =</span> T)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-390-1.png" width="672" /></p>
<p><strong>Explaining the code above</strong>:</p>
<p>This code differed in three ways:</p>
<ul>
<li>I used the option to request a histogram to be with the legend, using <code>legend.hist = T</code> in the <code>tm_fill()</code> function</li>
<li>I moved the entire legend <em>outside of the frame</em> by specifying <code>legend.outside = T</code> in the <code>tm_layout()</code> function. Note that in addition to shifting the legend outside, you can also control its location by using <code>legend.position</code> (for changing location <em>inside the frame</em>) or <code>legend.outside.position</code> (for controlling position <em>outside the frame</em>).</li>
</ul>
</div>
<div id="adding-map-elements" class="section level3" number="16.4.3">
<h3><span class="header-section-number">16.4.3</span> Adding map elements</h3>
<p>Finally, you may wonder how to add map elements like north arrows, scale bars, captions, etc.</p>
<table>
<colgroup>
<col width="41%" />
<col width="58%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tm_compass()</code></td>
<td>To add a north arrow or compass rose, use <code>tm_compass()</code> and specify <code>type =</code> to include a range of options (see help). The size, position, color, and font information can all be controlled</td>
</tr>
<tr class="even">
<td><code>tm_scale_bar()</code></td>
<td>Create and control a scale bar with options to change the units, position, size, and font</td>
</tr>
<tr class="odd">
<td><code>tm_credits()</code></td>
<td>Adds an inset text field to provide map source information or other notes</td>
</tr>
<tr class="even">
<td><code>tm_graticules()</code> and <code>tm_grid()</code></td>
<td>Add coordinate grid or graticule lines to map</td>
</tr>
<tr class="odd">
<td><code>tm_logo()</code></td>
<td>Add a user-defined logo to a map</td>
</tr>
</tbody>
</table>
<p>Here is an extremely busy map with too many elements, illustrating these features:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="intro-tmap.html#cb426-1"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb426-2"><a href="intro-tmap.html#cb426-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>,</span>
<span id="cb426-3"><a href="intro-tmap.html#cb426-3"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb426-4"><a href="intro-tmap.html#cb426-4"></a>          <span class="dt">palette =</span> <span class="st">&#39;BuPu&#39;</span>,</span>
<span id="cb426-5"><a href="intro-tmap.html#cb426-5"></a>          <span class="dt">title =</span> <span class="st">&#39;Deaths per 100,000, </span><span class="ch">\n</span><span class="st">2017&#39;</span>,</span>
<span id="cb426-6"><a href="intro-tmap.html#cb426-6"></a>          <span class="dt">legend.hist =</span> T) <span class="op">+</span></span>
<span id="cb426-7"><a href="intro-tmap.html#cb426-7"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb426-8"><a href="intro-tmap.html#cb426-8"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">main.title =</span> <span class="st">&#39;Car crash mortality in Georgia&#39;</span>,</span>
<span id="cb426-9"><a href="intro-tmap.html#cb426-9"></a>            <span class="dt">legend.outside =</span> T, </span>
<span id="cb426-10"><a href="intro-tmap.html#cb426-10"></a>            <span class="dt">inner.margins =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span>)) <span class="op">+</span></span>
<span id="cb426-11"><a href="intro-tmap.html#cb426-11"></a><span class="st">  </span><span class="kw">tm_compass</span>(<span class="dt">type =</span> <span class="st">&#39;4star&#39;</span>, </span>
<span id="cb426-12"><a href="intro-tmap.html#cb426-12"></a>             <span class="dt">size =</span> <span class="dv">2</span>,</span>
<span id="cb426-13"><a href="intro-tmap.html#cb426-13"></a>             <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&#39;right&#39;</span>, <span class="st">&#39;top&#39;</span>)) <span class="op">+</span></span>
<span id="cb426-14"><a href="intro-tmap.html#cb426-14"></a><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>, <span class="st">&#39;bottom&#39;</span>)) <span class="op">+</span></span>
<span id="cb426-15"><a href="intro-tmap.html#cb426-15"></a><span class="st">  </span><span class="kw">tm_credits</span>(<span class="st">&#39;Source: Georgia OASIS&#39;</span>) <span class="op">+</span></span>
<span id="cb426-16"><a href="intro-tmap.html#cb426-16"></a><span class="st">  </span><span class="kw">tm_grid</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-391-1.png" width="672" /></p>
</div>
<div id="change-the-global-style-of-a-map" class="section level3" number="16.4.4">
<h3><span class="header-section-number">16.4.4</span> Change the global style of a map</h3>
<p><code>tmap</code> has several pre-defined ‘<em>styles</em>’ or ‘<em>themes</em>’ for maps. While this may not be the strategy you chose for most epidemiologic maps, it is a quick and easy way to achieve a certain ‘<em>feel</em>’ from a map. A style simply means a set of options that are preset (a user can still modify individual elements) to produce a particular look. To see examples of the same global map produced using each of ten different <em>styles</em>, type <code>tmap_style_catalog()</code> into the console. On my computer it took approximately 60-90 seconds to produce ten separate <code>.png</code> files in a sub-folder of my project. You can browse through those to see how styles differ. Two examples are shown here:</p>
<div class="figure"><span id="fig:unnamed-chunk-392"></span>
<img src="images/natural.png" alt="tmap style: Natural" width="50%" />
<p class="caption">
FIGURE 16.1: tmap style: Natural
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-393"></span>
<img src="images/classic.png" alt="tmap style: Classic" width="50%" />
<p class="caption">
FIGURE 16.2: tmap style: Classic
</p>
</div>
</div>
</div>
<div id="making-small-multiple-maps" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Making small-multiple maps</h2>
<p><em>Small multiples</em> refers to the production of multiple maps to be presented <em>as a set</em>. We often desire small multiples as a way to visually compare two or more features when it is not easy to put them both on the same map.</p>
<p>There are three ways to prepare small multiples in <code>tmap</code>. As you look at these, notice how they differ with respect to the number of legends produced, the range of the legends, and the content or flexibility of customization <em>within</em> and <em>between</em> map panels.</p>
<div id="small-multiples-as-a-vector-of-variables" class="section level3" number="16.5.1">
<h3><span class="header-section-number">16.5.1</span> Small multiples as a vector of variables</h3>
<p>To plot side-by-side maps of two or more variables from the same spatial object, simply call a vector of variable names when specifying the <em>layer</em> or symbolization.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="intro-tmap.html#cb427-1"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span><span class="st"> </span></span>
<span id="cb427-2"><a href="intro-tmap.html#cb427-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="kw">c</span>(<span class="st">&#39;MVCRATE_05&#39;</span>, <span class="st">&#39;MVCRATE_17&#39;</span>),</span>
<span id="cb427-3"><a href="intro-tmap.html#cb427-3"></a>          <span class="dt">palette =</span> <span class="st">&#39;Purples&#39;</span>,</span>
<span id="cb427-4"><a href="intro-tmap.html#cb427-4"></a>          <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb427-5"><a href="intro-tmap.html#cb427-5"></a>          <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">&#39;Mortality, 2005&#39;</span>, <span class="st">&#39;Mortality, 2017&#39;</span>)) <span class="op">+</span></span>
<span id="cb427-6"><a href="intro-tmap.html#cb427-6"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb427-7"><a href="intro-tmap.html#cb427-7"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">inner.margins =</span> <span class="kw">c</span>(<span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>),</span>
<span id="cb427-8"><a href="intro-tmap.html#cb427-8"></a>            <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&#39;right&#39;</span>, <span class="st">&#39;top&#39;</span>))</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-394-1.png" width="672" /></p>
</div>
<div id="tmap-facet" class="section level3" number="16.5.2">
<h3><span class="header-section-number">16.5.2</span> Small multiples with facets</h3>
<p>Facet plotting is something common in the package <code>ggplot2</code>. It refers to the production of two or more plot figures stratified by a ‘grouping’ variable. Typically in facet plots from <code>ggplot2</code>, the scale of the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axis are held constant across the set of plots so that the values plotted are readily comparable.</p>
<p>In <code>tmap</code>, facet plotting means creating multiple map plots that are distinguished by slicing or stratifying the spatial units along some <code>by</code> group. Faceting can be useful for highlighting patterns among different sub-groups in your spatial data. Unlike <code>ggplot2</code>, the scale of the legend and bounds of the x, y coordinate extent are <strong>not</strong> enforced to be the same across all panel maps by default. Instead the min/max x, y coordinates can vary according to the scope of content in each panel (e.g. by default, <code>free.coords = T</code>). By default the range and cut-points of the legend are held constant across maps (e.g. a single legend is produced to represent the data in all maps).</p>
<p>If you would like to force consistency between panels (e.g. either for better contextualization or for comparability), that can be specified. Argument <code>free.coords = FALSE</code> (e.g. each map should <strong>NOT</strong> have its own min/max x, y coordinate range) and <code>free.scale=FALSE</code> (e.g. each map should <strong>NOT</strong> have its own spatial scale or ‘zoom’ appropriate to the contents of that panel).</p>
<p>Here is a strange facet map produced by stratifying on the NCHS urban/rural six-level categorization scheme. First I have code for what happens <em>by default</em>, and then with setting the <code>free.coords</code> and <code>free.scales</code> to <code>FALSE</code>. You can see that by default, each map frame <em>zooms</em> to maximize the selected object, so the scale is different in each. In contrast when forced to maintain a constant scale it is easier to see the relative size and locations of each subset.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="intro-tmap.html#cb428-1"></a><span class="co"># Basic facet map with defaults</span></span>
<span id="cb428-2"><a href="intro-tmap.html#cb428-2"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb428-3"><a href="intro-tmap.html#cb428-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>) <span class="op">+</span></span>
<span id="cb428-4"><a href="intro-tmap.html#cb428-4"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb428-5"><a href="intro-tmap.html#cb428-5"></a><span class="st">  </span><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&#39;nchs_code&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-395-1.png" width="672" /></p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="intro-tmap.html#cb429-1"></a><span class="co"># With facet parameters set to FALSE</span></span>
<span id="cb429-2"><a href="intro-tmap.html#cb429-2"></a><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb429-3"><a href="intro-tmap.html#cb429-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_17&#39;</span>) <span class="op">+</span></span>
<span id="cb429-4"><a href="intro-tmap.html#cb429-4"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb429-5"><a href="intro-tmap.html#cb429-5"></a><span class="st">  </span><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&#39;nchs_code&#39;</span>, <span class="dt">free.coords =</span> <span class="ot">FALSE</span>, <span class="dt">free.scales =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-395-2.png" width="672" /></p>
</div>
<div id="facets-for-time-series" class="section level3" number="16.5.3">
<h3><span class="header-section-number">16.5.3</span> Facets for time-series</h3>
<p><strong>How small multiples from <em>vector-of-variables</em> and <em>facets</em> differ:</strong></p>
<p>One point, which might not be obvious at first, that distinguishes these first two methods of small multiple map productions is how they use data to separate maps. Notice that the first option above (supplying a vector of variables to plot using the <code>c()</code> call within <code>tm_fill()</code> for example) is good for mapping things that <strong>are wide in your data</strong>. In other words it maps separate <strong>columns</strong> as different maps.</p>
<p>In contrast the <code>tm_facets()</code> creates separate maps by stratifying <strong>rows</strong> of data. In other words it is good for mapping things that <strong>are long in your data</strong>. If you are not used to the idea of <em>long</em> versus <em>wide</em> data this might seem confusing, but its a relatively common distinction in data handling.</p>
<p>An extension of this idea is that if you wanted to map a time-series (e.g. maps of disease rates each year over a series of years), you could create a <em>long</em> dataset by year. Imagine a dataset with a row of data for every county in Year 1; then a separate dataset with a row of data for every county in Year 2; and so on. By <em>stacking</em> these datasets your dataset becomes as long as the number of geographic units <strong>X</strong> the number of years. You could not do this easily in ArcGIS, but it is perfectly allowable with <code>sf</code> class spatial objects. When plotting, simply use <code>tm_facets()</code> with <code>by = YEAR</code> to produce your series.</p>
<p>Here is an example of taking our current ‘wide’ dataset (e.g. we currently have 3 years in separate columns), and making it a long dataset (e.g. a single column for <code>MVCRATE</code>, and a separate column for <code>year</code> to distinguish which year-rate we are talking about). Then we produce time-series faceted maps. In this case we use the <code>tidy</code> functionality of the <code>pivot_*</code> verbs (e.g. read more about use of <a href="dplyr.html#pivot_">pivot verbs here</a>)</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="intro-tmap.html#cb430-1"></a><span class="kw">nrow</span>(mvc) <span class="co"># N = 159 rows corresponds to N=159 Georgia counties</span></span></code></pre></div>
<pre><code>## [1] 159</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="intro-tmap.html#cb432-1"></a>mvc_long &lt;-<span class="st"> </span>mvc <span class="op">%&gt;%</span></span>
<span id="cb432-2"><a href="intro-tmap.html#cb432-2"></a><span class="st">  </span><span class="kw">select</span>(GEOID, NAME, MVCRATE_<span class="dv">05</span>, MVCRATE_<span class="dv">14</span>, MVCRATE_<span class="dv">17</span>) <span class="op">%&gt;%</span></span>
<span id="cb432-3"><a href="intro-tmap.html#cb432-3"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb432-4"><a href="intro-tmap.html#cb432-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">starts_with</span>(<span class="st">&quot;MVCRATE&quot;</span>),</span>
<span id="cb432-5"><a href="intro-tmap.html#cb432-5"></a>               <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb432-6"><a href="intro-tmap.html#cb432-6"></a>               <span class="dt">values_to =</span> <span class="st">&quot;mvc_rate&quot;</span>,</span>
<span id="cb432-7"><a href="intro-tmap.html#cb432-7"></a>               <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb432-8"><a href="intro-tmap.html#cb432-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="dv">2000</span> <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(year)) <span class="op">%&gt;%</span></span>
<span id="cb432-9"><a href="intro-tmap.html#cb432-9"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span>
<span id="cb432-10"><a href="intro-tmap.html#cb432-10"></a><span class="kw">nrow</span>(mvc_long) <span class="co"># N =477 rows corresponds to 3 years each for N =159 counties  </span></span></code></pre></div>
<pre><code>## [1] 477</code></pre>
<p>Now, plot that <em>long</em> <code>sf</code> object ignoring the fact that there are three rows of data for every county. Can you tell what happens?</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="intro-tmap.html#cb434-1"></a><span class="co"># This is the WRONG way to plot a long dataset!</span></span>
<span id="cb434-2"><a href="intro-tmap.html#cb434-2"></a><span class="kw">tm_shape</span>(mvc_long) <span class="op">+</span></span>
<span id="cb434-3"><a href="intro-tmap.html#cb434-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE&#39;</span>) <span class="op">+</span></span>
<span id="cb434-4"><a href="intro-tmap.html#cb434-4"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-397-1.png" width="672" /></p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="intro-tmap.html#cb435-1"></a><span class="co"># If you want a single map from a long dataset, use the subset() function ...</span></span>
<span id="cb435-2"><a href="intro-tmap.html#cb435-2"></a><span class="kw">tm_shape</span>(<span class="kw">subset</span>(mvc_long, year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>)) <span class="op">+</span></span>
<span id="cb435-3"><a href="intro-tmap.html#cb435-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE&#39;</span>) <span class="op">+</span></span>
<span id="cb435-4"><a href="intro-tmap.html#cb435-4"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-397-2.png" width="672" /></p>
<p>Notice how both maps above are the same? Try changing the <code>YEAR == 2017</code> to a different year. You can see that when we ignored the <em>long</em> format, <code>tmap</code> essentially plotted the Georgia counties 3 times, with the <strong>last layer</strong> (e.g. 2017) being <strong>on top</strong> and thus the one we see. So beware…</p>
<p>Now let’s take advantage of the <strong>long format</strong> dataset to <em>facet</em> or sub-divide the dataset into separate maps as delineated by the <code>year</code> variable:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="intro-tmap.html#cb436-1"></a><span class="kw">tm_shape</span>(mvc_long) <span class="op">+</span></span>
<span id="cb436-2"><a href="intro-tmap.html#cb436-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb436-3"><a href="intro-tmap.html#cb436-3"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb436-4"><a href="intro-tmap.html#cb436-4"></a><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&#39;year&#39;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-398-1.png" width="672" /></p>
</div>
</div>
<div id="small-multiples-with-tmap_arrange" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> Small multiples with <code>tmap_arrange()</code></h2>
<p>The third way to make small multiples, and one that gives maximum control over each separate panel, is to create them one at a time, and then combining them into a panel using the function <code>tmap_arrange()</code>. The notable difference here is that we <em>name</em> each map object as we create it, and then provide the list of names to <code>tmap_arrange()</code>.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="intro-tmap.html#cb437-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(mvc) <span class="op">+</span></span>
<span id="cb437-2"><a href="intro-tmap.html#cb437-2"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE_05&#39;</span>) <span class="op">+</span></span>
<span id="cb437-3"><a href="intro-tmap.html#cb437-3"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span>
<span id="cb437-4"><a href="intro-tmap.html#cb437-4"></a></span>
<span id="cb437-5"><a href="intro-tmap.html#cb437-5"></a>m2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(trauma) <span class="op">+</span></span>
<span id="cb437-6"><a href="intro-tmap.html#cb437-6"></a><span class="st">  </span><span class="kw">tm_symbols</span>(<span class="dt">shape =</span> <span class="st">&#39;LEVEL&#39;</span>,</span>
<span id="cb437-7"><a href="intro-tmap.html#cb437-7"></a>             <span class="dt">col =</span> <span class="st">&#39;LEVEL&#39;</span>)</span>
<span id="cb437-8"><a href="intro-tmap.html#cb437-8"></a></span>
<span id="cb437-9"><a href="intro-tmap.html#cb437-9"></a><span class="kw">tmap_arrange</span>(m1, m2)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-399-1.png" width="672" /></p>
<p>For this example I used two totally different shape objects to illustrate the point that <code>tmap_arrange()</code> is particularly good for combining things that are not simply <strong>wide</strong> or <strong>long</strong> subsets of a single dataset. This approach is also good if you are taking a totally different approach to symbolizing two variables in the same dataset, as it doesn’t assume you are trying to keep anything the same.</p>
</div>
<div id="summarizing-small-multiples" class="section level2" number="16.7">
<h2><span class="header-section-number">16.7</span> Summarizing small multiples</h2>
<p>Small multiples are not a common visualization in GIS software like ArcGIS. To do small multiples there you need to create multiple data frames and manipulate them in Layout view; it is often difficult to get consistent scales, legends, or coordinates.</p>
<p>In <code>R</code>, the idea of faceting is quite common and has much potential for spatial epidemiology, which is why it is emphasized here. Below I summarize some of the overarching differences among the three approaches above for future reference.</p>
<table>
<colgroup>
<col width="15%" />
<col width="34%" />
<col width="22%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Vectors <code>c()</code> of variables</th>
<th><code>tm_facets()</code></th>
<th><code>tmap_arrange()</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Approach</td>
<td>Different map for different columns/variables</td>
<td>Different map for different rows/subsets</td>
<td>Completely independent map images</td>
</tr>
<tr class="even">
<td>Scale or legend</td>
<td>Separate legend for each variable</td>
<td>Choose either single scale across panels, or separate</td>
<td>Each panel independent</td>
</tr>
<tr class="odd">
<td>Coordinates</td>
<td>Same for all variables from same <code>sf</code> object</td>
<td>Option of same or different for each panel</td>
<td>Each panel independent</td>
</tr>
<tr class="even">
<td>Typical use</td>
<td>Quickly view set of variables</td>
<td>Highlight spatial sub-regions</td>
<td>Custom creation of figure</td>
</tr>
</tbody>
</table>
</div>
<div id="saving-maps" class="section level2" number="16.8">
<h2><span class="header-section-number">16.8</span> Saving maps</h2>
<p>Saving maps for use in other programs or applications is important. Images can be saved in the same output formats available in other R image functions. In other words we can save files as <code>.png</code>, <code>.pdf</code>, <code>.jpg</code>, <code>.tiff</code>, etc.</p>
<p>A quick way to do is to use the <em>export</em> button from the plot pane in R studio.</p>
<p>Recall that the way any graphic in <code>R</code> looks is shaped in part by the active <em>graphic device</em>. Your screen plot pane is the default <em>graphic device</em> and things are arranged to look good on your screen. However when you save to a different <em>graphic device</em> (e.g. a <em>jpg</em> device), things might look different. So sometimes you have to do some trial-and-error troubleshooting with the width, height, and dpi options.</p>
<p>To specify the save via code, rather than the export button (which is a good idea in terms of reproducible code!) use <code>tmap_save()</code>. To save the final two-panel map I created from the previous step I could do this:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="intro-tmap.html#cb438-1"></a><span class="co"># First make it an object by giving it a name, m3</span></span>
<span id="cb438-2"><a href="intro-tmap.html#cb438-2"></a>m3 &lt;-<span class="st"> </span><span class="kw">tmap_arrange</span>(m1, m2)</span>
<span id="cb438-3"><a href="intro-tmap.html#cb438-3"></a></span>
<span id="cb438-4"><a href="intro-tmap.html#cb438-4"></a><span class="kw">tmap_save</span>(m3, <span class="dt">filename =</span> <span class="st">&#39;mvc_maps.png&#39;</span>)</span></code></pre></div>
<p>You should now have the skills to make a wide variety of maps in <code>R</code>. To fine-tune how <code>tmap</code> works and to customize for each desired purpose, you will likely spend a lot of time looking at the help documentation or other online resources. While sometimes tedious, this process of figuring out how to make just the map you want is valuable. With time you will be able to create sophisticated maps quickly and efficiently.</p>

<div id="refs" class="references hanging-indent">
<div>
<p>Brewer, Cynthia A, and Linda Pickle. 2002. “Evaluation of Methods for Classifying Epidemiological Data on Choropleth Maps in Series.” <em>Annals of the Association of American Geographers</em> 92 (4): 662–81. <a href="https://doi.org/10.1111/1467-8306.00310">https://doi.org/10.1111/1467-8306.00310</a>.</p>
</div>
</div>
</div>
</div>







            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mkram01/EPI563-SpatialEPI/edit/master/86-intro-tmap.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["EPI563-SpatialEPI.pdf"],
"toc": {
"collapse": "section",
"toc_depth": 2,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
