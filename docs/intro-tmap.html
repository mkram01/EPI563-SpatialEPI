<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Week 7 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2021</title>
<meta name="author" content="Michael Kramer">
<meta name="description" content="Base-R has capable data visualization and plotting capabilities, but these fall short when doing anything but the most simple maps with spatial data. Many other packages including sp and ggplot2...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="Week 7 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2021">
<meta property="og:type" content="book">
<meta property="og:description" content="Base-R has capable data visualization and plotting capabilities, but these fall short when doing anything but the most simple maps with spatial data. Many other packages including sp and ggplot2...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Week 7 Tips for using tmap | EPI 563: Spatial Epidemiology, Fall 2021">
<meta name="twitter:description" content="Base-R has capable data visualization and plotting capabilities, but these fall short when doing anything but the most simple maps with spatial data. Many other packages including sp and ggplot2...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EPI 563: Spatial Epidemiology, Fall 2021</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">How to use this eBook</a></li>
<li class="book-part">Getting ready…</li>
<li><a class="" href="software-installation.html">Software installation</a></li>
<li><a class="" href="installing-packages-for-this-course.html">Installing packages for this course</a></li>
<li class="book-part">Weekly Modules</li>
<li><a class="" href="locating-spatial-epidemiology.html"><span class="header-section-number">1</span> Locating Spatial Epidemiology</a></li>
<li><a class="" href="cartography-for-epidemiology-i.html"><span class="header-section-number">2</span> Cartography for Epidemiology I</a></li>
<li><a class="" href="cartography-for-epidemiology-ii.html"><span class="header-section-number">3</span> Cartography for Epidemiology II</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="tips-for-reproducibility-in-r.html"><span class="header-section-number">4</span> Tips for reproducibility in R</a></li>
<li><a class="" href="sf-overview.html"><span class="header-section-number">5</span> Tips for working with sf data class</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">6</span> Tips for using dplyr</a></li>
<li><a class="active" href="intro-tmap.html"><span class="header-section-number">7</span> Tips for using tmap</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mkram01/EPI563-SpatialEPI">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="intro-tmap" class="section level1" number="7">
<h1>
<span class="header-section-number">Week 7</span> Tips for using <code>tmap</code><a class="anchor" aria-label="anchor" href="#intro-tmap"><i class="fas fa-link"></i></a>
</h1>
<p>Base-R has capable data visualization and plotting capabilities, but these fall short when doing anything but the most simple maps with spatial data. Many other packages including <code>sp</code> and <code>ggplot2</code> also have functionality specifically optimized for the data visualization needs of the spatial epidemiologist. We will have brief introductions to these and other packages.</p>
<p>But for this semester the workhorse mapping/cartography tool will be the <code>tmap</code> (<em>thematic</em> mapping) package. This package builds on the <em>grammar of graphics</em> logic built into <code>ggplot2</code> where data visualizations are conceived of as a series of layers of information (e.g. axes, plot space, data points, lines, fill, legends, titles, etc) systematically stacked one on top of another. With <code>tmap</code> we start with a spatial object (e.g. a data object of either <code>sf</code> or <code>sp</code> class) and build a visualization by similarly combining or adding together sequential layers.</p>
<p>Once again, we will use data from the motor vehicle crash mortality dataset of Georgia counties (a vector polygon spatial data file), along with information about highways (vector line data file) and trauma centers (vector point data).</p>
<p>First load the package, <code>tmap</code> and browse the help index:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the tmap and sf packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="st">'tmap'</span><span class="op">)</span></code></pre></div>
<p>After seeing the range of functions within <code>tmap</code>, we will import three datasets all stored in the geopackage format to begin visualizing:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import (read) three spatial datasets stored in geopackage format</span>
<span class="va">mvc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">'GA_MVC/ga_mvc.gpkg'</span><span class="op">)</span>
<span class="va">hwy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">'GA_MVC/ga_hwy.gpkg'</span><span class="op">)</span>
<span class="va">trauma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">'GA_MVC/trauma_centers.gpkg'</span><span class="op">)</span></code></pre></div>
<div id="tmap-mode" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> <code>tmap</code> mode<a class="anchor" aria-label="anchor" href="#tmap-mode"><i class="fas fa-link"></i></a>
</h2>
<p>One nice feature of <code>tmap</code> is that it has two <em>modes</em> for plotting maps. You may develop a general preference for one over another, although in my opinion they serve slightly different purposes.</p>
<ol style="list-style-type: decimal">
<li>The <code>plot</code> mode produces conventional <em>static</em> maps that are viewed in the plot pane of R-Studio, or can be saved to a file. These will be the main maps for dissemination in papers, posters, or many presentations.</li>
<li>The <code>view</code> mode is a more interactive plot in an html browser-like window. This mode allows the user to interact with the map including panning, zooming, and clicking on spatial objects to view underlying data. This is great for data exploration, and has extensions for web-served maps. However it is not so useful for any non-web-based dissemination or when you want to control the map.</li>
</ol>
<p>You select the mode with the function <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode()</a></code> and either <code>'plot'</code> or <code>'view'</code> in the parentheses. Note that when you set the mode, all the subsequent maps are in that mode…you must re-submit the <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode()</a></code> call to switch back again. By default, the <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode()</a></code> is <code>'plot'</code>, which means it produces static maps. We will plot some static maps, then switch to ’<code>view'</code> mode to compare.</p>
</div>
<div id="qtm" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Quick maps: <code>qtm()</code><a class="anchor" aria-label="anchor" href="#qtm"><i class="fas fa-link"></i></a>
</h2>
<p>The function <code><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm()</a></code> stands for <strong>Q</strong>uick <strong>T</strong>hematic <strong>M</strong>aps, and provides a step up from the simple <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> functions for quickly plotting spatial objects. The fundamental argument when submitting <code><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm()</a></code> is the name of the object to be plotted.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>This produces the geometry but no other information (note that unlike <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code>, it does not plot a map for every variable!).</p>
<p>To produce a choropleth map (e.g. one in which objects are shaded to represent an underlying statistic or value), simply add the name of the variable.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm</a></span><span class="op">(</span><span class="va">mvc</span>, <span class="st">'MVCRATE_05'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<p>Can you tell how the legend cut-points are determined? We’ll talk about when this matters and how to change it later.</p>
<p>Now try switching <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode()</a></code>:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">'view'</span><span class="op">)</span></code></pre></div>
<p>Try these things in <code>view</code> mode:</p>
<ul>
<li>By default it will be visible in your R Studio Viewer pane; there is an icon with a screen and arrow that allows you to show in new window…do this so it is bigger</li>
<li>Zoom in and out</li>
<li>Pan</li>
<li>Hover over counties (what do you see with hovering?)</li>
<li>Click on counties (what do you see when you click?)</li>
<li>Underneath the zoom + / - is an icon like a stack of papers. This changes the background map (how does the background information change as you zoom in/out?)</li>
<li>Click on icon that looks like stack of pages. This lets you change the background map (assuming you are currently connected to internet)</li>
</ul>
<p>To change back (if you like) do this:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">'plot'</span><span class="op">)</span></code></pre></div>
<div id="customizing-qtm-for-polygons" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Customizing <code>qtm()</code> for polygons<a class="anchor" aria-label="anchor" href="#customizing-qtm-for-polygons"><i class="fas fa-link"></i></a>
</h3>
<p>For polygon data, you might like to control several features including the title, the color palette, and the style by which the continuous variables are categorized in the legend.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm</a></span><span class="op">(</span><span class="va">mvc</span>,
    fill <span class="op">=</span> <span class="st">'MVCRATE_17'</span>, 
    fill.style <span class="op">=</span> <span class="st">'quantile'</span>, 
    fill.palette <span class="op">=</span> <span class="st">'YlGnBu'</span>,
    fill.title <span class="op">=</span> <span class="st">'MVC Mortality \n(2017)'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>The syntax above customizes the original plot in several ways:</p>
<ul>
<li>By changing the <code>fill.style</code> (which is the style by which continuous variables are categorized in order to plot in a sequential ramp choropleth map) from the default (fixed or equal intervals) to a quantile style (by default quantiles have <span class="math inline">\(n=5\)</span> so they are <em>quintiles</em> although other schemes including <em>tertiles</em> or <em>quartiles</em> are possible also)</li>
<li>By choosing a custom color palette, in this case the Yellow-Green-Blue (<code>YlGnBu</code>) palette, which is one of several built-in options.</li>
<li>Providing a more informative title to the legend, rather than the default variable name.</li>
</ul>
<div class="rmdnote">
<p>Notice the label for the legend in the code above has “/n” inserted in the middle of the line. The use of the forward slash creates what is called an <em>escape character</em>. In this case “/n” inside of a character string inserts a line break. That is why “(2017)” is not on the same line as “MVC Mortality.”</p>
</div>
</div>
<div id="customizing-qtm-for-lines" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Customizing <code>qtm()</code> for lines<a class="anchor" aria-label="anchor" href="#customizing-qtm-for-lines"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm()</a></code> (and <code>tmap</code> generally) can also handle other types of spatial data including line shape objects, and can provide some customization of the results. Try these for the highway dataset:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm</a></span><span class="op">(</span><span class="va">hwy</span>, 
    lines.lwd <span class="op">=</span> <span class="fl">2</span>, 
    lines.col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>The basic plot of highways uses default colors and sizes, but the plot here uses the <code>lines.lwd=</code> argument to specify the <strong>line width</strong> or thickness. The <code>lines.col=</code> sets the color.</p>
</div>
<div id="customizing-qtm-for-points" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> Customizing <code>qtm()</code> for points<a class="anchor" aria-label="anchor" href="#customizing-qtm-for-points"><i class="fas fa-link"></i></a>
</h3>
<p>And not surprisingly, there is similar control for point spatial objects, in this case the locations of the trauma centers.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm</a></span><span class="op">(</span><span class="va">trauma</span>,
    symbols.size <span class="op">=</span> <span class="st">'LEVEL_number'</span>, 
    symbols.shape <span class="op">=</span> <span class="st">'LEVEL'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
<p>Because <code>symbols.size</code> and <code>symbols.shape</code> were specified, the symbolized variables by modifying the size and shape. There are also settings for color. If you study the help documentation, notice that some arguments require numbers (and thus use <code>LEVEL_number</code> which is an integer) and some allow character/factors (and thus use <code>LEVEL</code>).</p>
</div>
<div id="finding-valid-color-options" class="section level3" number="7.2.4">
<h3>
<span class="header-section-number">7.2.4</span> Finding valid color options<a class="anchor" aria-label="anchor" href="#finding-valid-color-options"><i class="fas fa-link"></i></a>
</h3>
<p>In base R there are many ways to specify colors including using standardized character strings, as well as HEX codes which are complicated alphanumeric labels that are used across industries to identify unique colors. Here is one of many lists of base-R color names: <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" class="uri">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a></p>
<p>However for mapping we often want not just single colors, but reasonable sets of colors for symbolizing sequential values, categorical values, or diverging values. In the coming weeks we will talk about how to choose color and style for symbolizing maps. There are several sources for finding effective color palettes for spatial mapping. One of the best resources for choosing a color palette iw the <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">Color Brewer website</a>.</p>
<p>Another source of color palettes is actually built right into the <code>tmap</code> package (or actually it is part of an add-on package you installed called <code>tmaptools</code>). This tool is actually directly derived from the <em>Color Brewer</em> site above, but helps make it clear how to name palettes in <code>tmap</code>.</p>
<div class="rmdcaution">
<p>Occasionally this next step has caused my session of R to crash. Therefore I usually open a <em>second instance</em> of R Studio just to do the next thing. To do that simply go to <strong>Session</strong> in the R Studio menu and click <strong>New Session</strong>. This creates another completely independent instance of R Studio (e.g. none of the packages or data loaded in this current session are present in the new session unless you specify them).</p>
</div>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tmaptools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmaptools/man/palette_explorer.html">palette_explorer</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p>Why did we use the package name (<code>tmaptools</code>) followed by a double colon (<code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code>)? This is a shortcut in <code>R</code> that lets you call a single function from a package without loading the package. Basically this says <em>“go look in the package called <code>tmaptools</code> and load this specified function”</em>. I use this shortcut (in general, not only for <code>tmaptools</code>) in one of two situations:</p>
<ul>
<li>There is a function with the same name in two or more packages, and specifying which package identifies the one I mean. For instance we will soon learn the package <code>dplyr</code> and the function <code>select()</code> in this package is also the name of a function in another package for handling spatial data called <code>raster</code>. So I often use <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> to disambiguate.</li>
<li>In situations like <code><a href="https://rdrr.io/pkg/tmaptools/man/palette_explorer.html">tmaptools::palette_explorer()</a></code> where I really only need the one function but currently do not need anything else from the package.</li>
</ul>
</div>
<p>As you may discover with experimentation, the <code><a href="https://rdrr.io/pkg/tmaptools/man/palette_explorer.html">tmaptools::palette_explorer()</a></code> function is actually a small interactive <em>app</em> that opens in a new window and lets you see an array of color palettes. You can see them divided by <em>sequential</em>, <em>divergent</em>, and <em>categorical</em> color ramps and you can move the slider to change how many categories and see the color ranges. The thing you want from this explorer is the abbreviated names to the left of each color ramp.</p>
</div>
</div>
<div id="building-maps-with-tmap" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Building maps with <code>tmap</code><a class="anchor" aria-label="anchor" href="#building-maps-with-tmap"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm()</a></code> is great for quickly making a map, but when you want more control over the map, you will want to shift to the full functions of <code>tmap</code>.</p>
<div id="building-blocks-in-tmap" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Building blocks in <code>tmap</code><a class="anchor" aria-label="anchor" href="#building-blocks-in-tmap"><i class="fas fa-link"></i></a>
</h3>
<p><code>tmap</code> produces maps using the <em>grammar of graphics</em> approach which means building up a final product as the ‘sum’ of several fundamental components, plus possible options layers. There are three fundamental components of maps in <code>tmap</code>:</p>
<ol style="list-style-type: decimal">
<li>Specify the spatial object to map using <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code>.</li>
<li>Following the call to <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code> you generally specify the <em>layers</em> you wish to symbolize or map. In other words specifying a shape doesn’t plot anything…it just is the starting point. The <em>layers</em> are the actual things from that object/shape to plot. In the case of polygons you will usually use <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> to specify a layer about the fill of the polygon, although other layers are available (e.g. see the <em>base</em> and <em>derived</em> layers listed when you look at <code><a href="https://rdrr.io/pkg/tmap/man/tmap-package.html">help('tmap')</a></code>).</li>
<li>Finally, in many instances you want to customize other map layout features, such as the title or the legend, and you might like to add elements such as a North arrow or a scale bar.</li>
</ol>
<p>For a given map, the various layers or steps are connected together in <code>R</code> code with a plus sign (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>); this highlights that a map is the <strong>sum</strong> of many parts.</p>
<div class="rmdnote">
<p><strong>NOTE</strong>: the use of the pipe (<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>) and the plus (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>) is seemingly the same in that they both connect steps together but they are not! It is perhaps unfortunate that <code>ggplot2</code> and <code>tmap</code> do not use the same pipe as <code>dplyr</code>. Beware that you choose the correct connector for the function at hand!</p>
<p>The pipe (<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>) links together <em>separate functions</em>. In contrast the plus (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>) in <code>tmap</code> or <code>ggplot2</code> add sub-parts or instructions to the main function being called.</p>
</div>
<p>Note that steps 1 and 2 can be repeated for as many spatial objects as you wish to layer. So if you wanted to put points and lines on top of a polygon shape, you would specify <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code> and the corresponding layers for each spatial object in turn.</p>
<p>This code replicates our first map with <code><a href="https://rdrr.io/pkg/tmap/man/qtm.html">qtm()</a></code>, and basically says, "Start with the object <code>mvc</code> and symbolize it with two layers: the first fills the polygons to represent <code>MVCRATE_17</code> and the second adds polygon borders:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<p>Look at the help documentation for <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> to see the myriad ways you can customize this map! It’s a little overwhelming, but I’d suggest looking at the <code>style</code> and <code>palette</code> arguments, and using the above-mentioned <code>palette_explorer()</code> to try out different colors and different styles for cut-points.</p>
</div>
<div id="customizing-text-on-maps" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Customizing text on maps<a class="anchor" aria-label="anchor" href="#customizing-text-on-maps"><i class="fas fa-link"></i></a>
</h3>
<p>There are several ways you may wish to customize the text on maps. For example you may want to provide a name for the legend, new labels for the categories, or a title, subtitle or caption for the whole map.</p>
<ul>
<li>To give a title to the legend in a map use the <code>title = 'xxx'</code> in the <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> (or other layer function) call.</li>
<li>To change the labels of the legend</li>
<li>To add a source or credits annotation</li>
</ul>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># First, I create a vector of my custom legend labels</span>
  <span class="co"># (note, there must be same number of labels as there are categories in map)</span>
<span class="va">myLabels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Low (Q1)'</span>, <span class="st">'Q2'</span>, <span class="st">'Q3'</span>, <span class="st">'Q4'</span>, <span class="st">'Hi (Q5)'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          title <span class="op">=</span> <span class="st">'MVC Rate in 2017'</span>,
          n <span class="op">=</span> <span class="fl">5</span>, 
          labels <span class="op">=</span> <span class="va">myLabels</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Motor Vehicle Crashes per capita in Georgia'</span>,
          legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">'Source: Georgia OASIS, retrieved 2019'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<div class="rmdnote">
<p>The <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> option creates 5 bins or categories for plotting <em>by default</em>. For that reason it was unnecessary for me to put <code>n = 5</code> to specify how many categories. However I did so to be <em>explicit</em> about the number of categories because I am provide a vector of 5 labels to correspond to the categories. Of course one could choose a non-default number of categories (e.g. <code>n = 3</code> or <code>n = 7</code>), and if custom labels are provided there should be as many labels as categories.</p>
</div>
</div>
<div id="adding-two-or-more-spatial-objects-in-one-map" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Adding two or more spatial objects in one map<a class="anchor" aria-label="anchor" href="#adding-two-or-more-spatial-objects-in-one-map"><i class="fas fa-link"></i></a>
</h3>
<p>Just like in ArcGIS, additional spatial layers can be added up to produce a more informative map. For instance if we were interested in how highways and trauma centers related to motor vehicle mortality rates we could add these layers.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          palette <span class="op">=</span> <span class="st">'Purples'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_bubbles</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">'LEVEL'</span>,
             col <span class="op">=</span> <span class="st">'pink'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<p>Several things to note about above code:</p>
<ol style="list-style-type: decimal">
<li>There are three separate spatial objects plotted, and each is called by starting with <code><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape()</a></code> followed by some additional function <em>specific to the layer</em>. See the help documentation, or the Tenekes article on Canvas for a table of which layers are available for which kinds of shapes (e.g. polygons, points, or lines).</li>
<li>Each step or added feature (e.g. each call with parentheses) is connected together with plus signs</li>
<li>Within each step (e.g. <em>within the parentheses</em>), arguments are separated with commas</li>
<li>I organize my code vertically because I think it makes it more readable than all on one line.</li>
</ol>
<p>Try changing these arguments or try substituting different options!</p>
</div>
</div>
<div id="controlling-layout-and-map-elements" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Controlling layout and map elements<a class="anchor" aria-label="anchor" href="#controlling-layout-and-map-elements"><i class="fas fa-link"></i></a>
</h2>
<p>When the <em>audience</em> for your map is yourself, making it look ‘<em>just right</em>’ may not be critical. However, when you are creating a map to share with colleagues, other stakeholders, or the public, cartographic design is important for effective visual communication.</p>
<p><code>tmap</code> has a wide range of tools to customize the way a single map (or even a set of maps) looks. In fact there are so many that it can feel overwhelming at first. The best advice is to use the <code>help</code> documentation often, and experiment <em>a lot</em>! I will not repeat the help documentation completely, but below I provide some guidance on several common layout needs and options.</p>
<p>Note that the focus of the examples is for <em>static maps</em> presented with <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode('plot')</a></code>. Many of the options behave the same when you are using the interactive <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode('view')</a></code>, but because interactive html plots dynamically resize, some formatting may differ. See <code>?tm_view()</code> for more information on options specific to the interactive mode.</p>
<div id="understanding-the-graphic-space-in-tmap" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> Understanding the graphic space in <code>tmap</code><a class="anchor" aria-label="anchor" href="#understanding-the-graphic-space-in-tmap"><i class="fas fa-link"></i></a>
</h3>
<p>As you will see in the discussion below, there are many tools to adjust the size and position of elements so that they all fit in the way you want, and to accomplish desired graphic layout. But one recurring source of frustration is understanding which parameters move which parts of the graphical space. While it is not apparent, what you see in a plot is really a set of nested plot spaces each with border and margin width control.</p>
<p>To see these you can ‘<em>turn on</em>’ a global option called <code>design.mode</code> using the function <code><a href="https://rdrr.io/pkg/tmap/man/tmap_options.html">tmap_options()</a></code>. What this does is colorize different parts of the plot space, with messaging about the names of each space. This can help you figure out whether you need to control <code>inner.margins</code>, <code>outer.margins</code> or move things from a panel to an overall plot space.</p>
<p>This example uses a two-map plot to illustrate the information returned:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Turn 'on' the design.mode option</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_design_mode.html">tmap_design_mode</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## design.mode: ON</code></pre>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot a map of two rates, side by side (e.g. see small multiples below)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'MVCRATE_05'</span>, <span class="st">'MVCRATE_17'</span><span class="op">)</span>,
          palette <span class="op">=</span> <span class="st">'Purples'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## ----------------aspect ratios------------------------</code></pre>
<pre><code>## | specified (asp argument of tm_layout)          NA |</code></pre>
<pre><code>## | device (yellow)                         1.4000000 |</code></pre>
<pre><code>## | device without outer margins (green)    1.4000000 |</code></pre>
<pre><code>## | facets region (brown)                   1.7278757 |</code></pre>
<pre><code>## | frame (blue)                            0.8639379 |</code></pre>
<pre><code>## | master shape, mvc, (red)                0.8639379 |</code></pre>
<pre><code>## -----------------------------------------------------</code></pre>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># turn off the design.mode unless you want to see it on the next map you plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_design_mode.html">tmap_design_mode</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## design.mode: OFF</code></pre>
<p>As you will see from the text output (which interprets the colors), there are actually several different plot spaces.</p>
<ul>
<li>
<code>device</code> (yellow) means the full extent of your output device, whether that be your screen, a <code>.png</code> or a <code>.pdf</code>
</li>
<li>
<code>outer.margins</code> (indicated by green) shows how far the edges of the plot area are from the edge of the graphic device</li>
<li>
<code>master shape</code> (indicated in red) is the actual plotted map. Below you will see instructions on how to adjusted <code>inner.margins</code>; these margins are the distance between the red area and the blue area. If you want the map to be smaller inside the frame, use <code>inner.margins</code> to shrink the size of the red area</li>
</ul>
</div>
<div id="controlling-map-layout" class="section level3" number="7.4.2">
<h3>
<span class="header-section-number">7.4.2</span> Controlling map layout<a class="anchor" aria-label="anchor" href="#controlling-map-layout"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout()</a></code> controls title, margins, aspect ratio, colors, frame, legend, among many other things. Type <code>?tm_layout()</code> to review the help documentation to see the long list of arguments that you can modify. Arguments via the <code><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout()</a></code> function are incorporated into a map by ‘<em>adding</em>’ (e.g. using the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign) to a <code>tmap</code> object, just as you would add <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> or <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders()</a></code>.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using tm_fill and tm_layout to control layout and text</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          palette <span class="op">=</span> <span class="st">'BuPu'</span>,
          title <span class="op">=</span> <span class="st">'Deaths per 100,000, \n2017'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">'Car crash mortality in Georgia'</span>,
            inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-16-1.png" width="672"></div>
<p><strong>Explaining the code above</strong>:</p>
<p>Aspects of the layout were specified in different steps:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> permits the specification of the <em>title for the legend</em>. Notice the inclusion of <code>\n</code> within the title. As noted above, this is called an <em>escape character</em> and this particular one forces a line break/carriage return, which let me wrap the title of the legend onto two lines</li>
<li>
<code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders()</a></code> is familiar, but use the <code>alpha</code> argument to specify transparency in the borders, resulting in them being lighter in color. <code>alpha</code> is a parameter ranging from 0 (fully transparent, or invisible) to 1 (no transparency). You can use <code>alpha</code> in many different settings; it is useful in some maps with many units (e.g. map of all U.S. counties) to diminish the visual impact of boundaries by using transparency.</li>
<li>
<code><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout()</a></code> is a function with many purposes, but here it does two things: add an overall title to the map, and adjust the spacing inside the frame line so things fit:</li>
<li>
<code>inner.margins</code> controls how big the mapped figure is in relation to the overall frame; using this argument is a way to squish things around so that the legend or other elements fit without bumping into each other.
<ul>
<li>The argument expects a vector of four number going <em>bottom</em>, <em>left</em>, <em>top</em>, <em>right</em>
</li>
<li>The values in the vector of four numbers can each range from 0 to 1, representing a relative amount of space between the <em>map object</em> and the frame. So the use of <code>inner.margins = c(0.02, 0.02, 0.1, 0.2)</code> means that there is very little extra space in the bottom and left (only 0.02 each), but more extra space at the top (0.1) and even more on the right (0.2). I arrived at these values through trial and error necessary to keep the legend from bumping into the map.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adding a histogram to the legend and moving the legend outside of the frame</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          palette <span class="op">=</span> <span class="st">'BuPu'</span>,
          title <span class="op">=</span> <span class="st">'Deaths per 100,000, \n2017'</span>,
          legend.hist <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">'Car crash mortality in Georgia'</span>,
            legend.outside <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
<p><strong>Explaining the code above</strong>:</p>
<p>This code differed in three ways:</p>
<ul>
<li>I used the option to request a histogram to be with the legend, using <code>legend.hist = T</code> in the <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> function</li>
<li>I moved the entire legend <em>outside of the frame</em> by specifying <code>legend.outside = T</code> in the <code><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout()</a></code> function. Note that in addition to shifting the legend outside, you can also control its location by using <code>legend.position</code> (for changing location <em>inside the frame</em>) or <code>legend.outside.position</code> (for controlling position <em>outside the frame</em>).</li>
</ul>
</div>
<div id="adding-map-elements" class="section level3" number="7.4.3">
<h3>
<span class="header-section-number">7.4.3</span> Adding map elements<a class="anchor" aria-label="anchor" href="#adding-map-elements"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, you may wonder how to add map elements like north arrows, scale bars, captions, etc.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="41%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass()</a></code></td>
<td>To add a north arrow or compass rose, use <code><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass()</a></code> and specify <code>type =</code> to include a range of options (see help). The size, position, color, and font information can all be controlled</td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar()</a></code></td>
<td>Create and control a scale bar with options to change the units, position, size, and font</td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits()</a></code></td>
<td>Adds an inset text field to provide map source information or other notes</td>
</tr>
<tr class="even">
<td>
<code><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_graticules()</a></code> and <code><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_grid()</a></code>
</td>
<td>Add coordinate grid or graticule lines to map</td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/pkg/tmap/man/tm_logo.html">tm_logo()</a></code></td>
<td>Add a user-defined logo to a map</td>
</tr>
</tbody>
</table></div>
<p>Here is an extremely busy map with too many elements, illustrating these features:</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          palette <span class="op">=</span> <span class="st">'BuPu'</span>,
          title <span class="op">=</span> <span class="st">'Deaths per 100,000, \n2017'</span>,
          legend.hist <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">'Car crash mortality in Georgia'</span>,
            legend.outside <span class="op">=</span> <span class="cn">T</span>, 
            inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_compass.html">tm_compass</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'4star'</span>, 
             size <span class="op">=</span> <span class="fl">2</span>,
             position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'right'</span>, <span class="st">'top'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'left'</span>, <span class="st">'bottom'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">'Source: Georgia OASIS'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_grid.html">tm_grid</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-18-1.png" width="672"></div>
</div>
<div id="change-the-global-style-of-a-map" class="section level3" number="7.4.4">
<h3>
<span class="header-section-number">7.4.4</span> Change the global style of a map<a class="anchor" aria-label="anchor" href="#change-the-global-style-of-a-map"><i class="fas fa-link"></i></a>
</h3>
<p><code>tmap</code> has several pre-defined ‘<em>styles</em>’ or ‘<em>themes</em>’ for maps. While this may not be the strategy you chose for most epidemiologic maps, it is a quick and easy way to achieve a certain ‘<em>feel</em>’ from a map. A style simply means a set of options that are preset (a user can still modify individual elements) to produce a particular look. To see examples of the same global map produced using each of ten different <em>styles</em>, type <code><a href="https://rdrr.io/pkg/tmap/man/tmap_style_catalogue.html">tmap_style_catalog()</a></code> into the console. On my computer it took approximately 60-90 seconds to produce ten separate <code>.png</code> files in a sub-folder of my project. You can browse through those to see how styles differ. Two examples are shown here:</p>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-19"></span>
<img src="images/natural.png" alt="tmap style: Natural" width="50%"><p class="caption">
FIGURE 7.1: tmap style: Natural
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-20"></span>
<img src="images/classic.png" alt="tmap style: Classic" width="50%"><p class="caption">
FIGURE 7.2: tmap style: Classic
</p>
</div>
</div>
</div>
<div id="making-small-multiple-maps" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Making small-multiple maps<a class="anchor" aria-label="anchor" href="#making-small-multiple-maps"><i class="fas fa-link"></i></a>
</h2>
<p><em>Small multiples</em> refers to the production of multiple maps to be presented <em>as a set</em>. We often desire small multiples as a way to visually compare two or more features when it is not easy to put them both on the same map.</p>
<p>There are three ways to prepare small multiples in <code>tmap</code>. As you look at these, notice how they differ with respect to the number of legends produced, the range of the legends, and the content or flexibility of customization <em>within</em> and <em>between</em> map panels.</p>
<div id="small-multiples-as-a-vector-of-variables" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Small multiples as a vector of variables<a class="anchor" aria-label="anchor" href="#small-multiples-as-a-vector-of-variables"><i class="fas fa-link"></i></a>
</h3>
<p>To plot side-by-side maps of two or more variables from the same spatial object, simply call a vector of variable names when specifying the <em>layer</em> or symbolization.</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'MVCRATE_05'</span>, <span class="st">'MVCRATE_17'</span><span class="op">)</span>,
          palette <span class="op">=</span> <span class="st">'Purples'</span>,
          style <span class="op">=</span> <span class="st">'quantile'</span>,
          title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Mortality, 2005'</span>, <span class="st">'Mortality, 2017'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,
            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'right'</span>, <span class="st">'top'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-21-1.png" width="672"></div>
<div class="rmdnote">
<p>This strategy produced a single map for each variable listed in the vector, and each map has its own unique legend, determined by the breaks of the data for that variable.</p>
</div>
</div>
<div id="tmap-facet" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> Small multiples with facets<a class="anchor" aria-label="anchor" href="#tmap-facet"><i class="fas fa-link"></i></a>
</h3>
<p>Facet plotting is something common in the package <code>ggplot2</code>. It refers to the production of two or more plot figures stratified by a ‘grouping’ variable. Typically in facet plots from <code>ggplot2</code>, the scale of the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axis are held constant across the set of plots so that the values plotted are readily comparable.</p>
<p>In <code>tmap</code>, facet plotting means creating multiple map plots that are distinguished by slicing or stratifying the spatial units along some <code>by</code> group. Faceting can be useful for highlighting patterns among different sub-groups in your spatial data. Unlike <code>ggplot2</code>, the scale of the legend and bounds of the x, y coordinate extent are <strong>not</strong> enforced to be the same across all panel maps by default. Instead the min/max x, y coordinates can vary according to the scope of content in each panel (e.g. by default, <code>free.coords = T</code>).</p>
<p>By default the range and cut-points of the legend are held constant across maps (e.g. <em>a single legend is produced to represent the data in all maps</em>).</p>
<p>If you would like to force consistency between panels (e.g. either for better contextualization or for comparability), that can be specified. Argument <code>free.coords = FALSE</code> (e.g. each map should <strong>NOT</strong> have its own min/max x, y coordinate range) and <code>free.scale=FALSE</code> (e.g. each map should <strong>NOT</strong> have its own spatial scale or ‘zoom’ appropriate to the contents of that panel).</p>
<p>Here is a strange facet map produced by stratifying on the NCHS urban/rural six-level categorization scheme. First I have code for what happens <em>by default</em>, and then with setting the <code>free.coords</code> and <code>free.scales</code> to <code>FALSE</code>. You can see that by default, each map frame <em>zooms</em> to maximize the selected object, so the scale is different in each. In contrast when forced to maintain a constant scale it is easier to see the relative size and locations of each subset.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Basic facet map with defaults</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">'nchs_code'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With facet parameters set to FALSE</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_17'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">'nchs_code'</span>, free.coords <span class="op">=</span> <span class="cn">FALSE</span>, free.scales <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-22-2.png" width="672"></div>
</div>
<div id="facets-for-time-series" class="section level3" number="7.5.3">
<h3>
<span class="header-section-number">7.5.3</span> Facets for time-series<a class="anchor" aria-label="anchor" href="#facets-for-time-series"><i class="fas fa-link"></i></a>
</h3>
<p><strong>How small multiples from <em>vector-of-variables</em> and <em>facets</em> differ:</strong></p>
<p>One point, which might not be obvious at first, that distinguishes these first two methods of small multiple map productions is how they use data to separate maps. Notice that the first option above (supplying a vector of variables to plot using the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> call within <code><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill()</a></code> for example) is good for mapping things that <strong>are wide in your data</strong>. In other words it maps separate <strong>columns</strong> as different maps.</p>
<p>In contrast the <code><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets()</a></code> creates separate maps by stratifying <strong>rows</strong> of data. In other words it is good for mapping things that <strong>are long in your data</strong>. If you are not used to the idea of <em>long</em> versus <em>wide</em> data this might seem confusing, but its a relatively common distinction in data handling.</p>
<p>An extension of this idea is that if you wanted to map a time-series (e.g. maps of disease rates each year over a series of years), you could create a <em>long</em> dataset by year. Imagine a dataset with a row of data for every county in Year 1; then a separate dataset with a row of data for every county in Year 2; and so on. By <em>stacking</em> these datasets your dataset becomes as long as the number of geographic units <span class="math inline">\(\times\)</span> the number of years. You could not do this easily in ArcGIS, but it is perfectly allowable with <code>sf</code> class spatial objects. When plotting, simply use <code><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets()</a></code> with <code>by = YEAR</code> to produce your series.</p>
<p>Here is an example of taking our current ‘wide’ dataset (e.g. we currently have 3 years in separate columns), and making it a long dataset (e.g. a single column for <code>MVCRATE</code>, and a separate column for <code>year</code> to distinguish which year-rate we are talking about). Then we produce time-series faceted maps. In this case we use the <code>tidy</code> functionality of the <code>pivot_*</code> verbs (e.g. read more about use of <a href="dplyr.html#pivot_">pivot verbs here</a>)</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="co"># N = 159 rows corresponds to N=159 Georgia counties</span></code></pre></div>
<pre><code>## [1] 159</code></pre>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mvc_long</span> <span class="op">&lt;-</span> <span class="va">mvc</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">NAME</span>, <span class="va">MVCRATE_05</span>, <span class="va">MVCRATE_14</span>, <span class="va">MVCRATE_17</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"MVCRATE"</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">".value"</span>, <span class="st">"year"</span><span class="op">)</span>,
               values_to <span class="op">=</span> <span class="st">"mvc_rate"</span>,
               names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2000</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mvc_long</span><span class="op">)</span> <span class="co"># N =477 rows corresponds to 3 years each for N =159 counties  </span></code></pre></div>
<pre><code>## [1] 477</code></pre>
<p>Now, plot that <em>long</em> <code>sf</code> object ignoring the fact that there are three rows of data for every county. Can you tell what happens?</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This is the WRONG way to plot a long dataset!</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc_long</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-24-1.png" width="672"></div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If you want a single map from a long dataset, use the subset() function ...</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mvc_long</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2017</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-24-2.png" width="672"></div>
<p>Notice how both maps above are the same? Try changing the <code>YEAR == 2017</code> to a different year. You can see that when we ignored the <em>long</em> format, <code>tmap</code> essentially plotted the Georgia counties 3 times, with the <strong>last layer</strong> (e.g. 2017) being <strong>on top</strong> and thus the one we see. So beware…</p>
<p>Now let’s take advantage of the <strong>long format</strong> dataset to <em>facet</em> or sub-divide the dataset into separate maps as delineated by the <code>year</code> variable:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc_long</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">'year'</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-25-1.png" width="672"></div>
</div>
</div>
<div id="small-multiples-with-tmap_arrange" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Small multiples with <code>tmap_arrange()</code><a class="anchor" aria-label="anchor" href="#small-multiples-with-tmap_arrange"><i class="fas fa-link"></i></a>
</h2>
<p>The third way to make small multiples, and one that gives maximum control over each separate panel, is to create them one at a time, and then combining them into a panel using the function <code><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange()</a></code>. The notable difference here is that we <em>name</em> each map object as we create it, and then provide the list of names to <code><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange()</a></code>.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">mvc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">'MVCRATE_05'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">trauma</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">'LEVEL'</span>,
             col <span class="op">=</span> <span class="st">'LEVEL'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="86-intro-tmap_files/figure-html/unnamed-chunk-26-1.png" width="672"></div>
<p>For this example I used two totally different shape objects to illustrate the point that <code><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange()</a></code> is particularly good for combining things that are not simply <strong>wide</strong> or <strong>long</strong> subsets of a single dataset. This approach is also good if you are taking a totally different approach to symbolizing two variables in the same dataset, as it doesn’t assume you are trying to keep anything the same.</p>
</div>
<div id="summarizing-small-multiples" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Summarizing small multiples<a class="anchor" aria-label="anchor" href="#summarizing-small-multiples"><i class="fas fa-link"></i></a>
</h2>
<p>Small multiples are not a common visualization in GIS software like ArcGIS. To do small multiples there you need to create multiple data frames and manipulate them in Layout view; it is often difficult to get consistent scales, legends, or coordinates.</p>
<p>In <code>R</code>, the idea of faceting is quite common and has much potential for spatial epidemiology, which is why it is emphasized here. Below I summarize some of the overarching differences among the three approaches above for future reference.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="15%">
<col width="34%">
<col width="22%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>Vectors <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> of variables</th>
<th><code><a href="https://rdrr.io/pkg/tmap/man/tm_facets.html">tm_facets()</a></code></th>
<th><code><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange()</a></code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Approach</td>
<td>Different map for different columns/variables</td>
<td>Different map for different rows/subsets</td>
<td>Completely independent map images</td>
</tr>
<tr class="even">
<td>Scale or legend</td>
<td>Separate legend for each variable</td>
<td>Choose either single scale across panels, or separate</td>
<td>Each panel independent</td>
</tr>
<tr class="odd">
<td>Coordinates</td>
<td>Same for all variables from same <code>sf</code> object</td>
<td>Option of same or different for each panel</td>
<td>Each panel independent</td>
</tr>
<tr class="even">
<td>Typical use</td>
<td>Quickly view set of variables</td>
<td>Highlight spatial sub-regions</td>
<td>Custom creation of figure</td>
</tr>
</tbody>
</table></div>
</div>
<div id="saving-maps" class="section level2" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Saving maps<a class="anchor" aria-label="anchor" href="#saving-maps"><i class="fas fa-link"></i></a>
</h2>
<p>Saving maps for use in other programs or applications is important. Images can be saved in the same output formats available in other R image functions. In other words we can save files as <code>.png</code>, <code>.pdf</code>, <code>.jpg</code>, <code>.tiff</code>, etc.</p>
<p>A quick way to do is to use the <em>export</em> button from the plot pane in R studio.</p>
<p>Recall that the way any graphic in <code>R</code> looks is shaped in part by the active <em>graphic device</em>. Your screen plot pane is the default <em>graphic device</em> and things are arranged to look good on your screen. However when you save to a different <em>graphic device</em> (e.g. a <em>jpg</em> device), things might look different. So sometimes you have to do some trial-and-error troubleshooting with the width, height, and dpi options.</p>
<p>To specify the save via code, rather than the export button (which is a good idea in terms of reproducible code!) use <code><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap_save()</a></code>. To save the final two-panel map I created from the previous step I could do this:</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First make it an object by giving it a name, m3</span>
<span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap_save</a></span><span class="op">(</span><span class="va">m3</span>, filename <span class="op">=</span> <span class="st">'mvc_maps.png'</span><span class="op">)</span></code></pre></div>
<p>You should now have the skills to make a wide variety of maps in <code>R</code>. To fine-tune how <code>tmap</code> works and to customize for each desired purpose, you will likely spend a lot of time looking at the help documentation or other online resources. While sometimes tedious, this process of figuring out how to make just the map you want is valuable. With time you will be able to create sophisticated maps quickly and efficiently.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-brewer_evaluation_2002" class="csl-entry">
Brewer, Cynthia A, and Linda Pickle. 2002. <span>“Evaluation of <span>Methods</span> for <span>Classifying</span> <span>Epidemiological</span> <span>Data</span> on <span>Choropleth</span> <span>Maps</span> in <span>Series</span>.”</span> <em>Annals of the Association of American Geographers</em> 92 (4): 662–81. <a href="https://doi.org/10.1111/1467-8306.00310">https://doi.org/10.1111/1467-8306.00310</a>.
</div>
</div>
</div>
</div>






  <div class="chapter-nav">
<div class="prev"><a href="dplyr.html"><span class="header-section-number">6</span> Tips for using dplyr</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#intro-tmap"><span class="header-section-number">7</span> Tips for using tmap</a></li>
<li><a class="nav-link" href="#tmap-mode"><span class="header-section-number">7.1</span> tmap mode</a></li>
<li>
<a class="nav-link" href="#qtm"><span class="header-section-number">7.2</span> Quick maps: qtm()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#customizing-qtm-for-polygons"><span class="header-section-number">7.2.1</span> Customizing qtm() for polygons</a></li>
<li><a class="nav-link" href="#customizing-qtm-for-lines"><span class="header-section-number">7.2.2</span> Customizing qtm() for lines</a></li>
<li><a class="nav-link" href="#customizing-qtm-for-points"><span class="header-section-number">7.2.3</span> Customizing qtm() for points</a></li>
<li><a class="nav-link" href="#finding-valid-color-options"><span class="header-section-number">7.2.4</span> Finding valid color options</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#building-maps-with-tmap"><span class="header-section-number">7.3</span> Building maps with tmap</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#building-blocks-in-tmap"><span class="header-section-number">7.3.1</span> Building blocks in tmap</a></li>
<li><a class="nav-link" href="#customizing-text-on-maps"><span class="header-section-number">7.3.2</span> Customizing text on maps</a></li>
<li><a class="nav-link" href="#adding-two-or-more-spatial-objects-in-one-map"><span class="header-section-number">7.3.3</span> Adding two or more spatial objects in one map</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#controlling-layout-and-map-elements"><span class="header-section-number">7.4</span> Controlling layout and map elements</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#understanding-the-graphic-space-in-tmap"><span class="header-section-number">7.4.1</span> Understanding the graphic space in tmap</a></li>
<li><a class="nav-link" href="#controlling-map-layout"><span class="header-section-number">7.4.2</span> Controlling map layout</a></li>
<li><a class="nav-link" href="#adding-map-elements"><span class="header-section-number">7.4.3</span> Adding map elements</a></li>
<li><a class="nav-link" href="#change-the-global-style-of-a-map"><span class="header-section-number">7.4.4</span> Change the global style of a map</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#making-small-multiple-maps"><span class="header-section-number">7.5</span> Making small-multiple maps</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#small-multiples-as-a-vector-of-variables"><span class="header-section-number">7.5.1</span> Small multiples as a vector of variables</a></li>
<li><a class="nav-link" href="#tmap-facet"><span class="header-section-number">7.5.2</span> Small multiples with facets</a></li>
<li><a class="nav-link" href="#facets-for-time-series"><span class="header-section-number">7.5.3</span> Facets for time-series</a></li>
</ul>
</li>
<li><a class="nav-link" href="#small-multiples-with-tmap_arrange"><span class="header-section-number">7.6</span> Small multiples with tmap_arrange()</a></li>
<li><a class="nav-link" href="#summarizing-small-multiples"><span class="header-section-number">7.7</span> Summarizing small multiples</a></li>
<li><a class="nav-link" href="#saving-maps"><span class="header-section-number">7.8</span> Saving maps</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mkram01/EPI563-SpatialEPI/blob/master/86-intro-tmap.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mkram01/EPI563-SpatialEPI/edit/master/86-intro-tmap.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EPI 563: Spatial Epidemiology, Fall 2021</strong>" was written by Michael Kramer. It was last built on Last updated: 2021-08-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
