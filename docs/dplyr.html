<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 16 Tips for using dplyr | EPI 563: Spatial Epidemiology, Fall 2020</title>
  <meta name="description" content="Week 16 Tips for using dplyr | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 16 Tips for using dplyr | EPI 563: Spatial Epidemiology, Fall 2020" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="mkram01/EPI563-SpatialEPI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 16 Tips for using dplyr | EPI 563: Spatial Epidemiology, Fall 2020" />
  
  
  

<meta name="author" content="Michael Kramer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sf-overview.html"/>
<link rel="next" href="intro-tmap.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>How to use this eBook</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#strategy-for-using-this-ebook"><i class="fa fa-check"></i>Strategy for using this eBook</a></li>
</ul></li>
<li class="part"><span><b>I Getting ready…</b></span></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a>
<ul>
<li><a href="software-installation.html#installing-r-on-your-computer">Installing <code>R</code> on your computer</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#installing-rstudio-on-your-computer"><i class="fa fa-check"></i>Installing RStudio on your computer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html"><i class="fa fa-check"></i>Installing packages for this course</a>
<ul>
<li><a href="installing-packages-for-this-course.html#installing-rtools40">Installing <code>Rtools40</code></a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-general-data-science"><i class="fa fa-check"></i>Installing packages used for general data science</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-use-for-geographic-data"><i class="fa fa-check"></i>Installing packages use for geographic data</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-data-manipulation-visualization"><i class="fa fa-check"></i>Installing packages used for spatial data manipulation &amp; visualization</a></li>
<li class="chapter" data-level="" data-path="installing-packages-for-this-course.html"><a href="installing-packages-for-this-course.html#installing-packages-used-for-spatial-analysis"><i class="fa fa-check"></i>Installing packages used for spatial analysis</a></li>
</ul></li>
<li class="part"><span><b>II Weekly Modules</b></span></li>
<li class="chapter" data-level="1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html"><i class="fa fa-check"></i><b>1</b> Locating Spatial Epidemiology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>1.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#learning-objectives"><i class="fa fa-check"></i><b>1.1.1</b> Learning objectives</a></li>
<li class="chapter" data-level="1.1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i><b>1.1.2</b> Additional Resources</a></li>
<li class="chapter" data-level="1.1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#important-vocabulary"><i class="fa fa-check"></i><b>1.1.3</b> Important Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>1.2</b> Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="1.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>1.3</b> Spatial Analysis in Epidemiology</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#spatial-data-storage-foramts"><i class="fa fa-check"></i><b>1.3.1</b> Spatial data storage foramts</a></li>
<li class="chapter" data-level="1.3.2" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#representing-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.2</b> Representing spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#benefits-of-sf-data-classes"><i class="fa fa-check"></i><b>1.3.3</b> Benefits of <code>sf</code> data classes</a></li>
<li class="chapter" data-level="1.3.4" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-spatial-data-in-r"><i class="fa fa-check"></i><b>1.3.4</b> Working with spatial data in <code>R</code></a></li>
<li class="chapter" data-level="1.3.5" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#basic-visual-inspectionplots"><i class="fa fa-check"></i><b>1.3.5</b> Basic visual inspection/plots</a></li>
<li class="chapter" data-level="1.3.6" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#working-with-crs-and-projection"><i class="fa fa-check"></i><b>1.3.6</b> Working with CRS and projection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html"><i class="fa fa-check"></i><b>2</b> Cartography for Epidemiology I</a>
<ul>
<li class="chapter" data-level="2.1" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#getting-ready"><i class="fa fa-check"></i><b>2.1</b> Getting Ready</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#learning-objectives-w2"><i class="fa fa-check"></i><b>2.1.1</b> Learning objectives, w2</a></li>
<li class="chapter" data-level="2.1.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#additional-resources-w2"><i class="fa fa-check"></i><b>2.1.2</b> Additional Resources, w2</a></li>
<li class="chapter" data-level="2.1.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#important-vocabulary-w2"><i class="fa fa-check"></i><b>2.1.3</b> Important Vocabulary, w2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-thinking-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.2</b> Spatial Thinking in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#color-choices"><i class="fa fa-check"></i><b>2.2.1</b> Color choices</a></li>
<li class="chapter" data-level="2.2.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#choropleth-binning-styles"><i class="fa fa-check"></i><b>2.2.2</b> Choropleth binning styles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#spatial-analysis-in-epidemiology-w2"><i class="fa fa-check"></i><b>2.3</b> Spatial Analysis in Epidemiology, w2</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-numerator-data"><i class="fa fa-check"></i><b>2.3.1</b> Obtaining and preparing numerator data</a></li>
<li class="chapter" data-level="2.3.2" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-denominator-or-contextual-data"><i class="fa fa-check"></i><b>2.3.2</b> Obtaining and preparing denominator or contextual data</a></li>
<li class="chapter" data-level="2.3.3" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#obtaining-and-preparing-geographic-data"><i class="fa fa-check"></i><b>2.3.3</b> Obtaining and preparing geographic data</a></li>
<li class="chapter" data-level="2.3.4" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#merging-attributes-and-geography"><i class="fa fa-check"></i><b>2.3.4</b> Merging Attributes and Geography</a></li>
<li class="chapter" data-level="2.3.5" data-path="cartography-for-epidemiology-i.html"><a href="cartography-for-epidemiology-i.html#mapping-mortality-uninsured"><i class="fa fa-check"></i><b>2.3.5</b> Mapping Mortality &amp; Uninsured</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html"><i class="fa fa-check"></i><b>3</b> Cartography for Epidemiology II</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#learning-objectives-w3"><i class="fa fa-check"></i><b>3.1</b> Learning objectives, w3</a></li>
<li class="chapter" data-level="3.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#additional-resources-w3"><i class="fa fa-check"></i><b>3.2</b> Additional resources, w3</a></li>
<li class="chapter" data-level="3.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#important-vocabulary-w3"><i class="fa fa-check"></i><b>3.3</b> Important Vocabulary, w3</a></li>
<li class="chapter" data-level="3.4" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#spatial-thinking-in-epidemiology-w3"><i class="fa fa-check"></i><b>3.4</b> Spatial Thinking in Epidemiology, w3</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risks-of-privacy-breaches-in-collection-of-geospatial-information"><i class="fa fa-check"></i><b>3.4.1</b> Risks of privacy breaches in collection of geospatial information</a></li>
<li class="chapter" data-level="3.4.2" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-confidentiality-breaches-through-unintentional-de-identification"><i class="fa fa-check"></i><b>3.4.2</b> Risk of confidentiality breaches through unintentional de-identification</a></li>
<li class="chapter" data-level="3.4.3" data-path="cartography-for-epidemiology-ii.html"><a href="cartography-for-epidemiology-ii.html#risk-of-stigmatization-of-place"><i class="fa fa-check"></i><b>3.4.3</b> Risk of stigmatization of place</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html"><i class="fa fa-check"></i><b>4</b> Disease Mapping I</a>
<ul>
<li class="chapter" data-level="4.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#getting-ready-w4"><i class="fa fa-check"></i><b>4.1</b> Getting ready, w4</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#learning-objectives-w4"><i class="fa fa-check"></i><b>4.1.1</b> Learning objectives, w4</a></li>
<li class="chapter" data-level="4.1.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#additional-resources-w4"><i class="fa fa-check"></i><b>4.1.2</b> Additional Resources, w4</a></li>
<li class="chapter" data-level="4.1.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#important-vocabulary-w4"><i class="fa fa-check"></i><b>4.1.3</b> Important Vocabulary, w4</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-thinking-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.2</b> Spatial Thinking in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#why-do-we-need-disease-mapping"><i class="fa fa-check"></i><b>4.2.1</b> Why do we need disease mapping?</a></li>
<li class="chapter" data-level="4.2.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#using-statistics-and-probability-models-to-improve-disease-mapping"><i class="fa fa-check"></i><b>4.2.2</b> Using statistics and probability models to improve disease mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#spatial-analysis-in-epidemiology-w4"><i class="fa fa-check"></i><b>4.3</b> Spatial Analysis in Epidemiology, w4</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-is-there-spatial-heterogeneity"><i class="fa fa-check"></i><b>4.3.1</b> Disease mapping: Is there spatial heterogeneity?</a></li>
<li class="chapter" data-level="4.3.2" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-how-precise-are-county-estimates"><i class="fa fa-check"></i><b>4.3.2</b> Disease mapping: How precise are county estimates?</a></li>
<li class="chapter" data-level="4.3.3" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-adjusting-for-covariates"><i class="fa fa-check"></i><b>4.3.3</b> Disease mapping: Adjusting for covariates</a></li>
<li class="chapter" data-level="4.3.4" data-path="disease-mapping-i.html"><a href="disease-mapping-i.html#disease-mapping-rate-stabilization-with-global-empirical-bayes"><i class="fa fa-check"></i><b>4.3.4</b> Disease mapping: Rate stabilization with global Empirical Bayes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html"><i class="fa fa-check"></i><b>5</b> Disease Mapping II</a>
<ul>
<li class="chapter" data-level="5.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#getting-ready-w5"><i class="fa fa-check"></i><b>5.1</b> Getting Ready, w5</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#w5-learning-objectives"><i class="fa fa-check"></i><b>5.1.1</b> w5 Learning objectives</a></li>
<li class="chapter" data-level="5.1.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#additional-resources-w5"><i class="fa fa-check"></i><b>5.1.2</b> Additional Resources, w5</a></li>
<li class="chapter" data-level="5.1.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#important-vocabulary-w5"><i class="fa fa-check"></i><b>5.1.3</b> Important Vocabulary, w5</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-thinking-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.2</b> Spatial Thinking in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#an-argument-for-the-relevance-of-space"><i class="fa fa-check"></i><b>5.2.1</b> An argument for the relevance of space</a></li>
<li class="chapter" data-level="5.2.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#on-making-meaning-from-neighbors"><i class="fa fa-check"></i><b>5.2.2</b> On making meaning from neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-analysis-in-epidemiology-w5"><i class="fa fa-check"></i><b>5.3</b> Spatial Analysis in Epidemiology, w5</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-contiguity-neighbor-objects"><i class="fa fa-check"></i><b>5.3.1</b> Creating contiguity neighbor objects</a></li>
<li class="chapter" data-level="5.3.2" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-k-nearest-neighbors"><i class="fa fa-check"></i><b>5.3.2</b> Creating k-nearest neighbors</a></li>
<li class="chapter" data-level="5.3.3" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-graph-based-triangle-neighbor-objects"><i class="fa fa-check"></i><b>5.3.3</b> Creating Graph-based triangle neighbor objects</a></li>
<li class="chapter" data-level="5.3.4" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#creating-fixed-distance-neighbors"><i class="fa fa-check"></i><b>5.3.4</b> Creating fixed-distance neighbors</a></li>
<li class="chapter" data-level="5.3.5" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#from-spatial-neighbors-to-spatial-disease-mapping"><i class="fa fa-check"></i><b>5.3.5</b> From spatial neighbors to spatial Disease Mapping</a></li>
<li class="chapter" data-level="5.3.6" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#spatial-empirical-bayes"><i class="fa fa-check"></i><b>5.3.6</b> Spatial Empirical Bayes</a></li>
<li class="chapter" data-level="5.3.7" data-path="disease-mapping-ii.html"><a href="disease-mapping-ii.html#final-thoughts-making-choices"><i class="fa fa-check"></i><b>5.3.7</b> Final thoughts: Making choices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html"><i class="fa fa-check"></i><b>6</b> Disease Mapping III</a>
<ul>
<li class="chapter" data-level="6.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#getting-ready-w6"><i class="fa fa-check"></i><b>6.1</b> Getting Ready, w6</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#learning-objectives-w6"><i class="fa fa-check"></i><b>6.1.1</b> Learning objectives, w6</a></li>
<li class="chapter" data-level="6.1.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#additional-resources-w6"><i class="fa fa-check"></i><b>6.1.2</b> Additional Resources, w6</a></li>
<li class="chapter" data-level="6.1.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#important-vocabulary-w6"><i class="fa fa-check"></i><b>6.1.3</b> Important Vocabulary, w6</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-thinking-in-epidemiology-w6"><i class="fa fa-check"></i><b>6.2</b> Spatial Thinking in Epidemiology, w6</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#revisiting-spatial-point-processes"><i class="fa fa-check"></i><b>6.2.1</b> Revisiting spatial point processes</a></li>
<li class="chapter" data-level="6.2.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-is-a-kernel-density-estimator"><i class="fa fa-check"></i><b>6.2.2</b> What is a kernel density estimator?</a></li>
<li class="chapter" data-level="6.2.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#limitations-in-kernel-density-estimation"><i class="fa fa-check"></i><b>6.2.3</b> Limitations in kernel density estimation</a></li>
<li class="chapter" data-level="6.2.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#uses-for-kernel-density-estimation-kde-in-spatial-epidemiology"><i class="fa fa-check"></i><b>6.2.4</b> Uses for kernel density estimation (KDE) in spatial epidemiology</a></li>
<li class="chapter" data-level="6.2.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#guide-to-the-rest-of-this-section"><i class="fa fa-check"></i><b>6.2.5</b> Guide to the rest of this section…</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-point-processes"><i class="fa fa-check"></i><b>6.3</b> Spatial Analysis in Epidemiology: Kernel estimation of point processes</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#preparing-packages-and-data"><i class="fa fa-check"></i><b>6.3.1</b> Preparing packages and data</a></li>
<li class="chapter" data-level="6.3.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#introducing-a-new-spatial-data-class-ppp"><i class="fa fa-check"></i><b>6.3.2</b> Introducing a new spatial data class: <code>ppp</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-the-ppp-objects"><i class="fa fa-check"></i><b>6.3.3</b> Creating the <code>ppp</code> objects</a></li>
<li class="chapter" data-level="6.3.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#bandwidth-selection"><i class="fa fa-check"></i><b>6.3.4</b> Bandwidth selection</a></li>
<li class="chapter" data-level="6.3.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-kernel-density-surfaces"><i class="fa fa-check"></i><b>6.3.5</b> Estimating Kernel Density surfaces</a></li>
<li class="chapter" data-level="6.3.6" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-manually"><i class="fa fa-check"></i><b>6.3.6</b> Creating relative risk surface manually</a></li>
<li class="chapter" data-level="6.3.7" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#creating-relative-risk-surface-with-risk-function"><i class="fa fa-check"></i><b>6.3.7</b> Creating relative risk surface with <code>risk()</code> function</a></li>
<li class="chapter" data-level="6.3.8" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#using-functions-to-map-rr-with-tmap"><i class="fa fa-check"></i><b>6.3.8</b> Using functions to map RR with <code>tmap</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#spatial-analysis-in-epidemiology-kernel-estimation-of-areal-data"><i class="fa fa-check"></i><b>6.4</b> Spatial Analysis in Epidemiology: Kernel estimation of areal data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#packages-and-data"><i class="fa fa-check"></i><b>6.4.1</b> Packages and data</a></li>
<li class="chapter" data-level="6.4.2" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#what-bandwidth-for-kernel-density-estimates"><i class="fa fa-check"></i><b>6.4.2</b> What bandwidth for kernel density estimates?</a></li>
<li class="chapter" data-level="6.4.3" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#geographically-weighted-summary-statistics-gwss"><i class="fa fa-check"></i><b>6.4.3</b> Geographically weighted summary statistics: <code>gwss()</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#calculating-pseudo-p-values-for-smoothed-estimates"><i class="fa fa-check"></i><b>6.4.4</b> Calculating pseudo p-values for smoothed estimates</a></li>
<li class="chapter" data-level="6.4.5" data-path="disease-mapping-iii.html"><a href="disease-mapping-iii.html#estimating-geographically-weighted-bivariate-statistics"><i class="fa fa-check"></i><b>6.4.5</b> Estimating geographically-weighted bivariate statistics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html"><i class="fa fa-check"></i><b>7</b> Disease Mapping IV</a>
<ul>
<li class="chapter" data-level="7.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#getting-ready-w7"><i class="fa fa-check"></i><b>7.1</b> Getting Ready, w7</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#learning-objectives-w7"><i class="fa fa-check"></i><b>7.1.1</b> Learning objectives, w7</a></li>
<li class="chapter" data-level="7.1.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#additional-resources-w7"><i class="fa fa-check"></i><b>7.1.2</b> Additional Resources, w7</a></li>
<li class="chapter" data-level="7.1.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#important-vocabulary-w7"><i class="fa fa-check"></i><b>7.1.3</b> Important Vocabulary, w7</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-thinking-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.2</b> Spatial Thinking in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#what-is-bayesian-inference"><i class="fa fa-check"></i><b>7.2.1</b> What is <em>Bayesian Inference</em>?</a></li>
<li class="chapter" data-level="7.2.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#bayesian-inference-in-spatial-epidemiology"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian inference in spatial epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#spatial-analysis-in-epidemiology-w7"><i class="fa fa-check"></i><b>7.3</b> Spatial Analysis in Epidemiology, w7</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>7.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="7.3.2" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#preparing-for-carbayes"><i class="fa fa-check"></i><b>7.3.2</b> Preparing for <code>CARBayes()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#fitting-a-besag-york-mollie-bym-bayesian-model"><i class="fa fa-check"></i><b>7.3.3</b> Fitting a <em>Besag-York-Mollie (BYM)</em> Bayesian model</a></li>
<li class="chapter" data-level="7.3.4" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#summarizing-carbayes-model-output"><i class="fa fa-check"></i><b>7.3.4</b> Summarizing <code>CARBayes</code> model output</a></li>
<li class="chapter" data-level="7.3.5" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#making-inference-from-bayesian-posteriors"><i class="fa fa-check"></i><b>7.3.5</b> Making inference from Bayesian posteriors</a></li>
<li class="chapter" data-level="7.3.6" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#extracting-summaries-for-mapping-or-analysis"><i class="fa fa-check"></i><b>7.3.6</b> Extracting summaries for mapping or analysis</a></li>
<li class="chapter" data-level="7.3.7" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#plot-raw-versus-smoothed"><i class="fa fa-check"></i><b>7.3.7</b> Plot raw versus smoothed</a></li>
<li class="chapter" data-level="7.3.8" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-rates"><i class="fa fa-check"></i><b>7.3.8</b> Mapping rates</a></li>
<li class="chapter" data-level="7.3.9" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#mapping-exceedance-probability"><i class="fa fa-check"></i><b>7.3.9</b> Mapping exceedance probability</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html"><i class="fa fa-check"></i><b>8</b> Spatial Structure and Clustering I</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#getting-ready-w8"><i class="fa fa-check"></i><b>8.1</b> Getting Ready, w8</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#learning-objectives-w8"><i class="fa fa-check"></i><b>8.1.1</b> Learning objectives, w8</a></li>
<li class="chapter" data-level="8.1.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#additional-resources-w8"><i class="fa fa-check"></i><b>8.1.2</b> Additional Resources, w8</a></li>
<li class="chapter" data-level="8.1.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#important-vocabulary-w8"><i class="fa fa-check"></i><b>8.1.3</b> Important Vocabulary, w8</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-thinking-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.2</b> Spatial Thinking in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#two-big-questions"><i class="fa fa-check"></i><b>8.2.1</b> Two big questions…</a></li>
<li class="chapter" data-level="8.2.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#why-does-structure-or-clustering-matter"><i class="fa fa-check"></i><b>8.2.2</b> Why does structure or clustering matter?</a></li>
<li class="chapter" data-level="8.2.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#making-meaning-of-hypotheses-in-spatial-structure-testing"><i class="fa fa-check"></i><b>8.2.3</b> Making meaning of hypotheses in spatial structure testing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#spatial-analysis-in-epidemiology-w8"><i class="fa fa-check"></i><b>8.3</b> Spatial Analysis in Epidemiology, w8</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>8.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="8.3.2" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#global-morans-i"><i class="fa fa-check"></i><b>8.3.2</b> Global Moran’s I</a></li>
<li class="chapter" data-level="8.3.3" data-path="spatial-structure-and-clustering-i.html"><a href="spatial-structure-and-clustering-i.html#local-morans-i"><i class="fa fa-check"></i><b>8.3.3</b> Local Moran’s I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html"><i class="fa fa-check"></i><b>9</b> Spatial Structure and Clustering II</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#getting-ready-w9"><i class="fa fa-check"></i><b>9.1</b> Getting Ready, w9</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#learning-objectives-w9"><i class="fa fa-check"></i><b>9.1.1</b> Learning objectives, w9</a></li>
<li class="chapter" data-level="9.1.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#additional-resources-w9"><i class="fa fa-check"></i><b>9.1.2</b> Additional Resources, w9</a></li>
<li class="chapter" data-level="9.1.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#important-vocabulary-w9"><i class="fa fa-check"></i><b>9.1.3</b> Important Vocabulary, w9</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-thinking-in-epidemiology-conceptual-tools-for-thinking-about-clusters"><i class="fa fa-check"></i><b>9.2</b> Spatial Thinking in Epidemiology: Conceptual tools for thinking about ‘clusters’</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#the-clustering-conundrum"><i class="fa fa-check"></i><b>9.2.1</b> The clustering conundrum</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatial-scan-statistics"><i class="fa fa-check"></i><b>9.3</b> Spatial Scan Statistics</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="disease-mapping-iv.html"><a href="disease-mapping-iv.html#packages-data"><i class="fa fa-check"></i><b>9.3.1</b> Packages &amp; Data</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#overview-of-kulldorff-nagarwalla-scan-statistic"><i class="fa fa-check"></i><b>9.3.2</b> Overview of <em>Kulldorff &amp; Nagarwalla</em> scan statistic</a></li>
<li class="chapter" data-level="9.3.3" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#spatio-temporal-scan-statistics"><i class="fa fa-check"></i><b>9.3.3</b> Spatio-temporal scan statistics</a></li>
<li class="chapter" data-level="9.3.4" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatial-only-kulldorff-scan-statistics"><i class="fa fa-check"></i><b>9.3.4</b> Estimating <em>spatial-only</em> Kulldorff scan statistics</a></li>
<li class="chapter" data-level="9.3.5" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#estimating-spatio-temporal-kuldorff-scan-statistic"><i class="fa fa-check"></i><b>9.3.5</b> Estimating <em>spatio-temporal</em> Kuldorff scan statistic</a></li>
<li class="chapter" data-level="9.3.6" data-path="spatial-structure-and-clustering-ii.html"><a href="spatial-structure-and-clustering-ii.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.3.6</b> Concluding thoughts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html"><i class="fa fa-check"></i><b>10</b> Spatial Regression I</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#getting-ready-w10"><i class="fa fa-check"></i><b>10.1</b> Getting Ready, w10</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#learning-objectives-w10"><i class="fa fa-check"></i><b>10.1.1</b> Learning objectives, w10</a></li>
<li class="chapter" data-level="10.1.2" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#additional-resources-w10"><i class="fa fa-check"></i><b>10.1.2</b> Additional Resources, w10</a></li>
<li class="chapter" data-level="10.1.3" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#important-vocabulary-w10"><i class="fa fa-check"></i><b>10.1.3</b> Important Vocabulary, w10</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#multivariable-regression-for-exploring-spatial-data"><i class="fa fa-check"></i><b>10.2</b> Multivariable regression for exploring spatial data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#data-generating-process"><i class="fa fa-check"></i><b>10.2.1</b> Data Generating Process</a></li>
<li class="chapter" data-level="10.2.2" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#model-residuals-are-not-just-mistakes"><i class="fa fa-check"></i><b>10.2.2</b> Model residuals are not just mistakes</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#spatializing-aspatial-regression"><i class="fa fa-check"></i><b>10.3</b> Spatializing aspatial regression</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#data-packages"><i class="fa fa-check"></i><b>10.3.1</b> Data &amp; Packages</a></li>
<li class="chapter" data-level="10.3.2" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#fitting-unconditional-empty-model"><i class="fa fa-check"></i><b>10.3.2</b> Fitting unconditional (empty) model</a></li>
<li class="chapter" data-level="10.3.3" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#fitting-conditional-model"><i class="fa fa-check"></i><b>10.3.3</b> Fitting conditional model</a></li>
<li class="chapter" data-level="10.3.4" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#mapping-residuals"><i class="fa fa-check"></i><b>10.3.4</b> Mapping residuals</a></li>
<li class="chapter" data-level="10.3.5" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#morans-i-tests-on-lm-models"><i class="fa fa-check"></i><b>10.3.5</b> Moran’s I tests on <code>lm</code> models</a></li>
<li class="chapter" data-level="10.3.6" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#morans-i-tests-on-glm-models"><i class="fa fa-check"></i><b>10.3.6</b> Moran’s I tests on <code>glm</code> models</a></li>
<li class="chapter" data-level="10.3.7" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#mapping-glm-residuals"><i class="fa fa-check"></i><b>10.3.7</b> Mapping <code>glm</code> residuals</a></li>
<li class="chapter" data-level="10.3.8" data-path="spatial-regression-i.html"><a href="spatial-regression-i.html#final-words"><i class="fa fa-check"></i><b>10.3.8</b> Final words</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html"><i class="fa fa-check"></i><b>11</b> Spatial Regression II</a>
<ul>
<li class="chapter" data-level="11.1" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-learning-objectives"><i class="fa fa-check"></i><b>11.1</b> w11 Learning objectives</a></li>
<li class="chapter" data-level="11.2" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-additional-resources"><i class="fa fa-check"></i><b>11.2</b> w11 Additional Resources</a></li>
<li class="chapter" data-level="11.3" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>11.3</b> w11 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="11.4" data-path="spatial-regression-ii.html"><a href="spatial-regression-ii.html#w11-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>11.4</b> w11 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html"><i class="fa fa-check"></i><b>12</b> Spatial Regression III</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-learning-objectives"><i class="fa fa-check"></i><b>12.1</b> w12 Learning objectives</a></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-additional-resources"><i class="fa fa-check"></i><b>12.2</b> w12 Additional Resources</a></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>12.3</b> w12 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="12.4" data-path="spatial-regression-iii.html"><a href="spatial-regression-iii.html#w12-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>12.4</b> w12 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="wrap-up-project.html"><a href="wrap-up-project.html"><i class="fa fa-check"></i><b>13</b> Wrap-up &amp; Project</a>
<ul>
<li class="chapter" data-level="13.1" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-learning-objectives"><i class="fa fa-check"></i><b>13.1</b> w13 Learning objectives</a></li>
<li class="chapter" data-level="13.2" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-additional-resources"><i class="fa fa-check"></i><b>13.2</b> w13 Additional Resources</a></li>
<li class="chapter" data-level="13.3" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-spatial-thinking-in-epidemiology"><i class="fa fa-check"></i><b>13.3</b> w13 Spatial Thinking in Epidemiology</a></li>
<li class="chapter" data-level="13.4" data-path="wrap-up-project.html"><a href="wrap-up-project.html#w13-spatial-analysis-in-epidemiology"><i class="fa fa-check"></i><b>13.4</b> w13 Spatial Analysis in Epidemiology</a></li>
</ul></li>
<li class="part"><span><b>III Appendices</b></span></li>
<li class="chapter" data-level="14" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html"><i class="fa fa-check"></i><b>14</b> Tips for reproducibility in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="locating-spatial-epidemiology.html"><a href="locating-spatial-epidemiology.html#additional-resources"><i class="fa fa-check"></i>Additional Resources</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflows-to-enhance-reproducibility"><i class="fa fa-check"></i>Workflows to enhance reproducibility</a>
<ul>
<li><a href="tips-for-reproducibility-in-r.html#using-projects-in-r">Using Projects in <code>R</code></a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#understanding-directory-and-file-path-names-in-r">Understanding directory and file path names in <code>R</code></a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-location-within-the-working-directory"><i class="fa fa-check"></i>Specify a location within the working directory</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#specify-a-relative-location-outside-the-working-directory"><i class="fa fa-check"></i>Specify a relative location outside the working directory</a></li>
</ul></li>
<li><a href="tips-for-reproducibility-in-r.html#why-r-notebooks">Why <code>R Notebooks</code>?</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#what-you-need-to-know"><i class="fa fa-check"></i>What you need to know</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#important-r-notebook-functions"><i class="fa fa-check"></i>Important R Notebook functions</a>
<ul>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#the-yaml"><i class="fa fa-check"></i>The YAML</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#typing-text"><i class="fa fa-check"></i>Typing text</a></li>
<li><a href="tips-for-reproducibility-in-r.html#adding-r-code">Adding <code>R</code> Code</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#making-tables"><i class="fa fa-check"></i>Making tables</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#workflow"><i class="fa fa-check"></i>Workflow</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#optional-functions"><i class="fa fa-check"></i>Optional functions</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#customizing-your-yaml"><i class="fa fa-check"></i>Customizing your YAML</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#simple-formatting-of-your-notebook"><i class="fa fa-check"></i>Simple formatting of your Notebook</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#text-formatting"><i class="fa fa-check"></i>Text formatting</a></li>
<li class="chapter" data-level="" data-path="tips-for-reproducibility-in-r.html"><a href="tips-for-reproducibility-in-r.html#final-note"><i class="fa fa-check"></i>Final Note</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sf-overview.html"><a href="sf-overview.html"><i class="fa fa-check"></i><b>15</b> Tips for working with <code>sf</code> data class</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sf-overview.html"><a href="sf-overview.html#st_set_geom"><i class="fa fa-check"></i><b>15.1</b> <code>st_set_geom()</code></a></li>
<li class="chapter" data-level="15.2" data-path="sf-overview.html"><a href="sf-overview.html#st-as-sf"><i class="fa fa-check"></i><b>15.2</b> <code>st_as_sf()</code></a></li>
<li class="chapter" data-level="15.3" data-path="sf-overview.html"><a href="sf-overview.html#st_crs"><i class="fa fa-check"></i><b>15.3</b> <code>st_crs()</code></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>16</b> Tips for using <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="16.1" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>16.1</b> <code>select()</code></a></li>
<li class="chapter" data-level="16.2" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>16.2</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="16.3" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>16.3</b> <code>filter()</code></a></li>
<li class="chapter" data-level="16.4" data-path="dplyr.html"><a href="dplyr.html#arrange"><i class="fa fa-check"></i><b>16.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="16.5" data-path="dplyr.html"><a href="dplyr.html#pipe-operator"><i class="fa fa-check"></i><b>16.5</b> <code>%&gt;%</code> Pipe operator</a></li>
<li class="chapter" data-level="16.6" data-path="dplyr.html"><a href="dplyr.html#group_by-and-summarise"><i class="fa fa-check"></i><b>16.6</b> <code>group_by()</code> and <code>summarise()</code></a></li>
<li class="chapter" data-level="16.7" data-path="dplyr.html"><a href="dplyr.html#join"><i class="fa fa-check"></i><b>16.7</b> <code>join()</code></a></li>
<li class="chapter" data-level="16.8" data-path="dplyr.html"><a href="dplyr.html#pivot_"><i class="fa fa-check"></i><b>16.8</b> Reshaping (transposing) data</a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="dplyr.html"><a href="dplyr.html#pivot_longer-for-going-from-wide-to-long"><i class="fa fa-check"></i><b>16.8.1</b> <code>pivot_longer()</code> for going from wide to long</a></li>
<li class="chapter" data-level="16.8.2" data-path="dplyr.html"><a href="dplyr.html#pivot_wider"><i class="fa fa-check"></i><b>16.8.2</b> <code>pivot_wider()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="intro-tmap.html"><a href="intro-tmap.html"><i class="fa fa-check"></i><b>17</b> Tips for using <code>tmap</code></a>
<ul>
<li class="chapter" data-level="17.1" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-mode"><i class="fa fa-check"></i><b>17.1</b> <code>tmap</code> mode</a></li>
<li class="chapter" data-level="17.2" data-path="intro-tmap.html"><a href="intro-tmap.html#qtm"><i class="fa fa-check"></i><b>17.2</b> Quick maps: <code>qtm()</code></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-polygons"><i class="fa fa-check"></i><b>17.2.1</b> Customizing <code>qtm()</code> for polygons</a></li>
<li class="chapter" data-level="17.2.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-lines"><i class="fa fa-check"></i><b>17.2.2</b> Customizing <code>qtm()</code> for lines</a></li>
<li class="chapter" data-level="17.2.3" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-qtm-for-points"><i class="fa fa-check"></i><b>17.2.3</b> Customizing <code>qtm()</code> for points</a></li>
<li class="chapter" data-level="17.2.4" data-path="intro-tmap.html"><a href="intro-tmap.html#finding-valid-color-options"><i class="fa fa-check"></i><b>17.2.4</b> Finding valid color options</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="intro-tmap.html"><a href="intro-tmap.html#building-maps-with-tmap"><i class="fa fa-check"></i><b>17.3</b> Building maps with <code>tmap</code></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="intro-tmap.html"><a href="intro-tmap.html#building-blocks-in-tmap"><i class="fa fa-check"></i><b>17.3.1</b> Building blocks in <code>tmap</code></a></li>
<li class="chapter" data-level="17.3.2" data-path="intro-tmap.html"><a href="intro-tmap.html#customizing-text-on-maps"><i class="fa fa-check"></i><b>17.3.2</b> Customizing text on maps</a></li>
<li class="chapter" data-level="17.3.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-two-or-more-spatial-objects-in-one-map"><i class="fa fa-check"></i><b>17.3.3</b> Adding two or more spatial objects in one map</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-layout-and-map-elements"><i class="fa fa-check"></i><b>17.4</b> Controlling layout and map elements</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="intro-tmap.html"><a href="intro-tmap.html#understanding-the-graphic-space-in-tmap"><i class="fa fa-check"></i><b>17.4.1</b> Understanding the graphic space in <code>tmap</code></a></li>
<li class="chapter" data-level="17.4.2" data-path="intro-tmap.html"><a href="intro-tmap.html#controlling-map-layout"><i class="fa fa-check"></i><b>17.4.2</b> Controlling map layout</a></li>
<li class="chapter" data-level="17.4.3" data-path="intro-tmap.html"><a href="intro-tmap.html#adding-map-elements"><i class="fa fa-check"></i><b>17.4.3</b> Adding map elements</a></li>
<li class="chapter" data-level="17.4.4" data-path="intro-tmap.html"><a href="intro-tmap.html#change-the-global-style-of-a-map"><i class="fa fa-check"></i><b>17.4.4</b> Change the global style of a map</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="intro-tmap.html"><a href="intro-tmap.html#making-small-multiple-maps"><i class="fa fa-check"></i><b>17.5</b> Making small-multiple maps</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-as-a-vector-of-variables"><i class="fa fa-check"></i><b>17.5.1</b> Small multiples as a vector of variables</a></li>
<li class="chapter" data-level="17.5.2" data-path="intro-tmap.html"><a href="intro-tmap.html#tmap-facet"><i class="fa fa-check"></i><b>17.5.2</b> Small multiples with facets</a></li>
<li class="chapter" data-level="17.5.3" data-path="intro-tmap.html"><a href="intro-tmap.html#facets-for-time-series"><i class="fa fa-check"></i><b>17.5.3</b> Facets for time-series</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="intro-tmap.html"><a href="intro-tmap.html#small-multiples-with-tmap_arrange"><i class="fa fa-check"></i><b>17.6</b> Small multiples with <code>tmap_arrange()</code></a></li>
<li class="chapter" data-level="17.7" data-path="intro-tmap.html"><a href="intro-tmap.html#summarizing-small-multiples"><i class="fa fa-check"></i><b>17.7</b> Summarizing small multiples</a></li>
<li class="chapter" data-level="17.8" data-path="intro-tmap.html"><a href="intro-tmap.html#saving-maps"><i class="fa fa-check"></i><b>17.8</b> Saving maps</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EPI 563: Spatial Epidemiology, Fall 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1" number="16">
<h1><span class="header-section-number">Week 16</span> Tips for using <code>dplyr</code></h1>
<p>Here are a few handy resources with more detail on wrangling with <code>dplyr</code> and <code>tidyr</code>:</p>
<ul>
<li><a href="https://dplyr.tidyverse.org/"><code>dplyr</code> overview</a></li>
<li><a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling cheat sheet</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">Data transformation cheat sheet</a></li>
</ul>
<p>As is the case in many software packages, there is always more than one way to get something done in <code>R</code>! Base-R tools can accomplish all kinds of tasks, but sometimes they are cumbersome and inefficient. Because most of our use of <code>R</code> as epidemiologists is focused on the tools of <em>data science</em>, you might find the diverse and continually evolving <code>tidyverse</code> a great toolbox to explore. Originated by Hadley Wickham (founder of RSTudio), the packages constituting the <code>tidyverse</code> are now contributed by lots of different people. What they have in common is an interest in handling data in <strong>tidy</strong> ways. <a href="https://r4ds.had.co.nz/">R for Data Science</a> is an authoritative guide to <em>tidy</em> data, and many of the tools constituting the <code>tidyverse</code> including <code>ggplot2</code>, <code>dplyr</code> and more.</p>
<p>This appendix is a very brief introduction to the <code>dplyr</code> package which is a set of data manipulation functions. In other words it is the epidemiologists’ go-to package for data manipulation, recoding, and preparation in <code>R</code>.</p>
<p>There are two high-level observations about how we will use <code>dplyr</code> this semester:</p>
<ol style="list-style-type: decimal">
<li><code>dplyr</code> functions can be thought of as <strong>verbs</strong>. That means each one is a tool to <em>act on</em> your data, producing a change. So your question is <em>“what do I want to change?”</em></li>
<li>Functions in <code>dplyr</code> (and in many other parts of the <code>tidyverse</code> for that matter) can be stand alone code. Or alternatively they can be <em>chained together in a sequence</em>. This chaining (called <em>piping</em> because the tool to connect or chain steps is called a pipe and looks like this: <code>%&gt;%</code>) can make your code both easier for humans to read, and also helps run a sequence of steps more efficiently.</li>
</ol>
<p>For the examples below, I will use the Georgia motor vehicle crash mortality dataset where the unit of observation (e.g. the content of one row of data) is a Georgia county, and the columns are variable names. This dataset is also explicitly <em>spatial</em> meaning that it includes geography information regarding the boundaries of each county, contained with the <code>geom</code> column, as is typical for <code>sf</code> class data in <code>R</code>.</p>
<p>Here is what the first few rows of the dataset looks like (minus the <code>geom</code> column):</p>
<pre><code>## Reading layer `ga_mvc&#39; from data source `C:\Users\mkram02\Box\SpatialEpi-2020\DATA\GA_MVC\ga_mvc.gpkg&#39; using driver `GPKG&#39;
## Simple feature collection with 159 features and 17 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -85.60516 ymin: 30.35785 xmax: -80.83973 ymax: 35.00066
## geographic CRS: WGS 84</code></pre>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-301">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-301">TABLE 16.1: </span> </caption><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">variable</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">County</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCDEATHS_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCDEATHS_14</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCDEATH_17</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">TPOP_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">TPOP_14</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">TPOP_17</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NCHS_RURAL_CODE_2013</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">nchs_code</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rural</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_14</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_17</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.5e+03&nbsp;</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">10</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.78e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.85e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.85e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Non-core</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">21.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">54&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">875&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.1e+03&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.22e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.34e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Non-core</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">61.8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13005</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Bacon County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">945&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Bacon County</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.06e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.13e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.13e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Non-core</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">66.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">44.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13007</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Baker County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">390&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Baker County</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.97e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.26e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.2e+03&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Small metro</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.2</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13009</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Baldwin County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.94e+03</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Baldwin County</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.63e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.59e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.49e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Micropolitan</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">17.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">28.9</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13011</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Banks County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">B00001_001</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.77e+03</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Banks County</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.67e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.83e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.86e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Non-core</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">24&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">43.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">32.2</td></tr>
</table>

<div id="select" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> <code>select()</code></h2>
<p>The first <em>verb</em> of <code>dplyr</code> is called <code>select()</code> and it is useful when you want to remove or <em>select</em> specific columns/variables. For instance, as mentioned this dataset has 17 attribute columns plus the <code>geom</code> column. But perhaps we only need three variables, and we decided it would be easier to exclude the unneeded variables? Then we can <code>select()</code> those we want (or inversely we can select those we <strong>don’t want</strong>).</p>
<p>There are three useful tips on using <code>select()</code> with spatial data:</p>
<ol style="list-style-type: decimal">
<li>To select variables <em>to keep</em> simply list them (e.g. <code>select(data, var1, var2, var3)</code>)</li>
<li>If it is easier to only <em>omit</em> specific variables (e.g .perhaps you have 100 variables and you only want to drop 3), place a negative sign before the name (e.g. <code>select(data, -var5, -var6)</code>).</li>
<li>Finally, something specific to working with <code>sf</code> spatial data is that the geometry column (typically named <code>geom</code> or <code>geometry</code>) is <strong>sticky</strong>. That means that it’s hard to get rid of it. That’s actually a good thing. You usually want the geometry to <strong>stick</strong> with the attribute data. But occasionally you might want to convert you <em>spatial</em> <code>sf</code> data object into an <em>aspatial</em> <code>data.frame</code>. To do this you must first set the geometry to be null like this: <code>aspatial.df &lt;- st_set_geometry(spatial.df, NULL)</code>. <a href="sf-overview.html#sf-overview">See additional info here</a>.</li>
</ol>
<p>Let’s do that with the motor vehicle crash data.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="dplyr.html#cb312-1"></a><span class="co"># First we read in the dataset, which is stored as a geopackage</span></span>
<span id="cb312-2"><a href="dplyr.html#cb312-2"></a>mvc &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;GA_MVC/ga_mvc.gpkg&#39;</span>)</span>
<span id="cb312-3"><a href="dplyr.html#cb312-3"></a></span>
<span id="cb312-4"><a href="dplyr.html#cb312-4"></a><span class="co"># Look at column names</span></span>
<span id="cb312-5"><a href="dplyr.html#cb312-5"></a><span class="kw">names</span>(mvc)</span>
<span id="cb312-6"><a href="dplyr.html#cb312-6"></a></span>
<span id="cb312-7"><a href="dplyr.html#cb312-7"></a><span class="co"># FOr this example we do not want the geom column because it is too big to view</span></span>
<span id="cb312-8"><a href="dplyr.html#cb312-8"></a>mvc2 &lt;-<span class="st"> </span><span class="kw">st_set_geometry</span>(mvc, <span class="ot">NULL</span>)</span>
<span id="cb312-9"><a href="dplyr.html#cb312-9"></a></span>
<span id="cb312-10"><a href="dplyr.html#cb312-10"></a><span class="co"># Creating a new object with only 4 attributes</span></span>
<span id="cb312-11"><a href="dplyr.html#cb312-11"></a>mvc2 &lt;-<span class="st"> </span><span class="kw">select</span>(mvc2, GEOID, NAME, rural, MVCRATE_<span class="dv">05</span>, MVCRATE_<span class="dv">17</span>)</span>
<span id="cb312-12"><a href="dplyr.html#cb312-12"></a></span>
<span id="cb312-13"><a href="dplyr.html#cb312-13"></a><span class="co"># look at column names</span></span>
<span id="cb312-14"><a href="dplyr.html#cb312-14"></a><span class="kw">names</span>(mvc2)</span></code></pre></div>
<pre><code>##  [1] &quot;GEOID&quot;                &quot;NAME&quot;                 &quot;variable&quot;            
##  [4] &quot;estimate&quot;             &quot;County&quot;               &quot;MVCDEATHS_05&quot;        
##  [7] &quot;MVCDEATHS_14&quot;         &quot;MVCDEATH_17&quot;          &quot;TPOP_05&quot;             
## [10] &quot;TPOP_14&quot;              &quot;TPOP_17&quot;              &quot;NCHS_RURAL_CODE_2013&quot;
## [13] &quot;nchs_code&quot;            &quot;rural&quot;                &quot;MVCRATE_05&quot;          
## [16] &quot;MVCRATE_14&quot;           &quot;MVCRATE_17&quot;           &quot;geom&quot;</code></pre>
<pre><code>## [1] &quot;GEOID&quot;      &quot;NAME&quot;       &quot;rural&quot;      &quot;MVCRATE_05&quot; &quot;MVCRATE_17&quot;</code></pre>
</div>
<div id="mutate" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> <code>mutate()</code></h2>
<p>Another frequently needed <em>verb</em> is called <code>mutate()</code> and as you might guess it <em>changes</em> your data. Specifically <code>mutate()</code> is a function for creating a new variable, possibly as a recode of an older variable. The <code>mvc</code> data object has 159 rows (one each for n=159 counties).</p>
<p>Let’s imagine that we wanted to create a map that illustrated the magnitude of the <strong>change</strong> in the rate of death from motor vehicle crashes between 2005 and 2017. To do this we want to create two new variables that we will name <code>delta_mr_abs</code> (the <em>absolute</em> difference in rates) and <code>delta_mr_rel</code> (the <em>relative</em> diference in rates).</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="dplyr.html#cb315-1"></a><span class="co"># Now we make a new object called mvc2</span></span>
<span id="cb315-2"><a href="dplyr.html#cb315-2"></a>mvc3 &lt;-<span class="st"> </span><span class="kw">mutate</span>(mvc2, </span>
<span id="cb315-3"><a href="dplyr.html#cb315-3"></a>               <span class="dt">delta_mr_abs =</span> MVCRATE_<span class="dv">05</span> <span class="op">-</span><span class="st"> </span>MVCRATE_<span class="dv">17</span>,</span>
<span id="cb315-4"><a href="dplyr.html#cb315-4"></a>               <span class="dt">delta_mr_rel =</span> MVCRATE_<span class="dv">05</span> <span class="op">/</span><span class="st"> </span>MVCRATE_<span class="dv">17</span>)</span></code></pre></div>
<p>If you look at the help documentation for <code>mutate()</code> you’ll see that the first argument is the input dataset, in this case <code>mvc</code>. Then anywhere from one to a zillion different <em>‘recode’</em> steps can be included inside the parentheses, each separated by a comma. Above, we created two new variables, one representing the <em>absolute</em> and the other representing the <em>relative</em> difference in rates between the two years.</p>
<p>We can look at the first few rows of selected columns to see the new variables:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="dplyr.html#cb316-1"></a><span class="kw">head</span>(mvc3)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-305">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-305">TABLE 16.2: </span> </caption><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rural</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_17</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_abs</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_rel</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">54&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-31.5&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.417</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">61.8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25.8&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.72&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13005</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Bacon County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">66.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">66.3&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Inf&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13007</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Baker County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-6.04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.807</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13009</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Baldwin County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">28.9</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-16&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.448</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13011</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Banks County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">24&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">32.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-8.22</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.745</td></tr>
</table>

</div>
<div id="filter" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> <code>filter()</code></h2>
<p>While <code>select()</code> above was about choosing which <em>columns</em> you keep or drop, <code>filter()</code> is about choosing which <em>rows</em> you keep or drop. If you are more familiar with SAS, <code>filter()</code> does what an <code>if</code> or <code>where</code> statement might do.</p>
<p>Imagine we wanted to only map the <em>urban counties</em>, and omit the rural counties. We could do this be defining a filtering rule. A rule is any logical statement (e.g. a relationship that can be tested in the data and return <code>TRUE</code> or <code>FALSE</code>). Here we create a new dataset, <code>mvc4</code> that is created from <code>mvc3</code> but is restricted only to <code>non-Rural</code> counties:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="dplyr.html#cb317-1"></a>mvc4 &lt;-<span class="st"> </span><span class="kw">filter</span>(mvc3, rural <span class="op">==</span><span class="st"> &#39;non-Rural&#39;</span>)</span>
<span id="cb317-2"><a href="dplyr.html#cb317-2"></a></span>
<span id="cb317-3"><a href="dplyr.html#cb317-3"></a></span>
<span id="cb317-4"><a href="dplyr.html#cb317-4"></a><span class="kw">dim</span>(mvc3) <span class="co"># dimensions (rows, columns) of the mvc3 object</span></span></code></pre></div>
<pre><code>## [1] 159   7</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="dplyr.html#cb319-1"></a><span class="kw">dim</span>(mvc4) <span class="co"># dimensions (rows, columns) of the restricted mvc4 object</span></span></code></pre></div>
<pre><code>## [1] 102   7</code></pre>
<p>As you can see the original object (<code>mvc3</code>) had 159 rows, while the <em>filtered</em> object (<code>mvc4</code>) has only 102, reflecting the number of non-Rural counties in Georgia.</p>
</div>
<div id="arrange" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> <code>arrange()</code></h2>
<p>Occasionally you might want to sort a dataset, perhaps to find the lowest or highest values of a variable, or to group like values together. Sorting with <code>dplyr</code> uses the <code>arrange()</code> verb. By default, data is <em>arranged</em> in ascending order (either numberical or alphabetical for character variables), but you can also choose descending order as below:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="dplyr.html#cb321-1"></a>mvc5 &lt;-<span class="st"> </span><span class="kw">arrange</span>(mvc3, <span class="kw">desc</span>(MVCRATE_<span class="dv">17</span>))</span>
<span id="cb321-2"><a href="dplyr.html#cb321-2"></a></span>
<span id="cb321-3"><a href="dplyr.html#cb321-3"></a><span class="kw">head</span>(mvc5)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-307">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-307">TABLE 16.3: </span> </caption><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rural</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_17</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_abs</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_rel</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13307</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Webster County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">38.8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">115&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-76.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.337</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13269</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Taylor County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">22.6</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">73.7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-51.1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.306</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13165</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Jenkins County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">47&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">57&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-10&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.824</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">22.5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">54&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-31.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.417</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13087</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Decatur County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">18.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">52.4</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-34.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.347</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13191</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">McIntosh County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">16.1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">49.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-33.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.325</td></tr>
</table>

</div>
<div id="pipe-operator" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> <code>%&gt;%</code> Pipe operator</h2>
<p>Everything we’ve done up until now has been one step at a time, and we created five different datasets to avoid overwriting our original. But one source of coding efficiency in <code>R</code> comes from the careful <em>chaining</em> or <em>piping</em> together of multiple steps.</p>
<p>While every verb above required an <em>input dataset</em> as the first argument, when we chain steps, the functions take the <em>output</em> of the previous step as the <em>input</em> for the current step. For example this code chunk does everything we did above in one step:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="dplyr.html#cb322-1"></a>mvc6 &lt;-<span class="st"> </span>mvc <span class="op">%&gt;%</span></span>
<span id="cb322-2"><a href="dplyr.html#cb322-2"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st">                             </span><span class="co"># remove geom column</span></span>
<span id="cb322-3"><a href="dplyr.html#cb322-3"></a><span class="st">  </span><span class="kw">select</span>(GEOID, NAME, rural, MVCRATE_<span class="dv">05</span>, MVCRATE_<span class="dv">17</span>) <span class="op">%&gt;%</span><span class="co"># select target variables</span></span>
<span id="cb322-4"><a href="dplyr.html#cb322-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delta_mr_abs =</span> MVCRATE_<span class="dv">05</span> <span class="op">-</span><span class="st"> </span>MVCRATE_<span class="dv">17</span>,        <span class="co"># recode variables</span></span>
<span id="cb322-5"><a href="dplyr.html#cb322-5"></a>        <span class="dt">delta_mr_rel =</span> MVCRATE_<span class="dv">05</span> <span class="op">/</span><span class="st"> </span>MVCRATE_<span class="dv">17</span>) <span class="op">%&gt;%</span></span>
<span id="cb322-6"><a href="dplyr.html#cb322-6"></a><span class="st">  </span><span class="kw">filter</span>(rural <span class="op">==</span><span class="st"> &#39;non-Rural&#39;</span>) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># filter (restrict) rows</span></span>
<span id="cb322-7"><a href="dplyr.html#cb322-7"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(MVCRATE_<span class="dv">17</span>))                             <span class="co"># sort by MVCRATE_17</span></span>
<span id="cb322-8"><a href="dplyr.html#cb322-8"></a></span>
<span id="cb322-9"><a href="dplyr.html#cb322-9"></a><span class="kw">dim</span>(mvc6)</span></code></pre></div>
<pre><code>## [1] 102   7</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="dplyr.html#cb324-1"></a><span class="kw">head</span>(mvc6)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-308">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-308">TABLE 16.4: </span> </caption><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rural</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_17</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_abs</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">delta_mr_rel</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13087</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Decatur County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">18.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">52.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-34.2&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.347</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13191</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">McIntosh County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">16.1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">49.6</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-33.5&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.325</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13033</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Burke County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">34.9</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">40&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-5.09</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.873</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13189</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">McDuffie County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">18.7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">37.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-18.5&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.502</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13055</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Chattooga County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">11.8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">36.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-24.6&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.324</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13227</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Pickens County, Georgia</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">29.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">34.8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-5.49</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.842</td></tr>
</table>

<p>In practice, it takes some experience to write a whole chain of steps that do what you want. I often go iteratively, adding one step at a time and checking that each step is doing what I expected.</p>
</div>
<div id="group_by-and-summarise" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> <code>group_by()</code> and <code>summarise()</code></h2>
<p>A <code>dplyr</code> verb that can be incredibly important for spatial epidemiology is the combination of <code>group_by()</code> with <code>summarise()</code>. These two are used to aggregate and summarize data. For instance if you had data arranged with individual persons as the unit of analysis (e.g. 1 person = 1 row of data), but you wanted to aggregate them so you got counts per census tract, you could use <code>group_by()</code> to arrange the rows into groups defined by census tract, and then use <code>summarise()</code> to do some calculation (e.g. count, mean, sum, etc) separately for each group.</p>
<p>An important feature of <code>sf</code> data objects when operated on by <code>dplyr</code> verbs, is that there is built in functionality to handle geography/geometry data. So for instance, imagine we wanted to create a map where we aggregated all of the <em>rural counties</em> and separately all of the <em>non-rural counties</em>.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="dplyr.html#cb325-1"></a>mvc7 &lt;-<span class="st"> </span>mvc <span class="op">%&gt;%</span></span>
<span id="cb325-2"><a href="dplyr.html#cb325-2"></a><span class="st">  </span><span class="kw">group_by</span>(rural) <span class="op">%&gt;%</span></span>
<span id="cb325-3"><a href="dplyr.html#cb325-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_mr_17 =</span> <span class="kw">mean</span>(MVCRATE_<span class="dv">17</span>))</span>
<span id="cb325-4"><a href="dplyr.html#cb325-4"></a></span>
<span id="cb325-5"><a href="dplyr.html#cb325-5"></a>mvc7 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-309">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-309">TABLE 16.5: </span> </caption><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rural</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">avg_mr_17</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">non-Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">18.8</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Rural</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">29.2</td></tr>
</table>

<p>As you can see (and as you might have predicted), the aggregation changed our dataset from 159 rows to 2 rows: one row for rural and one for non-rural. Let’s see what it did to the spatial data by first mapping the original data, and then mapping the aggregated data. Read <a href="intro-tmap.html#qtm">more about <code>qtm()</code></a>) and other <code>tmap</code> functions.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="dplyr.html#cb326-1"></a><span class="co"># Using the qtm() function from tmap to create map of original data</span></span>
<span id="cb326-2"><a href="dplyr.html#cb326-2"></a>m1 &lt;-<span class="st"> </span><span class="kw">qtm</span>(mvc, <span class="st">&#39;MVCRATE_17&#39;</span>)</span>
<span id="cb326-3"><a href="dplyr.html#cb326-3"></a></span>
<span id="cb326-4"><a href="dplyr.html#cb326-4"></a><span class="co"># Using the qtm() function from tmap package to create a map</span></span>
<span id="cb326-5"><a href="dplyr.html#cb326-5"></a>m2 &lt;-<span class="st"> </span><span class="kw">qtm</span>(mvc7, <span class="st">&#39;avg_mr_17&#39;</span>)</span>
<span id="cb326-6"><a href="dplyr.html#cb326-6"></a></span>
<span id="cb326-7"><a href="dplyr.html#cb326-7"></a><span class="kw">tmap_arrange</span>(m1, m2)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-310-1.png" width="672" /></p>

<div class="rmdwarning">
You may see a <em>message</em> in the <code>R</code> console when you run <code>group_by()</code> followed by <code>summarise()</code> that says something like <code>summarise() ungrouping output override with .groups argument</code>. What this is telling you is that <code>R</code> automatically <em>ungrouped</em> your data. More specifically it removed grouping by the <em>last <code>group_by()</code> variable, to avoid unintended consequences from persistent grouping. If you <code>group_by()</code> two or more variables it </em>only drops the last grouping*, so other grouping may persist. All grouping can be removed by adding <code>ungroup()</code> after the <code>summarise()</code>.
</div>
</div>
<div id="join" class="section level2" number="16.7">
<h2><span class="header-section-number">16.7</span> <code>join()</code></h2>
<p>Merging data is so common in epidemiology, but also prone to so many unintended consequences that it is important to pay attention to the options for successful merges or ‘<em>table joins</em>’ as they are called in the parlance of relational databases.</p>
<p>Because of the challenges with getting the desired output from a merge or <code>join()</code>, <code>dplyr</code> has a set of verbs including: <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join()</code> and more. Here is documentation of the <a href="https://dplyr.tidyverse.org/reference/join.html">many ways to join!</a></p>
<p>A join is simply a way to integrate or merge two tables when they have some common key or ID. For our purposes in this class I want to focus on several key features of joining that are important for spatial analysis.</p>
<p>For this explanation we will work with two separate files: an <em>aspatial <code>data.frame</code></em> with the motor vehicle crash data called <code>mvc.df</code>; and a <code>sf</code> object of all U.S. counties, called <code>us</code>. The unit of analysis in each is the county, there is a common ID or key variable in the county FIPS code (named <code>GEOID</code>), but they have a different number of rows:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="dplyr.html#cb327-1"></a><span class="kw">dim</span>(mvc.df)  <span class="co"># this is dimensions for the aspatial attribute data</span></span></code></pre></div>
<pre><code>## [1] 159  17</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="dplyr.html#cb329-1"></a><span class="kw">dim</span>(us)      <span class="co"># this is dimensions for the spatial county polygon sf data</span></span></code></pre></div>
<pre><code>## [1] 3220   10</code></pre>
<p>As expected, the <code>mvc.df</code> has the <span class="math inline">\(n=159\)</span> counties that makeup Georgia. However the spatial/geography information has <span class="math inline">\(n=3220\)</span> rows, corresponding to the number of U.S. counties and territories.</p>
<p>First, the difference between the <code>xxxx_join()</code> is how the two tables relate to one another. For most purposes a <code>left_join()</code> or <code>right_join()</code> will do the trick. Here is the difference: a <code>left_join()</code> <strong>starts with</strong> the first object and joins it to the second. In contrast the <code>right_join()</code> <strong>starts with</strong> the second object and joins it to the first. What does that mean?</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="dplyr.html#cb331-1"></a><span class="co"># left join, starting with mvc.df as the first object, us as the second</span></span>
<span id="cb331-2"><a href="dplyr.html#cb331-2"></a>test.left &lt;-<span class="st"> </span>mvc.df <span class="op">%&gt;%</span></span>
<span id="cb331-3"><a href="dplyr.html#cb331-3"></a><span class="st">  </span><span class="kw">left_join</span>(us, <span class="dt">by =</span> <span class="st">&#39;GEOID&#39;</span>)</span>
<span id="cb331-4"><a href="dplyr.html#cb331-4"></a></span>
<span id="cb331-5"><a href="dplyr.html#cb331-5"></a><span class="kw">dim</span>(test.left)</span></code></pre></div>
<pre><code>## [1] 159  26</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="dplyr.html#cb333-1"></a><span class="kw">class</span>(test.left)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="dplyr.html#cb335-1"></a><span class="co"># right join, starting with mvc.df as the first object</span></span>
<span id="cb335-2"><a href="dplyr.html#cb335-2"></a>test.right &lt;-<span class="st"> </span>us <span class="op">%&gt;%</span></span>
<span id="cb335-3"><a href="dplyr.html#cb335-3"></a><span class="st">  </span><span class="kw">left_join</span>(mvc.df, <span class="dt">by =</span> <span class="st">&#39;GEOID&#39;</span>)</span>
<span id="cb335-4"><a href="dplyr.html#cb335-4"></a></span>
<span id="cb335-5"><a href="dplyr.html#cb335-5"></a><span class="kw">dim</span>(test.right)</span></code></pre></div>
<pre><code>## [1] 3220   26</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="dplyr.html#cb337-1"></a><span class="kw">class</span>(test.right)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p><strong>What did we learn?</strong></p>
<ul>
<li>The number of rows in the output dataset is dictated by two things:</li>
<li>the order the objects are written (e.g. in this case <code>mvc.df</code> was always <em>first</em> and <code>us</code> was always <em>second</em>, contained within the <code>join()</code>)</li>
<li>the direction of the join. In a <code>left_join()</code> the merge <em>begins with</em> <code>mvc.df</code>, which limits the output to only 159 rows. In contrast with <code>right_join()</code> the merge <em>begins with</em> <code>us</code>, which limits the output to 3220 rows.</li>
<li>The class of the output data depends on which object was <em>first</em>. Notice that in the <code>left_join()</code>, because we started with an aspatial <code>data.frame</code>, the output is also an aspatial <code>data.frame</code> (although the <code>geom</code> column <strong>is now incorporated</strong>!). In contrast with the <code>right_join()</code> which put the <code>sf</code> object <code>us</code> first, the class was <code>sf</code>.</li>
</ul>
<p>This means that when merging or joining you should think about whether you want <em>all of the rows</em> of data to go to the output, or only some; and think about whether (or how) you can make the <code>sf</code> object be first.</p>
<p>In the scenario above, we only want <span class="math inline">\(n=159\)</span> rows, and thus want to exclude all of the non-Georgia counties. That means we must have <code>mvc.df</code> first. Therefore, we could <em>force</em> the object to be of class <code>sf</code> like this (<a href="sf-overview.html#st-as-sf">also see info here</a>):</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="dplyr.html#cb339-1"></a>test.left &lt;-<span class="st"> </span>mvc.df <span class="op">%&gt;%</span></span>
<span id="cb339-2"><a href="dplyr.html#cb339-2"></a><span class="st">  </span><span class="kw">left_join</span>(us, <span class="dt">by =</span> <span class="st">&#39;GEOID&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb339-3"><a href="dplyr.html#cb339-3"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span>
<span id="cb339-4"><a href="dplyr.html#cb339-4"></a></span>
<span id="cb339-5"><a href="dplyr.html#cb339-5"></a><span class="kw">dim</span>(test.left)</span></code></pre></div>
<pre><code>## [1] 159  26</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="dplyr.html#cb341-1"></a><span class="kw">class</span>(test.left)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p><strong>Joining when Key/ID variables have different names</strong></p>
<p>Sometimes we have a common variable, such as the county FIPS code, but the variable names are different. For example in the code below, the column storing the unique county ID for the <code>mvc.df</code> is named <code>GEOID</code>. However the column in the <code>sf</code> object <code>us</code> that stores the unique county ID is named <code>FIPS</code>. It is still possible to use the <code>join()</code> verbs by relating them (inside a <code>c()</code> concatenation) in the order in which the datasets are introduced.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="dplyr.html#cb343-1"></a><span class="co"># if us had the FIPS code stored in the column named &#39;FIPS&#39;</span></span>
<span id="cb343-2"><a href="dplyr.html#cb343-2"></a>test.left &lt;-<span class="st"> </span>mvc.df <span class="op">%&gt;%</span></span>
<span id="cb343-3"><a href="dplyr.html#cb343-3"></a><span class="st">  </span><span class="kw">left_join</span>(us, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;GEOID&#39;</span> =<span class="st"> &#39;FIPS&#39;</span>))</span></code></pre></div>
</div>
<div id="pivot_" class="section level2" number="16.8">
<h2><span class="header-section-number">16.8</span> Reshaping (transposing) data</h2>
<p>There are numerous other intermediate to advanced data manipulation options available in <code>dplyr</code> and the <code>tidyverse</code>, but most are outside of the scope of this course. One final verb that represents a more sophisticated kind of data change, is however useful in preparing spatial data. That is the tools to <strong>transpose</strong> or <strong>reshape</strong> a rectangular dataset from <em>wide</em> to <em>long</em> or vice versa. Transposing is useful when, for example, you have a column with a disease rate for each of several years (these data are <em>wide</em>), but you want a dataset where a single column contains the rate and a separate column indicates the year (these data are <em>long</em>). <a href="https://tidyr.tidyverse.org/articles/pivot.html">This article introduces the notion of <em>pivoting</em> data</a>; you can also review <a href="https://r4ds.had.co.nz/tidy-data.html#pivoting">this section in R for Data Science</a></p>
<p>Two related verbs help pivot <code>tidy</code> data one direction or the other:</p>
<div id="pivot_longer-for-going-from-wide-to-long" class="section level3" number="16.8.1">
<h3><span class="header-section-number">16.8.1</span> <code>pivot_longer()</code> for going from wide to long</h3>
<p>Reviewing the article linked in the previous paragraph (or searching the help documentation) will give you more detail. But as an example we will look at how to take our current <code>mvc</code> dataset, which contains the motor vehicle crash mortality rate for each county from three different years (2005, 2014, 2017) as separate columns (e.g. it is <em>wide</em>):</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="dplyr.html#cb344-1"></a><span class="co"># this code shows the first 6 rows (the head) of the relevant variables</span></span>
<span id="cb344-2"><a href="dplyr.html#cb344-2"></a>mvc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb344-3"><a href="dplyr.html#cb344-3"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span></span>
<span id="cb344-4"><a href="dplyr.html#cb344-4"></a><span class="st">  </span><span class="kw">select</span>(GEOID, NAME, MVCRATE_<span class="dv">05</span>, MVCRATE_<span class="dv">14</span>, MVCRATE_<span class="dv">17</span>) <span class="op">%&gt;%</span></span>
<span id="cb344-5"><a href="dplyr.html#cb344-5"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-318">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-318">TABLE 16.6: </span> </caption><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_05</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_14</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE_17</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">21.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">54&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">61.8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13005</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Bacon County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">66.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">44.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13007</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Baker County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.2</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13009</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Baldwin County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">17.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">28.9</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13011</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Banks County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">24&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">43.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">32.2</td></tr>
</table>

<p>For mapping a time-series it is often beneficial to have the data <strong>long</strong>, which is to say we want the data with a single column for <code>mvc_rate</code> and a separate column for <code>year</code>, and then we can choose to create a map for each subset (defined by year) of the data.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="dplyr.html#cb345-1"></a>mvc_long &lt;-<span class="st"> </span>mvc <span class="op">%&gt;%</span></span>
<span id="cb345-2"><a href="dplyr.html#cb345-2"></a><span class="st">  </span><span class="kw">select</span>(GEOID, NAME, MVCRATE_<span class="dv">05</span>, MVCRATE_<span class="dv">14</span>, MVCRATE_<span class="dv">17</span>) <span class="op">%&gt;%</span></span>
<span id="cb345-3"><a href="dplyr.html#cb345-3"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb345-4"><a href="dplyr.html#cb345-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">starts_with</span>(<span class="st">&quot;MVCRATE&quot;</span>),</span>
<span id="cb345-5"><a href="dplyr.html#cb345-5"></a>               <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb345-6"><a href="dplyr.html#cb345-6"></a>               <span class="dt">values_to =</span> <span class="st">&quot;mvc_rate&quot;</span>,</span>
<span id="cb345-7"><a href="dplyr.html#cb345-7"></a>               <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb345-8"><a href="dplyr.html#cb345-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="dv">2000</span> <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(year)) <span class="op">%&gt;%</span></span>
<span id="cb345-9"><a href="dplyr.html#cb345-9"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span></code></pre></div>
<p>First let’s look at the results, and then I’ll walk through each of the steps in the code chunk above:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="dplyr.html#cb346-1"></a>mvc_long <span class="op">%&gt;%</span></span>
<span id="cb346-2"><a href="dplyr.html#cb346-2"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span></span>
<span id="cb346-3"><a href="dplyr.html#cb346-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-320">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-320">TABLE 16.7: </span> </caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">year</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2e+03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.5</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.01e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">21.6</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.02e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">54&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2e+03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">61.8</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.01e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12.2</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.02e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36&nbsp;&nbsp;</td></tr>
</table>

<p>As you can see, we now have <strong>3 rows</strong> for Appling County (GEOID 13001): one for each of the three years, with different <code>MVCRATE</code> in each. That is a <em>long</em> dataset. So how did that code work? Here is a step-by-step of what that code chunk did:</p>
<ol style="list-style-type: decimal">
<li>The first step was to create a new object, <code>mvc_long</code> that will be the outcome of all of the steps piped together. The input to the pipe is the original dataset, <code>mvc</code>.</li>
<li>The use of <code>as_tibble()</code> is a current work around to an annoying <em>‘feature’</em> of the <code>pivot_*</code> functions and that is that they don’t play well with <code>sf</code> data classes. So when we use <code>as_tibble()</code> we are essentially removing the class designation, (making it a <code>tibble</code> which is a tidy object); importantly this is <em>different from</em> <code>st_set_geometry(NULL)</code> which actually omits the geometry column (e.g. <a href="#sf_overview">see additional detail here</a>).</li>
<li>I used <code>select()</code> to pull out only the variables of interest, although you could leave other variables if desired.</li>
<li><code>pivot_longer()</code> can be called in several ways. The way I call it here, I first specified <strong>which columns to pivot</strong> by defining the <code>cols =</code> argument to be all variables that <em>start with</em> the phrase <code>MVCRATE</code>. <code>starts_with()</code> is another utility function in <code>dplyr</code>. So this step told <code>R</code> that the columns I wanted changed were the three called <code>MVCRATE_05</code>, <code>MVCRATE_12</code> and <code>MVCRATE_17</code></li>
<li>The <code>names_to =</code> argument defines the column name <em>in the new dataset</em> that will delineate between the three variables (e.g. <code>MVCRATE_05</code>, etc). In our case we wanted the value to be the <strong>year</strong> not the word <code>MVCRATE_12</code>. To accomplish this we had to do some extra work:</li>
</ol>
<ul>
<li>First, note that we used the option <code>names_sep = '_'</code>. That is another utility function that says we want to break a string into parts wherever a designated separated (e.g. the underscore, <code>_</code>) occurs. So this will take the column name <code>MVCRATE_05</code> and break it at the underscore to return two parts: <code>MVCRATE</code> and <code>05</code>.</li>
<li>Because breaking it into two would produce <em>two answers</em>, we had to make <em>two variable names</em> in the <code>names_to =</code> to hold them. Thus <code>names_to = c(".value", "year")</code>. In other words the column labeled <code>.variable</code> will hold the value <code>MVCRATE</code> and the column <code>year</code> will hold the value <code>05</code></li>
<li><code>'.value'</code> is actually a special value in this instance. It is a way of designating that the first part was essentially <em>junk</em>. As such it will automatically be discarded.</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li><code>values_to = 'mvcrate'</code>. This is where we define the name in the <em>new dataset</em> that will hold the actual value (e.g. the MVC mortality rate itself.)</li>
<li>The <code>mutate()</code> step is just a way to take the year fragment (e.g. <code>05</code>, <code>12</code>, <code>17</code>) and make it into calendar years by first making it numeric, and then simply adding 2000.</li>
<li>The final step, <code>st_as_sf()</code> is because all of the manipulations above actually removed the objects designation as class <code>sf</code>. Importantly, it DID NOT remove the <code>geom</code> column, but the object is not recognized (e.g. by <code>tmap</code>) as a spatial object. So <code>st_as_sf()</code> simply declares that it is in fact <code>sf</code>.</li>
</ol>
<p>The best way to wrap your head around this is to start trying to reshape or transpose data you have on hand. You may need to look for additional help or examples online, but with time it will become more intuitive.</p>
<p>To see <em>why</em> you might have gone through all of that work, we will use the <code>tm_facets()</code> (read more about<a href="intro-tmap.html#tmap-facet"><code>tmap_facets()</code> here</a>).</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="dplyr.html#cb347-1"></a><span class="kw">tm_shape</span>(mvc_long) <span class="op">+</span></span>
<span id="cb347-2"><a href="dplyr.html#cb347-2"></a><span class="st">  </span></span>
<span id="cb347-3"><a href="dplyr.html#cb347-3"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="st">&#39;MVCRATE&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb347-4"><a href="dplyr.html#cb347-4"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb347-5"><a href="dplyr.html#cb347-5"></a><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&#39;year&#39;</span>)</span></code></pre></div>
<p><img src="EPI563-SpatialEPI_files/figure-html/unnamed-chunk-321-1.png" width="672" /></p>
</div>
<div id="pivot_wider" class="section level3" number="16.8.2">
<h3><span class="header-section-number">16.8.2</span> <code>pivot_wider()</code></h3>
<p>Of course it is also possible to go the other way, from long to wide. This often is easier. Here is some code to return to our original shape:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="dplyr.html#cb348-1"></a>mvc_wide &lt;-<span class="st"> </span>mvc_long <span class="op">%&gt;%</span></span>
<span id="cb348-2"><a href="dplyr.html#cb348-2"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb348-3"><a href="dplyr.html#cb348-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">my_var =</span> <span class="kw">paste0</span>(<span class="st">&#39;MVCRATE &#39;</span>, year)) <span class="op">%&gt;%</span></span>
<span id="cb348-4"><a href="dplyr.html#cb348-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>year) <span class="op">%&gt;%</span></span>
<span id="cb348-5"><a href="dplyr.html#cb348-5"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> my_var,</span>
<span id="cb348-6"><a href="dplyr.html#cb348-6"></a>              <span class="dt">values_from =</span> MVCRATE) <span class="op">%&gt;%</span></span>
<span id="cb348-7"><a href="dplyr.html#cb348-7"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span></code></pre></div>
<p>Take a look at the output:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="dplyr.html#cb349-1"></a>mvc_wide <span class="op">%&gt;%</span></span>
<span id="cb349-2"><a href="dplyr.html#cb349-2"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span></span>
<span id="cb349-3"><a href="dplyr.html#cb349-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-323">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-323">TABLE 16.8: </span> </caption><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">GEOID</th><th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">NAME</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE 2005</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE 2014</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">MVCRATE 2017</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13001</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Appling County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">21.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">54&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13003</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Atkinson County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">61.8</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12.2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13005</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Bacon County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">66.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">44.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13007</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Baker County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.2</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13009</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">Baldwin County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">13&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">17.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">28.9</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13011</td><td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Banks County, Georgia</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">24&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">43.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">32.2</td></tr>
</table>

<p>It appears that we have returned to <em>1 row per county</em>. So what were all of those steps?</p>
<ol style="list-style-type: decimal">
<li>Once again, we start by removing the class designation <code>sf</code> but calling <code>as_tibble()</code></li>
<li><code>mutate()</code> is called to re-create a variable that will become the column names.</li>
<li>We no longer need the old <code>year</code> variable so I omit it with <code>select(-year)</code></li>
<li>Finally the <code>pivot_wider()</code> call has arguments defining which <em>current</em> variable contains the informatino that will be the <em>new</em> column name (<code>names_from =</code>) and which <em>current</em> variable contains the information that will population the cells within that column (<code>values_from =</code>).</li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sf-overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro-tmap.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mkram01/EPI563-SpatialEPI/edit/master/85-intro-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"toc_depth": 2,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
